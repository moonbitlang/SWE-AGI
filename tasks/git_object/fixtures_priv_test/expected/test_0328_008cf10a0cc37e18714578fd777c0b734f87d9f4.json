{
  "content": {
    "base64": "IyEvYmluL3NoCiMKIyBDb3B5cmlnaHQgKGMpIDIwMDYgSnVuaW8gQyBIYW1hbm8KIwoKdGVzdF9kZXNjcmlwdGlvbj0nQmluYXJ5IGRpZmYgYW5kIGFwcGx5CicKCi4gLi90ZXN0LWxpYi5zaAoKdGVzdF9leHBlY3Rfc3VjY2VzcyAncHJlcGFyZSByZXBvc2l0b3J5JyBcCgknZWNobyBBSVQgPmEgJiYgZWNobyBCSVQgPmIgJiYgZWNobyBDSVQgPmMgJiYgZWNobyBESVQgPmQgJiYKCSBnaXQgdXBkYXRlLWluZGV4IC0tYWRkIGEgYiBjIGQgJiYKCSBlY2hvIGdpdCA+YSAmJgoJIGNhdCAiJFRFU1RfRElSRUNUT1JZIi90ZXN0LWJpbmFyeS0xLnBuZyA+YiAmJgoJIGVjaG8gZ2l0ID5jICYmCgkgY2F0IGIgYiA+ZCcKCmNhdCA+IGV4cGVjdGVkIDw8XEVPRgogYSB8ICAgIDIgKy0KIGIgfCAgQmluCiBjIHwgICAgMiArLQogZCB8ICBCaW4KIDQgZmlsZXMgY2hhbmdlZCwgMiBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQpFT0YKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZGlmZiB3aXRob3V0IC0tYmluYXJ5JyBcCgknZ2l0IGRpZmYgfCBnaXQgYXBwbHkgLS1zdGF0IC0tc3VtbWFyeSA+Y3VycmVudCAmJgoJIHRlc3RfaTE4bmNtcCBleHBlY3RlZCBjdXJyZW50JwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZGlmZiB3aXRoIC0tYmluYXJ5JyBcCgknZ2l0IGRpZmYgLS1iaW5hcnkgfCBnaXQgYXBwbHkgLS1zdGF0IC0tc3VtbWFyeSA+Y3VycmVudCAmJgoJIHRlc3RfaTE4bmNtcCBleHBlY3RlZCBjdXJyZW50JwoKIyBhcHBseSBuZWVkcyB0byBiZSBhYmxlIHRvIHNraXAgdGhlIGJpbmFyeSBtYXRlcmlhbCBjb3JyZWN0bHkKIyBpbiBvcmRlciB0byByZXBvcnQgdGhlIGxpbmUgbnVtYmVyIG9mIGEgY29ycnVwdCBwYXRjaC4KdGVzdF9leHBlY3Rfc3VjY2VzcyAnYXBwbHkgZGV0ZWN0aW5nIGNvcnJ1cHQgcGF0Y2ggY29ycmVjdGx5JyBcCgknZ2l0IGRpZmYgfCBzZWQgLWUgJ3MvLUNJVC94Q0lULycgPmJyb2tlbiAmJgoJIGlmIGdpdCBhcHBseSAtLXN0YXQgLS1zdW1tYXJ5IGJyb2tlbiAyPmRldGVjdGVkCgkgdGhlbgoJCWVjaG8gdW5oYXBweSAtIHNob3VsZCBoYXZlIGRldGVjdGVkIGFuIGVycm9yCgkJKGV4aXQgMSkKCSBlbHNlCgkJZWNobyBoYXBweQoJIGZpICYmCgkgZGV0ZWN0ZWQ9YGNhdCBkZXRlY3RlZGAgJiYKCSBkZXRlY3RlZD1gZXhwciAiJGRldGVjdGVkIiA6ICJmYXRhbC4qYXQgbGluZSBcXChbMC05XSpcXClcJCJgICYmCgkgZGV0ZWN0ZWQ9YHNlZCAtbmUgIiR7ZGV0ZWN0ZWR9cCIgYnJva2VuYCAmJgoJIHRlc3QgIiRkZXRlY3RlZCIgPSB4Q0lUJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYXBwbHkgZGV0ZWN0aW5nIGNvcnJ1cHQgcGF0Y2ggY29ycmVjdGx5JyBcCgknZ2l0IGRpZmYgLS1iaW5hcnkgfCBzZWQgLWUgJ3MvLUNJVC94Q0lULycgPmJyb2tlbiAmJgoJIGlmIGdpdCBhcHBseSAtLXN0YXQgLS1zdW1tYXJ5IGJyb2tlbiAyPmRldGVjdGVkCgkgdGhlbgoJCWVjaG8gdW5oYXBweSAtIHNob3VsZCBoYXZlIGRldGVjdGVkIGFuIGVycm9yCgkJKGV4aXQgMSkKCSBlbHNlCgkJZWNobyBoYXBweQoJIGZpICYmCgkgZGV0ZWN0ZWQ9YGNhdCBkZXRlY3RlZGAgJiYKCSBkZXRlY3RlZD1gZXhwciAiJGRldGVjdGVkIiA6ICJmYXRhbC4qYXQgbGluZSBcXChbMC05XSpcXClcJCJgICYmCgkgZGV0ZWN0ZWQ9YHNlZCAtbmUgIiR7ZGV0ZWN0ZWR9cCIgYnJva2VuYCAmJgoJIHRlc3QgIiRkZXRlY3RlZCIgPSB4Q0lUJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnaW5pdGlhbCBjb21taXQnICdnaXQgY29tbWl0IC1hIC1tIGluaXRpYWwnCgojIFRyeSByZW1vdmFsIChiKSwgbW9kaWZpY2F0aW9uIChkKSwgYW5kIGNyZWF0aW9uIChlKS4KdGVzdF9leHBlY3Rfc3VjY2VzcyAnZGlmZi1pbmRleCB3aXRoIC0tYmluYXJ5JyBcCgknZWNobyBBSVQgPmEgJiYgbXYgYiBlICYmIGVjaG8gQ0lUID5jICYmIGNhdCBlID5kICYmCgkgZ2l0IHVwZGF0ZS1pbmRleCAtLWFkZCAtLXJlbW92ZSBhIGIgYyBkIGUgJiYKCSB0cmVlMD1gZ2l0IHdyaXRlLXRyZWVgICYmCgkgZ2l0IGRpZmYgLS1jYWNoZWQgLS1iaW5hcnkgPmN1cnJlbnQgJiYKCSBnaXQgYXBwbHkgLS1zdGF0IC0tc3VtbWFyeSBjdXJyZW50JwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYXBwbHkgYmluYXJ5IHBhdGNoJyBcCgknZ2l0IHJlc2V0IC0taGFyZCAmJgoJIGdpdCBhcHBseSAtLWJpbmFyeSAtLWluZGV4IDxjdXJyZW50ICYmCgkgdHJlZTE9YGdpdCB3cml0ZS10cmVlYCAmJgoJIHRlc3QgIiR0cmVlMSIgPSAiJHRyZWUwIicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2RpZmYgLS1uby1pbmRleCB3aXRoIGJpbmFyeSBjcmVhdGlvbicgJwoJZWNobyBRIHwgcV90b19udWwgPmJpbmFyeSAmJgoJKDogaGlkZSBlcnJvciBjb2RlIGZyb20gZGlmZiwgd2hpY2gganVzdCBpbmRpY2F0ZXMgZGlmZmVyZW5jZXMKCSBnaXQgZGlmZiAtLWJpbmFyeSAtLW5vLWluZGV4IC9kZXYvbnVsbCBiaW5hcnkgPmN1cnJlbnQgfHwKCSB0cnVlCgkpICYmCglybSBiaW5hcnkgJiYKCWdpdCBhcHBseSAtLWJpbmFyeSA8Y3VycmVudCAmJgoJZWNobyBRID5leHBlY3RlZCAmJgoJbnVsX3RvX3EgPGJpbmFyeSA+YWN0dWFsICYmCgl0ZXN0X2NtcCBleHBlY3RlZCBhY3R1YWwKJwoKdGVzdF9kb25lCg==",
    "text": "#!/bin/sh\n#\n# Copyright (c) 2006 Junio C Hamano\n#\n\ntest_description='Binary diff and apply\n'\n\n. ./test-lib.sh\n\ntest_expect_success 'prepare repository' \\\n\t'echo AIT >a && echo BIT >b && echo CIT >c && echo DIT >d &&\n\t git update-index --add a b c d &&\n\t echo git >a &&\n\t cat \"$TEST_DIRECTORY\"/test-binary-1.png >b &&\n\t echo git >c &&\n\t cat b b >d'\n\ncat > expected <<\\EOF\n a |    2 +-\n b |  Bin\n c |    2 +-\n d |  Bin\n 4 files changed, 2 insertions(+), 2 deletions(-)\nEOF\ntest_expect_success 'diff without --binary' \\\n\t'git diff | git apply --stat --summary >current &&\n\t test_i18ncmp expected current'\n\ntest_expect_success 'diff with --binary' \\\n\t'git diff --binary | git apply --stat --summary >current &&\n\t test_i18ncmp expected current'\n\n# apply needs to be able to skip the binary material correctly\n# in order to report the line number of a corrupt patch.\ntest_expect_success 'apply detecting corrupt patch correctly' \\\n\t'git diff | sed -e 's/-CIT/xCIT/' >broken &&\n\t if git apply --stat --summary broken 2>detected\n\t then\n\t\techo unhappy - should have detected an error\n\t\t(exit 1)\n\t else\n\t\techo happy\n\t fi &&\n\t detected=`cat detected` &&\n\t detected=`expr \"$detected\" : \"fatal.*at line \\\\([0-9]*\\\\)\\$\"` &&\n\t detected=`sed -ne \"${detected}p\" broken` &&\n\t test \"$detected\" = xCIT'\n\ntest_expect_success 'apply detecting corrupt patch correctly' \\\n\t'git diff --binary | sed -e 's/-CIT/xCIT/' >broken &&\n\t if git apply --stat --summary broken 2>detected\n\t then\n\t\techo unhappy - should have detected an error\n\t\t(exit 1)\n\t else\n\t\techo happy\n\t fi &&\n\t detected=`cat detected` &&\n\t detected=`expr \"$detected\" : \"fatal.*at line \\\\([0-9]*\\\\)\\$\"` &&\n\t detected=`sed -ne \"${detected}p\" broken` &&\n\t test \"$detected\" = xCIT'\n\ntest_expect_success 'initial commit' 'git commit -a -m initial'\n\n# Try removal (b), modification (d), and creation (e).\ntest_expect_success 'diff-index with --binary' \\\n\t'echo AIT >a && mv b e && echo CIT >c && cat e >d &&\n\t git update-index --add --remove a b c d e &&\n\t tree0=`git write-tree` &&\n\t git diff --cached --binary >current &&\n\t git apply --stat --summary current'\n\ntest_expect_success 'apply binary patch' \\\n\t'git reset --hard &&\n\t git apply --binary --index <current &&\n\t tree1=`git write-tree` &&\n\t test \"$tree1\" = \"$tree0\"'\n\ntest_expect_success 'diff --no-index with binary creation' '\n\techo Q | q_to_nul >binary &&\n\t(: hide error code from diff, which just indicates differences\n\t git diff --binary --no-index /dev/null binary >current ||\n\t true\n\t) &&\n\trm binary &&\n\tgit apply --binary <current &&\n\techo Q >expected &&\n\tnul_to_q <binary >actual &&\n\ttest_cmp expected actual\n'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "008cf10a0cc37e18714578fd777c0b734f87d9f4",
  "sha1_ok": true,
  "size": 2620
}
