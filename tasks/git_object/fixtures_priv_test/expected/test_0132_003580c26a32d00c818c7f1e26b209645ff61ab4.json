{
  "content": {
    "base64": "I2luY2x1ZGUgImJ1aWx0aW4uaCIKI2luY2x1ZGUgImNhY2hlLmgiCiNpbmNsdWRlICJ0cmFuc3BvcnQuaCIKI2luY2x1ZGUgInJlbW90ZS5oIgoKc3RhdGljIGNvbnN0IGNoYXIgbHNfcmVtb3RlX3VzYWdlW10gPQoiZ2l0LWxzLXJlbW90ZSBbLS11cGxvYWQtcGFjaz08Z2l0LXVwbG9hZC1wYWNrPl0gWzxob3N0PjpdPGRpcmVjdG9yeT4iOwoKaW50IGNtZF9sc19yZW1vdGUoaW50IGFyZ2MsIGNvbnN0IGNoYXIgKiphcmd2LCBjb25zdCBjaGFyICpwcmVmaXgpCnsKCWludCBpOwoJY29uc3QgY2hhciAqZGVzdCA9IE5VTEw7CglpbnQgbm9uZ2l0ID0gMDsKCXVuc2lnbmVkIGZsYWdzID0gMDsKCWNvbnN0IGNoYXIgKnVwbG9hZHBhY2sgPSBOVUxMOwoKCXN0cnVjdCB0cmFuc3BvcnQgKnRyYW5zcG9ydDsKCWNvbnN0IHN0cnVjdCByZWYgKnJlZjsKCglzZXR1cF9naXRfZGlyZWN0b3J5X2dlbnRseSgmbm9uZ2l0KTsKCglmb3IgKGkgPSAxOyBpIDwgYXJnYzsgaSsrKSB7CgkJY29uc3QgY2hhciAqYXJnID0gYXJndltpXTsKCgkJaWYgKCphcmcgPT0gJy0nKSB7CgkJCWlmICghcHJlZml4Y21wKGFyZywgIi0tdXBsb2FkLXBhY2s9IikpIHsKCQkJCXVwbG9hZHBhY2sgPSBhcmcgKyAxNDsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCWlmICghcHJlZml4Y21wKGFyZywgIi0tZXhlYz0iKSkgewoJCQkJdXBsb2FkcGFjayA9IGFyZyArIDc7CgkJCQljb250aW51ZTsKCQkJfQoJCQlpZiAoIXN0cmNtcCgiLS10YWdzIiwgYXJnKSkgewoJCQkJZmxhZ3MgfD0gUkVGX1RBR1M7CgkJCQljb250aW51ZTsKCQkJfQoJCQlpZiAoIXN0cmNtcCgiLS1oZWFkcyIsIGFyZykpIHsKCQkJCWZsYWdzIHw9IFJFRl9IRUFEUzsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCWlmICghc3RyY21wKCItLXJlZnMiLCBhcmcpKSB7CgkJCQlmbGFncyB8PSBSRUZfTk9STUFMOwoJCQkJY29udGludWU7CgkJCX0KCQkJdXNhZ2UobHNfcmVtb3RlX3VzYWdlKTsKCQl9CgkJZGVzdCA9IGFyZzsKCQlicmVhazsKCX0KCglpZiAoIWRlc3QgfHwgaSAhPSBhcmdjIC0gMSkKCQl1c2FnZShsc19yZW1vdGVfdXNhZ2UpOwoKCXRyYW5zcG9ydCA9IHRyYW5zcG9ydF9nZXQoTlVMTCwgZGVzdCk7CglpZiAodXBsb2FkcGFjayAhPSBOVUxMKQoJCXRyYW5zcG9ydF9zZXRfb3B0aW9uKHRyYW5zcG9ydCwgVFJBTlNfT1BUX1VQTE9BRFBBQ0ssIHVwbG9hZHBhY2spOwoKCXJlZiA9IHRyYW5zcG9ydF9nZXRfcmVtb3RlX3JlZnModHJhbnNwb3J0KTsKCglpZiAoIXJlZikKCQlyZXR1cm4gMTsKCgl3aGlsZSAocmVmKSB7CgkJaWYgKGNoZWNrX3JlZl90eXBlKHJlZiwgZmxhZ3MpKQoJCQlwcmludGYoIiVzCSVzXG4iLCBzaGExX3RvX2hleChyZWYtPm9sZF9zaGExKSwgcmVmLT5uYW1lKTsKCQlyZWYgPSByZWYtPm5leHQ7Cgl9CglyZXR1cm4gMDsKfQo=",
    "text": "#include \"builtin.h\"\n#include \"cache.h\"\n#include \"transport.h\"\n#include \"remote.h\"\n\nstatic const char ls_remote_usage[] =\n\"git-ls-remote [--upload-pack=<git-upload-pack>] [<host>:]<directory>\";\n\nint cmd_ls_remote(int argc, const char **argv, const char *prefix)\n{\n\tint i;\n\tconst char *dest = NULL;\n\tint nongit = 0;\n\tunsigned flags = 0;\n\tconst char *uploadpack = NULL;\n\n\tstruct transport *transport;\n\tconst struct ref *ref;\n\n\tsetup_git_directory_gently(&nongit);\n\n\tfor (i = 1; i < argc; i++) {\n\t\tconst char *arg = argv[i];\n\n\t\tif (*arg == '-') {\n\t\t\tif (!prefixcmp(arg, \"--upload-pack=\")) {\n\t\t\t\tuploadpack = arg + 14;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!prefixcmp(arg, \"--exec=\")) {\n\t\t\t\tuploadpack = arg + 7;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!strcmp(\"--tags\", arg)) {\n\t\t\t\tflags |= REF_TAGS;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!strcmp(\"--heads\", arg)) {\n\t\t\t\tflags |= REF_HEADS;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!strcmp(\"--refs\", arg)) {\n\t\t\t\tflags |= REF_NORMAL;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tusage(ls_remote_usage);\n\t\t}\n\t\tdest = arg;\n\t\tbreak;\n\t}\n\n\tif (!dest || i != argc - 1)\n\t\tusage(ls_remote_usage);\n\n\ttransport = transport_get(NULL, dest);\n\tif (uploadpack != NULL)\n\t\ttransport_set_option(transport, TRANS_OPT_UPLOADPACK, uploadpack);\n\n\tref = transport_get_remote_refs(transport);\n\n\tif (!ref)\n\t\treturn 1;\n\n\twhile (ref) {\n\t\tif (check_ref_type(ref, flags))\n\t\t\tprintf(\"%s\t%s\\n\", sha1_to_hex(ref->old_sha1), ref->name);\n\t\tref = ref->next;\n\t}\n\treturn 0;\n}\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "003580c26a32d00c818c7f1e26b209645ff61ab4",
  "sha1_ok": true,
  "size": 1409
}
