{
  "content": {
    "base64": "I2luY2x1ZGUgImJ1aWx0aW4uaCIKI2luY2x1ZGUgImNvbmZpZy5oIgojaW5jbHVkZSAiZ2V0dGV4dC5oIgojaW5jbHVkZSAiaWRlbnQuaCIKI2luY2x1ZGUgIm1haWxtYXAuaCIKI2luY2x1ZGUgInBhcnNlLW9wdGlvbnMuaCIKI2luY2x1ZGUgInN0cmluZy1saXN0LmgiCiNpbmNsdWRlICJ3cml0ZS1vci1kaWUuaCIKCnN0YXRpYyBpbnQgdXNlX3N0ZGluOwpzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IGNoZWNrX21haWxtYXBfdXNhZ2VbXSA9IHsKTl8oImdpdCBjaGVjay1tYWlsbWFwIFs8b3B0aW9ucz5dIDxjb250YWN0Pi4uLiIpLApOVUxMCn07CgpzdGF0aWMgY29uc3Qgc3RydWN0IG9wdGlvbiBjaGVja19tYWlsbWFwX29wdGlvbnNbXSA9IHsKCU9QVF9CT09MKDAsICJzdGRpbiIsICZ1c2Vfc3RkaW4sIE5fKCJhbHNvIHJlYWQgY29udGFjdHMgZnJvbSBzdGRpbiIpKSwKCU9QVF9FTkQoKQp9OwoKc3RhdGljIHZvaWQgY2hlY2tfbWFpbG1hcChzdHJ1Y3Qgc3RyaW5nX2xpc3QgKm1haWxtYXAsIGNvbnN0IGNoYXIgKmNvbnRhY3QpCnsKCWNvbnN0IGNoYXIgKm5hbWUsICptYWlsOwoJc2l6ZV90IG5hbWVsZW4sIG1haWxsZW47CglzdHJ1Y3QgaWRlbnRfc3BsaXQgaWRlbnQ7CgoJaWYgKHNwbGl0X2lkZW50X2xpbmUoJmlkZW50LCBjb250YWN0LCBzdHJsZW4oY29udGFjdCkpKQoJCWRpZShfKCJ1bmFibGUgdG8gcGFyc2UgY29udGFjdDogJXMiKSwgY29udGFjdCk7CgoJbmFtZSA9IGlkZW50Lm5hbWVfYmVnaW47CgluYW1lbGVuID0gaWRlbnQubmFtZV9lbmQgLSBpZGVudC5uYW1lX2JlZ2luOwoJbWFpbCA9IGlkZW50Lm1haWxfYmVnaW47CgltYWlsbGVuID0gaWRlbnQubWFpbF9lbmQgLSBpZGVudC5tYWlsX2JlZ2luOwoKCW1hcF91c2VyKG1haWxtYXAsICZtYWlsLCAmbWFpbGxlbiwgJm5hbWUsICZuYW1lbGVuKTsKCglpZiAobmFtZWxlbikKCQlwcmludGYoIiUuKnMgIiwgKGludCluYW1lbGVuLCBuYW1lKTsKCXByaW50ZigiPCUuKnM+XG4iLCAoaW50KW1haWxsZW4sIG1haWwpOwp9CgppbnQgY21kX2NoZWNrX21haWxtYXAoaW50IGFyZ2MsIGNvbnN0IGNoYXIgKiphcmd2LCBjb25zdCBjaGFyICpwcmVmaXgpCnsKCWludCBpOwoJc3RydWN0IHN0cmluZ19saXN0IG1haWxtYXAgPSBTVFJJTkdfTElTVF9JTklUX05PRFVQOwoKCWdpdF9jb25maWcoZ2l0X2RlZmF1bHRfY29uZmlnLCBOVUxMKTsKCWFyZ2MgPSBwYXJzZV9vcHRpb25zKGFyZ2MsIGFyZ3YsIHByZWZpeCwgY2hlY2tfbWFpbG1hcF9vcHRpb25zLAoJCQkgICAgIGNoZWNrX21haWxtYXBfdXNhZ2UsIDApOwoJaWYgKGFyZ2MgPT0gMCAmJiAhdXNlX3N0ZGluKQoJCWRpZShfKCJubyBjb250YWN0cyBzcGVjaWZpZWQiKSk7CgoJcmVhZF9tYWlsbWFwKCZtYWlsbWFwKTsKCglmb3IgKGkgPSAwOyBpIDwgYXJnYzsgKytpKQoJCWNoZWNrX21haWxtYXAoJm1haWxtYXAsIGFyZ3ZbaV0pOwoJbWF5YmVfZmx1c2hfb3JfZGllKHN0ZG91dCwgInN0ZG91dCIpOwoKCWlmICh1c2Vfc3RkaW4pIHsKCQlzdHJ1Y3Qgc3RyYnVmIGJ1ZiA9IFNUUkJVRl9JTklUOwoJCXdoaWxlIChzdHJidWZfZ2V0bGluZV9sZigmYnVmLCBzdGRpbikgIT0gRU9GKSB7CgkJCWNoZWNrX21haWxtYXAoJm1haWxtYXAsIGJ1Zi5idWYpOwoJCQltYXliZV9mbHVzaF9vcl9kaWUoc3Rkb3V0LCAic3Rkb3V0Iik7CgkJfQoJCXN0cmJ1Zl9yZWxlYXNlKCZidWYpOwoJfQoKCWNsZWFyX21haWxtYXAoJm1haWxtYXApOwoJcmV0dXJuIDA7Cn0K",
    "text": "#include \"builtin.h\"\n#include \"config.h\"\n#include \"gettext.h\"\n#include \"ident.h\"\n#include \"mailmap.h\"\n#include \"parse-options.h\"\n#include \"string-list.h\"\n#include \"write-or-die.h\"\n\nstatic int use_stdin;\nstatic const char * const check_mailmap_usage[] = {\nN_(\"git check-mailmap [<options>] <contact>...\"),\nNULL\n};\n\nstatic const struct option check_mailmap_options[] = {\n\tOPT_BOOL(0, \"stdin\", &use_stdin, N_(\"also read contacts from stdin\")),\n\tOPT_END()\n};\n\nstatic void check_mailmap(struct string_list *mailmap, const char *contact)\n{\n\tconst char *name, *mail;\n\tsize_t namelen, maillen;\n\tstruct ident_split ident;\n\n\tif (split_ident_line(&ident, contact, strlen(contact)))\n\t\tdie(_(\"unable to parse contact: %s\"), contact);\n\n\tname = ident.name_begin;\n\tnamelen = ident.name_end - ident.name_begin;\n\tmail = ident.mail_begin;\n\tmaillen = ident.mail_end - ident.mail_begin;\n\n\tmap_user(mailmap, &mail, &maillen, &name, &namelen);\n\n\tif (namelen)\n\t\tprintf(\"%.*s \", (int)namelen, name);\n\tprintf(\"<%.*s>\\n\", (int)maillen, mail);\n}\n\nint cmd_check_mailmap(int argc, const char **argv, const char *prefix)\n{\n\tint i;\n\tstruct string_list mailmap = STRING_LIST_INIT_NODUP;\n\n\tgit_config(git_default_config, NULL);\n\targc = parse_options(argc, argv, prefix, check_mailmap_options,\n\t\t\t     check_mailmap_usage, 0);\n\tif (argc == 0 && !use_stdin)\n\t\tdie(_(\"no contacts specified\"));\n\n\tread_mailmap(&mailmap);\n\n\tfor (i = 0; i < argc; ++i)\n\t\tcheck_mailmap(&mailmap, argv[i]);\n\tmaybe_flush_or_die(stdout, \"stdout\");\n\n\tif (use_stdin) {\n\t\tstruct strbuf buf = STRBUF_INIT;\n\t\twhile (strbuf_getline_lf(&buf, stdin) != EOF) {\n\t\t\tcheck_mailmap(&mailmap, buf.buf);\n\t\t\tmaybe_flush_or_die(stdout, \"stdout\");\n\t\t}\n\t\tstrbuf_release(&buf);\n\t}\n\n\tclear_mailmap(&mailmap);\n\treturn 0;\n}\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "002d2941e931034f9426c8e3dbda28310fc2776a",
  "sha1_ok": true,
  "size": 1740
}
