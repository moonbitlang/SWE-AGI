{
  "content": {
    "base64": "U3ViamVjdDogW0hPV1RPXSBVc2luZyBwb3N0LXVwZGF0ZSBob29rCk1lc3NhZ2UtSUQ6IDw3dnk4Nm82dXN4LmZzZkBhc3NpZ25lZC1ieS1kaGNwLmNveC5uZXQ+CkZyb206IEp1bmlvIEMgSGFtYW5vIDxnaXRzdGVyQHBvYm94LmNvbT4KRGF0ZTogRnJpLCAyNiBBdWcgMjAwNSAxODoxOToxMCAtMDcwMApBYnN0cmFjdDogSW4gdGhpcyBob3ctdG8gYXJ0aWNsZSwgSkMgdGFsa3MgYWJvdXQgaG93IGhlCiB1c2VzIHRoZSBwb3N0LXVwZGF0ZSBob29rIHRvIGF1dG9tYXRlIGdpdCBkb2N1bWVudGF0aW9uIHBhZ2UKIHNob3duIGF0IGh0dHA6Ly93d3cua2VybmVsLm9yZy9wdWIvc29mdHdhcmUvc2NtL2dpdC9kb2NzLy4KQ29udGVudC10eXBlOiB0ZXh0L2FzY2lpZG9jCgpIb3cgdG8gcmVidWlsZCBmcm9tIHVwZGF0ZSBob29rCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KClRoZSBwYWdlcyB1bmRlciBodHRwOi8vd3d3Lmtlcm5lbC5vcmcvcHViL3NvZnR3YXJlL3NjbS9naXQvZG9jcy8KYXJlIGJ1aWx0IGZyb20gRG9jdW1lbnRhdGlvbi8gZGlyZWN0b3J5IG9mIHRoZSBnaXQuZ2l0IHByb2plY3QKYW5kIG5lZWRlZCB0byBiZSBrZXB0IHVwLXRvLWRhdGUuICBUaGUgd3d3Lmtlcm5lbC5vcmcvIHNlcnZlcnMKYXJlIG1pcnJvcmVkIGFuZCBJIHdhcyB0b2xkIHRoYXQgdGhlIG9yaWdpbiBvZiB0aGUgbWlycm9yIGlzIG9uCnRoZSBtYWNoaW5lICRzb21lLmtlcm5lbC5vcmcsIG9uIHdoaWNoIEkgd2FzIGdpdmVuIGFuIGFjY291bnQKd2hlbiBJIHRvb2sgb3ZlciBnaXQgbWFpbnRhaW5lcnNoaXAgZnJvbSBMaW51cy4KClRoZSBkaXJlY3RvcmllcyByZWxldmFudCB0byB0aGlzIGhvdy10byBhcmUgdGhlc2UgdHdvOgoKICAgIC9wdWIvc2NtL2dpdC9naXQuZ2l0LwlUaGUgcHVibGljIGdpdCByZXBvc2l0b3J5LgogICAgL3B1Yi9zb2Z0d2FyZS9zY20vZ2l0L2RvY3MvCVRoZSBIVE1MIGRvY3VtZW50YXRpb24gcGFnZS4KClNvIEkgbWFkZSBhIHJlcG9zaXRvcnkgdG8gZ2VuZXJhdGUgdGhlIGRvY3VtZW50YXRpb24gdW5kZXIgbXkKaG9tZSBkaXJlY3Rvcnkgb3ZlciB0aGVyZS4KCiAgICAkIGNkCiAgICAkIG1rZGlyIGRvYy1naXQgJiYgY2QgZG9jLWdpdAogICAgJCBnaXQgY2xvbmUgL3B1Yi9zY20vZ2l0L2dpdC5naXQvIGRvY2dlbgoKV2hhdCBuZWVkcyB0byBoYXBwZW4gaXMgdG8gdXBkYXRlIHRoZSAkSE9NRS9kb2MtZ2l0L2RvY2dlbi8Kd29ya2luZyB0cmVlLCBidWlsZCBIVE1MIGRvY3MgdGhlcmUgYW5kIGluc3RhbGwgdGhlIHJlc3VsdCBpbgovcHViL3NvZnR3YXJlL3NjbS9naXQvZG9jcy8gZGlyZWN0b3J5LiAgU28gSSB3cm90ZSBhIGxpdHRsZQpzY3JpcHQ6CgogICAgJCBjYXQgPmRvZG9kb2Muc2ggPDxcRU9GCiAgICAjIS9iaW4vc2gKICAgIGNkICRIT01FL2RvYy1naXQvZG9jZ2VuIHx8IGV4aXQKCiAgICB1bnNldCBHSVRfRElSCgogICAgZ2l0IHB1bGwgL3B1Yi9zY20vZ2l0L2dpdC5naXQvIG1hc3RlciAmJgogICAgY2QgRG9jdW1lbnRhdGlvbiAmJgogICAgbWFrZSBpbnN0YWxsLXdlYmRvYwogICAgRU9GCgpJbml0aWFsbHkgSSB1c2VkIHRvIHJ1biB0aGlzIGJ5IGhhbmQgd2hlbmV2ZXIgSSBwdXNoIGludG8gdGhlCnB1YmxpYyBnaXQgcmVwb3NpdG9yeS4gIFRoZW4gSSBkaWQgYSBjcm9uIGpvYiB0aGF0IHJhbiB0d2ljZSBhCmRheS4gIFRoZSBjdXJyZW50IHJvdW5kIHVzZXMgdGhlIHBvc3QtdXBkYXRlIGhvb2sgbWVjaGFuaXNtLApsaWtlIHRoaXM6CgogICAgJCBjYXQgPi9wdWIvc2NtL2dpdC9naXQuZ2l0L2hvb2tzL3Bvc3QtdXBkYXRlIDw8XEVPRgogICAgIyEvYmluL3NoCiAgICAjCiAgICAjIEFuIGV4YW1wbGUgaG9vayBzY3JpcHQgdG8gcHJlcGFyZSBhIHBhY2tlZCByZXBvc2l0b3J5IGZvciB1c2Ugb3ZlcgogICAgIyBkdW1iIHRyYW5zcG9ydHMuCiAgICAjCiAgICAjIFRvIGVuYWJsZSB0aGlzIGhvb2ssIG1ha2UgdGhpcyBmaWxlIGV4ZWN1dGFibGUgYnkgImNobW9kICt4IHBvc3QtdXBkYXRlIi4KCiAgICBjYXNlICIgJCogIiBpbgogICAgKicgcmVmcy9oZWFkcy9tYXN0ZXIgJyopCiAgICAgICAgICAgIGVjaG8gJEhPTUUvZG9jLWdpdC9kb2RvZG9jLnNoIHwgYXQgbm93CiAgICAgICAgICAgIDs7CiAgICBlc2FjCiAgICBleGVjIGdpdC11cGRhdGUtc2VydmVyLWluZm8KICAgIEVPRgogICAgJCBjaG1vZCAreCAvcHViL3NjbS9naXQvZ2l0LmdpdC9ob29rcy9wb3N0LXVwZGF0ZQoKVGhlcmUgYXJlIGZvdXIgdGhpbmdzIHdvcnRoIG1lbnRpb25pbmc6CgogLSBUaGUgdXBkYXRlLWhvb2sgaXMgcnVuIGFmdGVyIHRoZSByZXBvc2l0b3J5IGFjY2VwdHMgYSAiZ2l0CiAgIHB1c2giLCB1bmRlciBteSB1c2VyIHByaXZpbGVnZS4gIEl0IGlzIGdpdmVuIHRoZSBmdWxsIG5hbWVzCiAgIG9mIHJlZnMgdGhhdCBoYXZlIGJlZW4gdXBkYXRlZCBhcyBhcmd1bWVudHMuICBNeSBwb3N0LXVwZGF0ZQogICBydW5zIHRoZSBkb2RvZG9jLnNoIHNjcmlwdCBvbmx5IHdoZW4gdGhlIG1hc3RlciBoZWFkIGlzCiAgIHVwZGF0ZWQuCgogLSBXaGVuIHVwZGF0ZS1ob29rIGlzIHJ1biwgR0lUX0RJUiBpcyBzZXQgdG8gJy4nIGJ5IHRoZSBjYWxsaW5nCiAgIHJlY2VpdmUtcGFjay4gIFRoaXMgaXMgaW5oZXJpdGVkIGJ5IHRoZSBkb2RvZG9jLnNoIHJ1biB2aWEKICAgdGhlICJhdCIgY29tbWFuZCwgYW5kIG5lZWRzIHRvIGJlIHVuc2V0OyBvdGhlcndpc2UsICJnaXQKICAgcHVsbCIgaXQgZG9lcyBpbnRvICRIT01FL2RvYy1naXQvZG9jZ2VuLyByZXBvc2l0b3J5IHdvdWxkIG5vdAogICB3b3JrIGNvcnJlY3RseS4KCiAtIFRoZSBzdGRvdXQgb2YgdXBkYXRlIGhvb2sgc2NyaXB0IGlzIG5vdCBjb25uZWN0ZWQgdG8gZ2l0CiAgIHB1c2g7IEkgcnVuIHRoZSBoZWF2eSBwYXJ0IG9mIHRoZSBjb21tYW5kIGluc2lkZSAiYXQiLCB0bwogICByZWNlaXZlIHRoZSBleGVjdXRpb24gcmVwb3J0IHZpYSBlLW1haWwuCgogLSBUaGlzIGlzIHN0aWxsIGNydWRlIGFuZCBkb2VzIG5vdCBwcm90ZWN0IGFnYWluc3Qgc2ltdWx0YW5lb3VzCiAgIG1ha2UgaW52b2NhdGlvbnMgc3RvbXBpbmcgb24gZWFjaCBvdGhlci4gIEkgd291bGQgbmVlZCB0byBhZGQKICAgc29tZSBsb2NraW5nIG1lY2hhbmlzbSBmb3IgdGhpcy4K",
    "text": "Subject: [HOWTO] Using post-update hook\nMessage-ID: <7vy86o6usx.fsf@assigned-by-dhcp.cox.net>\nFrom: Junio C Hamano <gitster@pobox.com>\nDate: Fri, 26 Aug 2005 18:19:10 -0700\nAbstract: In this how-to article, JC talks about how he\n uses the post-update hook to automate git documentation page\n shown at http://www.kernel.org/pub/software/scm/git/docs/.\nContent-type: text/asciidoc\n\nHow to rebuild from update hook\n===============================\n\nThe pages under http://www.kernel.org/pub/software/scm/git/docs/\nare built from Documentation/ directory of the git.git project\nand needed to be kept up-to-date.  The www.kernel.org/ servers\nare mirrored and I was told that the origin of the mirror is on\nthe machine $some.kernel.org, on which I was given an account\nwhen I took over git maintainership from Linus.\n\nThe directories relevant to this how-to are these two:\n\n    /pub/scm/git/git.git/\tThe public git repository.\n    /pub/software/scm/git/docs/\tThe HTML documentation page.\n\nSo I made a repository to generate the documentation under my\nhome directory over there.\n\n    $ cd\n    $ mkdir doc-git && cd doc-git\n    $ git clone /pub/scm/git/git.git/ docgen\n\nWhat needs to happen is to update the $HOME/doc-git/docgen/\nworking tree, build HTML docs there and install the result in\n/pub/software/scm/git/docs/ directory.  So I wrote a little\nscript:\n\n    $ cat >dododoc.sh <<\\EOF\n    #!/bin/sh\n    cd $HOME/doc-git/docgen || exit\n\n    unset GIT_DIR\n\n    git pull /pub/scm/git/git.git/ master &&\n    cd Documentation &&\n    make install-webdoc\n    EOF\n\nInitially I used to run this by hand whenever I push into the\npublic git repository.  Then I did a cron job that ran twice a\nday.  The current round uses the post-update hook mechanism,\nlike this:\n\n    $ cat >/pub/scm/git/git.git/hooks/post-update <<\\EOF\n    #!/bin/sh\n    #\n    # An example hook script to prepare a packed repository for use over\n    # dumb transports.\n    #\n    # To enable this hook, make this file executable by \"chmod +x post-update\".\n\n    case \" $* \" in\n    *' refs/heads/master '*)\n            echo $HOME/doc-git/dododoc.sh | at now\n            ;;\n    esac\n    exec git-update-server-info\n    EOF\n    $ chmod +x /pub/scm/git/git.git/hooks/post-update\n\nThere are four things worth mentioning:\n\n - The update-hook is run after the repository accepts a \"git\n   push\", under my user privilege.  It is given the full names\n   of refs that have been updated as arguments.  My post-update\n   runs the dododoc.sh script only when the master head is\n   updated.\n\n - When update-hook is run, GIT_DIR is set to '.' by the calling\n   receive-pack.  This is inherited by the dododoc.sh run via\n   the \"at\" command, and needs to be unset; otherwise, \"git\n   pull\" it does into $HOME/doc-git/docgen/ repository would not\n   work correctly.\n\n - The stdout of update hook script is not connected to git\n   push; I run the heavy part of the command inside \"at\", to\n   receive the execution report via e-mail.\n\n - This is still crude and does not protect against simultaneous\n   make invocations stomping on each other.  I would need to add\n   some locking mechanism for this.\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "00c1b45b7963ea38c87dca95a94e8ccfc273f7b1",
  "sha1_ok": true,
  "size": 3135
}
