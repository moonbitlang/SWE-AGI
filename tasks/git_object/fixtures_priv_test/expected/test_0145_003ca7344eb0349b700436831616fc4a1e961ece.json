{
  "content": {
    "base64": "IyEvYmluL3NoCgp0ZXN0X2Rlc2NyaXB0aW9uPSdjcnVmdCBwYWNrIHJlbGF0ZWQgcGFjay1vYmplY3RzIHRlc3RzJwouIC4vdGVzdC1saWIuc2gKCm9iamRpcj0uZ2l0L29iamVjdHMKcGFja2Rpcj0kb2JqZGlyL3BhY2sKCmJhc2ljX2NydWZ0X3BhY2tfdGVzdHMgKCkgewoJZXhwaXJlPSIkMSIKCgl0ZXN0X2V4cGVjdF9zdWNjZXNzICJ1bnJlYWNoYWJsZSBsb29zZSBvYmplY3RzIGFyZSBwYWNrZWQgKGV4cGlyZSAkZXhwaXJlKSIgJwoJCWdpdCBpbml0IHJlcG8gJiYKCQl0ZXN0X3doZW5fZmluaXNoZWQgInJtIC1mciByZXBvIiAmJgoJCSgKCQkJY2QgcmVwbyAmJgoKCQkJdGVzdF9jb21taXQgYmFzZSAmJgoJCQlnaXQgcmVwYWNrIC1BZCAmJgoJCQl0ZXN0X2NvbW1pdCBsb29zZSAmJgoKCQkJdGVzdC10b29sIGNobXRpbWUgKzIwMDAgIiRvYmpkaXIvJCh0ZXN0X29pZF90b19wYXRoIFwKCQkJCSQoZ2l0IHJldi1wYXJzZSBsb29zZTpsb29zZS50KSkiICYmCgkJCXRlc3QtdG9vbCBjaG10aW1lICsxMDAwICIkb2JqZGlyLyQodGVzdF9vaWRfdG9fcGF0aCBcCgkJCQkkKGdpdCByZXYtcGFyc2UgbG9vc2Vee3RyZWV9KSkiICYmCgoJCQkoCgkJCQlnaXQgcmV2LWxpc3QgLS1vYmplY3RzIC0tbm8tb2JqZWN0LW5hbWVzIGJhc2UuLmxvb3NlIHwKCQkJCXdoaWxlIHJlYWQgb2lkCgkJCQlkbwoJCQkJCXBhdGg9IiRvYmpkaXIvJCh0ZXN0X29pZF90b19wYXRoICIkb2lkIikiICYmCgkJCQkJcHJpbnRmICIlcyAlZFxuIiAiJG9pZCIgIiQodGVzdC10b29sIGNobXRpbWUgLS1nZXQgIiRwYXRoIikiCgkJCQlkb25lIHwKCQkJCXNvcnQgLWsxCgkJCSkgPmV4cGVjdCAmJgoKCQkJa2VlcD0iJChiYXNlbmFtZSAiJChscyAkcGFja2Rpci9wYWNrLSoucGFjaykiKSIgJiYKCQkJY3J1ZnQ9IiQoZWNobyAka2VlcCB8IGdpdCBwYWNrLW9iamVjdHMgLS1jcnVmdCBcCgkJCQktLWNydWZ0LWV4cGlyYXRpb249IiRleHBpcmUiICRwYWNrZGlyL3BhY2spIiAmJgoJCQl0ZXN0LXRvb2wgcGFjay1tdGltZXMgInBhY2stJGNydWZ0Lm10aW1lcyIgPmFjdHVhbCAmJgoKCQkJdGVzdF9jbXAgZXhwZWN0IGFjdHVhbAoJCSkKCScKCgl0ZXN0X2V4cGVjdF9zdWNjZXNzICJ1bnJlYWNoYWJsZSBwYWNrZWQgb2JqZWN0cyBhcmUgcGFja2VkIChleHBpcmUgJGV4cGlyZSkiICcKCQlnaXQgaW5pdCByZXBvICYmCgkJdGVzdF93aGVuX2ZpbmlzaGVkICJybSAtZnIgcmVwbyIgJiYKCQkoCgkJCWNkIHJlcG8gJiYKCgkJCXRlc3RfY29tbWl0IHBhY2tlZCAmJgoJCQlnaXQgcmVwYWNrIC1BZCAmJgoJCQl0ZXN0X2NvbW1pdCBvdGhlciAmJgoKCQkJZ2l0IHJldi1saXN0IC0tb2JqZWN0cyAtLW5vLW9iamVjdC1uYW1lcyBwYWNrZWQuLiA+b2JqZWN0cyAmJgoJCQlrZWVwPSIkKGJhc2VuYW1lICIkKGxzICRwYWNrZGlyL3BhY2stKi5wYWNrKSIpIiAmJgoJCQlvdGhlcj0iJChnaXQgcGFjay1vYmplY3RzIC0tZGVsdGEtYmFzZS1vZmZzZXQgXAoJCQkJJHBhY2tkaXIvcGFjayA8b2JqZWN0cykiICYmCgkJCWdpdCBwcnVuZS1wYWNrZWQgJiYKCgkJCXRlc3QtdG9vbCBjaG10aW1lIC0tZ2V0IC0xMDAgIiRwYWNrZGlyL3BhY2stJG90aGVyLnBhY2siID5leHBlY3QgJiYKCgkJCWNydWZ0PSIkKGdpdCBwYWNrLW9iamVjdHMgLS1jcnVmdCAtLWNydWZ0LWV4cGlyYXRpb249IiRleHBpcmUiICRwYWNrZGlyL3BhY2sgPDwtRU9GCgkJCSRrZWVwCgkJCS1wYWNrLSRvdGhlci5wYWNrCgkJCUVPRgoJCQkpIiAmJgoJCQl0ZXN0LXRvb2wgcGFjay1tdGltZXMgInBhY2stJGNydWZ0Lm10aW1lcyIgPmFjdHVhbC5yYXcgJiYKCgkJCWN1dCAtZCIgIiAtZjIgPGFjdHVhbC5yYXcgfCBzb3J0IC11ID5hY3R1YWwgJiYKCgkJCXRlc3RfY21wIGV4cGVjdCBhY3R1YWwKCQkpCgknCgoJdGVzdF9leHBlY3Rfc3VjY2VzcyAidW5yZWFjaGFibGUgY3J1ZnQgb2JqZWN0cyBhcmUgcmVwYWNrZWQgKGV4cGlyZSAkZXhwaXJlKSIgJwoJCWdpdCBpbml0IHJlcG8gJiYKCQl0ZXN0X3doZW5fZmluaXNoZWQgInJtIC1mciByZXBvIiAmJgoJCSgKCQkJY2QgcmVwbyAmJgoKCQkJdGVzdF9jb21taXQgcGFja2VkICYmCgkJCWdpdCByZXBhY2sgLUFkICYmCgkJCXRlc3RfY29tbWl0IG90aGVyICYmCgoJCQlnaXQgcmV2LWxpc3QgLS1vYmplY3RzIC0tbm8tb2JqZWN0LW5hbWVzIHBhY2tlZC4uID5vYmplY3RzICYmCgkJCWtlZXA9IiQoYmFzZW5hbWUgIiQobHMgJHBhY2tkaXIvcGFjay0qLnBhY2spIikiICYmCgoJCQljcnVmdF9hPSIkKGVjaG8gJGtlZXAgfCBnaXQgcGFjay1vYmplY3RzIC0tY3J1ZnQgLS1jcnVmdC1leHBpcmF0aW9uPSIkZXhwaXJlIiAkcGFja2Rpci9wYWNrKSIgJiYKCQkJZ2l0IHBydW5lLXBhY2tlZCAmJgoJCQljcnVmdF9iPSIkKGdpdCBwYWNrLW9iamVjdHMgLS1jcnVmdCAtLWNydWZ0LWV4cGlyYXRpb249IiRleHBpcmUiICRwYWNrZGlyL3BhY2sgPDwtRU9GCgkJCSRrZWVwCgkJCS1wYWNrLSRjcnVmdF9hLnBhY2sKCQkJRU9GCgkJCSkiICYmCgoJCQl0ZXN0LXRvb2wgcGFjay1tdGltZXMgInBhY2stJGNydWZ0X2EubXRpbWVzIiA+ZXhwZWN0LnJhdyAmJgoJCQl0ZXN0LXRvb2wgcGFjay1tdGltZXMgInBhY2stJGNydWZ0X2IubXRpbWVzIiA+YWN0dWFsLnJhdyAmJgoKCQkJc29ydCA8ZXhwZWN0LnJhdyA+ZXhwZWN0ICYmCgkJCXNvcnQgPGFjdHVhbC5yYXcgPmFjdHVhbCAmJgoKCQkJdGVzdF9jbXAgZXhwZWN0IGFjdHVhbAoJCSkKCScKCgl0ZXN0X2V4cGVjdF9zdWNjZXNzICJtdWx0aXBsZSBjcnVmdCBwYWNrcyAoZXhwaXJlICRleHBpcmUpIiAnCgkJZ2l0IGluaXQgcmVwbyAmJgoJCXRlc3Rfd2hlbl9maW5pc2hlZCAicm0gLWZyIHJlcG8iICYmCgkJKAoJCQljZCByZXBvICYmCgoJCQl0ZXN0X2NvbW1pdCByZWFjaGFibGUgJiYKCQkJZ2l0IHJlcGFjayAtQWQgJiYKCQkJa2VlcD0iJChiYXNlbmFtZSAiJChscyAkcGFja2Rpci9wYWNrLSoucGFjaykiKSIgJiYKCgkJCXRlc3RfY29tbWl0IGNydWZ0ICYmCgkJCWxvb3NlPSIkb2JqZGlyLyQodGVzdF9vaWRfdG9fcGF0aCAkKGdpdCByZXYtcGFyc2UgY3J1ZnQpKSIgJiYKCgkJCSMgZ2VuZXJhdGUgdGhyZWUgY29waWVzIG9mIHRoZSBjcnVmdCBvYmplY3QgaW4gZGlmZmVyZW50CgkJCSMgY3J1ZnQgcGFja3MsIGVhY2ggd2l0aCBhIHVuaXF1ZSBtdGltZToKCQkJIyAgIC0gb25lIGV4cGlyZWQgKDEwMDAgc2Vjb25kcyBhZ28pCgkJCSMgICAtIHR3byBub24tZXhwaXJlZCAob25lIDEwMDAgc2Vjb25kcyBpbiB0aGUgZnV0dXJlLAoJCQkjICAgICBvbmUgMTUwMCBzZWNvbmRzIGluIHRoZSBmdXR1cmUpCgkJCXRlc3QtdG9vbCBjaG10aW1lID0tMTAwMCAiJGxvb3NlIiAmJgoJCQlnaXQgcGFjay1vYmplY3RzIC0tY3J1ZnQgJHBhY2tkaXIvcGFjay1BIDw8LUVPRiAmJgoJCQkka2VlcAoJCQlFT0YKCQkJdGVzdC10b29sIGNobXRpbWUgPSsxMDAwICIkbG9vc2UiICYmCgkJCWdpdCBwYWNrLW9iamVjdHMgLS1jcnVmdCAkcGFja2Rpci9wYWNrLUIgPDwtRU9GICYmCgkJCSRrZWVwCgkJCS0kKGJhc2VuYW1lICQobHMgJHBhY2tkaXIvcGFjay1BLSoucGFjaykpCgkJCUVPRgoJCQl0ZXN0LXRvb2wgY2htdGltZSA9KzE1MDAgIiRsb29zZSIgJiYKCQkJZ2l0IHBhY2stb2JqZWN0cyAtLWNydWZ0ICRwYWNrZGlyL3BhY2stQyA8PC1FT0YgJiYKCQkJJGtlZXAKCQkJLSQoYmFzZW5hbWUgJChscyAkcGFja2Rpci9wYWNrLUEtKi5wYWNrKSkKCQkJLSQoYmFzZW5hbWUgJChscyAkcGFja2Rpci9wYWNrLUItKi5wYWNrKSkKCQkJRU9GCgoJCQkjIGVuc3VyZSB0aGUgcmVzdWx0aW5nIGNydWZ0IHBhY2sgdGFrZXMgdGhlIG1vc3QgcmVjZW50CgkJCSMgbXRpbWUgYW1vbmcgYWxsIGNvcGllcwoJCQljcnVmdD0iJChnaXQgcGFjay1vYmplY3RzIC0tY3J1ZnQgXAoJCQkJLS1jcnVmdC1leHBpcmF0aW9uPSIkZXhwaXJlIiBcCgkJCQkkcGFja2Rpci9wYWNrIDw8LUVPRgoJCQkka2VlcAoJCQktJChiYXNlbmFtZSAkKGxzICRwYWNrZGlyL3BhY2stQS0qLnBhY2spKQoJCQktJChiYXNlbmFtZSAkKGxzICRwYWNrZGlyL3BhY2stQi0qLnBhY2spKQoJCQktJChiYXNlbmFtZSAkKGxzICRwYWNrZGlyL3BhY2stQy0qLnBhY2spKQoJCQlFT0YKCQkJKSIgJiYKCgkJCXRlc3QtdG9vbCBwYWNrLW10aW1lcyAiJChiYXNlbmFtZSAkKGxzICRwYWNrZGlyL3BhY2stQy0qLm10aW1lcykpIiA+ZXhwZWN0LnJhdyAmJgoJCQl0ZXN0LXRvb2wgcGFjay1tdGltZXMgInBhY2stJGNydWZ0Lm10aW1lcyIgPmFjdHVhbC5yYXcgJiYKCgkJCXNvcnQgZXhwZWN0LnJhdyA+ZXhwZWN0ICYmCgkJCXNvcnQgYWN0dWFsLnJhdyA+YWN0dWFsICYmCgkJCXRlc3RfY21wIGV4cGVjdCBhY3R1YWwKCQkpCgknCgoJdGVzdF9leHBlY3Rfc3VjY2VzcyAiY3J1ZnQgcGFja3MgdG9sZXJhdGUgbWlzc2luZyB0cmVlcyAoZXhwaXJlICRleHBpcmUpIiAnCgkJZ2l0IGluaXQgcmVwbyAmJgoJCXRlc3Rfd2hlbl9maW5pc2hlZCAicm0gLWZyIHJlcG8iICYmCgkJKAoJCQljZCByZXBvICYmCgoJCQl0ZXN0X2NvbW1pdCByZWFjaGFibGUgJiYKCQkJdGVzdF9jb21taXQgY3J1ZnQgJiYKCgkJCXRyZWU9IiQoZ2l0IHJldi1wYXJzZSBjcnVmdF57dHJlZX0pIiAmJgoKCQkJZ2l0IHJlc2V0IC0taGFyZCByZWFjaGFibGUgJiYKCQkJZ2l0IHRhZyAtZCBjcnVmdCAmJgoJCQlnaXQgcmVmbG9nIGV4cGlyZSAtLWFsbCAtLWV4cGlyZT1hbGwgJiYKCgkJCSMgcmVtb3ZlIHRoZSB1bnJlYWNoYWJsZSB0cmVlLCBidXQgbGVhdmUgdGhlIGNvbW1pdAoJCQkjIHdoaWNoIGhhcyBpdCBhcyBpdHMgcm9vdCB0cmVlIGludGFjdAoJCQlybSAtZnIgIiRvYmpkaXIvJCh0ZXN0X29pZF90b19wYXRoICIkdHJlZSIpIiAmJgoKCQkJZ2l0IHJlcGFjayAtQWQgJiYKCQkJYmFzZW5hbWUgJChscyAkcGFja2Rpci9wYWNrLSoucGFjaykgPmluICYmCgkJCWdpdCBwYWNrLW9iamVjdHMgLS1jcnVmdCAtLWNydWZ0LWV4cGlyYXRpb249IiRleHBpcmUiIFwKCQkJCSRwYWNrZGlyL3BhY2sgPGluCgkJKQoJJwoKCXRlc3RfZXhwZWN0X3N1Y2Nlc3MgImNydWZ0IHBhY2tzIHRvbGVyYXRlIG1pc3NpbmcgYmxvYnMgKGV4cGlyZSAkZXhwaXJlKSIgJwoJCWdpdCBpbml0IHJlcG8gJiYKCQl0ZXN0X3doZW5fZmluaXNoZWQgInJtIC1mciByZXBvIiAmJgoJCSgKCQkJY2QgcmVwbyAmJgoKCQkJdGVzdF9jb21taXQgcmVhY2hhYmxlICYmCgkJCXRlc3RfY29tbWl0IGNydWZ0ICYmCgoJCQlibG9iPSIkKGdpdCByZXYtcGFyc2UgY3J1ZnQ6Y3J1ZnQudCkiICYmCgoJCQlnaXQgcmVzZXQgLS1oYXJkIHJlYWNoYWJsZSAmJgoJCQlnaXQgdGFnIC1kIGNydWZ0ICYmCgkJCWdpdCByZWZsb2cgZXhwaXJlIC0tYWxsIC0tZXhwaXJlPWFsbCAmJgoKCQkJIyByZW1vdmUgdGhlIHVucmVhY2hhYmxlIGJsb2IsIGJ1dCBsZWF2ZSB0aGUgY29tbWl0IChhbmQKCQkJIyB0aGUgcm9vdCB0cmVlIG9mIHRoYXQgY29tbWl0KSBpbnRhY3QKCQkJcm0gLWZyICIkb2JqZGlyLyQodGVzdF9vaWRfdG9fcGF0aCAiJGJsb2IiKSIgJiYKCgkJCWdpdCByZXBhY2sgLUFkICYmCgkJCWJhc2VuYW1lICQobHMgJHBhY2tkaXIvcGFjay0qLnBhY2spID5pbiAmJgoJCQlnaXQgcGFjay1vYmplY3RzIC0tY3J1ZnQgLS1jcnVmdC1leHBpcmF0aW9uPSIkZXhwaXJlIiBcCgkJCQkkcGFja2Rpci9wYWNrIDxpbgoJCSkKCScKfQoKYmFzaWNfY3J1ZnRfcGFja190ZXN0cyBuZXZlcgoKdGVzdF9kb25lCg==",
    "text": "#!/bin/sh\n\ntest_description='cruft pack related pack-objects tests'\n. ./test-lib.sh\n\nobjdir=.git/objects\npackdir=$objdir/pack\n\nbasic_cruft_pack_tests () {\n\texpire=\"$1\"\n\n\ttest_expect_success \"unreachable loose objects are packed (expire $expire)\" '\n\t\tgit init repo &&\n\t\ttest_when_finished \"rm -fr repo\" &&\n\t\t(\n\t\t\tcd repo &&\n\n\t\t\ttest_commit base &&\n\t\t\tgit repack -Ad &&\n\t\t\ttest_commit loose &&\n\n\t\t\ttest-tool chmtime +2000 \"$objdir/$(test_oid_to_path \\\n\t\t\t\t$(git rev-parse loose:loose.t))\" &&\n\t\t\ttest-tool chmtime +1000 \"$objdir/$(test_oid_to_path \\\n\t\t\t\t$(git rev-parse loose^{tree}))\" &&\n\n\t\t\t(\n\t\t\t\tgit rev-list --objects --no-object-names base..loose |\n\t\t\t\twhile read oid\n\t\t\t\tdo\n\t\t\t\t\tpath=\"$objdir/$(test_oid_to_path \"$oid\")\" &&\n\t\t\t\t\tprintf \"%s %d\\n\" \"$oid\" \"$(test-tool chmtime --get \"$path\")\"\n\t\t\t\tdone |\n\t\t\t\tsort -k1\n\t\t\t) >expect &&\n\n\t\t\tkeep=\"$(basename \"$(ls $packdir/pack-*.pack)\")\" &&\n\t\t\tcruft=\"$(echo $keep | git pack-objects --cruft \\\n\t\t\t\t--cruft-expiration=\"$expire\" $packdir/pack)\" &&\n\t\t\ttest-tool pack-mtimes \"pack-$cruft.mtimes\" >actual &&\n\n\t\t\ttest_cmp expect actual\n\t\t)\n\t'\n\n\ttest_expect_success \"unreachable packed objects are packed (expire $expire)\" '\n\t\tgit init repo &&\n\t\ttest_when_finished \"rm -fr repo\" &&\n\t\t(\n\t\t\tcd repo &&\n\n\t\t\ttest_commit packed &&\n\t\t\tgit repack -Ad &&\n\t\t\ttest_commit other &&\n\n\t\t\tgit rev-list --objects --no-object-names packed.. >objects &&\n\t\t\tkeep=\"$(basename \"$(ls $packdir/pack-*.pack)\")\" &&\n\t\t\tother=\"$(git pack-objects --delta-base-offset \\\n\t\t\t\t$packdir/pack <objects)\" &&\n\t\t\tgit prune-packed &&\n\n\t\t\ttest-tool chmtime --get -100 \"$packdir/pack-$other.pack\" >expect &&\n\n\t\t\tcruft=\"$(git pack-objects --cruft --cruft-expiration=\"$expire\" $packdir/pack <<-EOF\n\t\t\t$keep\n\t\t\t-pack-$other.pack\n\t\t\tEOF\n\t\t\t)\" &&\n\t\t\ttest-tool pack-mtimes \"pack-$cruft.mtimes\" >actual.raw &&\n\n\t\t\tcut -d\" \" -f2 <actual.raw | sort -u >actual &&\n\n\t\t\ttest_cmp expect actual\n\t\t)\n\t'\n\n\ttest_expect_success \"unreachable cruft objects are repacked (expire $expire)\" '\n\t\tgit init repo &&\n\t\ttest_when_finished \"rm -fr repo\" &&\n\t\t(\n\t\t\tcd repo &&\n\n\t\t\ttest_commit packed &&\n\t\t\tgit repack -Ad &&\n\t\t\ttest_commit other &&\n\n\t\t\tgit rev-list --objects --no-object-names packed.. >objects &&\n\t\t\tkeep=\"$(basename \"$(ls $packdir/pack-*.pack)\")\" &&\n\n\t\t\tcruft_a=\"$(echo $keep | git pack-objects --cruft --cruft-expiration=\"$expire\" $packdir/pack)\" &&\n\t\t\tgit prune-packed &&\n\t\t\tcruft_b=\"$(git pack-objects --cruft --cruft-expiration=\"$expire\" $packdir/pack <<-EOF\n\t\t\t$keep\n\t\t\t-pack-$cruft_a.pack\n\t\t\tEOF\n\t\t\t)\" &&\n\n\t\t\ttest-tool pack-mtimes \"pack-$cruft_a.mtimes\" >expect.raw &&\n\t\t\ttest-tool pack-mtimes \"pack-$cruft_b.mtimes\" >actual.raw &&\n\n\t\t\tsort <expect.raw >expect &&\n\t\t\tsort <actual.raw >actual &&\n\n\t\t\ttest_cmp expect actual\n\t\t)\n\t'\n\n\ttest_expect_success \"multiple cruft packs (expire $expire)\" '\n\t\tgit init repo &&\n\t\ttest_when_finished \"rm -fr repo\" &&\n\t\t(\n\t\t\tcd repo &&\n\n\t\t\ttest_commit reachable &&\n\t\t\tgit repack -Ad &&\n\t\t\tkeep=\"$(basename \"$(ls $packdir/pack-*.pack)\")\" &&\n\n\t\t\ttest_commit cruft &&\n\t\t\tloose=\"$objdir/$(test_oid_to_path $(git rev-parse cruft))\" &&\n\n\t\t\t# generate three copies of the cruft object in different\n\t\t\t# cruft packs, each with a unique mtime:\n\t\t\t#   - one expired (1000 seconds ago)\n\t\t\t#   - two non-expired (one 1000 seconds in the future,\n\t\t\t#     one 1500 seconds in the future)\n\t\t\ttest-tool chmtime =-1000 \"$loose\" &&\n\t\t\tgit pack-objects --cruft $packdir/pack-A <<-EOF &&\n\t\t\t$keep\n\t\t\tEOF\n\t\t\ttest-tool chmtime =+1000 \"$loose\" &&\n\t\t\tgit pack-objects --cruft $packdir/pack-B <<-EOF &&\n\t\t\t$keep\n\t\t\t-$(basename $(ls $packdir/pack-A-*.pack))\n\t\t\tEOF\n\t\t\ttest-tool chmtime =+1500 \"$loose\" &&\n\t\t\tgit pack-objects --cruft $packdir/pack-C <<-EOF &&\n\t\t\t$keep\n\t\t\t-$(basename $(ls $packdir/pack-A-*.pack))\n\t\t\t-$(basename $(ls $packdir/pack-B-*.pack))\n\t\t\tEOF\n\n\t\t\t# ensure the resulting cruft pack takes the most recent\n\t\t\t# mtime among all copies\n\t\t\tcruft=\"$(git pack-objects --cruft \\\n\t\t\t\t--cruft-expiration=\"$expire\" \\\n\t\t\t\t$packdir/pack <<-EOF\n\t\t\t$keep\n\t\t\t-$(basename $(ls $packdir/pack-A-*.pack))\n\t\t\t-$(basename $(ls $packdir/pack-B-*.pack))\n\t\t\t-$(basename $(ls $packdir/pack-C-*.pack))\n\t\t\tEOF\n\t\t\t)\" &&\n\n\t\t\ttest-tool pack-mtimes \"$(basename $(ls $packdir/pack-C-*.mtimes))\" >expect.raw &&\n\t\t\ttest-tool pack-mtimes \"pack-$cruft.mtimes\" >actual.raw &&\n\n\t\t\tsort expect.raw >expect &&\n\t\t\tsort actual.raw >actual &&\n\t\t\ttest_cmp expect actual\n\t\t)\n\t'\n\n\ttest_expect_success \"cruft packs tolerate missing trees (expire $expire)\" '\n\t\tgit init repo &&\n\t\ttest_when_finished \"rm -fr repo\" &&\n\t\t(\n\t\t\tcd repo &&\n\n\t\t\ttest_commit reachable &&\n\t\t\ttest_commit cruft &&\n\n\t\t\ttree=\"$(git rev-parse cruft^{tree})\" &&\n\n\t\t\tgit reset --hard reachable &&\n\t\t\tgit tag -d cruft &&\n\t\t\tgit reflog expire --all --expire=all &&\n\n\t\t\t# remove the unreachable tree, but leave the commit\n\t\t\t# which has it as its root tree intact\n\t\t\trm -fr \"$objdir/$(test_oid_to_path \"$tree\")\" &&\n\n\t\t\tgit repack -Ad &&\n\t\t\tbasename $(ls $packdir/pack-*.pack) >in &&\n\t\t\tgit pack-objects --cruft --cruft-expiration=\"$expire\" \\\n\t\t\t\t$packdir/pack <in\n\t\t)\n\t'\n\n\ttest_expect_success \"cruft packs tolerate missing blobs (expire $expire)\" '\n\t\tgit init repo &&\n\t\ttest_when_finished \"rm -fr repo\" &&\n\t\t(\n\t\t\tcd repo &&\n\n\t\t\ttest_commit reachable &&\n\t\t\ttest_commit cruft &&\n\n\t\t\tblob=\"$(git rev-parse cruft:cruft.t)\" &&\n\n\t\t\tgit reset --hard reachable &&\n\t\t\tgit tag -d cruft &&\n\t\t\tgit reflog expire --all --expire=all &&\n\n\t\t\t# remove the unreachable blob, but leave the commit (and\n\t\t\t# the root tree of that commit) intact\n\t\t\trm -fr \"$objdir/$(test_oid_to_path \"$blob\")\" &&\n\n\t\t\tgit repack -Ad &&\n\t\t\tbasename $(ls $packdir/pack-*.pack) >in &&\n\t\t\tgit pack-objects --cruft --cruft-expiration=\"$expire\" \\\n\t\t\t\t$packdir/pack <in\n\t\t)\n\t'\n}\n\nbasic_cruft_pack_tests never\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "003ca7344eb0349b700436831616fc4a1e961ece",
  "sha1_ok": true,
  "size": 5710
}
