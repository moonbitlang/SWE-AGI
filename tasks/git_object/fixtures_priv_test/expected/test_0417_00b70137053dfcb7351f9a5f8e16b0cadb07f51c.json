{
  "content": {
    "base64": "IyEvYmluL3NoCgp0ZXN0X2Rlc2NyaXB0aW9uPSdUZXN0IGdpdCB1cGRhdGUtcmVmIGVycm9yIGhhbmRsaW5nJwoKVEVTVF9QQVNTRVNfU0FOSVRJWkVfTEVBSz10cnVlCi4gLi90ZXN0LWxpYi5zaAoKIyBDcmVhdGUgc29tZSByZWZlcmVuY2VzLCBwZXJoYXBzIHJ1biBwYWNrLXJlZnMgLS1hbGwsIHRoZW4gdHJ5IHRvCiMgY3JlYXRlIHNvbWUgbW9yZSByZWZlcmVuY2VzLiBFbnN1cmUgdGhhdCB0aGUgc2Vjb25kIGNyZWF0aW9uIGZhaWxzCiMgd2l0aCB0aGUgY29ycmVjdCBlcnJvciBtZXNzYWdlLgojIFVzYWdlOiB0ZXN0X3VwZGF0ZV9yZWplY3RlZCA8YmVmb3JlPiA8cGFjaz4gPGNyZWF0ZT4gPGVycm9yPgojICAgPGJlZm9yZT4gaXMgYSB3cy1zZXBhcmF0ZWQgbGlzdCBvZiByZWZzIHRvIGNyZWF0ZSBiZWZvcmUgdGhlIHRlc3QKIyAgIDxwYWNrPiAodHJ1ZSBvciBmYWxzZSkgdGVsbHMgd2hldGhlciB0byBwYWNrIHRoZSByZWZzIGJlZm9yZSB0aGUgdGVzdAojICAgPGNyZWF0ZT4gaXMgYSBsaXN0IG9mIHZhcmlhYmxlcyB0byBhdHRlbXB0IGNyZWF0aW5nCiMgICA8ZXJyb3I+IGlzIGEgc3RyaW5nIHRvIGxvb2sgZm9yIGluIHRoZSBzdGRlcnIgb2YgdXBkYXRlLXJlZi4KIyBBbGwgcmVmZXJlbmNlcyBhcmUgY3JlYXRlZCBpbiB0aGUgbmFtZXNwYWNlIHNwZWNpZmllZCBieSB0aGUgY3VycmVudAojIHZhbHVlIG9mICRwcmVmaXguCnRlc3RfdXBkYXRlX3JlamVjdGVkICgpIHsKCWJlZm9yZT0iJDEiICYmCglwYWNrPSIkMiIgJiYKCWNyZWF0ZT0iJDMiICYmCgllcnJvcj0iJDQiICYmCglwcmludGYgImNyZWF0ZSAkcHJlZml4LyVzICRDXG4iICRiZWZvcmUgfAoJZ2l0IHVwZGF0ZS1yZWYgLS1zdGRpbiAmJgoJZ2l0IGZvci1lYWNoLXJlZiAkcHJlZml4ID51bmNoYW5nZWQgJiYKCWlmICRwYWNrCgl0aGVuCgkJZ2l0IHBhY2stcmVmcyAtLWFsbAoJZmkgJiYKCXByaW50ZiAiY3JlYXRlICRwcmVmaXgvJXMgJENcbiIgJGNyZWF0ZSA+aW5wdXQgJiYKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC0tc3RkaW4gPGlucHV0IDI+b3V0cHV0LmVyciAmJgoJdGVzdF9ncmVwIC1GICIkZXJyb3IiIG91dHB1dC5lcnIgJiYKCWdpdCBmb3ItZWFjaC1yZWYgJHByZWZpeCA+YWN0dWFsICYmCgl0ZXN0X2NtcCB1bmNoYW5nZWQgYWN0dWFsCn0KCiMgVGVzdCBhZGRpbmcgYW5kIGRlbGV0aW5nIEQvRi1jb25mbGljdGluZyByZWZlcmVuY2VzIGluIGEgc2luZ2xlCiMgdHJhbnNhY3Rpb24uCmRmX3Rlc3QoKSB7CglwcmVmaXg9IiQxIgoJcGFjaz06IHN5bWFkZD1mYWxzZSBzeW1kZWw9ZmFsc2UgYWRkX2RlbD1mYWxzZSBhZGRyZWY9IGRlbHJlZj0KCXNoaWZ0Cgl3aGlsZSB0ZXN0ICQjIC1ndCAwCglkbwoJCWNhc2UgIiQxIiBpbgoJCS0tcGFjaykKCQkJcGFjaz0iZ2l0IHBhY2stcmVmcyAtLWFsbCIKCQkJc2hpZnQKCQkJOzsKCQktLXN5bS1hZGQpCgkJCSMgUGVyZm9ybSB0aGUgYWRkIHZpYSBhIHN5bWJvbGljIHJlZmVyZW5jZQoJCQlzeW1hZGQ9dHJ1ZQoJCQlzaGlmdAoJCQk7OwoJCS0tc3ltLWRlbCkKCQkJIyBQZXJmb3JtIHRoZSBkZWwgdmlhIGEgc3ltYm9saWMgcmVmZXJlbmNlCgkJCXN5bWRlbD10cnVlCgkJCXNoaWZ0CgkJCTs7CgkJLS1kZWwtYWRkKQoJCQkjIERlbGV0ZSBmaXJzdCByZWZlcmVuY2UgdGhlbiBhZGQgc2Vjb25kCgkJCWFkZF9kZWw9ZmFsc2UKCQkJZGVscmVmPSIkcHJlZml4L3IvJDIiCgkJCWFkZHJlZj0iJHByZWZpeC9yLyQzIgoJCQlzaGlmdCAzCgkJCTs7CgkJLS1hZGQtZGVsKQoJCQkjIEFkZCBmaXJzdCByZWZlcmVuY2UgdGhlbiBkZWxldGUgc2Vjb25kCgkJCWFkZF9kZWw9dHJ1ZQoJCQlhZGRyZWY9IiRwcmVmaXgvci8kMiIKCQkJZGVscmVmPSIkcHJlZml4L3IvJDMiCgkJCXNoaWZ0IDMKCQkJOzsKCQkqKQoJCQllY2hvIDE+JjIgIkV4dHJhIGFyZ3MgdG8gZGZfdGVzdDogJCoiCgkJCXJldHVybiAxCgkJCTs7CgkJZXNhYwoJZG9uZQoJZ2l0IHVwZGF0ZS1yZWYgIiRkZWxyZWYiICRDICYmCglpZiAkc3ltYWRkCgl0aGVuCgkJYWRkbmFtZT0iJHByZWZpeC9zL3N5bWFkZCIgJiYKCQlnaXQgc3ltYm9saWMtcmVmICIkYWRkbmFtZSIgIiRhZGRyZWYiCgllbHNlCgkJYWRkbmFtZT0iJGFkZHJlZiIKCWZpICYmCglpZiAkc3ltZGVsCgl0aGVuCgkJZGVsbmFtZT0iJHByZWZpeC9zL3N5bWRlbCIgJiYKCQlnaXQgc3ltYm9saWMtcmVmICIkZGVsbmFtZSIgIiRkZWxyZWYiCgllbHNlCgkJZGVsbmFtZT0iJGRlbHJlZiIKCWZpICYmCgljYXQgPmV4cGVjdGVkLWVyciA8PC1FT0YgJiYKCWZhdGFsOiBjYW5ub3QgbG9jayByZWYgJFNRJGFkZG5hbWUkU1E6ICRTUSRkZWxyZWYkU1EgZXhpc3RzOyBjYW5ub3QgY3JlYXRlICRTUSRhZGRyZWYkU1EKCUVPRgoJJHBhY2sgJiYKCWlmICRhZGRfZGVsCgl0aGVuCgkJcHJpbnRmICIlc1xuIiAiY3JlYXRlICRhZGRuYW1lICREIiAiZGVsZXRlICRkZWxuYW1lIgoJZWxzZQoJCXByaW50ZiAiJXNcbiIgImRlbGV0ZSAkZGVsbmFtZSIgImNyZWF0ZSAkYWRkbmFtZSAkRCIKCWZpID5jb21tYW5kcyAmJgoJdGVzdF9tdXN0X2ZhaWwgZ2l0IHVwZGF0ZS1yZWYgLS1zdGRpbiA8Y29tbWFuZHMgMj5vdXRwdXQuZXJyICYmCgl0ZXN0X2NtcCBleHBlY3RlZC1lcnIgb3V0cHV0LmVyciAmJgoJcHJpbnRmICIlc1xuIiAiJEMgJGRlbHJlZiIgPmV4cGVjdGVkLXJlZnMgJiYKCWdpdCBmb3ItZWFjaC1yZWYgLS1mb3JtYXQ9IiUob2JqZWN0bmFtZSkgJShyZWZuYW1lKSIgJHByZWZpeC9yID5hY3R1YWwtcmVmcyAmJgoJdGVzdF9jbXAgZXhwZWN0ZWQtcmVmcyBhY3R1YWwtcmVmcwp9Cgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdzZXR1cCcgJwoKCWdpdCBjb21taXQgLS1hbGxvdy1lbXB0eSAtbSBJbml0aWFsICYmCglDPSQoZ2l0IHJldi1wYXJzZSBIRUFEKSAmJgoJZ2l0IGNvbW1pdCAtLWFsbG93LWVtcHR5IC1tIFNlY29uZCAmJgoJRD0kKGdpdCByZXYtcGFyc2UgSEVBRCkgJiYKCWdpdCBjb21taXQgLS1hbGxvdy1lbXB0eSAtbSBUaGlyZCAmJgoJRT0kKGdpdCByZXYtcGFyc2UgSEVBRCkKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZXhpc3RpbmcgbG9vc2UgcmVmIGlzIGEgc2ltcGxlIHByZWZpeCBvZiBuZXcnICcKCglwcmVmaXg9cmVmcy8xbCAmJgoJdGVzdF91cGRhdGVfcmVqZWN0ZWQgImEgYyBlIiBmYWxzZSAiYiBjL3ggZCIgXAoJCSIkU1EkcHJlZml4L2MkU1EgZXhpc3RzOyBjYW5ub3QgY3JlYXRlICRTUSRwcmVmaXgvYy94JFNRIgoKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZXhpc3RpbmcgcGFja2VkIHJlZiBpcyBhIHNpbXBsZSBwcmVmaXggb2YgbmV3JyAnCgoJcHJlZml4PXJlZnMvMXAgJiYKCXRlc3RfdXBkYXRlX3JlamVjdGVkICJhIGMgZSIgdHJ1ZSAiYiBjL3ggZCIgXAoJCSIkU1EkcHJlZml4L2MkU1EgZXhpc3RzOyBjYW5ub3QgY3JlYXRlICRTUSRwcmVmaXgvYy94JFNRIgoKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZXhpc3RpbmcgbG9vc2UgcmVmIGlzIGEgZGVlcGVyIHByZWZpeCBvZiBuZXcnICcKCglwcmVmaXg9cmVmcy8ybCAmJgoJdGVzdF91cGRhdGVfcmVqZWN0ZWQgImEgYyBlIiBmYWxzZSAiYiBjL3gveSBkIiBcCgkJIiRTUSRwcmVmaXgvYyRTUSBleGlzdHM7IGNhbm5vdCBjcmVhdGUgJFNRJHByZWZpeC9jL3gveSRTUSIKCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2V4aXN0aW5nIHBhY2tlZCByZWYgaXMgYSBkZWVwZXIgcHJlZml4IG9mIG5ldycgJwoKCXByZWZpeD1yZWZzLzJwICYmCgl0ZXN0X3VwZGF0ZV9yZWplY3RlZCAiYSBjIGUiIHRydWUgImIgYy94L3kgZCIgXAoJCSIkU1EkcHJlZml4L2MkU1EgZXhpc3RzOyBjYW5ub3QgY3JlYXRlICRTUSRwcmVmaXgvYy94L3kkU1EiCgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICduZXcgcmVmIGlzIGEgc2ltcGxlIHByZWZpeCBvZiBleGlzdGluZyBsb29zZScgJwoKCXByZWZpeD1yZWZzLzNsICYmCgl0ZXN0X3VwZGF0ZV9yZWplY3RlZCAiYSBjL3ggZSIgZmFsc2UgImIgYyBkIiBcCgkJIiRTUSRwcmVmaXgvYy94JFNRIGV4aXN0czsgY2Fubm90IGNyZWF0ZSAkU1EkcHJlZml4L2MkU1EiCgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICduZXcgcmVmIGlzIGEgc2ltcGxlIHByZWZpeCBvZiBleGlzdGluZyBwYWNrZWQnICcKCglwcmVmaXg9cmVmcy8zcCAmJgoJdGVzdF91cGRhdGVfcmVqZWN0ZWQgImEgYy94IGUiIHRydWUgImIgYyBkIiBcCgkJIiRTUSRwcmVmaXgvYy94JFNRIGV4aXN0czsgY2Fubm90IGNyZWF0ZSAkU1EkcHJlZml4L2MkU1EiCgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICduZXcgcmVmIGlzIGEgZGVlcGVyIHByZWZpeCBvZiBleGlzdGluZyBsb29zZScgJwoKCXByZWZpeD1yZWZzLzRsICYmCgl0ZXN0X3VwZGF0ZV9yZWplY3RlZCAiYSBjL3gveSBlIiBmYWxzZSAiYiBjIGQiIFwKCQkiJFNRJHByZWZpeC9jL3gveSRTUSBleGlzdHM7IGNhbm5vdCBjcmVhdGUgJFNRJHByZWZpeC9jJFNRIgoKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbmV3IHJlZiBpcyBhIGRlZXBlciBwcmVmaXggb2YgZXhpc3RpbmcgcGFja2VkJyAnCgoJcHJlZml4PXJlZnMvNHAgJiYKCXRlc3RfdXBkYXRlX3JlamVjdGVkICJhIGMveC95IGUiIHRydWUgImIgYyBkIiBcCgkJIiRTUSRwcmVmaXgvYy94L3kkU1EgZXhpc3RzOyBjYW5ub3QgY3JlYXRlICRTUSRwcmVmaXgvYyRTUSIKCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ29uZSBuZXcgcmVmIGlzIGEgc2ltcGxlIHByZWZpeCBvZiBhbm90aGVyJyAnCgoJcHJlZml4PXJlZnMvNSAmJgoJdGVzdF91cGRhdGVfcmVqZWN0ZWQgImEgZSIgZmFsc2UgImIgYyBjL3ggZCIgXAoJCSJjYW5ub3QgcHJvY2VzcyAkU1EkcHJlZml4L2MkU1EgYW5kICRTUSRwcmVmaXgvYy94JFNRIGF0IHRoZSBzYW1lIHRpbWUiCgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIFJFRkZJTEVTICdEL0YgY29uZmxpY3QgcHJldmVudHMgYWRkIGxvbmcgKyBkZWxldGUgc2hvcnQnICcKCWRmX3Rlc3QgcmVmcy9kZi1hbC1kcyAtLWFkZC1kZWwgZm9vL2JhciBmb28KJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyBSRUZGSUxFUyAnRC9GIGNvbmZsaWN0IHByZXZlbnRzIGFkZCBzaG9ydCArIGRlbGV0ZSBsb25nJyAnCglkZl90ZXN0IHJlZnMvZGYtYXMtZGwgLS1hZGQtZGVsIGZvbyBmb28vYmFyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgUkVGRklMRVMgJ0QvRiBjb25mbGljdCBwcmV2ZW50cyBkZWxldGUgbG9uZyArIGFkZCBzaG9ydCcgJwoJZGZfdGVzdCByZWZzL2RmLWRsLWFzIC0tZGVsLWFkZCBmb28vYmFyIGZvbwonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIFJFRkZJTEVTICdEL0YgY29uZmxpY3QgcHJldmVudHMgZGVsZXRlIHNob3J0ICsgYWRkIGxvbmcnICcKCWRmX3Rlc3QgcmVmcy9kZi1kcy1hbCAtLWRlbC1hZGQgZm9vIGZvby9iYXIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyBSRUZGSUxFUyAnRC9GIGNvbmZsaWN0IHByZXZlbnRzIGFkZCBsb25nICsgZGVsZXRlIHNob3J0IHBhY2tlZCcgJwoJZGZfdGVzdCByZWZzL2RmLWFsLWRzcCAtLXBhY2sgLS1hZGQtZGVsIGZvby9iYXIgZm9vCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgUkVGRklMRVMgJ0QvRiBjb25mbGljdCBwcmV2ZW50cyBhZGQgc2hvcnQgKyBkZWxldGUgbG9uZyBwYWNrZWQnICcKCWRmX3Rlc3QgcmVmcy9kZi1hcy1kbHAgLS1wYWNrIC0tYWRkLWRlbCBmb28gZm9vL2JhcgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIFJFRkZJTEVTICdEL0YgY29uZmxpY3QgcHJldmVudHMgZGVsZXRlIGxvbmcgcGFja2VkICsgYWRkIHNob3J0JyAnCglkZl90ZXN0IHJlZnMvZGYtZGxwLWFzIC0tcGFjayAtLWRlbC1hZGQgZm9vL2JhciBmb28KJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyBSRUZGSUxFUyAnRC9GIGNvbmZsaWN0IHByZXZlbnRzIGRlbGV0ZSBzaG9ydCBwYWNrZWQgKyBhZGQgbG9uZycgJwoJZGZfdGVzdCByZWZzL2RmLWRzcC1hbCAtLXBhY2sgLS1kZWwtYWRkIGZvbyBmb28vYmFyCicKCiMgVHJ5IHNvbWUgY29tYmluYXRpb25zIGludm9sdmluZyBzeW1ib2xpYyByZWZzLi4uCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIFJFRkZJTEVTICdEL0YgY29uZmxpY3QgcHJldmVudHMgaW5kaXJlY3QgYWRkIGxvbmcgKyBkZWxldGUgc2hvcnQnICcKCWRmX3Rlc3QgcmVmcy9kZi1pYWwtZHMgLS1zeW0tYWRkIC0tYWRkLWRlbCBmb28vYmFyIGZvbwonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIFJFRkZJTEVTICdEL0YgY29uZmxpY3QgcHJldmVudHMgaW5kaXJlY3QgYWRkIGxvbmcgKyBpbmRpcmVjdCBkZWxldGUgc2hvcnQnICcKCWRmX3Rlc3QgcmVmcy9kZi1pYWwtaWRzIC0tc3ltLWFkZCAtLXN5bS1kZWwgLS1hZGQtZGVsIGZvby9iYXIgZm9vCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgUkVGRklMRVMgJ0QvRiBjb25mbGljdCBwcmV2ZW50cyBpbmRpcmVjdCBhZGQgc2hvcnQgKyBpbmRpcmVjdCBkZWxldGUgbG9uZycgJwoJZGZfdGVzdCByZWZzL2RmLWlhcy1pZGwgLS1zeW0tYWRkIC0tc3ltLWRlbCAtLWFkZC1kZWwgZm9vIGZvby9iYXIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyBSRUZGSUxFUyAnRC9GIGNvbmZsaWN0IHByZXZlbnRzIGluZGlyZWN0IGRlbGV0ZSBsb25nICsgaW5kaXJlY3QgYWRkIHNob3J0JyAnCglkZl90ZXN0IHJlZnMvZGYtaWRsLWlhcyAtLXN5bS1hZGQgLS1zeW0tZGVsIC0tZGVsLWFkZCBmb28vYmFyIGZvbwonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIFJFRkZJTEVTICdEL0YgY29uZmxpY3QgcHJldmVudHMgaW5kaXJlY3QgYWRkIGxvbmcgKyBkZWxldGUgc2hvcnQgcGFja2VkJyAnCglkZl90ZXN0IHJlZnMvZGYtaWFsLWRzcCAtLXN5bS1hZGQgLS1wYWNrIC0tYWRkLWRlbCBmb28vYmFyIGZvbwonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIFJFRkZJTEVTICdEL0YgY29uZmxpY3QgcHJldmVudHMgaW5kaXJlY3QgYWRkIGxvbmcgKyBpbmRpcmVjdCBkZWxldGUgc2hvcnQgcGFja2VkJyAnCglkZl90ZXN0IHJlZnMvZGYtaWFsLWlkc3AgLS1zeW0tYWRkIC0tc3ltLWRlbCAtLXBhY2sgLS1hZGQtZGVsIGZvby9iYXIgZm9vCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgUkVGRklMRVMgJ0QvRiBjb25mbGljdCBwcmV2ZW50cyBhZGQgbG9uZyArIGluZGlyZWN0IGRlbGV0ZSBzaG9ydCBwYWNrZWQnICcKCWRmX3Rlc3QgcmVmcy9kZi1hbC1pZHNwIC0tc3ltLWRlbCAtLXBhY2sgLS1hZGQtZGVsIGZvby9iYXIgZm9vCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgUkVGRklMRVMgJ0QvRiBjb25mbGljdCBwcmV2ZW50cyBpbmRpcmVjdCBkZWxldGUgbG9uZyBwYWNrZWQgKyBpbmRpcmVjdCBhZGQgc2hvcnQnICcKCWRmX3Rlc3QgcmVmcy9kZi1pZGxwLWlhcyAtLXN5bS1hZGQgLS1zeW0tZGVsIC0tcGFjayAtLWRlbC1hZGQgZm9vL2JhciBmb28KJwoKIyBUZXN0IHZhcmlvdXMgZXJyb3JzIHdoZW4gcmVhZGluZyB0aGUgb2xkIHZhbHVlcyBvZiByZWZlcmVuY2VzLi4uCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdtaXNzaW5nIG9sZCB2YWx1ZSBibG9ja3MgdXBkYXRlJyAnCglwcmVmaXg9cmVmcy9taXNzaW5nLXVwZGF0ZSAmJgoJY2F0ID5leHBlY3RlZCA8PC1FT0YgJiYKCWZhdGFsOiBjYW5ub3QgbG9jayByZWYgJFNRJHByZWZpeC9mb28kU1E6IHVuYWJsZSB0byByZXNvbHZlIHJlZmVyZW5jZSAkU1EkcHJlZml4L2ZvbyRTUQoJRU9GCglwcmludGYgIiVzXG4iICJ1cGRhdGUgJHByZWZpeC9mb28gJEUgJEQiIHwKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC0tc3RkaW4gMj5vdXRwdXQuZXJyICYmCgl0ZXN0X2NtcCBleHBlY3RlZCBvdXRwdXQuZXJyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2luY29ycmVjdCBvbGQgdmFsdWUgYmxvY2tzIHVwZGF0ZScgJwoJcHJlZml4PXJlZnMvaW5jb3JyZWN0LXVwZGF0ZSAmJgoJZ2l0IHVwZGF0ZS1yZWYgJHByZWZpeC9mb28gJEMgJiYKCWNhdCA+ZXhwZWN0ZWQgPDwtRU9GICYmCglmYXRhbDogY2Fubm90IGxvY2sgcmVmICRTUSRwcmVmaXgvZm9vJFNROiBpcyBhdCAkQyBidXQgZXhwZWN0ZWQgJEQKCUVPRgoJcHJpbnRmICIlc1xuIiAidXBkYXRlICRwcmVmaXgvZm9vICRFICREIiB8Cgl0ZXN0X211c3RfZmFpbCBnaXQgdXBkYXRlLXJlZiAtLXN0ZGluIDI+b3V0cHV0LmVyciAmJgoJdGVzdF9jbXAgZXhwZWN0ZWQgb3V0cHV0LmVycgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdleGlzdGluZyBvbGQgdmFsdWUgYmxvY2tzIGNyZWF0ZScgJwoJcHJlZml4PXJlZnMvZXhpc3RpbmctY3JlYXRlICYmCglnaXQgdXBkYXRlLXJlZiAkcHJlZml4L2ZvbyAkQyAmJgoJY2F0ID5leHBlY3RlZCA8PC1FT0YgJiYKCWZhdGFsOiBjYW5ub3QgbG9jayByZWYgJFNRJHByZWZpeC9mb28kU1E6IHJlZmVyZW5jZSBhbHJlYWR5IGV4aXN0cwoJRU9GCglwcmludGYgIiVzXG4iICJjcmVhdGUgJHByZWZpeC9mb28gJEUiIHwKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC0tc3RkaW4gMj5vdXRwdXQuZXJyICYmCgl0ZXN0X2NtcCBleHBlY3RlZCBvdXRwdXQuZXJyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2luY29ycmVjdCBvbGQgdmFsdWUgYmxvY2tzIGRlbGV0ZScgJwoJcHJlZml4PXJlZnMvaW5jb3JyZWN0LWRlbGV0ZSAmJgoJZ2l0IHVwZGF0ZS1yZWYgJHByZWZpeC9mb28gJEMgJiYKCWNhdCA+ZXhwZWN0ZWQgPDwtRU9GICYmCglmYXRhbDogY2Fubm90IGxvY2sgcmVmICRTUSRwcmVmaXgvZm9vJFNROiBpcyBhdCAkQyBidXQgZXhwZWN0ZWQgJEQKCUVPRgoJcHJpbnRmICIlc1xuIiAiZGVsZXRlICRwcmVmaXgvZm9vICREIiB8Cgl0ZXN0X211c3RfZmFpbCBnaXQgdXBkYXRlLXJlZiAtLXN0ZGluIDI+b3V0cHV0LmVyciAmJgoJdGVzdF9jbXAgZXhwZWN0ZWQgb3V0cHV0LmVycgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdtaXNzaW5nIG9sZCB2YWx1ZSBibG9ja3MgaW5kaXJlY3QgdXBkYXRlJyAnCglwcmVmaXg9cmVmcy9taXNzaW5nLWluZGlyZWN0LXVwZGF0ZSAmJgoJZ2l0IHN5bWJvbGljLXJlZiAkcHJlZml4L3N5bXJlZiAkcHJlZml4L2ZvbyAmJgoJY2F0ID5leHBlY3RlZCA8PC1FT0YgJiYKCWZhdGFsOiBjYW5ub3QgbG9jayByZWYgJFNRJHByZWZpeC9zeW1yZWYkU1E6IHVuYWJsZSB0byByZXNvbHZlIHJlZmVyZW5jZSAkU1EkcHJlZml4L2ZvbyRTUQoJRU9GCglwcmludGYgIiVzXG4iICJ1cGRhdGUgJHByZWZpeC9zeW1yZWYgJEUgJEQiIHwKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC0tc3RkaW4gMj5vdXRwdXQuZXJyICYmCgl0ZXN0X2NtcCBleHBlY3RlZCBvdXRwdXQuZXJyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2luY29ycmVjdCBvbGQgdmFsdWUgYmxvY2tzIGluZGlyZWN0IHVwZGF0ZScgJwoJcHJlZml4PXJlZnMvaW5jb3JyZWN0LWluZGlyZWN0LXVwZGF0ZSAmJgoJZ2l0IHN5bWJvbGljLXJlZiAkcHJlZml4L3N5bXJlZiAkcHJlZml4L2ZvbyAmJgoJZ2l0IHVwZGF0ZS1yZWYgJHByZWZpeC9mb28gJEMgJiYKCWNhdCA+ZXhwZWN0ZWQgPDwtRU9GICYmCglmYXRhbDogY2Fubm90IGxvY2sgcmVmICRTUSRwcmVmaXgvc3ltcmVmJFNROiBpcyBhdCAkQyBidXQgZXhwZWN0ZWQgJEQKCUVPRgoJcHJpbnRmICIlc1xuIiAidXBkYXRlICRwcmVmaXgvc3ltcmVmICRFICREIiB8Cgl0ZXN0X211c3RfZmFpbCBnaXQgdXBkYXRlLXJlZiAtLXN0ZGluIDI+b3V0cHV0LmVyciAmJgoJdGVzdF9jbXAgZXhwZWN0ZWQgb3V0cHV0LmVycgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdleGlzdGluZyBvbGQgdmFsdWUgYmxvY2tzIGluZGlyZWN0IGNyZWF0ZScgJwoJcHJlZml4PXJlZnMvZXhpc3RpbmctaW5kaXJlY3QtY3JlYXRlICYmCglnaXQgc3ltYm9saWMtcmVmICRwcmVmaXgvc3ltcmVmICRwcmVmaXgvZm9vICYmCglnaXQgdXBkYXRlLXJlZiAkcHJlZml4L2ZvbyAkQyAmJgoJY2F0ID5leHBlY3RlZCA8PC1FT0YgJiYKCWZhdGFsOiBjYW5ub3QgbG9jayByZWYgJFNRJHByZWZpeC9zeW1yZWYkU1E6IHJlZmVyZW5jZSBhbHJlYWR5IGV4aXN0cwoJRU9GCglwcmludGYgIiVzXG4iICJjcmVhdGUgJHByZWZpeC9zeW1yZWYgJEUiIHwKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC0tc3RkaW4gMj5vdXRwdXQuZXJyICYmCgl0ZXN0X2NtcCBleHBlY3RlZCBvdXRwdXQuZXJyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2luY29ycmVjdCBvbGQgdmFsdWUgYmxvY2tzIGluZGlyZWN0IGRlbGV0ZScgJwoJcHJlZml4PXJlZnMvaW5jb3JyZWN0LWluZGlyZWN0LWRlbGV0ZSAmJgoJZ2l0IHN5bWJvbGljLXJlZiAkcHJlZml4L3N5bXJlZiAkcHJlZml4L2ZvbyAmJgoJZ2l0IHVwZGF0ZS1yZWYgJHByZWZpeC9mb28gJEMgJiYKCWNhdCA+ZXhwZWN0ZWQgPDwtRU9GICYmCglmYXRhbDogY2Fubm90IGxvY2sgcmVmICRTUSRwcmVmaXgvc3ltcmVmJFNROiBpcyBhdCAkQyBidXQgZXhwZWN0ZWQgJEQKCUVPRgoJcHJpbnRmICIlc1xuIiAiZGVsZXRlICRwcmVmaXgvc3ltcmVmICREIiB8Cgl0ZXN0X211c3RfZmFpbCBnaXQgdXBkYXRlLXJlZiAtLXN0ZGluIDI+b3V0cHV0LmVyciAmJgoJdGVzdF9jbXAgZXhwZWN0ZWQgb3V0cHV0LmVycgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdtaXNzaW5nIG9sZCB2YWx1ZSBibG9ja3MgaW5kaXJlY3Qgbm8tZGVyZWYgdXBkYXRlJyAnCglwcmVmaXg9cmVmcy9taXNzaW5nLW5vZGVyZWYtdXBkYXRlICYmCglnaXQgc3ltYm9saWMtcmVmICRwcmVmaXgvc3ltcmVmICRwcmVmaXgvZm9vICYmCgljYXQgPmV4cGVjdGVkIDw8LUVPRiAmJgoJZmF0YWw6IGNhbm5vdCBsb2NrIHJlZiAkU1EkcHJlZml4L3N5bXJlZiRTUTogcmVmZXJlbmNlIGlzIG1pc3NpbmcgYnV0IGV4cGVjdGVkICRECglFT0YKCXByaW50ZiAiJXNcbiIgIm9wdGlvbiBuby1kZXJlZiIgInVwZGF0ZSAkcHJlZml4L3N5bXJlZiAkRSAkRCIgfAoJdGVzdF9tdXN0X2ZhaWwgZ2l0IHVwZGF0ZS1yZWYgLS1zdGRpbiAyPm91dHB1dC5lcnIgJiYKCXRlc3RfY21wIGV4cGVjdGVkIG91dHB1dC5lcnIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnaW5jb3JyZWN0IG9sZCB2YWx1ZSBibG9ja3MgaW5kaXJlY3Qgbm8tZGVyZWYgdXBkYXRlJyAnCglwcmVmaXg9cmVmcy9pbmNvcnJlY3Qtbm9kZXJlZi11cGRhdGUgJiYKCWdpdCBzeW1ib2xpYy1yZWYgJHByZWZpeC9zeW1yZWYgJHByZWZpeC9mb28gJiYKCWdpdCB1cGRhdGUtcmVmICRwcmVmaXgvZm9vICRDICYmCgljYXQgPmV4cGVjdGVkIDw8LUVPRiAmJgoJZmF0YWw6IGNhbm5vdCBsb2NrIHJlZiAkU1EkcHJlZml4L3N5bXJlZiRTUTogaXMgYXQgJEMgYnV0IGV4cGVjdGVkICRECglFT0YKCXByaW50ZiAiJXNcbiIgIm9wdGlvbiBuby1kZXJlZiIgInVwZGF0ZSAkcHJlZml4L3N5bXJlZiAkRSAkRCIgfAoJdGVzdF9tdXN0X2ZhaWwgZ2l0IHVwZGF0ZS1yZWYgLS1zdGRpbiAyPm91dHB1dC5lcnIgJiYKCXRlc3RfY21wIGV4cGVjdGVkIG91dHB1dC5lcnIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZXhpc3Rpbmcgb2xkIHZhbHVlIGJsb2NrcyBpbmRpcmVjdCBuby1kZXJlZiBjcmVhdGUnICcKCXByZWZpeD1yZWZzL2V4aXN0aW5nLW5vZGVyZWYtY3JlYXRlICYmCglnaXQgc3ltYm9saWMtcmVmICRwcmVmaXgvc3ltcmVmICRwcmVmaXgvZm9vICYmCglnaXQgdXBkYXRlLXJlZiAkcHJlZml4L2ZvbyAkQyAmJgoJY2F0ID5leHBlY3RlZCA8PC1FT0YgJiYKCWZhdGFsOiBjYW5ub3QgbG9jayByZWYgJFNRJHByZWZpeC9zeW1yZWYkU1E6IHJlZmVyZW5jZSBhbHJlYWR5IGV4aXN0cwoJRU9GCglwcmludGYgIiVzXG4iICJvcHRpb24gbm8tZGVyZWYiICJjcmVhdGUgJHByZWZpeC9zeW1yZWYgJEUiIHwKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC0tc3RkaW4gMj5vdXRwdXQuZXJyICYmCgl0ZXN0X2NtcCBleHBlY3RlZCBvdXRwdXQuZXJyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2luY29ycmVjdCBvbGQgdmFsdWUgYmxvY2tzIGluZGlyZWN0IG5vLWRlcmVmIGRlbGV0ZScgJwoJcHJlZml4PXJlZnMvaW5jb3JyZWN0LW5vZGVyZWYtZGVsZXRlICYmCglnaXQgc3ltYm9saWMtcmVmICRwcmVmaXgvc3ltcmVmICRwcmVmaXgvZm9vICYmCglnaXQgdXBkYXRlLXJlZiAkcHJlZml4L2ZvbyAkQyAmJgoJY2F0ID5leHBlY3RlZCA8PC1FT0YgJiYKCWZhdGFsOiBjYW5ub3QgbG9jayByZWYgJFNRJHByZWZpeC9zeW1yZWYkU1E6IGlzIGF0ICRDIGJ1dCBleHBlY3RlZCAkRAoJRU9GCglwcmludGYgIiVzXG4iICJvcHRpb24gbm8tZGVyZWYiICJkZWxldGUgJHByZWZpeC9zeW1yZWYgJEQiIHwKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC0tc3RkaW4gMj5vdXRwdXQuZXJyICYmCgl0ZXN0X2NtcCBleHBlY3RlZCBvdXRwdXQuZXJyCicKCnRlc3RfZG9uZQo=",
    "text": "#!/bin/sh\n\ntest_description='Test git update-ref error handling'\n\nTEST_PASSES_SANITIZE_LEAK=true\n. ./test-lib.sh\n\n# Create some references, perhaps run pack-refs --all, then try to\n# create some more references. Ensure that the second creation fails\n# with the correct error message.\n# Usage: test_update_rejected <before> <pack> <create> <error>\n#   <before> is a ws-separated list of refs to create before the test\n#   <pack> (true or false) tells whether to pack the refs before the test\n#   <create> is a list of variables to attempt creating\n#   <error> is a string to look for in the stderr of update-ref.\n# All references are created in the namespace specified by the current\n# value of $prefix.\ntest_update_rejected () {\n\tbefore=\"$1\" &&\n\tpack=\"$2\" &&\n\tcreate=\"$3\" &&\n\terror=\"$4\" &&\n\tprintf \"create $prefix/%s $C\\n\" $before |\n\tgit update-ref --stdin &&\n\tgit for-each-ref $prefix >unchanged &&\n\tif $pack\n\tthen\n\t\tgit pack-refs --all\n\tfi &&\n\tprintf \"create $prefix/%s $C\\n\" $create >input &&\n\ttest_must_fail git update-ref --stdin <input 2>output.err &&\n\ttest_grep -F \"$error\" output.err &&\n\tgit for-each-ref $prefix >actual &&\n\ttest_cmp unchanged actual\n}\n\n# Test adding and deleting D/F-conflicting references in a single\n# transaction.\ndf_test() {\n\tprefix=\"$1\"\n\tpack=: symadd=false symdel=false add_del=false addref= delref=\n\tshift\n\twhile test $# -gt 0\n\tdo\n\t\tcase \"$1\" in\n\t\t--pack)\n\t\t\tpack=\"git pack-refs --all\"\n\t\t\tshift\n\t\t\t;;\n\t\t--sym-add)\n\t\t\t# Perform the add via a symbolic reference\n\t\t\tsymadd=true\n\t\t\tshift\n\t\t\t;;\n\t\t--sym-del)\n\t\t\t# Perform the del via a symbolic reference\n\t\t\tsymdel=true\n\t\t\tshift\n\t\t\t;;\n\t\t--del-add)\n\t\t\t# Delete first reference then add second\n\t\t\tadd_del=false\n\t\t\tdelref=\"$prefix/r/$2\"\n\t\t\taddref=\"$prefix/r/$3\"\n\t\t\tshift 3\n\t\t\t;;\n\t\t--add-del)\n\t\t\t# Add first reference then delete second\n\t\t\tadd_del=true\n\t\t\taddref=\"$prefix/r/$2\"\n\t\t\tdelref=\"$prefix/r/$3\"\n\t\t\tshift 3\n\t\t\t;;\n\t\t*)\n\t\t\techo 1>&2 \"Extra args to df_test: $*\"\n\t\t\treturn 1\n\t\t\t;;\n\t\tesac\n\tdone\n\tgit update-ref \"$delref\" $C &&\n\tif $symadd\n\tthen\n\t\taddname=\"$prefix/s/symadd\" &&\n\t\tgit symbolic-ref \"$addname\" \"$addref\"\n\telse\n\t\taddname=\"$addref\"\n\tfi &&\n\tif $symdel\n\tthen\n\t\tdelname=\"$prefix/s/symdel\" &&\n\t\tgit symbolic-ref \"$delname\" \"$delref\"\n\telse\n\t\tdelname=\"$delref\"\n\tfi &&\n\tcat >expected-err <<-EOF &&\n\tfatal: cannot lock ref $SQ$addname$SQ: $SQ$delref$SQ exists; cannot create $SQ$addref$SQ\n\tEOF\n\t$pack &&\n\tif $add_del\n\tthen\n\t\tprintf \"%s\\n\" \"create $addname $D\" \"delete $delname\"\n\telse\n\t\tprintf \"%s\\n\" \"delete $delname\" \"create $addname $D\"\n\tfi >commands &&\n\ttest_must_fail git update-ref --stdin <commands 2>output.err &&\n\ttest_cmp expected-err output.err &&\n\tprintf \"%s\\n\" \"$C $delref\" >expected-refs &&\n\tgit for-each-ref --format=\"%(objectname) %(refname)\" $prefix/r >actual-refs &&\n\ttest_cmp expected-refs actual-refs\n}\n\ntest_expect_success 'setup' '\n\n\tgit commit --allow-empty -m Initial &&\n\tC=$(git rev-parse HEAD) &&\n\tgit commit --allow-empty -m Second &&\n\tD=$(git rev-parse HEAD) &&\n\tgit commit --allow-empty -m Third &&\n\tE=$(git rev-parse HEAD)\n'\n\ntest_expect_success 'existing loose ref is a simple prefix of new' '\n\n\tprefix=refs/1l &&\n\ttest_update_rejected \"a c e\" false \"b c/x d\" \\\n\t\t\"$SQ$prefix/c$SQ exists; cannot create $SQ$prefix/c/x$SQ\"\n\n'\n\ntest_expect_success 'existing packed ref is a simple prefix of new' '\n\n\tprefix=refs/1p &&\n\ttest_update_rejected \"a c e\" true \"b c/x d\" \\\n\t\t\"$SQ$prefix/c$SQ exists; cannot create $SQ$prefix/c/x$SQ\"\n\n'\n\ntest_expect_success 'existing loose ref is a deeper prefix of new' '\n\n\tprefix=refs/2l &&\n\ttest_update_rejected \"a c e\" false \"b c/x/y d\" \\\n\t\t\"$SQ$prefix/c$SQ exists; cannot create $SQ$prefix/c/x/y$SQ\"\n\n'\n\ntest_expect_success 'existing packed ref is a deeper prefix of new' '\n\n\tprefix=refs/2p &&\n\ttest_update_rejected \"a c e\" true \"b c/x/y d\" \\\n\t\t\"$SQ$prefix/c$SQ exists; cannot create $SQ$prefix/c/x/y$SQ\"\n\n'\n\ntest_expect_success 'new ref is a simple prefix of existing loose' '\n\n\tprefix=refs/3l &&\n\ttest_update_rejected \"a c/x e\" false \"b c d\" \\\n\t\t\"$SQ$prefix/c/x$SQ exists; cannot create $SQ$prefix/c$SQ\"\n\n'\n\ntest_expect_success 'new ref is a simple prefix of existing packed' '\n\n\tprefix=refs/3p &&\n\ttest_update_rejected \"a c/x e\" true \"b c d\" \\\n\t\t\"$SQ$prefix/c/x$SQ exists; cannot create $SQ$prefix/c$SQ\"\n\n'\n\ntest_expect_success 'new ref is a deeper prefix of existing loose' '\n\n\tprefix=refs/4l &&\n\ttest_update_rejected \"a c/x/y e\" false \"b c d\" \\\n\t\t\"$SQ$prefix/c/x/y$SQ exists; cannot create $SQ$prefix/c$SQ\"\n\n'\n\ntest_expect_success 'new ref is a deeper prefix of existing packed' '\n\n\tprefix=refs/4p &&\n\ttest_update_rejected \"a c/x/y e\" true \"b c d\" \\\n\t\t\"$SQ$prefix/c/x/y$SQ exists; cannot create $SQ$prefix/c$SQ\"\n\n'\n\ntest_expect_success 'one new ref is a simple prefix of another' '\n\n\tprefix=refs/5 &&\n\ttest_update_rejected \"a e\" false \"b c c/x d\" \\\n\t\t\"cannot process $SQ$prefix/c$SQ and $SQ$prefix/c/x$SQ at the same time\"\n\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents add long + delete short' '\n\tdf_test refs/df-al-ds --add-del foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents add short + delete long' '\n\tdf_test refs/df-as-dl --add-del foo foo/bar\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents delete long + add short' '\n\tdf_test refs/df-dl-as --del-add foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents delete short + add long' '\n\tdf_test refs/df-ds-al --del-add foo foo/bar\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents add long + delete short packed' '\n\tdf_test refs/df-al-dsp --pack --add-del foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents add short + delete long packed' '\n\tdf_test refs/df-as-dlp --pack --add-del foo foo/bar\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents delete long packed + add short' '\n\tdf_test refs/df-dlp-as --pack --del-add foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents delete short packed + add long' '\n\tdf_test refs/df-dsp-al --pack --del-add foo foo/bar\n'\n\n# Try some combinations involving symbolic refs...\n\ntest_expect_success REFFILES 'D/F conflict prevents indirect add long + delete short' '\n\tdf_test refs/df-ial-ds --sym-add --add-del foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents indirect add long + indirect delete short' '\n\tdf_test refs/df-ial-ids --sym-add --sym-del --add-del foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents indirect add short + indirect delete long' '\n\tdf_test refs/df-ias-idl --sym-add --sym-del --add-del foo foo/bar\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents indirect delete long + indirect add short' '\n\tdf_test refs/df-idl-ias --sym-add --sym-del --del-add foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents indirect add long + delete short packed' '\n\tdf_test refs/df-ial-dsp --sym-add --pack --add-del foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents indirect add long + indirect delete short packed' '\n\tdf_test refs/df-ial-idsp --sym-add --sym-del --pack --add-del foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents add long + indirect delete short packed' '\n\tdf_test refs/df-al-idsp --sym-del --pack --add-del foo/bar foo\n'\n\ntest_expect_success REFFILES 'D/F conflict prevents indirect delete long packed + indirect add short' '\n\tdf_test refs/df-idlp-ias --sym-add --sym-del --pack --del-add foo/bar foo\n'\n\n# Test various errors when reading the old values of references...\n\ntest_expect_success 'missing old value blocks update' '\n\tprefix=refs/missing-update &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/foo$SQ: unable to resolve reference $SQ$prefix/foo$SQ\n\tEOF\n\tprintf \"%s\\n\" \"update $prefix/foo $E $D\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'incorrect old value blocks update' '\n\tprefix=refs/incorrect-update &&\n\tgit update-ref $prefix/foo $C &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/foo$SQ: is at $C but expected $D\n\tEOF\n\tprintf \"%s\\n\" \"update $prefix/foo $E $D\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'existing old value blocks create' '\n\tprefix=refs/existing-create &&\n\tgit update-ref $prefix/foo $C &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/foo$SQ: reference already exists\n\tEOF\n\tprintf \"%s\\n\" \"create $prefix/foo $E\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'incorrect old value blocks delete' '\n\tprefix=refs/incorrect-delete &&\n\tgit update-ref $prefix/foo $C &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/foo$SQ: is at $C but expected $D\n\tEOF\n\tprintf \"%s\\n\" \"delete $prefix/foo $D\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'missing old value blocks indirect update' '\n\tprefix=refs/missing-indirect-update &&\n\tgit symbolic-ref $prefix/symref $prefix/foo &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/symref$SQ: unable to resolve reference $SQ$prefix/foo$SQ\n\tEOF\n\tprintf \"%s\\n\" \"update $prefix/symref $E $D\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'incorrect old value blocks indirect update' '\n\tprefix=refs/incorrect-indirect-update &&\n\tgit symbolic-ref $prefix/symref $prefix/foo &&\n\tgit update-ref $prefix/foo $C &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/symref$SQ: is at $C but expected $D\n\tEOF\n\tprintf \"%s\\n\" \"update $prefix/symref $E $D\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'existing old value blocks indirect create' '\n\tprefix=refs/existing-indirect-create &&\n\tgit symbolic-ref $prefix/symref $prefix/foo &&\n\tgit update-ref $prefix/foo $C &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/symref$SQ: reference already exists\n\tEOF\n\tprintf \"%s\\n\" \"create $prefix/symref $E\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'incorrect old value blocks indirect delete' '\n\tprefix=refs/incorrect-indirect-delete &&\n\tgit symbolic-ref $prefix/symref $prefix/foo &&\n\tgit update-ref $prefix/foo $C &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/symref$SQ: is at $C but expected $D\n\tEOF\n\tprintf \"%s\\n\" \"delete $prefix/symref $D\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'missing old value blocks indirect no-deref update' '\n\tprefix=refs/missing-noderef-update &&\n\tgit symbolic-ref $prefix/symref $prefix/foo &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/symref$SQ: reference is missing but expected $D\n\tEOF\n\tprintf \"%s\\n\" \"option no-deref\" \"update $prefix/symref $E $D\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'incorrect old value blocks indirect no-deref update' '\n\tprefix=refs/incorrect-noderef-update &&\n\tgit symbolic-ref $prefix/symref $prefix/foo &&\n\tgit update-ref $prefix/foo $C &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/symref$SQ: is at $C but expected $D\n\tEOF\n\tprintf \"%s\\n\" \"option no-deref\" \"update $prefix/symref $E $D\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'existing old value blocks indirect no-deref create' '\n\tprefix=refs/existing-noderef-create &&\n\tgit symbolic-ref $prefix/symref $prefix/foo &&\n\tgit update-ref $prefix/foo $C &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/symref$SQ: reference already exists\n\tEOF\n\tprintf \"%s\\n\" \"option no-deref\" \"create $prefix/symref $E\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_expect_success 'incorrect old value blocks indirect no-deref delete' '\n\tprefix=refs/incorrect-noderef-delete &&\n\tgit symbolic-ref $prefix/symref $prefix/foo &&\n\tgit update-ref $prefix/foo $C &&\n\tcat >expected <<-EOF &&\n\tfatal: cannot lock ref $SQ$prefix/symref$SQ: is at $C but expected $D\n\tEOF\n\tprintf \"%s\\n\" \"option no-deref\" \"delete $prefix/symref $D\" |\n\ttest_must_fail git update-ref --stdin 2>output.err &&\n\ttest_cmp expected output.err\n'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "00b70137053dfcb7351f9a5f8e16b0cadb07f51c",
  "sha1_ok": true,
  "size": 12266
}
