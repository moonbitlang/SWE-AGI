{
  "content": {
    "base64": "IyEvYmluL3NoCgp0ZXN0X2Rlc2NyaXB0aW9uPSdUZXN0IGdpdCBjb25maWctc2V0IEFQSSBpbiBkaWZmZXJlbnQgc2V0dGluZ3MnCgouIC4vdGVzdC1saWIuc2gKCiMgJ2NoZWNrX2NvbmZpZyBnZXRfKiBzZWN0aW9uLmtleSB2YWx1ZScgdmVyaWZpZXMgdGhhdCB0aGUgZW50cnkgZm9yCiMgc2VjdGlvbi5rZXkgaXMgJ3ZhbHVlJwpjaGVja19jb25maWcgKCkgewoJaWYgdGVzdCAiJDEiID0gZXhwZWN0X2NvZGUKCXRoZW4KCQlleHBlY3RfY29kZT0iJDIiICYmIHNoaWZ0ICYmIHNoaWZ0CgllbHNlCgkJZXhwZWN0X2NvZGU9MAoJZmkgJiYKCW9wPSQxIGtleT0kMiAmJiBzaGlmdCAmJiBzaGlmdCAmJgoJaWYgdGVzdCAkIyAhPSAwCgl0aGVuCgkJcHJpbnRmICIlc1xuIiAiJEAiCglmaSA+ZXhwZWN0ICYmCgl0ZXN0X2V4cGVjdF9jb2RlICRleHBlY3RfY29kZSB0ZXN0LWNvbmZpZyAiJG9wIiAiJGtleSIgPmFjdHVhbCAmJgoJdGVzdF9jbXAgZXhwZWN0IGFjdHVhbAp9Cgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdzZXR1cCBkZWZhdWx0IGNvbmZpZycgJwoJY2F0ID4uZ2l0L2NvbmZpZyA8PC1cRU9GCglbY2FzZV0KCQlwZW5ndWluID0gdmVyeSBibHVlCgkJTW92aWUgPSBCYWRQaHlzaWNzCgkJVVBQRVJDQVNFID0gdHJ1ZQoJCU1peGVkQ2FzZSA9IHRydWUKCQlteSA9CgkJZm9vCgkJYmF6ID0gc2FtCglbQ29yZXNdCgkJV2hhdEV2ZXIgPSBTZWNvbmQKCQliYXogPSBiYXIKCVtjb3Jlc10KCQliYXogPSBiYXQKCVtDT1JFU10KCQliYXogPSBiYWxsCglbbXkgIkZvbyBiQXIiXQoJCWhpID0gbWl4ZWQtY2FzZQoJW215ICJGT08gQkFSIl0KCQloaSA9IHVwcGVyLWNhc2UKCVtteSAiZm9vIGJhciJdCgkJaGkgPSBsb3dlci1jYXNlCglbY2FzZV0KCQliYXogPSBiYXQKCQliYXogPSBoYXNrCglbbGFtYl0KCQljaG9wID0gNjUKCQloZWFkID0gbm9uZQoJW2dvYXRdCgkJbGVncyA9IDQKCQloZWFkID0gdHJ1ZQoJCXNraW4gPSBmYWxzZQoJCW5vc2UgPSAxCgkJaG9ybnMKCUVPRgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdnZXQgdmFsdWUgZm9yIGEgc2ltcGxlIGtleScgJwoJY2hlY2tfY29uZmlnIGdldF92YWx1ZSBjYXNlLnBlbmd1aW4gInZlcnkgYmx1ZSIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZ2V0IHZhbHVlIGZvciBhIGtleSB3aXRoIHZhbHVlIGFzIGFuIGVtcHR5IHN0cmluZycgJwoJY2hlY2tfY29uZmlnIGdldF92YWx1ZSBjYXNlLm15ICIiCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2dldCB2YWx1ZSBmb3IgYSBrZXkgd2l0aCB2YWx1ZSBhcyBOVUxMJyAnCgljaGVja19jb25maWcgZ2V0X3ZhbHVlIGNhc2UuZm9vICIoTlVMTCkiCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3VwcGVyIGNhc2Uga2V5JyAnCgljaGVja19jb25maWcgZ2V0X3ZhbHVlIGNhc2UuVVBQRVJDQVNFICJ0cnVlIiAmJgoJY2hlY2tfY29uZmlnIGdldF92YWx1ZSBjYXNlLnVwcGVyY2FzZSAidHJ1ZSIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbWl4ZWQgY2FzZSBrZXknICcKCWNoZWNrX2NvbmZpZyBnZXRfdmFsdWUgY2FzZS5NaXhlZENhc2UgInRydWUiICYmCgljaGVja19jb25maWcgZ2V0X3ZhbHVlIGNhc2UuTUlYRURDQVNFICJ0cnVlIiAmJgoJY2hlY2tfY29uZmlnIGdldF92YWx1ZSBjYXNlLm1peGVkY2FzZSAidHJ1ZSIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAna2V5IGFuZCB2YWx1ZSB3aXRoIG1peGVkIGNhc2UnICcKCWNoZWNrX2NvbmZpZyBnZXRfdmFsdWUgY2FzZS5Nb3ZpZSAiQmFkUGh5c2ljcyIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAna2V5IHdpdGggY2FzZSBzZW5zaXRpdmUgc3Vic2VjdGlvbicgJwoJY2hlY2tfY29uZmlnIGdldF92YWx1ZSAibXkuRm9vIGJBci5oaSIgIm1peGVkLWNhc2UiICYmCgljaGVja19jb25maWcgZ2V0X3ZhbHVlICJteS5GT08gQkFSLmhpIiAidXBwZXItY2FzZSIgJiYKCWNoZWNrX2NvbmZpZyBnZXRfdmFsdWUgIm15LmZvbyBiYXIuaGkiICJsb3dlci1jYXNlIgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdrZXkgd2l0aCBjYXNlIGluc2Vuc2l0aXZlIHNlY3Rpb24gaGVhZGVyJyAnCgljaGVja19jb25maWcgZ2V0X3ZhbHVlIGNvcmVzLmJheiAiYmFsbCIgJiYKCWNoZWNrX2NvbmZpZyBnZXRfdmFsdWUgQ29yZXMuYmF6ICJiYWxsIiAmJgoJY2hlY2tfY29uZmlnIGdldF92YWx1ZSBDT1JFUy5iYXogImJhbGwiICYmCgljaGVja19jb25maWcgZ2V0X3ZhbHVlIGNvcmVTLmJheiAiYmFsbCIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAna2V5IHdpdGggY2FzZSBpbnNlbnNpdGl2ZSBzZWN0aW9uIGhlYWRlciAmIHZhcmlhYmxlJyAnCgljaGVja19jb25maWcgZ2V0X3ZhbHVlIENPUkVTLkJBWiAiYmFsbCIgJiYKCWNoZWNrX2NvbmZpZyBnZXRfdmFsdWUgY29yZXMuYmF6ICJiYWxsIiAmJgoJY2hlY2tfY29uZmlnIGdldF92YWx1ZSBjb3Jlcy5CYVogImJhbGwiICYmCgljaGVja19jb25maWcgZ2V0X3ZhbHVlIGNPcmVTLmJBeiAiYmFsbCIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZmluZCB2YWx1ZSB3aXRoIG1pc3NwZWxsZWQga2V5JyAnCgljaGVja19jb25maWcgZXhwZWN0X2NvZGUgMSBnZXRfdmFsdWUgIm15LmZPbyBCYXIuaGkiICJWYWx1ZSBub3QgZm91bmQgZm9yIFwibXkuZk9vIEJhci5oaVwiIgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdmaW5kIHZhbHVlIHdpdGggdGhlIGhpZ2hlc3QgcHJpb3JpdHknICcKCWNoZWNrX2NvbmZpZyBnZXRfdmFsdWUgY2FzZS5iYXogImhhc2siCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2ZpbmQgaW50ZWdlciB2YWx1ZSBmb3IgYSBrZXknICcKCWNoZWNrX2NvbmZpZyBnZXRfaW50IGxhbWIuY2hvcCA2NQonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdmaW5kIHN0cmluZyB2YWx1ZSBmb3IgYSBrZXknICcKCWNoZWNrX2NvbmZpZyBnZXRfc3RyaW5nIGNhc2UuYmF6IGhhc2sgJiYKCWNoZWNrX2NvbmZpZyBleHBlY3RfY29kZSAxIGdldF9zdHJpbmcgY2FzZS5iYSAiVmFsdWUgbm90IGZvdW5kIGZvciBcImNhc2UuYmFcIiIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnY2hlY2sgbGluZSBlcnJvciB3aGVuIE5VTEwgc3RyaW5nIGlzIHF1ZXJpZWQnICcKCXRlc3RfZXhwZWN0X2NvZGUgMTI4IHRlc3QtY29uZmlnIGdldF9zdHJpbmcgY2FzZS5mb28gMj5yZXN1bHQgJiYKCXRlc3RfaTE4bmdyZXAgImZhdGFsOiAuKmNhc2VcLmZvby4qXC5naXQvY29uZmlnLipsaW5lIDciIHJlc3VsdAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdmaW5kIGludGVnZXIgaWYgdmFsdWUgaXMgbm9uIHBhcnNlLWFibGUnICcKCWNoZWNrX2NvbmZpZyBleHBlY3RfY29kZSAxMjggZ2V0X2ludCBsYW1iLmhlYWQKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZmluZCBib29sIHZhbHVlIGZvciB0aGUgZW50ZXJlZCBrZXknICcKCWNoZWNrX2NvbmZpZyBnZXRfYm9vbCBnb2F0LmhlYWQgMSAmJgoJY2hlY2tfY29uZmlnIGdldF9ib29sIGdvYXQuc2tpbiAwICYmCgljaGVja19jb25maWcgZ2V0X2Jvb2wgZ29hdC5ub3NlIDEgJiYKCWNoZWNrX2NvbmZpZyBnZXRfYm9vbCBnb2F0Lmhvcm5zIDEgJiYKCWNoZWNrX2NvbmZpZyBnZXRfYm9vbCBnb2F0LmxlZ3MgMQonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdmaW5kIG11bHRpcGxlIHZhbHVlcycgJwoJY2hlY2tfY29uZmlnIGdldF92YWx1ZV9tdWx0aSBjYXNlLmJheiBzYW0gYmF0IGhhc2sKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZmluZCB2YWx1ZSBmcm9tIGEgY29uZmlnc2V0JyAnCgljYXQgPmNvbmZpZzIgPDwtXEVPRiAmJgoJW2Nhc2VdCgkJYmF6ID0gbGFtYQoJW215XQoJCW5ldyA9IHNpbGsKCVtjYXNlXQoJCWJheiA9IGJhbGwKCUVPRgoJZWNobyBzaWxrID5leHBlY3QgJiYKCXRlc3QtY29uZmlnIGNvbmZpZ3NldF9nZXRfdmFsdWUgbXkubmV3IGNvbmZpZzIgLmdpdC9jb25maWcgPmFjdHVhbCAmJgoJdGVzdF9jbXAgZXhwZWN0IGFjdHVhbAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdmaW5kIHZhbHVlIHdpdGggaGlnaGVzdCBwcmlvcml0eSBmcm9tIGEgY29uZmlnc2V0JyAnCgllY2hvIGhhc2sgPmV4cGVjdCAmJgoJdGVzdC1jb25maWcgY29uZmlnc2V0X2dldF92YWx1ZSBjYXNlLmJheiBjb25maWcyIC5naXQvY29uZmlnID5hY3R1YWwgJiYKCXRlc3RfY21wIGV4cGVjdCBhY3R1YWwKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZmluZCB2YWx1ZV9saXN0IGZvciBhIGtleSBmcm9tIGEgY29uZmlnc2V0JyAnCgljYXQgPmV4Y2VwdCA8PC1cRU9GICYmCglzYW0KCWJhdAoJaGFzawoJbGFtYQoJYmFsbAoJRU9GCgl0ZXN0LWNvbmZpZyBjb25maWdzZXRfZ2V0X3ZhbHVlIGNhc2UuYmF6IGNvbmZpZzIgLmdpdC9jb25maWcgPmFjdHVhbCAmJgoJdGVzdF9jbXAgZXhwZWN0IGFjdHVhbAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdwcm9wZXIgZXJyb3Igb24gbm9uLWV4aXN0ZW50IGZpbGVzJyAnCgllY2hvICJFcnJvciAoLTEpIHJlYWRpbmcgY29uZmlndXJhdGlvbiBmaWxlIG5vbi1leGlzdGVudC1maWxlLiIgPmV4cGVjdCAmJgoJdGVzdF9leHBlY3RfY29kZSAyIHRlc3QtY29uZmlnIGNvbmZpZ3NldF9nZXRfdmFsdWUgZm9vLmJhciBub24tZXhpc3RlbnQtZmlsZSAyPmFjdHVhbCAmJgoJdGVzdF9jbXAgZXhwZWN0IGFjdHVhbAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIFBPU0lYUEVSTSxTQU5JVFkgJ3Byb3BlciBlcnJvciBvbiBub24tYWNjZXNzaWJsZSBmaWxlcycgJwoJY2htb2QgLXIgLmdpdC9jb25maWcgJiYKCXRlc3Rfd2hlbl9maW5pc2hlZCAiY2htb2QgK3IgLmdpdC9jb25maWciICYmCgllY2hvICJFcnJvciAoLTEpIHJlYWRpbmcgY29uZmlndXJhdGlvbiBmaWxlIC5naXQvY29uZmlnLiIgPmV4cGVjdCAmJgoJdGVzdF9leHBlY3RfY29kZSAyIHRlc3QtY29uZmlnIGNvbmZpZ3NldF9nZXRfdmFsdWUgZm9vLmJhciAuZ2l0L2NvbmZpZyAyPmFjdHVhbCAmJgoJdGVzdF9jbXAgZXhwZWN0IGFjdHVhbAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdwcm9wZXIgZXJyb3Igb24gZXJyb3IgaW4gZGVmYXVsdCBjb25maWcgZmlsZXMnICcKCWNwIC5naXQvY29uZmlnIC5naXQvY29uZmlnLm9sZCAmJgoJdGVzdF93aGVuX2ZpbmlzaGVkICJtdiAuZ2l0L2NvbmZpZy5vbGQgLmdpdC9jb25maWciICYmCgllY2hvICJbIiA+Pi5naXQvY29uZmlnICYmCgllY2hvICJmYXRhbDogYmFkIGNvbmZpZyBsaW5lIDM0IGluIGZpbGUgLmdpdC9jb25maWciID5leHBlY3QgJiYKCXRlc3RfZXhwZWN0X2NvZGUgMTI4IHRlc3QtY29uZmlnIGdldF92YWx1ZSBmb28uYmFyIDI+YWN0dWFsICYmCgl0ZXN0X2NtcCBleHBlY3QgYWN0dWFsCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3Byb3BlciBlcnJvciBvbiBlcnJvciBpbiBjdXN0b20gY29uZmlnIGZpbGVzJyAnCgllY2hvICJbIiA+PnN5bnRheC1lcnJvciAmJgoJZWNobyAiZmF0YWw6IGJhZCBjb25maWcgbGluZSAxIGluIGZpbGUgc3ludGF4LWVycm9yIiA+ZXhwZWN0ICYmCgl0ZXN0X2V4cGVjdF9jb2RlIDEyOCB0ZXN0LWNvbmZpZyBjb25maWdzZXRfZ2V0X3ZhbHVlIGZvby5iYXIgc3ludGF4LWVycm9yIDI+YWN0dWFsICYmCgl0ZXN0X2NtcCBleHBlY3QgYWN0dWFsCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2NoZWNrIGxpbmUgZXJyb3JzIGZvciBtYWxmb3JtZWQgdmFsdWVzJyAnCgltdiAuZ2l0L2NvbmZpZyAuZ2l0L2NvbmZpZy5vbGQgJiYKCXRlc3Rfd2hlbl9maW5pc2hlZCAibXYgLmdpdC9jb25maWcub2xkIC5naXQvY29uZmlnIiAmJgoJY2F0ID4uZ2l0L2NvbmZpZyA8PC1cRU9GICYmCglbYWxpYXNdCgkJYnIKCUVPRgoJdGVzdF9leHBlY3RfY29kZSAxMjggZ2l0IGJyIDI+cmVzdWx0ICYmCgl0ZXN0X2kxOG5ncmVwICJmYXRhbDogLiphbGlhc1wuYnIuKlwuZ2l0L2NvbmZpZy4qbGluZSAyIiByZXN1bHQKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZXJyb3Igb24gbW9kaWZ5aW5nIHJlcG8gY29uZmlnIHdpdGhvdXQgcmVwbycgJwoJbWtkaXIgbm8tcmVwbyAmJgoJKAoJCUdJVF9DRUlMSU5HX0RJUkVDVE9SSUVTPSQocHdkKSAmJgoJCWV4cG9ydCBHSVRfQ0VJTElOR19ESVJFQ1RPUklFUyAmJgoJCWNkIG5vLXJlcG8gJiYKCQl0ZXN0X211c3RfZmFpbCBnaXQgY29uZmlnIGEuYiBjIDI+ZXJyICYmCgkJZ3JlcCAibm90IGluIGEgZ2l0IGRpcmVjdG9yeSIgZXJyCgkpCicKCnRlc3RfZG9uZQo=",
    "text": "#!/bin/sh\n\ntest_description='Test git config-set API in different settings'\n\n. ./test-lib.sh\n\n# 'check_config get_* section.key value' verifies that the entry for\n# section.key is 'value'\ncheck_config () {\n\tif test \"$1\" = expect_code\n\tthen\n\t\texpect_code=\"$2\" && shift && shift\n\telse\n\t\texpect_code=0\n\tfi &&\n\top=$1 key=$2 && shift && shift &&\n\tif test $# != 0\n\tthen\n\t\tprintf \"%s\\n\" \"$@\"\n\tfi >expect &&\n\ttest_expect_code $expect_code test-config \"$op\" \"$key\" >actual &&\n\ttest_cmp expect actual\n}\n\ntest_expect_success 'setup default config' '\n\tcat >.git/config <<-\\EOF\n\t[case]\n\t\tpenguin = very blue\n\t\tMovie = BadPhysics\n\t\tUPPERCASE = true\n\t\tMixedCase = true\n\t\tmy =\n\t\tfoo\n\t\tbaz = sam\n\t[Cores]\n\t\tWhatEver = Second\n\t\tbaz = bar\n\t[cores]\n\t\tbaz = bat\n\t[CORES]\n\t\tbaz = ball\n\t[my \"Foo bAr\"]\n\t\thi = mixed-case\n\t[my \"FOO BAR\"]\n\t\thi = upper-case\n\t[my \"foo bar\"]\n\t\thi = lower-case\n\t[case]\n\t\tbaz = bat\n\t\tbaz = hask\n\t[lamb]\n\t\tchop = 65\n\t\thead = none\n\t[goat]\n\t\tlegs = 4\n\t\thead = true\n\t\tskin = false\n\t\tnose = 1\n\t\thorns\n\tEOF\n'\n\ntest_expect_success 'get value for a simple key' '\n\tcheck_config get_value case.penguin \"very blue\"\n'\n\ntest_expect_success 'get value for a key with value as an empty string' '\n\tcheck_config get_value case.my \"\"\n'\n\ntest_expect_success 'get value for a key with value as NULL' '\n\tcheck_config get_value case.foo \"(NULL)\"\n'\n\ntest_expect_success 'upper case key' '\n\tcheck_config get_value case.UPPERCASE \"true\" &&\n\tcheck_config get_value case.uppercase \"true\"\n'\n\ntest_expect_success 'mixed case key' '\n\tcheck_config get_value case.MixedCase \"true\" &&\n\tcheck_config get_value case.MIXEDCASE \"true\" &&\n\tcheck_config get_value case.mixedcase \"true\"\n'\n\ntest_expect_success 'key and value with mixed case' '\n\tcheck_config get_value case.Movie \"BadPhysics\"\n'\n\ntest_expect_success 'key with case sensitive subsection' '\n\tcheck_config get_value \"my.Foo bAr.hi\" \"mixed-case\" &&\n\tcheck_config get_value \"my.FOO BAR.hi\" \"upper-case\" &&\n\tcheck_config get_value \"my.foo bar.hi\" \"lower-case\"\n'\n\ntest_expect_success 'key with case insensitive section header' '\n\tcheck_config get_value cores.baz \"ball\" &&\n\tcheck_config get_value Cores.baz \"ball\" &&\n\tcheck_config get_value CORES.baz \"ball\" &&\n\tcheck_config get_value coreS.baz \"ball\"\n'\n\ntest_expect_success 'key with case insensitive section header & variable' '\n\tcheck_config get_value CORES.BAZ \"ball\" &&\n\tcheck_config get_value cores.baz \"ball\" &&\n\tcheck_config get_value cores.BaZ \"ball\" &&\n\tcheck_config get_value cOreS.bAz \"ball\"\n'\n\ntest_expect_success 'find value with misspelled key' '\n\tcheck_config expect_code 1 get_value \"my.fOo Bar.hi\" \"Value not found for \\\"my.fOo Bar.hi\\\"\"\n'\n\ntest_expect_success 'find value with the highest priority' '\n\tcheck_config get_value case.baz \"hask\"\n'\n\ntest_expect_success 'find integer value for a key' '\n\tcheck_config get_int lamb.chop 65\n'\n\ntest_expect_success 'find string value for a key' '\n\tcheck_config get_string case.baz hask &&\n\tcheck_config expect_code 1 get_string case.ba \"Value not found for \\\"case.ba\\\"\"\n'\n\ntest_expect_success 'check line error when NULL string is queried' '\n\ttest_expect_code 128 test-config get_string case.foo 2>result &&\n\ttest_i18ngrep \"fatal: .*case\\.foo.*\\.git/config.*line 7\" result\n'\n\ntest_expect_success 'find integer if value is non parse-able' '\n\tcheck_config expect_code 128 get_int lamb.head\n'\n\ntest_expect_success 'find bool value for the entered key' '\n\tcheck_config get_bool goat.head 1 &&\n\tcheck_config get_bool goat.skin 0 &&\n\tcheck_config get_bool goat.nose 1 &&\n\tcheck_config get_bool goat.horns 1 &&\n\tcheck_config get_bool goat.legs 1\n'\n\ntest_expect_success 'find multiple values' '\n\tcheck_config get_value_multi case.baz sam bat hask\n'\n\ntest_expect_success 'find value from a configset' '\n\tcat >config2 <<-\\EOF &&\n\t[case]\n\t\tbaz = lama\n\t[my]\n\t\tnew = silk\n\t[case]\n\t\tbaz = ball\n\tEOF\n\techo silk >expect &&\n\ttest-config configset_get_value my.new config2 .git/config >actual &&\n\ttest_cmp expect actual\n'\n\ntest_expect_success 'find value with highest priority from a configset' '\n\techo hask >expect &&\n\ttest-config configset_get_value case.baz config2 .git/config >actual &&\n\ttest_cmp expect actual\n'\n\ntest_expect_success 'find value_list for a key from a configset' '\n\tcat >except <<-\\EOF &&\n\tsam\n\tbat\n\thask\n\tlama\n\tball\n\tEOF\n\ttest-config configset_get_value case.baz config2 .git/config >actual &&\n\ttest_cmp expect actual\n'\n\ntest_expect_success 'proper error on non-existent files' '\n\techo \"Error (-1) reading configuration file non-existent-file.\" >expect &&\n\ttest_expect_code 2 test-config configset_get_value foo.bar non-existent-file 2>actual &&\n\ttest_cmp expect actual\n'\n\ntest_expect_success POSIXPERM,SANITY 'proper error on non-accessible files' '\n\tchmod -r .git/config &&\n\ttest_when_finished \"chmod +r .git/config\" &&\n\techo \"Error (-1) reading configuration file .git/config.\" >expect &&\n\ttest_expect_code 2 test-config configset_get_value foo.bar .git/config 2>actual &&\n\ttest_cmp expect actual\n'\n\ntest_expect_success 'proper error on error in default config files' '\n\tcp .git/config .git/config.old &&\n\ttest_when_finished \"mv .git/config.old .git/config\" &&\n\techo \"[\" >>.git/config &&\n\techo \"fatal: bad config line 34 in file .git/config\" >expect &&\n\ttest_expect_code 128 test-config get_value foo.bar 2>actual &&\n\ttest_cmp expect actual\n'\n\ntest_expect_success 'proper error on error in custom config files' '\n\techo \"[\" >>syntax-error &&\n\techo \"fatal: bad config line 1 in file syntax-error\" >expect &&\n\ttest_expect_code 128 test-config configset_get_value foo.bar syntax-error 2>actual &&\n\ttest_cmp expect actual\n'\n\ntest_expect_success 'check line errors for malformed values' '\n\tmv .git/config .git/config.old &&\n\ttest_when_finished \"mv .git/config.old .git/config\" &&\n\tcat >.git/config <<-\\EOF &&\n\t[alias]\n\t\tbr\n\tEOF\n\ttest_expect_code 128 git br 2>result &&\n\ttest_i18ngrep \"fatal: .*alias\\.br.*\\.git/config.*line 2\" result\n'\n\ntest_expect_success 'error on modifying repo config without repo' '\n\tmkdir no-repo &&\n\t(\n\t\tGIT_CEILING_DIRECTORIES=$(pwd) &&\n\t\texport GIT_CEILING_DIRECTORIES &&\n\t\tcd no-repo &&\n\t\ttest_must_fail git config a.b c 2>err &&\n\t\tgrep \"not in a git directory\" err\n\t)\n'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "005d66dbef6c361363752b37087bbbc6a3098833",
  "sha1_ok": true,
  "size": 6140
}
