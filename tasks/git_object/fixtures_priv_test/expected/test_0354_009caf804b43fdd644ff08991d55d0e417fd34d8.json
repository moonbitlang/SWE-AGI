{
  "content": {
    "base64": "I2luY2x1ZGUgPHN0ZGxpYi5oPgojaW5jbHVkZSAiY2FjaGUuaCIKI2luY2x1ZGUgImNvbW1pdC5oIgoKc3RhdGljIGludCBzaG93X2FsbDsKCnN0YXRpYyBpbnQgbWVyZ2VfYmFzZShzdHJ1Y3QgY29tbWl0ICpyZXYxLCBzdHJ1Y3QgY29tbWl0ICpyZXYyKQp7CglzdHJ1Y3QgY29tbWl0X2xpc3QgKnJlc3VsdCA9IGdldF9tZXJnZV9iYXNlcyhyZXYxLCByZXYyLCAwKTsKCglpZiAoIXJlc3VsdCkKCQlyZXR1cm4gMTsKCgl3aGlsZSAocmVzdWx0KSB7CgkJcHJpbnRmKCIlc1xuIiwgc2hhMV90b19oZXgocmVzdWx0LT5pdGVtLT5vYmplY3Quc2hhMSkpOwoJCWlmICghc2hvd19hbGwpCgkJCXJldHVybiAwOwoJCXJlc3VsdCA9IHJlc3VsdC0+bmV4dDsKCX0KCglyZXR1cm4gMDsKfQoKc3RhdGljIGNvbnN0IGNoYXIgbWVyZ2VfYmFzZV91c2FnZVtdID0KImdpdC1tZXJnZS1iYXNlIFstLWFsbF0gPGNvbW1pdC1pZD4gPGNvbW1pdC1pZD4iOwoKaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKiphcmd2KQp7CglzdHJ1Y3QgY29tbWl0ICpyZXYxLCAqcmV2MjsKCXVuc2lnbmVkIGNoYXIgcmV2MWtleVsyMF0sIHJldjJrZXlbMjBdOwoKCXNldHVwX2dpdF9kaXJlY3RvcnkoKTsKCWdpdF9jb25maWcoZ2l0X2RlZmF1bHRfY29uZmlnKTsKCgl3aGlsZSAoMSA8IGFyZ2MgJiYgYXJndlsxXVswXSA9PSAnLScpIHsKCQljaGFyICphcmcgPSBhcmd2WzFdOwoJCWlmICghc3RyY21wKGFyZywgIi1hIikgfHwgIXN0cmNtcChhcmcsICItLWFsbCIpKQoJCQlzaG93X2FsbCA9IDE7CgkJZWxzZQoJCQl1c2FnZShtZXJnZV9iYXNlX3VzYWdlKTsKCQlhcmdjLS07IGFyZ3YrKzsKCX0KCWlmIChhcmdjICE9IDMpCgkJdXNhZ2UobWVyZ2VfYmFzZV91c2FnZSk7CglpZiAoZ2V0X3NoYTEoYXJndlsxXSwgcmV2MWtleSkpCgkJZGllKCJOb3QgYSB2YWxpZCBvYmplY3QgbmFtZSAlcyIsIGFyZ3ZbMV0pOwoJaWYgKGdldF9zaGExKGFyZ3ZbMl0sIHJldjJrZXkpKQoJCWRpZSgiTm90IGEgdmFsaWQgb2JqZWN0IG5hbWUgJXMiLCBhcmd2WzJdKTsKCXJldjEgPSBsb29rdXBfY29tbWl0X3JlZmVyZW5jZShyZXYxa2V5KTsKCXJldjIgPSBsb29rdXBfY29tbWl0X3JlZmVyZW5jZShyZXYya2V5KTsKCWlmICghcmV2MSB8fCAhcmV2MikKCQlyZXR1cm4gMTsKCXJldHVybiBtZXJnZV9iYXNlKHJldjEsIHJldjIpOwp9Cg==",
    "text": "#include <stdlib.h>\n#include \"cache.h\"\n#include \"commit.h\"\n\nstatic int show_all;\n\nstatic int merge_base(struct commit *rev1, struct commit *rev2)\n{\n\tstruct commit_list *result = get_merge_bases(rev1, rev2, 0);\n\n\tif (!result)\n\t\treturn 1;\n\n\twhile (result) {\n\t\tprintf(\"%s\\n\", sha1_to_hex(result->item->object.sha1));\n\t\tif (!show_all)\n\t\t\treturn 0;\n\t\tresult = result->next;\n\t}\n\n\treturn 0;\n}\n\nstatic const char merge_base_usage[] =\n\"git-merge-base [--all] <commit-id> <commit-id>\";\n\nint main(int argc, char **argv)\n{\n\tstruct commit *rev1, *rev2;\n\tunsigned char rev1key[20], rev2key[20];\n\n\tsetup_git_directory();\n\tgit_config(git_default_config);\n\n\twhile (1 < argc && argv[1][0] == '-') {\n\t\tchar *arg = argv[1];\n\t\tif (!strcmp(arg, \"-a\") || !strcmp(arg, \"--all\"))\n\t\t\tshow_all = 1;\n\t\telse\n\t\t\tusage(merge_base_usage);\n\t\targc--; argv++;\n\t}\n\tif (argc != 3)\n\t\tusage(merge_base_usage);\n\tif (get_sha1(argv[1], rev1key))\n\t\tdie(\"Not a valid object name %s\", argv[1]);\n\tif (get_sha1(argv[2], rev2key))\n\t\tdie(\"Not a valid object name %s\", argv[2]);\n\trev1 = lookup_commit_reference(rev1key);\n\trev2 = lookup_commit_reference(rev2key);\n\tif (!rev1 || !rev2)\n\t\treturn 1;\n\treturn merge_base(rev1, rev2);\n}\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "009caf804b43fdd644ff08991d55d0e417fd34d8",
  "sha1_ok": true,
  "size": 1180
}
