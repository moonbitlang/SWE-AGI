{
  "content": {
    "base64": "IyEvYmluL3NoCgp0ZXN0X2Rlc2NyaXB0aW9uPSdnaXQgZ3JlcCB3aXRoIGEgYmluYXJ5IHBhdHRlcm4gZmlsZXMnCgouIC4vbGliLWdldHRleHQuc2gKCm51bF9tYXRjaF9pbnRlcm5hbCAoKSB7CgltYXRjaGVzPSQxCglwcmVyZXFzPSQyCglsY19hbGw9JDMKCWV4dHJhX2ZsYWdzPSQ0CglmbGFncz0kNQoJcGF0dGVybj0kNgoJcGF0dGVybl9odW1hbj0kKGVjaG8gIiRwYXR0ZXJuIiB8IHNlZCAncy9RLzxOVUw+L2cnKQoKCWlmIHRlc3QgIiRtYXRjaGVzIiA9IDEKCXRoZW4KCQl0ZXN0X2V4cGVjdF9zdWNjZXNzICRwcmVyZXFzICJMQ19BTEw9JyRsY19hbGwnIGdpdCBncmVwICRleHRyYV9mbGFncyAtZiBmICRmbGFncyAnJHBhdHRlcm5faHVtYW4nIGEiICIKCQkJcHJpbnRmICckcGF0dGVybicgfCBxX3RvX251bCA+ZiAmJgoJCQlMQ19BTEw9JyRsY19hbGwnIGdpdCBncmVwICRleHRyYV9mbGFncyAtZiBmICRmbGFncyBhCgkJIgoJZWxpZiB0ZXN0ICIkbWF0Y2hlcyIgPSAwCgl0aGVuCgkJdGVzdF9leHBlY3Rfc3VjY2VzcyAkcHJlcmVxcyAiTENfQUxMPSckbGNfYWxsJyBnaXQgZ3JlcCAkZXh0cmFfZmxhZ3MgLWYgZiAkZmxhZ3MgJyRwYXR0ZXJuX2h1bWFuJyBhIiAiCgkJCT5zdGRlcnIgJiYKCQkJcHJpbnRmICckcGF0dGVybicgfCBxX3RvX251bCA+ZiAmJgoJCQl0ZXN0X211c3RfZmFpbCBlbnYgTENfQUxMPVwiJGxjX2FsbFwiIGdpdCBncmVwICRleHRyYV9mbGFncyAtZiBmICRmbGFncyBhIDI+c3RkZXJyICYmCgkJCXRlc3RfZ3JlcCAhICdUaGlzIGlzIG9ubHkgc3VwcG9ydGVkIHdpdGggLVAgdW5kZXIgUENSRSB2Micgc3RkZXJyCgkJIgoJZWxpZiB0ZXN0ICIkbWF0Y2hlcyIgPSBQCgl0aGVuCgkJdGVzdF9leHBlY3Rfc3VjY2VzcyAkcHJlcmVxcyAiZXJyb3IsIFBDUkUgdjIgb25seTogTENfQUxMPSckbGNfYWxsJyBnaXQgZ3JlcCAtZiBmICRmbGFncyAnJHBhdHRlcm5faHVtYW4nIGEiICIKCQkJPnN0ZGVyciAmJgoJCQlwcmludGYgJyRwYXR0ZXJuJyB8IHFfdG9fbnVsID5mICYmCgkJCXRlc3RfbXVzdF9mYWlsIGVudiBMQ19BTEw9XCIkbGNfYWxsXCIgZ2l0IGdyZXAgLWYgZiAkZmxhZ3MgYSAyPnN0ZGVyciAmJgoJCQl0ZXN0X2dyZXAgJ1RoaXMgaXMgb25seSBzdXBwb3J0ZWQgd2l0aCAtUCB1bmRlciBQQ1JFIHYyJyBzdGRlcnIKCQkiCgllbHNlCgkJdGVzdF9leHBlY3Rfc3VjY2VzcyAiUEFOSUM6IFRlc3QgZnJhbWV3b3JrIGVycm9yLiBVbmtub3duIG1hdGNoZXMgdmFsdWUgJG1hdGNoZXMiICdmYWxzZScKCWZpCn0KCm51bF9tYXRjaCAoKSB7CgltYXRjaGVzPSQxCgltYXRjaGVzX3BjcmUyPSQyCgltYXRjaGVzX3BjcmUyX2xvY2FsZT0kMwoJZmxhZ3M9JDQKCXBhdHRlcm49JDUKCXBhdHRlcm5faHVtYW49JChlY2hvICIkcGF0dGVybiIgfCBzZWQgJ3MvUS88TlVMPi9nJykKCgludWxfbWF0Y2hfaW50ZXJuYWwgIiRtYXRjaGVzIiAiIiAiQyIgIiIgIiRmbGFncyIgIiRwYXR0ZXJuIgoJbnVsX21hdGNoX2ludGVybmFsICIkbWF0Y2hlc19wY3JlMiIgIkxJQlBDUkUyIiAiQyIgIi1QIiAiJGZsYWdzIiAiJHBhdHRlcm4iCgludWxfbWF0Y2hfaW50ZXJuYWwgIiRtYXRjaGVzX3BjcmUyX2xvY2FsZSIgIkxJQlBDUkUyLEdFVFRFWFRfTE9DQUxFIiAiJGlzX0lTX2xvY2FsZSIgIi1QIiAiJGZsYWdzIiAiJHBhdHRlcm4iCn0KCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3NldHVwJyAiCgllY2hvICdiaW5hcnlRZmlsZVFtWypdY1Eqw6ZRw7AnIHwgcV90b19udWwgPmEgJiYKCWdpdCBhZGQgYSAmJgoJZ2l0IGNvbW1pdCAtbS4KIgoKIyBTaW1wbGUgZml4ZWQtc3RyaW5nIG1hdGNoaW5nCm51bF9tYXRjaCBQIFAgUCAnLUYnICd5UWYnCm51bF9tYXRjaCBQIFAgUCAnLUYnICd5UXgnCm51bF9tYXRjaCBQIFAgUCAnLUZpJyAnWVFmJwpudWxfbWF0Y2ggUCBQIFAgJy1GaScgJ1lReCcKbnVsX21hdGNoIFAgUCAxICcnICd5UWYnCm51bF9tYXRjaCBQIFAgMCAnJyAneVF4JwpudWxfbWF0Y2ggUCBQIDEgJycgJ8OmUcOwJwpudWxfbWF0Y2ggUCBQIFAgJy1GJyAnZVFtWypdYycKbnVsX21hdGNoIFAgUCBQICctRmknICdFUU1bKl1DJwoKIyBSZWdleCBwYXR0ZXJucyB0aGF0IHdvdWxkIG1hdGNoIGJ1dCBzaG91bGRuJ3Qgd2l0aCAtRgpudWxfbWF0Y2ggUCBQIFAgJy1GJyAneVFbZl0nCm51bF9tYXRjaCBQIFAgUCAnLUYnICdbeV1RZicKbnVsX21hdGNoIFAgUCBQICctRmknICdZUVtGXScKbnVsX21hdGNoIFAgUCBQICctRmknICdbWV1RRicKbnVsX21hdGNoIFAgUCBQICctRicgJ8OmUVvDsF0nCm51bF9tYXRjaCBQIFAgUCAnLUYnICdbw6ZdUcOwJwoKIyBNYXRjaGluZyBwYXR0ZXJuIGFuZCBzdWJqZWN0IGNhc2Ugd2l0aCAtaQpudWxfbWF0Y2ggUCAxIDEgJy1pJyAnW8OmXVHDsCcKCiMgLi4uUENSRSB2MiBvbmx5IG1hdGNoZXMgbm9uLUFTQ0lJIHdpdGggLWkgY2FzZWZvbGRpbmcgdW5kZXIgVVRGLTgKIyBzZW1hbnRpY3MKbnVsX21hdGNoIFAgUCBQICctRmknICfDhlFbw5BdJwpudWxfbWF0Y2ggUCAwIDEgJy1pJyAgJ8OGUVvDkF0nCm51bF9tYXRjaCBQIDAgMSAnLWknICAnW8OGXVHDkCcKbnVsX21hdGNoIFAgMCAxICctaScgJ1vDhl1Rw7AnCm51bF9tYXRjaCBQIDAgMSAnLWknICfDhlHDkCcKCiMgXDAgaW4gcmVnZXhlcyBjYW4gb25seSB3b3JrIHdpdGggLVAgJiBQQ1JFIHYyCm51bF9tYXRjaCBQIFAgMSAnJyAneVFbZl0nCm51bF9tYXRjaCBQIFAgMSAnJyAnW3ldUWYnCm51bF9tYXRjaCBQIFAgMSAnLWknICdZUVtGXScKbnVsX21hdGNoIFAgUCAxICctaScgJ1tZXVFmJwpudWxfbWF0Y2ggUCBQIDEgJycgJ8OmUVvDsF0nCm51bF9tYXRjaCBQIFAgMSAnJyAnW8OmXVHDsCcKbnVsX21hdGNoIFAgUCAxICctaScgJ8OGUVvDkF0nCm51bF9tYXRjaCBQIFAgMSAnJyAnZVFtLipjUScKbnVsX21hdGNoIFAgUCAxICctaScgJ0VRTS4qY1EnCm51bF9tYXRjaCBQIFAgMCAnJyAnZVFtWypdYycKbnVsX21hdGNoIFAgUCAwICctaScgJ0VRTVsqXUMnCgojIEFzc2VydCB0aGF0IHdlJ3JlIHVzaW5nIFJFR19TVEFSVEVORCBhbmQgdGhlIHBhdHRlcm4gZG9lc24ndCBtYXRjaAojIGp1c3QgYmVjYXVzZSBpdCdzIGN1dCBvZmYgYXQgdGhlIGZpcnN0IFwwLgpudWxfbWF0Y2ggUCBQIDAgJy1pJyAnTk9NQVRDSFHDsCcKbnVsX21hdGNoIFAgUCAwICctaScgJ1vDhl1RTk9NQVRDSCcKbnVsX21hdGNoIFAgUCAwICctaScgJ1vDpl1RTk9NQVRDSCcKCiMgRW5zdXJlIHRoYXQgdGhlIG1hdGNoZXIgZG9lc24ndCByZWdyZXNzIHRvIHNvbWV0aGluZyB0aGF0IHN0b3BzIGF0CiMgXDAKbnVsX21hdGNoIFAgUCBQICctRicgJ3lRW2ZdJwpudWxfbWF0Y2ggUCBQIFAgJy1GaScgJ1lRW0ZdJwpudWxfbWF0Y2ggUCBQIDAgJycgJ3lRTk9NQVRDSCcKbnVsX21hdGNoIFAgUCAwICcnICdRTk9NQVRDSCcKbnVsX21hdGNoIFAgUCAwICctaScgJ1lRTk9NQVRDSCcKbnVsX21hdGNoIFAgUCAwICctaScgJ1FOT01BVENIJwpudWxfbWF0Y2ggUCBQIFAgJy1GJyAnw6ZRW8OwXScKbnVsX21hdGNoIFAgUCBQICctRmknICfDhlFbw5BdJwpudWxfbWF0Y2ggUCBQIDEgJy1pJyAnw4ZRW8OQXScKbnVsX21hdGNoIFAgUCAwICcnICd5UU7Dk01BVENIJwpudWxfbWF0Y2ggUCBQIDAgJycgJ1FOw5NNQVRDSCcKbnVsX21hdGNoIFAgUCAwICctaScgJ1lRTsOTTUFUQ0gnCm51bF9tYXRjaCBQIFAgMCAnLWknICdRTsOTTUFUQ0gnCgp0ZXN0X2RvbmUK",
    "text": "#!/bin/sh\n\ntest_description='git grep with a binary pattern files'\n\n. ./lib-gettext.sh\n\nnul_match_internal () {\n\tmatches=$1\n\tprereqs=$2\n\tlc_all=$3\n\textra_flags=$4\n\tflags=$5\n\tpattern=$6\n\tpattern_human=$(echo \"$pattern\" | sed 's/Q/<NUL>/g')\n\n\tif test \"$matches\" = 1\n\tthen\n\t\ttest_expect_success $prereqs \"LC_ALL='$lc_all' git grep $extra_flags -f f $flags '$pattern_human' a\" \"\n\t\t\tprintf '$pattern' | q_to_nul >f &&\n\t\t\tLC_ALL='$lc_all' git grep $extra_flags -f f $flags a\n\t\t\"\n\telif test \"$matches\" = 0\n\tthen\n\t\ttest_expect_success $prereqs \"LC_ALL='$lc_all' git grep $extra_flags -f f $flags '$pattern_human' a\" \"\n\t\t\t>stderr &&\n\t\t\tprintf '$pattern' | q_to_nul >f &&\n\t\t\ttest_must_fail env LC_ALL=\\\"$lc_all\\\" git grep $extra_flags -f f $flags a 2>stderr &&\n\t\t\ttest_grep ! 'This is only supported with -P under PCRE v2' stderr\n\t\t\"\n\telif test \"$matches\" = P\n\tthen\n\t\ttest_expect_success $prereqs \"error, PCRE v2 only: LC_ALL='$lc_all' git grep -f f $flags '$pattern_human' a\" \"\n\t\t\t>stderr &&\n\t\t\tprintf '$pattern' | q_to_nul >f &&\n\t\t\ttest_must_fail env LC_ALL=\\\"$lc_all\\\" git grep -f f $flags a 2>stderr &&\n\t\t\ttest_grep 'This is only supported with -P under PCRE v2' stderr\n\t\t\"\n\telse\n\t\ttest_expect_success \"PANIC: Test framework error. Unknown matches value $matches\" 'false'\n\tfi\n}\n\nnul_match () {\n\tmatches=$1\n\tmatches_pcre2=$2\n\tmatches_pcre2_locale=$3\n\tflags=$4\n\tpattern=$5\n\tpattern_human=$(echo \"$pattern\" | sed 's/Q/<NUL>/g')\n\n\tnul_match_internal \"$matches\" \"\" \"C\" \"\" \"$flags\" \"$pattern\"\n\tnul_match_internal \"$matches_pcre2\" \"LIBPCRE2\" \"C\" \"-P\" \"$flags\" \"$pattern\"\n\tnul_match_internal \"$matches_pcre2_locale\" \"LIBPCRE2,GETTEXT_LOCALE\" \"$is_IS_locale\" \"-P\" \"$flags\" \"$pattern\"\n}\n\ntest_expect_success 'setup' \"\n\techo 'binaryQfileQm[*]cQ*\u00e6Q\u00f0' | q_to_nul >a &&\n\tgit add a &&\n\tgit commit -m.\n\"\n\n# Simple fixed-string matching\nnul_match P P P '-F' 'yQf'\nnul_match P P P '-F' 'yQx'\nnul_match P P P '-Fi' 'YQf'\nnul_match P P P '-Fi' 'YQx'\nnul_match P P 1 '' 'yQf'\nnul_match P P 0 '' 'yQx'\nnul_match P P 1 '' '\u00e6Q\u00f0'\nnul_match P P P '-F' 'eQm[*]c'\nnul_match P P P '-Fi' 'EQM[*]C'\n\n# Regex patterns that would match but shouldn't with -F\nnul_match P P P '-F' 'yQ[f]'\nnul_match P P P '-F' '[y]Qf'\nnul_match P P P '-Fi' 'YQ[F]'\nnul_match P P P '-Fi' '[Y]QF'\nnul_match P P P '-F' '\u00e6Q[\u00f0]'\nnul_match P P P '-F' '[\u00e6]Q\u00f0'\n\n# Matching pattern and subject case with -i\nnul_match P 1 1 '-i' '[\u00e6]Q\u00f0'\n\n# ...PCRE v2 only matches non-ASCII with -i casefolding under UTF-8\n# semantics\nnul_match P P P '-Fi' '\u00c6Q[\u00d0]'\nnul_match P 0 1 '-i'  '\u00c6Q[\u00d0]'\nnul_match P 0 1 '-i'  '[\u00c6]Q\u00d0'\nnul_match P 0 1 '-i' '[\u00c6]Q\u00f0'\nnul_match P 0 1 '-i' '\u00c6Q\u00d0'\n\n# \\0 in regexes can only work with -P & PCRE v2\nnul_match P P 1 '' 'yQ[f]'\nnul_match P P 1 '' '[y]Qf'\nnul_match P P 1 '-i' 'YQ[F]'\nnul_match P P 1 '-i' '[Y]Qf'\nnul_match P P 1 '' '\u00e6Q[\u00f0]'\nnul_match P P 1 '' '[\u00e6]Q\u00f0'\nnul_match P P 1 '-i' '\u00c6Q[\u00d0]'\nnul_match P P 1 '' 'eQm.*cQ'\nnul_match P P 1 '-i' 'EQM.*cQ'\nnul_match P P 0 '' 'eQm[*]c'\nnul_match P P 0 '-i' 'EQM[*]C'\n\n# Assert that we're using REG_STARTEND and the pattern doesn't match\n# just because it's cut off at the first \\0.\nnul_match P P 0 '-i' 'NOMATCHQ\u00f0'\nnul_match P P 0 '-i' '[\u00c6]QNOMATCH'\nnul_match P P 0 '-i' '[\u00e6]QNOMATCH'\n\n# Ensure that the matcher doesn't regress to something that stops at\n# \\0\nnul_match P P P '-F' 'yQ[f]'\nnul_match P P P '-Fi' 'YQ[F]'\nnul_match P P 0 '' 'yQNOMATCH'\nnul_match P P 0 '' 'QNOMATCH'\nnul_match P P 0 '-i' 'YQNOMATCH'\nnul_match P P 0 '-i' 'QNOMATCH'\nnul_match P P P '-F' '\u00e6Q[\u00f0]'\nnul_match P P P '-Fi' '\u00c6Q[\u00d0]'\nnul_match P P 1 '-i' '\u00c6Q[\u00d0]'\nnul_match P P 0 '' 'yQN\u00d3MATCH'\nnul_match P P 0 '' 'QN\u00d3MATCH'\nnul_match P P 0 '-i' 'YQN\u00d3MATCH'\nnul_match P P 0 '-i' 'QN\u00d3MATCH'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "0088eaa0c918aa4afd91d590f19f840e9a58661d",
  "sha1_ok": true,
  "size": 3702
}
