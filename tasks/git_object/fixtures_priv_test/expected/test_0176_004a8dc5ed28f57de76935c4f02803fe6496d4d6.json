{
  "content": {
    "base64": "IyEvYmluL3NoCgp0ZXN0X2Rlc2NyaXB0aW9uPSdnaXQgcmVtb3RlIHBvcmNlbGFpbi1pc2gnCgouIC4vdGVzdC1saWIuc2gKCnNldHVwX3JlcG9zaXRvcnkgKCkgewoJbWtkaXIgIiQxIiAmJiAoCgljZCAiJDEiICYmCglnaXQgaW5pdCAmJgoJPmZpbGUgJiYKCWdpdCBhZGQgZmlsZSAmJgoJdGVzdF90aWNrICYmCglnaXQgY29tbWl0IC1tICJJbml0aWFsIiAmJgoJZ2l0IGNoZWNrb3V0IC1iIHNpZGUgJiYKCT5lbGlmICYmCglnaXQgYWRkIGVsaWYgJiYKCXRlc3RfdGljayAmJgoJZ2l0IGNvbW1pdCAtbSAiU2Vjb25kIiAmJgoJZ2l0IGNoZWNrb3V0IG1hc3RlcgoJKQp9Cgp0b2tlbnNfbWF0Y2ggKCkgewoJZWNobyAiJDEiIHwgdHIgJyAnICdcMDEyJyB8IHNvcnQgfCBzZWQgLWUgJy9eJC9kJyA+ZXhwZWN0ICYmCgllY2hvICIkMiIgfCB0ciAnICcgJ1wwMTInIHwgc29ydCB8IHNlZCAtZSAnL14kL2QnID5hY3R1YWwgJiYKCXRlc3RfY21wIGV4cGVjdCBhY3R1YWwKfQoKY2hlY2tfcmVtb3RlX3RyYWNrICgpIHsKCWFjdHVhbD0kKGdpdCByZW1vdGUgc2hvdyAiJDEiIHwgc2VkIC1uIC1lICckcCcpICYmCglzaGlmdCAmJgoJdG9rZW5zX21hdGNoICIkKiIgIiRhY3R1YWwiCn0KCmNoZWNrX3RyYWNraW5nX2JyYW5jaCAoKSB7CglmPSIiICYmCglyPSQoZ2l0IGZvci1lYWNoLXJlZiAiLS1mb3JtYXQ9JShyZWZuYW1lKSIgfAoJCXNlZCAtbmUgInN8XnJlZnMvcmVtb3Rlcy8kMS98fHAiKSAmJgoJc2hpZnQgJiYKCXRva2Vuc19tYXRjaCAiJCoiICIkciIKfQoKdGVzdF9leHBlY3Rfc3VjY2VzcyBzZXR1cCAnCgoJc2V0dXBfcmVwb3NpdG9yeSBvbmUgJiYKCXNldHVwX3JlcG9zaXRvcnkgdHdvICYmCgkoCgkJY2QgdHdvICYmIGdpdCBicmFuY2ggYW5vdGhlcgoJKSAmJgoJZ2l0IGNsb25lIG9uZSB0ZXN0CgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdyZW1vdGUgaW5mb3JtYXRpb24gZm9yIHRoZSBvcmlnaW4nICcKKAoJY2QgdGVzdCAmJgoJdG9rZW5zX21hdGNoIG9yaWdpbiAiJChnaXQgcmVtb3RlKSIgJiYKCWNoZWNrX3JlbW90ZV90cmFjayBvcmlnaW4gbWFzdGVyIHNpZGUgJiYKCWNoZWNrX3RyYWNraW5nX2JyYW5jaCBvcmlnaW4gSEVBRCBtYXN0ZXIgc2lkZQopCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2FkZCBhbm90aGVyIHJlbW90ZScgJwooCgljZCB0ZXN0ICYmCglnaXQgcmVtb3RlIGFkZCAtZiBzZWNvbmQgLi4vdHdvICYmCgl0b2tlbnNfbWF0Y2ggIm9yaWdpbiBzZWNvbmQiICIkKGdpdCByZW1vdGUpIiAmJgoJY2hlY2tfcmVtb3RlX3RyYWNrIG9yaWdpbiBtYXN0ZXIgc2lkZSAmJgoJY2hlY2tfcmVtb3RlX3RyYWNrIHNlY29uZCBtYXN0ZXIgc2lkZSBhbm90aGVyICYmCgljaGVja190cmFja2luZ19icmFuY2ggc2Vjb25kIG1hc3RlciBzaWRlIGFub3RoZXIgJiYKCWdpdCBmb3ItZWFjaC1yZWYgIi0tZm9ybWF0PSUocmVmbmFtZSkiIHJlZnMvcmVtb3RlcyB8CglzZWQgLWUgIi9ecmVmc1wvcmVtb3Rlc1wvb3JpZ2luXC8vZCIgXAoJICAgIC1lICIvXnJlZnNcL3JlbW90ZXNcL3NlY29uZFwvL2QiID5hY3R1YWwgJiYKCT5leHBlY3QgJiYKCXRlc3RfY21wIGV4cGVjdCBhY3R1YWwKKQonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdyZW1vdmUgcmVtb3RlJyAnCigKCWNkIHRlc3QgJiYKCWdpdCBzeW1ib2xpYy1yZWYgcmVmcy9yZW1vdGVzL3NlY29uZC9IRUFEIHJlZnMvcmVtb3Rlcy9zZWNvbmQvbWFzdGVyICYmCglnaXQgcmVtb3RlIHJtIHNlY29uZAopCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3JlbW92ZSByZW1vdGUnICcKKAoJY2QgdGVzdCAmJgoJdG9rZW5zX21hdGNoIG9yaWdpbiAiJChnaXQgcmVtb3RlKSIgJiYKCWNoZWNrX3JlbW90ZV90cmFjayBvcmlnaW4gbWFzdGVyIHNpZGUgJiYKCWdpdCBmb3ItZWFjaC1yZWYgIi0tZm9ybWF0PSUocmVmbmFtZSkiIHJlZnMvcmVtb3RlcyB8CglzZWQgLWUgIi9ecmVmc1wvcmVtb3Rlc1wvb3JpZ2luXC8vZCIgPmFjdHVhbCAmJgoJPmV4cGVjdCAmJgoJdGVzdF9jbXAgZXhwZWN0IGFjdHVhbAopCicKCmNhdCA+IHRlc3QvZXhwZWN0IDw8IEVPRgoqIHJlbW90ZSBvcmlnaW4KICBVUkw6ICQocHdkKS9vbmUvLmdpdAogIFJlbW90ZSBicmFuY2ggbWVyZ2VkIHdpdGggJ2dpdCBwdWxsJyB3aGlsZSBvbiBicmFuY2ggbWFzdGVyCiAgICBtYXN0ZXIKICBOZXcgcmVtb3RlIGJyYW5jaCAobmV4dCBmZXRjaCB3aWxsIHN0b3JlIGluIHJlbW90ZXMvb3JpZ2luKQogICAgbWFzdGVyCiAgVHJhY2tlZCByZW1vdGUgYnJhbmNoZXMKICAgIHNpZGUgbWFzdGVyCkVPRgoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnc2hvdycgJwoJKGNkIHRlc3QgJiYKCSBnaXQgY29uZmlnIC0tYWRkIHJlbW90ZS5vcmlnaW4uZmV0Y2ggXAoJCXJlZnMvaGVhZHMvbWFzdGVyOnJlZnMvaGVhZHMvdXBzdHJlYW0gJiYKCSBnaXQgZmV0Y2ggJiYKCSBnaXQgYnJhbmNoIC1kIC1yIG9yaWdpbi9tYXN0ZXIgJiYKCSAoY2QgLi4vb25lICYmCgkgIGVjaG8gMSA+IGZpbGUgJiYKCSAgdGVzdF90aWNrICYmCgkgIGdpdCBjb21taXQgLW0gdXBkYXRlIGZpbGUpICYmCgkgZ2l0IHJlbW90ZSBzaG93IG9yaWdpbiA+IG91dHB1dCAmJgoJIGdpdCBkaWZmIGV4cGVjdCBvdXRwdXQpCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3BydW5lJyAnCgkoY2Qgb25lICYmCgkgZ2l0IGJyYW5jaCAtbSBzaWRlIHNpZGUyKSAmJgoJKGNkIHRlc3QgJiYKCSBnaXQgZmV0Y2ggb3JpZ2luICYmCgkgZ2l0IHJlbW90ZSBwcnVuZSBvcmlnaW4gJiYKCSBnaXQgcmV2LXBhcnNlIHJlZnMvcmVtb3Rlcy9vcmlnaW4vc2lkZTIgJiYKCSAhIGdpdCByZXYtcGFyc2UgcmVmcy9yZW1vdGVzL29yaWdpbi9zaWRlKQonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhZGQgLS1taXJyb3IgJiYgcHJ1bmUnICcKCShta2RpciBtaXJyb3IgJiYKCSBjZCBtaXJyb3IgJiYKCSBnaXQgaW5pdCAmJgoJIGdpdCByZW1vdGUgYWRkIC0tbWlycm9yIC1mIG9yaWdpbiAuLi9vbmUpICYmCgkoY2Qgb25lICYmCgkgZ2l0IGJyYW5jaCAtbSBzaWRlMiBzaWRlKSAmJgoJKGNkIG1pcnJvciAmJgoJIGdpdCByZXYtcGFyc2UgLS12ZXJpZnkgcmVmcy9oZWFkcy9zaWRlMiAmJgoJICEgZ2l0IHJldi1wYXJzZSAtLXZlcmlmeSByZWZzL2hlYWRzL3NpZGUgJiYKCSBnaXQgZmV0Y2ggb3JpZ2luICYmCgkgZ2l0IHJlbW90ZSBwcnVuZSBvcmlnaW4gJiYKCSAhIGdpdCByZXYtcGFyc2UgLS12ZXJpZnkgcmVmcy9oZWFkcy9zaWRlMiAmJgoJIGdpdCByZXYtcGFyc2UgLS12ZXJpZnkgcmVmcy9oZWFkcy9zaWRlKQonCgpjYXQgPiBvbmUvZXhwZWN0IDw8IEVPRgogIGFwaXMvbWFzdGVyCiAgYXBpcy9zaWRlCiAgZHJvc29waGlsYS9hbm90aGVyCiAgZHJvc29waGlsYS9tYXN0ZXIKICBkcm9zb3BoaWxhL3NpZGUKRU9GCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICd1cGRhdGUnICcKCgkoY2Qgb25lICYmCgkgZ2l0IHJlbW90ZSBhZGQgZHJvc29waGlsYSAuLi90d28gJiYKCSBnaXQgcmVtb3RlIGFkZCBhcGlzIC4uL21pcnJvciAmJgoJIGdpdCByZW1vdGUgdXBkYXRlICYmCgkgZ2l0IGJyYW5jaCAtciA+IG91dHB1dCAmJgoJIGdpdCBkaWZmIGV4cGVjdCBvdXRwdXQpCgonCgpjYXQgPiBvbmUvZXhwZWN0IDw8IEVPRgogIGRyb3NvcGhpbGEvYW5vdGhlcgogIGRyb3NvcGhpbGEvbWFzdGVyCiAgZHJvc29waGlsYS9zaWRlCiAgbWFuZHVjYS9tYXN0ZXIKICBtYW5kdWNhL3NpZGUKICBtZWdhbG9wcmVwdXMvbWFzdGVyCiAgbWVnYWxvcHJlcHVzL3NpZGUKRU9GCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICd1cGRhdGUgd2l0aCBhcmd1bWVudHMnICcKCgkoY2Qgb25lICYmCgkgZm9yIGIgaW4gJChnaXQgYnJhbmNoIC1yKQoJIGRvCgkJZ2l0IGJyYW5jaCAtciAtZCAkYiB8fCBicmVhawoJIGRvbmUgJiYKCSBnaXQgcmVtb3RlIGFkZCBtYW5kdWNhIC4uL21pcnJvciAmJgoJIGdpdCByZW1vdGUgYWRkIG1lZ2Fsb3ByZXB1cyAuLi9taXJyb3IgJiYKCSBnaXQgY29uZmlnIHJlbW90ZXMucGhvYmFldGljdXMgImRyb3NvcGhpbGEgbWVnYWxvcHJlcHVzIiAmJgoJIGdpdCBjb25maWcgcmVtb3Rlcy50aXRhbnVzIG1hbmR1Y2EgJiYKCSBnaXQgcmVtb3RlIHVwZGF0ZSBwaG9iYWV0aWN1cyB0aXRhbnVzICYmCgkgZ2l0IGJyYW5jaCAtciA+IG91dHB1dCAmJgoJIGdpdCBkaWZmIGV4cGVjdCBvdXRwdXQpCgonCgpjYXQgPiBvbmUvZXhwZWN0IDw8IEVPRgogIGFwaXMvbWFzdGVyCiAgYXBpcy9zaWRlCiAgbWFuZHVjYS9tYXN0ZXIKICBtYW5kdWNhL3NpZGUKICBtZWdhbG9wcmVwdXMvbWFzdGVyCiAgbWVnYWxvcHJlcHVzL3NpZGUKRU9GCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICd1cGRhdGUgZGVmYXVsdCcgJwoKCShjZCBvbmUgJiYKCSBmb3IgYiBpbiAkKGdpdCBicmFuY2ggLXIpCgkgZG8KCQlnaXQgYnJhbmNoIC1yIC1kICRiIHx8IGJyZWFrCgkgZG9uZSAmJgoJIGdpdCBjb25maWcgcmVtb3RlLmRyb3NvcGhpbGEuc2tpcERlZmF1bHRVcGRhdGUgdHJ1ZSAmJgoJIGdpdCByZW1vdGUgdXBkYXRlIGRlZmF1bHQgJiYKCSBnaXQgYnJhbmNoIC1yID4gb3V0cHV0ICYmCgkgZ2l0IGRpZmYgZXhwZWN0IG91dHB1dCkKCicKCmNhdCA+IG9uZS9leHBlY3QgPDwgRU9GCiAgZHJvc29waGlsYS9hbm90aGVyCiAgZHJvc29waGlsYS9tYXN0ZXIKICBkcm9zb3BoaWxhL3NpZGUKRU9GCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICd1cGRhdGUgZGVmYXVsdCAob3ZlcnJpZGRlbiwgd2l0aCBmdW5ueSB3aGl0ZXNwYWNlKScgJwoKCShjZCBvbmUgJiYKCSBmb3IgYiBpbiAkKGdpdCBicmFuY2ggLXIpCgkgZG8KCQlnaXQgYnJhbmNoIC1yIC1kICRiIHx8IGJyZWFrCgkgZG9uZSAmJgoJIGdpdCBjb25maWcgcmVtb3Rlcy5kZWZhdWx0ICIkKHByaW50ZiAiXHQgZHJvc29waGlsYSAgXG4iKSIgJiYKCSBnaXQgcmVtb3RlIHVwZGF0ZSBkZWZhdWx0ICYmCgkgZ2l0IGJyYW5jaCAtciA+IG91dHB1dCAmJgoJIGdpdCBkaWZmIGV4cGVjdCBvdXRwdXQpCgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICcicmVtb3RlIHNob3ciIGRvZXMgbm90IHNob3cgc3ltYm9saWMgcmVmcycgJwoKCWdpdCBjbG9uZSBvbmUgdGhyZWUgJiYKCShjZCB0aHJlZSAmJgoJIGdpdCByZW1vdGUgc2hvdyBvcmlnaW4gPiBvdXRwdXQgJiYKCSAhIGdyZXAgSEVBRCA8IG91dHB1dCAmJgoJICEgZ3JlcCAtaSBzdGFsZSA8IG91dHB1dCkKCicKCnRlc3RfZG9uZQo=",
    "text": "#!/bin/sh\n\ntest_description='git remote porcelain-ish'\n\n. ./test-lib.sh\n\nsetup_repository () {\n\tmkdir \"$1\" && (\n\tcd \"$1\" &&\n\tgit init &&\n\t>file &&\n\tgit add file &&\n\ttest_tick &&\n\tgit commit -m \"Initial\" &&\n\tgit checkout -b side &&\n\t>elif &&\n\tgit add elif &&\n\ttest_tick &&\n\tgit commit -m \"Second\" &&\n\tgit checkout master\n\t)\n}\n\ntokens_match () {\n\techo \"$1\" | tr ' ' '\\012' | sort | sed -e '/^$/d' >expect &&\n\techo \"$2\" | tr ' ' '\\012' | sort | sed -e '/^$/d' >actual &&\n\ttest_cmp expect actual\n}\n\ncheck_remote_track () {\n\tactual=$(git remote show \"$1\" | sed -n -e '$p') &&\n\tshift &&\n\ttokens_match \"$*\" \"$actual\"\n}\n\ncheck_tracking_branch () {\n\tf=\"\" &&\n\tr=$(git for-each-ref \"--format=%(refname)\" |\n\t\tsed -ne \"s|^refs/remotes/$1/||p\") &&\n\tshift &&\n\ttokens_match \"$*\" \"$r\"\n}\n\ntest_expect_success setup '\n\n\tsetup_repository one &&\n\tsetup_repository two &&\n\t(\n\t\tcd two && git branch another\n\t) &&\n\tgit clone one test\n\n'\n\ntest_expect_success 'remote information for the origin' '\n(\n\tcd test &&\n\ttokens_match origin \"$(git remote)\" &&\n\tcheck_remote_track origin master side &&\n\tcheck_tracking_branch origin HEAD master side\n)\n'\n\ntest_expect_success 'add another remote' '\n(\n\tcd test &&\n\tgit remote add -f second ../two &&\n\ttokens_match \"origin second\" \"$(git remote)\" &&\n\tcheck_remote_track origin master side &&\n\tcheck_remote_track second master side another &&\n\tcheck_tracking_branch second master side another &&\n\tgit for-each-ref \"--format=%(refname)\" refs/remotes |\n\tsed -e \"/^refs\\/remotes\\/origin\\//d\" \\\n\t    -e \"/^refs\\/remotes\\/second\\//d\" >actual &&\n\t>expect &&\n\ttest_cmp expect actual\n)\n'\n\ntest_expect_success 'remove remote' '\n(\n\tcd test &&\n\tgit symbolic-ref refs/remotes/second/HEAD refs/remotes/second/master &&\n\tgit remote rm second\n)\n'\n\ntest_expect_success 'remove remote' '\n(\n\tcd test &&\n\ttokens_match origin \"$(git remote)\" &&\n\tcheck_remote_track origin master side &&\n\tgit for-each-ref \"--format=%(refname)\" refs/remotes |\n\tsed -e \"/^refs\\/remotes\\/origin\\//d\" >actual &&\n\t>expect &&\n\ttest_cmp expect actual\n)\n'\n\ncat > test/expect << EOF\n* remote origin\n  URL: $(pwd)/one/.git\n  Remote branch merged with 'git pull' while on branch master\n    master\n  New remote branch (next fetch will store in remotes/origin)\n    master\n  Tracked remote branches\n    side master\nEOF\n\ntest_expect_success 'show' '\n\t(cd test &&\n\t git config --add remote.origin.fetch \\\n\t\trefs/heads/master:refs/heads/upstream &&\n\t git fetch &&\n\t git branch -d -r origin/master &&\n\t (cd ../one &&\n\t  echo 1 > file &&\n\t  test_tick &&\n\t  git commit -m update file) &&\n\t git remote show origin > output &&\n\t git diff expect output)\n'\n\ntest_expect_success 'prune' '\n\t(cd one &&\n\t git branch -m side side2) &&\n\t(cd test &&\n\t git fetch origin &&\n\t git remote prune origin &&\n\t git rev-parse refs/remotes/origin/side2 &&\n\t ! git rev-parse refs/remotes/origin/side)\n'\n\ntest_expect_success 'add --mirror && prune' '\n\t(mkdir mirror &&\n\t cd mirror &&\n\t git init &&\n\t git remote add --mirror -f origin ../one) &&\n\t(cd one &&\n\t git branch -m side2 side) &&\n\t(cd mirror &&\n\t git rev-parse --verify refs/heads/side2 &&\n\t ! git rev-parse --verify refs/heads/side &&\n\t git fetch origin &&\n\t git remote prune origin &&\n\t ! git rev-parse --verify refs/heads/side2 &&\n\t git rev-parse --verify refs/heads/side)\n'\n\ncat > one/expect << EOF\n  apis/master\n  apis/side\n  drosophila/another\n  drosophila/master\n  drosophila/side\nEOF\n\ntest_expect_success 'update' '\n\n\t(cd one &&\n\t git remote add drosophila ../two &&\n\t git remote add apis ../mirror &&\n\t git remote update &&\n\t git branch -r > output &&\n\t git diff expect output)\n\n'\n\ncat > one/expect << EOF\n  drosophila/another\n  drosophila/master\n  drosophila/side\n  manduca/master\n  manduca/side\n  megaloprepus/master\n  megaloprepus/side\nEOF\n\ntest_expect_success 'update with arguments' '\n\n\t(cd one &&\n\t for b in $(git branch -r)\n\t do\n\t\tgit branch -r -d $b || break\n\t done &&\n\t git remote add manduca ../mirror &&\n\t git remote add megaloprepus ../mirror &&\n\t git config remotes.phobaeticus \"drosophila megaloprepus\" &&\n\t git config remotes.titanus manduca &&\n\t git remote update phobaeticus titanus &&\n\t git branch -r > output &&\n\t git diff expect output)\n\n'\n\ncat > one/expect << EOF\n  apis/master\n  apis/side\n  manduca/master\n  manduca/side\n  megaloprepus/master\n  megaloprepus/side\nEOF\n\ntest_expect_success 'update default' '\n\n\t(cd one &&\n\t for b in $(git branch -r)\n\t do\n\t\tgit branch -r -d $b || break\n\t done &&\n\t git config remote.drosophila.skipDefaultUpdate true &&\n\t git remote update default &&\n\t git branch -r > output &&\n\t git diff expect output)\n\n'\n\ncat > one/expect << EOF\n  drosophila/another\n  drosophila/master\n  drosophila/side\nEOF\n\ntest_expect_success 'update default (overridden, with funny whitespace)' '\n\n\t(cd one &&\n\t for b in $(git branch -r)\n\t do\n\t\tgit branch -r -d $b || break\n\t done &&\n\t git config remotes.default \"$(printf \"\\t drosophila  \\n\")\" &&\n\t git remote update default &&\n\t git branch -r > output &&\n\t git diff expect output)\n\n'\n\ntest_expect_success '\"remote show\" does not show symbolic refs' '\n\n\tgit clone one three &&\n\t(cd three &&\n\t git remote show origin > output &&\n\t ! grep HEAD < output &&\n\t ! grep -i stale < output)\n\n'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "004a8dc5ed28f57de76935c4f02803fe6496d4d6",
  "sha1_ok": true,
  "size": 5174
}
