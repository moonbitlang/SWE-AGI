{
  "content": {
    "base64": "IyEvYmluL3NoCgp0ZXN0X2Rlc2NyaXB0aW9uPSdUZXN0IGhhbmRsaW5nIG9mIHJlZiBuYW1lcyB0aGF0IGNoZWNrLXJlZi1mb3JtYXQgcmVqZWN0cycKLiAuL3Rlc3QtbGliLnNoCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIHNldHVwICcKCXRlc3RfY29tbWl0IG9uZSAmJgoJdGVzdF9jb21taXQgdHdvCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2Zhc3QtaW1wb3J0OiBmYWlsIG9uIGludmFsaWQgYnJhbmNoIG5hbWUgIi5iYWRicmFuY2huYW1lIicgJwoJdGVzdF93aGVuX2ZpbmlzaGVkICJybSAtZiAuZ2l0L29iamVjdHMvcGFja18qIC5naXQvb2JqZWN0cy9pbmRleF8qIiAmJgoJY2F0ID5pbnB1dCA8PC1JTlBVVF9FTkQgJiYKCQljb21taXQgLmJhZGJyYW5jaG5hbWUKCQljb21taXR0ZXIgJEdJVF9DT01NSVRURVJfTkFNRSA8JEdJVF9DT01NSVRURVJfRU1BSUw+ICRHSVRfQ09NTUlUVEVSX0RBVEUKCQlkYXRhIDw8Q09NTUlUCgkJY29ycnVwdAoJCUNPTU1JVAoKCQlmcm9tIHJlZnMvaGVhZHMvbWFzdGVyCgoJSU5QVVRfRU5ECgl0ZXN0X211c3RfZmFpbCBnaXQgZmFzdC1pbXBvcnQgPGlucHV0CicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2Zhc3QtaW1wb3J0OiBmYWlsIG9uIGludmFsaWQgYnJhbmNoIG5hbWUgImJhZFticmFuY2hdbmFtZSInICcKCXRlc3Rfd2hlbl9maW5pc2hlZCAicm0gLWYgLmdpdC9vYmplY3RzL3BhY2tfKiAuZ2l0L29iamVjdHMvaW5kZXhfKiIgJiYKCWNhdCA+aW5wdXQgPDwtSU5QVVRfRU5EICYmCgkJY29tbWl0IGJhZFticmFuY2hdbmFtZQoJCWNvbW1pdHRlciAkR0lUX0NPTU1JVFRFUl9OQU1FIDwkR0lUX0NPTU1JVFRFUl9FTUFJTD4gJEdJVF9DT01NSVRURVJfREFURQoJCWRhdGEgPDxDT01NSVQKCQljb3JydXB0CgkJQ09NTUlUCgoJCWZyb20gcmVmcy9oZWFkcy9tYXN0ZXIKCglJTlBVVF9FTkQKCXRlc3RfbXVzdF9mYWlsIGdpdCBmYXN0LWltcG9ydCA8aW5wdXQKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZ2l0IGJyYW5jaCBzaG93cyBiYWRseSBuYW1lZCByZWYgYXMgd2FybmluZycgJwoJY3AgLmdpdC9yZWZzL2hlYWRzL21hc3RlciAuZ2l0L3JlZnMvaGVhZHMvYnJva2VuLi4ucmVmICYmCgl0ZXN0X3doZW5fZmluaXNoZWQgInJtIC1mIC5naXQvcmVmcy9oZWFkcy9icm9rZW4uLi5yZWYiICYmCglnaXQgYnJhbmNoID5vdXRwdXQgMj5lcnJvciAmJgoJdGVzdF9pMThuZ3JlcCAtZSAiaWdub3JpbmcgcmVmIHdpdGggYnJva2VuIG5hbWUgcmVmcy9oZWFkcy9icm9rZW5cLlwuXC5yZWYiIGVycm9yICYmCgkhIGdyZXAgLWUgImJyb2tlblwuXC5cLnJlZiIgb3V0cHV0CicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2JyYW5jaCAtZCBjYW4gZGVsZXRlIGJhZGx5IG5hbWVkIHJlZicgJwoJY3AgLmdpdC9yZWZzL2hlYWRzL21hc3RlciAuZ2l0L3JlZnMvaGVhZHMvYnJva2VuLi4ucmVmICYmCgl0ZXN0X3doZW5fZmluaXNoZWQgInJtIC1mIC5naXQvcmVmcy9oZWFkcy9icm9rZW4uLi5yZWYiICYmCglnaXQgYnJhbmNoIC1kIGJyb2tlbi4uLnJlZiAmJgoJZ2l0IGJyYW5jaCA+b3V0cHV0IDI+ZXJyb3IgJiYKCSEgZ3JlcCAtZSAiYnJva2VuXC5cLlwucmVmIiBlcnJvciAmJgoJISBncmVwIC1lICJicm9rZW5cLlwuXC5yZWYiIG91dHB1dAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdicmFuY2ggLUQgY2FuIGRlbGV0ZSBiYWRseSBuYW1lZCByZWYnICcKCWNwIC5naXQvcmVmcy9oZWFkcy9tYXN0ZXIgLmdpdC9yZWZzL2hlYWRzL2Jyb2tlbi4uLnJlZiAmJgoJdGVzdF93aGVuX2ZpbmlzaGVkICJybSAtZiAuZ2l0L3JlZnMvaGVhZHMvYnJva2VuLi4ucmVmIiAmJgoJZ2l0IGJyYW5jaCAtRCBicm9rZW4uLi5yZWYgJiYKCWdpdCBicmFuY2ggPm91dHB1dCAyPmVycm9yICYmCgkhIGdyZXAgLWUgImJyb2tlblwuXC5cLnJlZiIgZXJyb3IgJiYKCSEgZ3JlcCAtZSAiYnJva2VuXC5cLlwucmVmIiBvdXRwdXQKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYnJhbmNoIC1EIGNhbm5vdCBkZWxldGUgbm9uLXJlZiBpbiAuZ2l0IGRpcicgJwoJZWNobyBwcmVjaW91cyA+LmdpdC9teS1wcml2YXRlLWZpbGUgJiYKCWVjaG8gcHJlY2lvdXMgPmV4cGVjdCAmJgoJdGVzdF9tdXN0X2ZhaWwgZ2l0IGJyYW5jaCAtRCAuLi8uLi9teS1wcml2YXRlLWZpbGUgJiYKCXRlc3RfY21wIGV4cGVjdCAuZ2l0L215LXByaXZhdGUtZmlsZQonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdicmFuY2ggLUQgY2Fubm90IGRlbGV0ZSByZWYgaW4gLmdpdCBkaXInICcKCWdpdCByZXYtcGFyc2UgSEVBRCA+LmdpdC9teS1wcml2YXRlLWZpbGUgJiYKCWdpdCByZXYtcGFyc2UgSEVBRCA+ZXhwZWN0ICYmCglnaXQgYnJhbmNoIGZvby9sZWdpdCAmJgoJdGVzdF9tdXN0X2ZhaWwgZ2l0IGJyYW5jaCAtRCBmb28vLy8vLi8uLy4vLi4vLi4vLi4vbXktcHJpdmF0ZS1maWxlICYmCgl0ZXN0X2NtcCBleHBlY3QgLmdpdC9teS1wcml2YXRlLWZpbGUKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYnJhbmNoIC1EIGNhbm5vdCBkZWxldGUgYWJzb2x1dGUgcGF0aCcgJwoJZ2l0IGJyYW5jaCAtZiBleHRyYSAmJgoJdGVzdF9tdXN0X2ZhaWwgZ2l0IGJyYW5jaCAtRCAiJChwd2QpLy5naXQvcmVmcy9oZWFkcy9leHRyYSIgJiYKCXRlc3RfY21wX3JldiBIRUFEIGV4dHJhCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2dpdCBicmFuY2ggY2Fubm90IGNyZWF0ZSBhIGJhZGx5IG5hbWVkIHJlZicgJwoJdGVzdF93aGVuX2ZpbmlzaGVkICJybSAtZiAuZ2l0L3JlZnMvaGVhZHMvYnJva2VuLi4ucmVmIiAmJgoJdGVzdF9tdXN0X2ZhaWwgZ2l0IGJyYW5jaCBicm9rZW4uLi5yZWYgJiYKCWdpdCBicmFuY2ggPm91dHB1dCAyPmVycm9yICYmCgkhIGdyZXAgLWUgImJyb2tlblwuXC5cLnJlZiIgZXJyb3IgJiYKCSEgZ3JlcCAtZSAiYnJva2VuXC5cLlwucmVmIiBvdXRwdXQKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYnJhbmNoIC1tIGNhbm5vdCByZW5hbWUgdG8gYSBiYWQgcmVmIG5hbWUnICcKCXRlc3Rfd2hlbl9maW5pc2hlZCAicm0gLWYgLmdpdC9yZWZzL2hlYWRzL2Jyb2tlbi4uLnJlZiIgJiYKCXRlc3RfbWlnaHRfZmFpbCBnaXQgYnJhbmNoIC1EIGdvb2RyZWYgJiYKCWdpdCBicmFuY2ggZ29vZHJlZiAmJgoJdGVzdF9tdXN0X2ZhaWwgZ2l0IGJyYW5jaCAtbSBnb29kcmVmIGJyb2tlbi4uLnJlZiAmJgoJdGVzdF9jbXBfcmV2IG1hc3RlciBnb29kcmVmICYmCglnaXQgYnJhbmNoID5vdXRwdXQgMj5lcnJvciAmJgoJISBncmVwIC1lICJicm9rZW5cLlwuXC5yZWYiIGVycm9yICYmCgkhIGdyZXAgLWUgImJyb2tlblwuXC5cLnJlZiIgb3V0cHV0CicKCnRlc3RfZXhwZWN0X2ZhaWx1cmUgJ2JyYW5jaCAtbSBjYW4gcmVuYW1lIGZyb20gYSBiYWQgcmVmIG5hbWUnICcKCWNwIC5naXQvcmVmcy9oZWFkcy9tYXN0ZXIgLmdpdC9yZWZzL2hlYWRzL2Jyb2tlbi4uLnJlZiAmJgoJdGVzdF93aGVuX2ZpbmlzaGVkICJybSAtZiAuZ2l0L3JlZnMvaGVhZHMvYnJva2VuLi4ucmVmIiAmJgoJZ2l0IGJyYW5jaCAtbSBicm9rZW4uLi5yZWYgcmVuYW1lZCAmJgoJdGVzdF9jbXBfcmV2IG1hc3RlciByZW5hbWVkICYmCglnaXQgYnJhbmNoID5vdXRwdXQgMj5lcnJvciAmJgoJISBncmVwIC1lICJicm9rZW5cLlwuXC5yZWYiIGVycm9yICYmCgkhIGdyZXAgLWUgImJyb2tlblwuXC5cLnJlZiIgb3V0cHV0CicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3B1c2ggY2Fubm90IGNyZWF0ZSBhIGJhZGx5IG5hbWVkIHJlZicgJwoJdGVzdF93aGVuX2ZpbmlzaGVkICJybSAtZiAuZ2l0L3JlZnMvaGVhZHMvYnJva2VuLi4ucmVmIiAmJgoJdGVzdF9tdXN0X2ZhaWwgZ2l0IHB1c2ggImZpbGU6Ly8kKHB3ZCkiIEhFQUQ6cmVmcy9oZWFkcy9icm9rZW4uLi5yZWYgJiYKCWdpdCBicmFuY2ggPm91dHB1dCAyPmVycm9yICYmCgkhIGdyZXAgLWUgImJyb2tlblwuXC5cLnJlZiIgZXJyb3IgJiYKCSEgZ3JlcCAtZSAiYnJva2VuXC5cLlwucmVmIiBvdXRwdXQKJwoKdGVzdF9leHBlY3RfZmFpbHVyZSAncHVzaCAtLW1pcnJvciBjYW4gZGVsZXRlIGJhZGx5IG5hbWVkIHJlZicgJwoJdG9wPSQocHdkKSAmJgoJZ2l0IGluaXQgc3JjICYmCglnaXQgaW5pdCBkZXN0ICYmCgoJKAoJCWNkIHNyYyAmJgoJCXRlc3RfY29tbWl0IG9uZQoJKSAmJgoJKAoJCWNkIGRlc3QgJiYKCQl0ZXN0X2NvbW1pdCB0d28gJiYKCQlnaXQgY2hlY2tvdXQgLS1kZXRhY2ggJiYKCQljcCAuZ2l0L3JlZnMvaGVhZHMvbWFzdGVyIC5naXQvcmVmcy9oZWFkcy9icm9rZW4uLi5yZWYKCSkgJiYKCWdpdCAtQyBzcmMgcHVzaCAtLW1pcnJvciAiZmlsZTovLyR0b3AvZGVzdCIgJiYKCWdpdCAtQyBkZXN0IGJyYW5jaCA+b3V0cHV0IDI+ZXJyb3IgJiYKCSEgZ3JlcCAtZSAiYnJva2VuXC5cLlwucmVmIiBlcnJvciAmJgoJISBncmVwIC1lICJicm9rZW5cLlwuXC5yZWYiIG91dHB1dAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdyZXYtcGFyc2Ugc2tpcHMgc3ltcmVmIHBvaW50aW5nIHRvIGJyb2tlbiBuYW1lJyAnCgl0ZXN0X3doZW5fZmluaXNoZWQgInJtIC1mIC5naXQvcmVmcy9oZWFkcy9icm9rZW4uLi5yZWYiICYmCglnaXQgYnJhbmNoIHNoYWRvdyBvbmUgJiYKCWNwIC5naXQvcmVmcy9oZWFkcy9tYXN0ZXIgLmdpdC9yZWZzL2hlYWRzL2Jyb2tlbi4uLnJlZiAmJgoJZ2l0IHN5bWJvbGljLXJlZiByZWZzL3RhZ3Mvc2hhZG93IHJlZnMvaGVhZHMvYnJva2VuLi4ucmVmICYmCgoJZ2l0IHJldi1wYXJzZSAtLXZlcmlmeSBvbmUgPmV4cGVjdCAmJgoJZ2l0IHJldi1wYXJzZSAtLXZlcmlmeSBzaGFkb3cgPmFjdHVhbCAyPmVyciAmJgoJdGVzdF9jbXAgZXhwZWN0IGFjdHVhbCAmJgoJdGVzdF9pMThuZ3JlcCAiaWdub3JpbmcgZGFuZ2xpbmcgc3ltcmVmIHJlZnMvdGFncy9zaGFkb3ciIGVycgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICd1cGRhdGUtcmVmIC0tbm8tZGVyZWYgLWQgY2FuIGRlbGV0ZSByZWZlcmVuY2UgdG8gYnJva2VuIG5hbWUnICcKCWdpdCBzeW1ib2xpYy1yZWYgcmVmcy9oZWFkcy9iYWRuYW1lIHJlZnMvaGVhZHMvYnJva2VuLi4ucmVmICYmCgl0ZXN0X3doZW5fZmluaXNoZWQgInJtIC1mIC5naXQvcmVmcy9oZWFkcy9iYWRuYW1lIiAmJgoJdGVzdF9wYXRoX2lzX2ZpbGUgLmdpdC9yZWZzL2hlYWRzL2JhZG5hbWUgJiYKCWdpdCB1cGRhdGUtcmVmIC0tbm8tZGVyZWYgLWQgcmVmcy9oZWFkcy9iYWRuYW1lID5vdXRwdXQgMj5lcnJvciAmJgoJdGVzdF9wYXRoX2lzX21pc3NpbmcgLmdpdC9yZWZzL2hlYWRzL2JhZG5hbWUgJiYKCXRlc3RfbXVzdF9iZV9lbXB0eSBvdXRwdXQgJiYKCXRlc3RfbXVzdF9iZV9lbXB0eSBlcnJvcgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICd1cGRhdGUtcmVmIC1kIGNhbiBkZWxldGUgYnJva2VuIG5hbWUnICcKCWNwIC5naXQvcmVmcy9oZWFkcy9tYXN0ZXIgLmdpdC9yZWZzL2hlYWRzL2Jyb2tlbi4uLnJlZiAmJgoJdGVzdF93aGVuX2ZpbmlzaGVkICJybSAtZiAuZ2l0L3JlZnMvaGVhZHMvYnJva2VuLi4ucmVmIiAmJgoJZ2l0IHVwZGF0ZS1yZWYgLWQgcmVmcy9oZWFkcy9icm9rZW4uLi5yZWYgPm91dHB1dCAyPmVycm9yICYmCgl0ZXN0X211c3RfYmVfZW1wdHkgb3V0cHV0ICYmCgl0ZXN0X211c3RfYmVfZW1wdHkgZXJyb3IgJiYKCWdpdCBicmFuY2ggPm91dHB1dCAyPmVycm9yICYmCgkhIGdyZXAgLWUgImJyb2tlblwuXC5cLnJlZiIgZXJyb3IgJiYKCSEgZ3JlcCAtZSAiYnJva2VuXC5cLlwucmVmIiBvdXRwdXQKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAndXBkYXRlLXJlZiAtZCBjYW5ub3QgZGVsZXRlIG5vbi1yZWYgaW4gLmdpdCBkaXInICcKCWVjaG8gcHJlY2lvdXMgPi5naXQvbXktcHJpdmF0ZS1maWxlICYmCgllY2hvIHByZWNpb3VzID5leHBlY3QgJiYKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC1kIG15LXByaXZhdGUtZmlsZSA+b3V0cHV0IDI+ZXJyb3IgJiYKCXRlc3RfbXVzdF9iZV9lbXB0eSBvdXRwdXQgJiYKCXRlc3RfaTE4bmdyZXAgLWUgImNhbm5vdCBsb2NrIC4qOiB1bmFibGUgdG8gcmVzb2x2ZSByZWZlcmVuY2UiIGVycm9yICYmCgl0ZXN0X2NtcCBleHBlY3QgLmdpdC9teS1wcml2YXRlLWZpbGUKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAndXBkYXRlLXJlZiAtZCBjYW5ub3QgZGVsZXRlIGFic29sdXRlIHBhdGgnICcKCWdpdCBicmFuY2ggLWYgZXh0cmEgJiYKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC1kICIkKHB3ZCkvLmdpdC9yZWZzL2hlYWRzL2V4dHJhIiAmJgoJdGVzdF9jbXBfcmV2IEhFQUQgZXh0cmEKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAndXBkYXRlLXJlZiAtLXN0ZGluIGZhaWxzIGNyZWF0ZSB3aXRoIGJhZCByZWYgbmFtZScgJwoJZWNobyAiY3JlYXRlIH5hIHJlZnMvaGVhZHMvbWFzdGVyIiA+c3RkaW4gJiYKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC0tc3RkaW4gPHN0ZGluIDI+ZXJyICYmCglncmVwICJmYXRhbDogaW52YWxpZCByZWYgZm9ybWF0OiB+YSIgZXJyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3VwZGF0ZS1yZWYgLS1zdGRpbiBmYWlscyB1cGRhdGUgd2l0aCBiYWQgcmVmIG5hbWUnICcKCWVjaG8gInVwZGF0ZSB+YSByZWZzL2hlYWRzL21hc3RlciIgPnN0ZGluICYmCgl0ZXN0X211c3RfZmFpbCBnaXQgdXBkYXRlLXJlZiAtLXN0ZGluIDxzdGRpbiAyPmVyciAmJgoJZ3JlcCAiZmF0YWw6IGludmFsaWQgcmVmIGZvcm1hdDogfmEiIGVycgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICd1cGRhdGUtcmVmIC0tc3RkaW4gZmFpbHMgZGVsZXRlIHdpdGggYmFkIHJlZiBuYW1lJyAnCgllY2hvICJkZWxldGUgfmEgcmVmcy9oZWFkcy9tYXN0ZXIiID5zdGRpbiAmJgoJdGVzdF9tdXN0X2ZhaWwgZ2l0IHVwZGF0ZS1yZWYgLS1zdGRpbiA8c3RkaW4gMj5lcnIgJiYKCWdyZXAgImZhdGFsOiBpbnZhbGlkIHJlZiBmb3JtYXQ6IH5hIiBlcnIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAndXBkYXRlLXJlZiAtLXN0ZGluIC16IGZhaWxzIGNyZWF0ZSB3aXRoIGJhZCByZWYgbmFtZScgJwoJcHJpbnRmICIlc1wwIiAiY3JlYXRlIH5hICIgcmVmcy9oZWFkcy9tYXN0ZXIgPnN0ZGluICYmCgl0ZXN0X211c3RfZmFpbCBnaXQgdXBkYXRlLXJlZiAteiAtLXN0ZGluIDxzdGRpbiAyPmVyciAmJgoJZ3JlcCAiZmF0YWw6IGludmFsaWQgcmVmIGZvcm1hdDogfmEgIiBlcnIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAndXBkYXRlLXJlZiAtLXN0ZGluIC16IGZhaWxzIHVwZGF0ZSB3aXRoIGJhZCByZWYgbmFtZScgJwoJcHJpbnRmICIlc1wwIiAidXBkYXRlIH5hIiByZWZzL2hlYWRzL21hc3RlciAiIiA+c3RkaW4gJiYKCXRlc3RfbXVzdF9mYWlsIGdpdCB1cGRhdGUtcmVmIC16IC0tc3RkaW4gPHN0ZGluIDI+ZXJyICYmCglncmVwICJmYXRhbDogaW52YWxpZCByZWYgZm9ybWF0OiB+YSIgZXJyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3VwZGF0ZS1yZWYgLS1zdGRpbiAteiBmYWlscyBkZWxldGUgd2l0aCBiYWQgcmVmIG5hbWUnICcKCXByaW50ZiAiJXNcMCIgImRlbGV0ZSB+YSIgcmVmcy9oZWFkcy9tYXN0ZXIgPnN0ZGluICYmCgl0ZXN0X211c3RfZmFpbCBnaXQgdXBkYXRlLXJlZiAteiAtLXN0ZGluIDxzdGRpbiAyPmVyciAmJgoJZ3JlcCAiZmF0YWw6IGludmFsaWQgcmVmIGZvcm1hdDogfmEiIGVycgonCgp0ZXN0X2RvbmUK",
    "text": "#!/bin/sh\n\ntest_description='Test handling of ref names that check-ref-format rejects'\n. ./test-lib.sh\n\ntest_expect_success setup '\n\ttest_commit one &&\n\ttest_commit two\n'\n\ntest_expect_success 'fast-import: fail on invalid branch name \".badbranchname\"' '\n\ttest_when_finished \"rm -f .git/objects/pack_* .git/objects/index_*\" &&\n\tcat >input <<-INPUT_END &&\n\t\tcommit .badbranchname\n\t\tcommitter $GIT_COMMITTER_NAME <$GIT_COMMITTER_EMAIL> $GIT_COMMITTER_DATE\n\t\tdata <<COMMIT\n\t\tcorrupt\n\t\tCOMMIT\n\n\t\tfrom refs/heads/master\n\n\tINPUT_END\n\ttest_must_fail git fast-import <input\n'\n\ntest_expect_success 'fast-import: fail on invalid branch name \"bad[branch]name\"' '\n\ttest_when_finished \"rm -f .git/objects/pack_* .git/objects/index_*\" &&\n\tcat >input <<-INPUT_END &&\n\t\tcommit bad[branch]name\n\t\tcommitter $GIT_COMMITTER_NAME <$GIT_COMMITTER_EMAIL> $GIT_COMMITTER_DATE\n\t\tdata <<COMMIT\n\t\tcorrupt\n\t\tCOMMIT\n\n\t\tfrom refs/heads/master\n\n\tINPUT_END\n\ttest_must_fail git fast-import <input\n'\n\ntest_expect_success 'git branch shows badly named ref as warning' '\n\tcp .git/refs/heads/master .git/refs/heads/broken...ref &&\n\ttest_when_finished \"rm -f .git/refs/heads/broken...ref\" &&\n\tgit branch >output 2>error &&\n\ttest_i18ngrep -e \"ignoring ref with broken name refs/heads/broken\\.\\.\\.ref\" error &&\n\t! grep -e \"broken\\.\\.\\.ref\" output\n'\n\ntest_expect_success 'branch -d can delete badly named ref' '\n\tcp .git/refs/heads/master .git/refs/heads/broken...ref &&\n\ttest_when_finished \"rm -f .git/refs/heads/broken...ref\" &&\n\tgit branch -d broken...ref &&\n\tgit branch >output 2>error &&\n\t! grep -e \"broken\\.\\.\\.ref\" error &&\n\t! grep -e \"broken\\.\\.\\.ref\" output\n'\n\ntest_expect_success 'branch -D can delete badly named ref' '\n\tcp .git/refs/heads/master .git/refs/heads/broken...ref &&\n\ttest_when_finished \"rm -f .git/refs/heads/broken...ref\" &&\n\tgit branch -D broken...ref &&\n\tgit branch >output 2>error &&\n\t! grep -e \"broken\\.\\.\\.ref\" error &&\n\t! grep -e \"broken\\.\\.\\.ref\" output\n'\n\ntest_expect_success 'branch -D cannot delete non-ref in .git dir' '\n\techo precious >.git/my-private-file &&\n\techo precious >expect &&\n\ttest_must_fail git branch -D ../../my-private-file &&\n\ttest_cmp expect .git/my-private-file\n'\n\ntest_expect_success 'branch -D cannot delete ref in .git dir' '\n\tgit rev-parse HEAD >.git/my-private-file &&\n\tgit rev-parse HEAD >expect &&\n\tgit branch foo/legit &&\n\ttest_must_fail git branch -D foo////./././../../../my-private-file &&\n\ttest_cmp expect .git/my-private-file\n'\n\ntest_expect_success 'branch -D cannot delete absolute path' '\n\tgit branch -f extra &&\n\ttest_must_fail git branch -D \"$(pwd)/.git/refs/heads/extra\" &&\n\ttest_cmp_rev HEAD extra\n'\n\ntest_expect_success 'git branch cannot create a badly named ref' '\n\ttest_when_finished \"rm -f .git/refs/heads/broken...ref\" &&\n\ttest_must_fail git branch broken...ref &&\n\tgit branch >output 2>error &&\n\t! grep -e \"broken\\.\\.\\.ref\" error &&\n\t! grep -e \"broken\\.\\.\\.ref\" output\n'\n\ntest_expect_success 'branch -m cannot rename to a bad ref name' '\n\ttest_when_finished \"rm -f .git/refs/heads/broken...ref\" &&\n\ttest_might_fail git branch -D goodref &&\n\tgit branch goodref &&\n\ttest_must_fail git branch -m goodref broken...ref &&\n\ttest_cmp_rev master goodref &&\n\tgit branch >output 2>error &&\n\t! grep -e \"broken\\.\\.\\.ref\" error &&\n\t! grep -e \"broken\\.\\.\\.ref\" output\n'\n\ntest_expect_failure 'branch -m can rename from a bad ref name' '\n\tcp .git/refs/heads/master .git/refs/heads/broken...ref &&\n\ttest_when_finished \"rm -f .git/refs/heads/broken...ref\" &&\n\tgit branch -m broken...ref renamed &&\n\ttest_cmp_rev master renamed &&\n\tgit branch >output 2>error &&\n\t! grep -e \"broken\\.\\.\\.ref\" error &&\n\t! grep -e \"broken\\.\\.\\.ref\" output\n'\n\ntest_expect_success 'push cannot create a badly named ref' '\n\ttest_when_finished \"rm -f .git/refs/heads/broken...ref\" &&\n\ttest_must_fail git push \"file://$(pwd)\" HEAD:refs/heads/broken...ref &&\n\tgit branch >output 2>error &&\n\t! grep -e \"broken\\.\\.\\.ref\" error &&\n\t! grep -e \"broken\\.\\.\\.ref\" output\n'\n\ntest_expect_failure 'push --mirror can delete badly named ref' '\n\ttop=$(pwd) &&\n\tgit init src &&\n\tgit init dest &&\n\n\t(\n\t\tcd src &&\n\t\ttest_commit one\n\t) &&\n\t(\n\t\tcd dest &&\n\t\ttest_commit two &&\n\t\tgit checkout --detach &&\n\t\tcp .git/refs/heads/master .git/refs/heads/broken...ref\n\t) &&\n\tgit -C src push --mirror \"file://$top/dest\" &&\n\tgit -C dest branch >output 2>error &&\n\t! grep -e \"broken\\.\\.\\.ref\" error &&\n\t! grep -e \"broken\\.\\.\\.ref\" output\n'\n\ntest_expect_success 'rev-parse skips symref pointing to broken name' '\n\ttest_when_finished \"rm -f .git/refs/heads/broken...ref\" &&\n\tgit branch shadow one &&\n\tcp .git/refs/heads/master .git/refs/heads/broken...ref &&\n\tgit symbolic-ref refs/tags/shadow refs/heads/broken...ref &&\n\n\tgit rev-parse --verify one >expect &&\n\tgit rev-parse --verify shadow >actual 2>err &&\n\ttest_cmp expect actual &&\n\ttest_i18ngrep \"ignoring dangling symref refs/tags/shadow\" err\n'\n\ntest_expect_success 'update-ref --no-deref -d can delete reference to broken name' '\n\tgit symbolic-ref refs/heads/badname refs/heads/broken...ref &&\n\ttest_when_finished \"rm -f .git/refs/heads/badname\" &&\n\ttest_path_is_file .git/refs/heads/badname &&\n\tgit update-ref --no-deref -d refs/heads/badname >output 2>error &&\n\ttest_path_is_missing .git/refs/heads/badname &&\n\ttest_must_be_empty output &&\n\ttest_must_be_empty error\n'\n\ntest_expect_success 'update-ref -d can delete broken name' '\n\tcp .git/refs/heads/master .git/refs/heads/broken...ref &&\n\ttest_when_finished \"rm -f .git/refs/heads/broken...ref\" &&\n\tgit update-ref -d refs/heads/broken...ref >output 2>error &&\n\ttest_must_be_empty output &&\n\ttest_must_be_empty error &&\n\tgit branch >output 2>error &&\n\t! grep -e \"broken\\.\\.\\.ref\" error &&\n\t! grep -e \"broken\\.\\.\\.ref\" output\n'\n\ntest_expect_success 'update-ref -d cannot delete non-ref in .git dir' '\n\techo precious >.git/my-private-file &&\n\techo precious >expect &&\n\ttest_must_fail git update-ref -d my-private-file >output 2>error &&\n\ttest_must_be_empty output &&\n\ttest_i18ngrep -e \"cannot lock .*: unable to resolve reference\" error &&\n\ttest_cmp expect .git/my-private-file\n'\n\ntest_expect_success 'update-ref -d cannot delete absolute path' '\n\tgit branch -f extra &&\n\ttest_must_fail git update-ref -d \"$(pwd)/.git/refs/heads/extra\" &&\n\ttest_cmp_rev HEAD extra\n'\n\ntest_expect_success 'update-ref --stdin fails create with bad ref name' '\n\techo \"create ~a refs/heads/master\" >stdin &&\n\ttest_must_fail git update-ref --stdin <stdin 2>err &&\n\tgrep \"fatal: invalid ref format: ~a\" err\n'\n\ntest_expect_success 'update-ref --stdin fails update with bad ref name' '\n\techo \"update ~a refs/heads/master\" >stdin &&\n\ttest_must_fail git update-ref --stdin <stdin 2>err &&\n\tgrep \"fatal: invalid ref format: ~a\" err\n'\n\ntest_expect_success 'update-ref --stdin fails delete with bad ref name' '\n\techo \"delete ~a refs/heads/master\" >stdin &&\n\ttest_must_fail git update-ref --stdin <stdin 2>err &&\n\tgrep \"fatal: invalid ref format: ~a\" err\n'\n\ntest_expect_success 'update-ref --stdin -z fails create with bad ref name' '\n\tprintf \"%s\\0\" \"create ~a \" refs/heads/master >stdin &&\n\ttest_must_fail git update-ref -z --stdin <stdin 2>err &&\n\tgrep \"fatal: invalid ref format: ~a \" err\n'\n\ntest_expect_success 'update-ref --stdin -z fails update with bad ref name' '\n\tprintf \"%s\\0\" \"update ~a\" refs/heads/master \"\" >stdin &&\n\ttest_must_fail git update-ref -z --stdin <stdin 2>err &&\n\tgrep \"fatal: invalid ref format: ~a\" err\n'\n\ntest_expect_success 'update-ref --stdin -z fails delete with bad ref name' '\n\tprintf \"%s\\0\" \"delete ~a\" refs/heads/master >stdin &&\n\ttest_must_fail git update-ref -z --stdin <stdin 2>err &&\n\tgrep \"fatal: invalid ref format: ~a\" err\n'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "005e2b1756d1f04bfc6fcb68d9b336d089cdbf92",
  "sha1_ok": true,
  "size": 7617
}
