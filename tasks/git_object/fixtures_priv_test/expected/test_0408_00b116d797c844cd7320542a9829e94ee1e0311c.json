{
  "content": {
    "base64": "I2luY2x1ZGUgImNhY2hlLmgiCiNpbmNsdWRlICJjb25maWcuaCIKI2luY2x1ZGUgInJ1bi1jb21tYW5kLmgiCiNpbmNsdWRlICJxdW90ZS5oIgojaW5jbHVkZSAidmVyc2lvbi5oIgojaW5jbHVkZSAidHJhY2UyL3RyMl9kc3QuaCIKI2luY2x1ZGUgInRyYWNlMi90cjJfc3lzZW52LmgiCiNpbmNsdWRlICJ0cmFjZTIvdHIyX3RidWYuaCIKI2luY2x1ZGUgInRyYWNlMi90cjJfdGd0LmgiCiNpbmNsdWRlICJ0cmFjZTIvdHIyX3Rscy5oIgoKc3RhdGljIHN0cnVjdCB0cjJfZHN0IHRyMmRzdF9ub3JtYWwgPSB7IFRSMl9TWVNFTlZfTk9STUFMLCAwLCAwLCAwIH07CgovKgogKiBVc2UgdGhlIFRSMl9TWVNFTlZfTk9STUFMX0JSSUVGIHNldHRpbmcgdG8gb21pdCB0aGUgIjx0aW1lPiA8ZmlsZT46PGxpbmU+IgogKiBmaWVsZHMgZnJvbSBlYWNoIGxpbmUgd3JpdHRlbiB0byB0aGUgYnVpbHRpbiBub3JtYWwgdGFyZ2V0LgogKgogKiBVbml0IHRlc3RzIG1heSB3YW50IHRvIHVzZSB0aGlzIHRvIGhlbHAgd2l0aCB0ZXN0aW5nLgogKi8Kc3RhdGljIGludCB0cjJlbnZfbm9ybWFsX2JlX2JyaWVmOwoKI2RlZmluZSBUUjJGTVRfTk9STUFMX0ZMX1dJRFRIICg1MCkKCnN0YXRpYyBpbnQgZm5faW5pdCh2b2lkKQp7CglpbnQgd2FudCA9IHRyMl9kc3RfdHJhY2Vfd2FudCgmdHIyZHN0X25vcm1hbCk7CglpbnQgd2FudF9icmllZjsKCWNvbnN0IGNoYXIgKmJyaWVmOwoKCWlmICghd2FudCkKCQlyZXR1cm4gd2FudDsKCglicmllZiA9IHRyMl9zeXNlbnZfZ2V0KFRSMl9TWVNFTlZfTk9STUFMX0JSSUVGKTsKCWlmIChicmllZiAmJiAqYnJpZWYgJiYKCSAgICAoKHdhbnRfYnJpZWYgPSBnaXRfcGFyc2VfbWF5YmVfYm9vbChicmllZikpICE9IC0xKSkKCQl0cjJlbnZfbm9ybWFsX2JlX2JyaWVmID0gd2FudF9icmllZjsKCglyZXR1cm4gd2FudDsKfQoKc3RhdGljIHZvaWQgZm5fdGVybSh2b2lkKQp7Cgl0cjJfZHN0X3RyYWNlX2Rpc2FibGUoJnRyMmRzdF9ub3JtYWwpOwp9CgpzdGF0aWMgdm9pZCBub3JtYWxfZm10X3ByZXBhcmUoY29uc3QgY2hhciAqZmlsZSwgaW50IGxpbmUsIHN0cnVjdCBzdHJidWYgKmJ1ZikKewoJc3RyYnVmX3NldGxlbihidWYsIDApOwoKCWlmICghdHIyZW52X25vcm1hbF9iZV9icmllZikgewoJCXN0cnVjdCB0cjJfdGJ1ZiB0Yl9ub3c7CgoJCXRyMl90YnVmX2xvY2FsX3RpbWUoJnRiX25vdyk7CgkJc3RyYnVmX2FkZHN0cihidWYsIHRiX25vdy5idWYpOwoJCXN0cmJ1Zl9hZGRjaChidWYsICcgJyk7CgoJCWlmIChmaWxlICYmICpmaWxlKQoJCQlzdHJidWZfYWRkZihidWYsICIlczolZCAiLCBmaWxlLCBsaW5lKTsKCQl3aGlsZSAoYnVmLT5sZW4gPCBUUjJGTVRfTk9STUFMX0ZMX1dJRFRIKQoJCQlzdHJidWZfYWRkY2goYnVmLCAnICcpOwoJfQp9CgpzdGF0aWMgdm9pZCBub3JtYWxfaW9fd3JpdGVfZmwoY29uc3QgY2hhciAqZmlsZSwgaW50IGxpbmUsCgkJCSAgICAgICBjb25zdCBzdHJ1Y3Qgc3RyYnVmICpidWZfcGF5bG9hZCkKewoJc3RydWN0IHN0cmJ1ZiBidWZfbGluZSA9IFNUUkJVRl9JTklUOwoKCW5vcm1hbF9mbXRfcHJlcGFyZShmaWxlLCBsaW5lLCAmYnVmX2xpbmUpOwoJc3RyYnVmX2FkZGJ1ZigmYnVmX2xpbmUsIGJ1Zl9wYXlsb2FkKTsKCXRyMl9kc3Rfd3JpdGVfbGluZSgmdHIyZHN0X25vcm1hbCwgJmJ1Zl9saW5lKTsKCXN0cmJ1Zl9yZWxlYXNlKCZidWZfbGluZSk7Cn0KCnN0YXRpYyB2b2lkIGZuX3ZlcnNpb25fZmwoY29uc3QgY2hhciAqZmlsZSwgaW50IGxpbmUpCnsKCXN0cnVjdCBzdHJidWYgYnVmX3BheWxvYWQgPSBTVFJCVUZfSU5JVDsKCglzdHJidWZfYWRkZigmYnVmX3BheWxvYWQsICJ2ZXJzaW9uICVzIiwgZ2l0X3ZlcnNpb25fc3RyaW5nKTsKCW5vcm1hbF9pb193cml0ZV9mbChmaWxlLCBsaW5lLCAmYnVmX3BheWxvYWQpOwoJc3RyYnVmX3JlbGVhc2UoJmJ1Zl9wYXlsb2FkKTsKfQoKc3RhdGljIHZvaWQgZm5fc3RhcnRfZmwoY29uc3QgY2hhciAqZmlsZSwgaW50IGxpbmUsCgkJCXVpbnQ2NF90IHVzX2VsYXBzZWRfYWJzb2x1dGUsIGNvbnN0IGNoYXIgKiphcmd2KQp7CglzdHJ1Y3Qgc3RyYnVmIGJ1Zl9wYXlsb2FkID0gU1RSQlVGX0lOSVQ7CgoJc3RyYnVmX2FkZHN0cigmYnVmX3BheWxvYWQsICJzdGFydCAiKTsKCXNxX3F1b3RlX2FyZ3ZfcHJldHR5KCZidWZfcGF5bG9hZCwgYXJndik7Cglub3JtYWxfaW9fd3JpdGVfZmwoZmlsZSwgbGluZSwgJmJ1Zl9wYXlsb2FkKTsKCXN0cmJ1Zl9yZWxlYXNlKCZidWZfcGF5bG9hZCk7Cn0KCnN0YXRpYyB2b2lkIGZuX2V4aXRfZmwoY29uc3QgY2hhciAqZmlsZSwgaW50IGxpbmUsIHVpbnQ2NF90IHVzX2VsYXBzZWRfYWJzb2x1dGUsCgkJICAgICAgIGludCBjb2RlKQp7CglzdHJ1Y3Qgc3RyYnVmIGJ1Zl9wYXlsb2FkID0gU1RSQlVGX0lOSVQ7Cglkb3VibGUgZWxhcHNlZCA9IChkb3VibGUpdXNfZWxhcHNlZF9hYnNvbHV0ZSAvIDEwMDAwMDAuMDsKCglzdHJidWZfYWRkZigmYnVmX3BheWxvYWQsICJleGl0IGVsYXBzZWQ6JS42ZiBjb2RlOiVkIiwgZWxhcHNlZCwgY29kZSk7Cglub3JtYWxfaW9fd3JpdGVfZmwoZmlsZSwgbGluZSwgJmJ1Zl9wYXlsb2FkKTsKCXN0cmJ1Zl9yZWxlYXNlKCZidWZfcGF5bG9hZCk7Cn0KCnN0YXRpYyB2b2lkIGZuX3NpZ25hbCh1aW50NjRfdCB1c19lbGFwc2VkX2Fic29sdXRlLCBpbnQgc2lnbm8pCnsKCXN0cnVjdCBzdHJidWYgYnVmX3BheWxvYWQgPSBTVFJCVUZfSU5JVDsKCWRvdWJsZSBlbGFwc2VkID0gKGRvdWJsZSl1c19lbGFwc2VkX2Fic29sdXRlIC8gMTAwMDAwMC4wOwoKCXN0cmJ1Zl9hZGRmKCZidWZfcGF5bG9hZCwgInNpZ25hbCBlbGFwc2VkOiUuNmYgY29kZTolZCIsIGVsYXBzZWQsCgkJICAgIHNpZ25vKTsKCW5vcm1hbF9pb193cml0ZV9mbChfX0ZJTEVfXywgX19MSU5FX18sICZidWZfcGF5bG9hZCk7CglzdHJidWZfcmVsZWFzZSgmYnVmX3BheWxvYWQpOwp9CgpzdGF0aWMgdm9pZCBmbl9hdGV4aXQodWludDY0X3QgdXNfZWxhcHNlZF9hYnNvbHV0ZSwgaW50IGNvZGUpCnsKCXN0cnVjdCBzdHJidWYgYnVmX3BheWxvYWQgPSBTVFJCVUZfSU5JVDsKCWRvdWJsZSBlbGFwc2VkID0gKGRvdWJsZSl1c19lbGFwc2VkX2Fic29sdXRlIC8gMTAwMDAwMC4wOwoKCXN0cmJ1Zl9hZGRmKCZidWZfcGF5bG9hZCwgImF0ZXhpdCBlbGFwc2VkOiUuNmYgY29kZTolZCIsIGVsYXBzZWQsIGNvZGUpOwoJbm9ybWFsX2lvX3dyaXRlX2ZsKF9fRklMRV9fLCBfX0xJTkVfXywgJmJ1Zl9wYXlsb2FkKTsKCXN0cmJ1Zl9yZWxlYXNlKCZidWZfcGF5bG9hZCk7Cn0KCnN0YXRpYyB2b2lkIG1heWJlX2FwcGVuZF9zdHJpbmdfdmEoc3RydWN0IHN0cmJ1ZiAqYnVmLCBjb25zdCBjaGFyICpmbXQsCgkJCQkgICB2YV9saXN0IGFwKQp7CglpZiAoZm10ICYmICpmbXQpIHsKCQl2YV9saXN0IGNvcHlfYXA7CgoJCXZhX2NvcHkoY29weV9hcCwgYXApOwoJCXN0cmJ1Zl92YWRkZihidWYsIGZtdCwgY29weV9hcCk7CgkJdmFfZW5kKGNvcHlfYXApOwoJCXJldHVybjsKCX0KCglpZiAoZm10ICYmICpmbXQpIHsKCQlzdHJidWZfYWRkc3RyKGJ1ZiwgZm10KTsKCQlyZXR1cm47Cgl9Cn0KCnN0YXRpYyB2b2lkIGZuX2Vycm9yX3ZhX2ZsKGNvbnN0IGNoYXIgKmZpbGUsIGludCBsaW5lLCBjb25zdCBjaGFyICpmbXQsCgkJCSAgIHZhX2xpc3QgYXApCnsKCXN0cnVjdCBzdHJidWYgYnVmX3BheWxvYWQgPSBTVFJCVUZfSU5JVDsKCglzdHJidWZfYWRkc3RyKCZidWZfcGF5bG9hZCwgImVycm9yICIpOwoJbWF5YmVfYXBwZW5kX3N0cmluZ192YSgmYnVmX3BheWxvYWQsIGZtdCwgYXApOwoJbm9ybWFsX2lvX3dyaXRlX2ZsKGZpbGUsIGxpbmUsICZidWZfcGF5bG9hZCk7CglzdHJidWZfcmVsZWFzZSgmYnVmX3BheWxvYWQpOwp9CgpzdGF0aWMgdm9pZCBmbl9jb21tYW5kX3BhdGhfZmwoY29uc3QgY2hhciAqZmlsZSwgaW50IGxpbmUsIGNvbnN0IGNoYXIgKnBhdGhuYW1lKQp7CglzdHJ1Y3Qgc3RyYnVmIGJ1Zl9wYXlsb2FkID0gU1RSQlVGX0lOSVQ7CgoJc3RyYnVmX2FkZGYoJmJ1Zl9wYXlsb2FkLCAiY21kX3BhdGggJXMiLCBwYXRobmFtZSk7Cglub3JtYWxfaW9fd3JpdGVfZmwoZmlsZSwgbGluZSwgJmJ1Zl9wYXlsb2FkKTsKCXN0cmJ1Zl9yZWxlYXNlKCZidWZfcGF5bG9hZCk7Cn0KCnN0YXRpYyB2b2lkIGZuX2NvbW1hbmRfbmFtZV9mbChjb25zdCBjaGFyICpmaWxlLCBpbnQgbGluZSwgY29uc3QgY2hhciAqbmFtZSwKCQkJICAgICAgIGNvbnN0IGNoYXIgKmhpZXJhcmNoeSkKewoJc3RydWN0IHN0cmJ1ZiBidWZfcGF5bG9hZCA9IFNUUkJVRl9JTklUOwoKCXN0cmJ1Zl9hZGRmKCZidWZfcGF5bG9hZCwgImNtZF9uYW1lICVzIiwgbmFtZSk7CglpZiAoaGllcmFyY2h5ICYmICpoaWVyYXJjaHkpCgkJc3RyYnVmX2FkZGYoJmJ1Zl9wYXlsb2FkLCAiICglcykiLCBoaWVyYXJjaHkpOwoJbm9ybWFsX2lvX3dyaXRlX2ZsKGZpbGUsIGxpbmUsICZidWZfcGF5bG9hZCk7CglzdHJidWZfcmVsZWFzZSgmYnVmX3BheWxvYWQpOwp9CgpzdGF0aWMgdm9pZCBmbl9jb21tYW5kX21vZGVfZmwoY29uc3QgY2hhciAqZmlsZSwgaW50IGxpbmUsIGNvbnN0IGNoYXIgKm1vZGUpCnsKCXN0cnVjdCBzdHJidWYgYnVmX3BheWxvYWQgPSBTVFJCVUZfSU5JVDsKCglzdHJidWZfYWRkZigmYnVmX3BheWxvYWQsICJjbWRfbW9kZSAlcyIsIG1vZGUpOwoJbm9ybWFsX2lvX3dyaXRlX2ZsKGZpbGUsIGxpbmUsICZidWZfcGF5bG9hZCk7CglzdHJidWZfcmVsZWFzZSgmYnVmX3BheWxvYWQpOwp9CgpzdGF0aWMgdm9pZCBmbl9hbGlhc19mbChjb25zdCBjaGFyICpmaWxlLCBpbnQgbGluZSwgY29uc3QgY2hhciAqYWxpYXMsCgkJCWNvbnN0IGNoYXIgKiphcmd2KQp7CglzdHJ1Y3Qgc3RyYnVmIGJ1Zl9wYXlsb2FkID0gU1RSQlVGX0lOSVQ7CgoJc3RyYnVmX2FkZGYoJmJ1Zl9wYXlsb2FkLCAiYWxpYXMgJXMgLT4iLCBhbGlhcyk7CglzcV9xdW90ZV9hcmd2X3ByZXR0eSgmYnVmX3BheWxvYWQsIGFyZ3YpOwoJbm9ybWFsX2lvX3dyaXRlX2ZsKGZpbGUsIGxpbmUsICZidWZfcGF5bG9hZCk7CglzdHJidWZfcmVsZWFzZSgmYnVmX3BheWxvYWQpOwp9CgpzdGF0aWMgdm9pZCBmbl9jaGlsZF9zdGFydF9mbChjb25zdCBjaGFyICpmaWxlLCBpbnQgbGluZSwKCQkJICAgICAgdWludDY0X3QgdXNfZWxhcHNlZF9hYnNvbHV0ZSwKCQkJICAgICAgY29uc3Qgc3RydWN0IGNoaWxkX3Byb2Nlc3MgKmNtZCkKewoJc3RydWN0IHN0cmJ1ZiBidWZfcGF5bG9hZCA9IFNUUkJVRl9JTklUOwoKCXN0cmJ1Zl9hZGRmKCZidWZfcGF5bG9hZCwgImNoaWxkX3N0YXJ0WyVkXSAiLCBjbWQtPnRyYWNlMl9jaGlsZF9pZCk7CgoJaWYgKGNtZC0+ZGlyKSB7CgkJc3RyYnVmX2FkZHN0cigmYnVmX3BheWxvYWQsICIgY2QiKTsKCQlzcV9xdW90ZV9idWZfcHJldHR5KCZidWZfcGF5bG9hZCwgY21kLT5kaXIpOwoJCXN0cmJ1Zl9hZGRzdHIoJmJ1Zl9wYXlsb2FkLCAiOyAiKTsKCX0KCgkvKgoJICogVE9ETyBpZiAoY21kLT5lbnYpIHsgQ29uc2lkZXIgZHVtcGluZyBjaGFuZ2VzIHRvIGVudmlyb25tZW50LiB9CgkgKiBTZWUgdHJhY2VfYWRkX2VudigpIGluIHJ1bi1jb21tYW5kLmMgYXMgdXNlZCBieSBvcmlnaW5hbCB0cmFjZS5jCgkgKi8KCglpZiAoY21kLT5naXRfY21kKQoJCXN0cmJ1Zl9hZGRzdHIoJmJ1Zl9wYXlsb2FkLCAiZ2l0Iik7CglzcV9xdW90ZV9hcmd2X3ByZXR0eSgmYnVmX3BheWxvYWQsIGNtZC0+YXJndik7CgoJbm9ybWFsX2lvX3dyaXRlX2ZsKGZpbGUsIGxpbmUsICZidWZfcGF5bG9hZCk7CglzdHJidWZfcmVsZWFzZSgmYnVmX3BheWxvYWQpOwp9CgpzdGF0aWMgdm9pZCBmbl9jaGlsZF9leGl0X2ZsKGNvbnN0IGNoYXIgKmZpbGUsIGludCBsaW5lLAoJCQkgICAgIHVpbnQ2NF90IHVzX2VsYXBzZWRfYWJzb2x1dGUsIGludCBjaWQsIGludCBwaWQsCgkJCSAgICAgaW50IGNvZGUsIHVpbnQ2NF90IHVzX2VsYXBzZWRfY2hpbGQpCnsKCXN0cnVjdCBzdHJidWYgYnVmX3BheWxvYWQgPSBTVFJCVUZfSU5JVDsKCWRvdWJsZSBlbGFwc2VkID0gKGRvdWJsZSl1c19lbGFwc2VkX2NoaWxkIC8gMTAwMDAwMC4wOwoKCXN0cmJ1Zl9hZGRmKCZidWZfcGF5bG9hZCwgImNoaWxkX2V4aXRbJWRdIHBpZDolZCBjb2RlOiVkIGVsYXBzZWQ6JS42ZiIsCgkJICAgIGNpZCwgcGlkLCBjb2RlLCBlbGFwc2VkKTsKCW5vcm1hbF9pb193cml0ZV9mbChmaWxlLCBsaW5lLCAmYnVmX3BheWxvYWQpOwoJc3RyYnVmX3JlbGVhc2UoJmJ1Zl9wYXlsb2FkKTsKfQoKc3RhdGljIHZvaWQgZm5fZXhlY19mbChjb25zdCBjaGFyICpmaWxlLCBpbnQgbGluZSwgdWludDY0X3QgdXNfZWxhcHNlZF9hYnNvbHV0ZSwKCQkgICAgICAgaW50IGV4ZWNfaWQsIGNvbnN0IGNoYXIgKmV4ZSwgY29uc3QgY2hhciAqKmFyZ3YpCnsKCXN0cnVjdCBzdHJidWYgYnVmX3BheWxvYWQgPSBTVFJCVUZfSU5JVDsKCglzdHJidWZfYWRkZigmYnVmX3BheWxvYWQsICJleGVjWyVkXSAiLCBleGVjX2lkKTsKCWlmIChleGUpCgkJc3RyYnVmX2FkZHN0cigmYnVmX3BheWxvYWQsIGV4ZSk7CglzcV9xdW90ZV9hcmd2X3ByZXR0eSgmYnVmX3BheWxvYWQsIGFyZ3YpOwoJbm9ybWFsX2lvX3dyaXRlX2ZsKGZpbGUsIGxpbmUsICZidWZfcGF5bG9hZCk7CglzdHJidWZfcmVsZWFzZSgmYnVmX3BheWxvYWQpOwp9CgpzdGF0aWMgdm9pZCBmbl9leGVjX3Jlc3VsdF9mbChjb25zdCBjaGFyICpmaWxlLCBpbnQgbGluZSwKCQkJICAgICAgdWludDY0X3QgdXNfZWxhcHNlZF9hYnNvbHV0ZSwgaW50IGV4ZWNfaWQsCgkJCSAgICAgIGludCBjb2RlKQp7CglzdHJ1Y3Qgc3RyYnVmIGJ1Zl9wYXlsb2FkID0gU1RSQlVGX0lOSVQ7CgoJc3RyYnVmX2FkZGYoJmJ1Zl9wYXlsb2FkLCAiZXhlY19yZXN1bHRbJWRdIGNvZGU6JWQiLCBleGVjX2lkLCBjb2RlKTsKCWlmIChjb2RlID4gMCkKCQlzdHJidWZfYWRkZigmYnVmX3BheWxvYWQsICIgZXJyOiVzIiwgc3RyZXJyb3IoY29kZSkpOwoJbm9ybWFsX2lvX3dyaXRlX2ZsKGZpbGUsIGxpbmUsICZidWZfcGF5bG9hZCk7CglzdHJidWZfcmVsZWFzZSgmYnVmX3BheWxvYWQpOwp9CgpzdGF0aWMgdm9pZCBmbl9wYXJhbV9mbChjb25zdCBjaGFyICpmaWxlLCBpbnQgbGluZSwgY29uc3QgY2hhciAqcGFyYW0sCgkJCWNvbnN0IGNoYXIgKnZhbHVlKQp7CglzdHJ1Y3Qgc3RyYnVmIGJ1Zl9wYXlsb2FkID0gU1RSQlVGX0lOSVQ7CgoJc3RyYnVmX2FkZGYoJmJ1Zl9wYXlsb2FkLCAiZGVmX3BhcmFtICVzPSVzIiwgcGFyYW0sIHZhbHVlKTsKCW5vcm1hbF9pb193cml0ZV9mbChmaWxlLCBsaW5lLCAmYnVmX3BheWxvYWQpOwoJc3RyYnVmX3JlbGVhc2UoJmJ1Zl9wYXlsb2FkKTsKfQoKc3RhdGljIHZvaWQgZm5fcmVwb19mbChjb25zdCBjaGFyICpmaWxlLCBpbnQgbGluZSwKCQkgICAgICAgY29uc3Qgc3RydWN0IHJlcG9zaXRvcnkgKnJlcG8pCnsKCXN0cnVjdCBzdHJidWYgYnVmX3BheWxvYWQgPSBTVFJCVUZfSU5JVDsKCglzdHJidWZfYWRkc3RyKCZidWZfcGF5bG9hZCwgIndvcmt0cmVlICIpOwoJc3FfcXVvdGVfYnVmX3ByZXR0eSgmYnVmX3BheWxvYWQsIHJlcG8tPndvcmt0cmVlKTsKCW5vcm1hbF9pb193cml0ZV9mbChmaWxlLCBsaW5lLCAmYnVmX3BheWxvYWQpOwoJc3RyYnVmX3JlbGVhc2UoJmJ1Zl9wYXlsb2FkKTsKfQoKc3RhdGljIHZvaWQgZm5fcHJpbnRmX3ZhX2ZsKGNvbnN0IGNoYXIgKmZpbGUsIGludCBsaW5lLAoJCQkgICAgdWludDY0X3QgdXNfZWxhcHNlZF9hYnNvbHV0ZSwgY29uc3QgY2hhciAqZm10LAoJCQkgICAgdmFfbGlzdCBhcCkKewoJc3RydWN0IHN0cmJ1ZiBidWZfcGF5bG9hZCA9IFNUUkJVRl9JTklUOwoKCW1heWJlX2FwcGVuZF9zdHJpbmdfdmEoJmJ1Zl9wYXlsb2FkLCBmbXQsIGFwKTsKCW5vcm1hbF9pb193cml0ZV9mbChmaWxlLCBsaW5lLCAmYnVmX3BheWxvYWQpOwoJc3RyYnVmX3JlbGVhc2UoJmJ1Zl9wYXlsb2FkKTsKfQoKc3RydWN0IHRyMl90Z3QgdHIyX3RndF9ub3JtYWwgPSB7CgkmdHIyZHN0X25vcm1hbCwKCglmbl9pbml0LAoJZm5fdGVybSwKCglmbl92ZXJzaW9uX2ZsLAoJZm5fc3RhcnRfZmwsCglmbl9leGl0X2ZsLAoJZm5fc2lnbmFsLAoJZm5fYXRleGl0LAoJZm5fZXJyb3JfdmFfZmwsCglmbl9jb21tYW5kX3BhdGhfZmwsCglmbl9jb21tYW5kX25hbWVfZmwsCglmbl9jb21tYW5kX21vZGVfZmwsCglmbl9hbGlhc19mbCwKCWZuX2NoaWxkX3N0YXJ0X2ZsLAoJZm5fY2hpbGRfZXhpdF9mbCwKCU5VTEwsIC8qIHRocmVhZF9zdGFydCAqLwoJTlVMTCwgLyogdGhyZWFkX2V4aXQgKi8KCWZuX2V4ZWNfZmwsCglmbl9leGVjX3Jlc3VsdF9mbCwKCWZuX3BhcmFtX2ZsLAoJZm5fcmVwb19mbCwKCU5VTEwsIC8qIHJlZ2lvbl9lbnRlciAqLwoJTlVMTCwgLyogcmVnaW9uX2xlYXZlICovCglOVUxMLCAvKiBkYXRhICovCglOVUxMLCAvKiBkYXRhX2pzb24gKi8KCWZuX3ByaW50Zl92YV9mbCwKfTsK",
    "text": "#include \"cache.h\"\n#include \"config.h\"\n#include \"run-command.h\"\n#include \"quote.h\"\n#include \"version.h\"\n#include \"trace2/tr2_dst.h\"\n#include \"trace2/tr2_sysenv.h\"\n#include \"trace2/tr2_tbuf.h\"\n#include \"trace2/tr2_tgt.h\"\n#include \"trace2/tr2_tls.h\"\n\nstatic struct tr2_dst tr2dst_normal = { TR2_SYSENV_NORMAL, 0, 0, 0 };\n\n/*\n * Use the TR2_SYSENV_NORMAL_BRIEF setting to omit the \"<time> <file>:<line>\"\n * fields from each line written to the builtin normal target.\n *\n * Unit tests may want to use this to help with testing.\n */\nstatic int tr2env_normal_be_brief;\n\n#define TR2FMT_NORMAL_FL_WIDTH (50)\n\nstatic int fn_init(void)\n{\n\tint want = tr2_dst_trace_want(&tr2dst_normal);\n\tint want_brief;\n\tconst char *brief;\n\n\tif (!want)\n\t\treturn want;\n\n\tbrief = tr2_sysenv_get(TR2_SYSENV_NORMAL_BRIEF);\n\tif (brief && *brief &&\n\t    ((want_brief = git_parse_maybe_bool(brief)) != -1))\n\t\ttr2env_normal_be_brief = want_brief;\n\n\treturn want;\n}\n\nstatic void fn_term(void)\n{\n\ttr2_dst_trace_disable(&tr2dst_normal);\n}\n\nstatic void normal_fmt_prepare(const char *file, int line, struct strbuf *buf)\n{\n\tstrbuf_setlen(buf, 0);\n\n\tif (!tr2env_normal_be_brief) {\n\t\tstruct tr2_tbuf tb_now;\n\n\t\ttr2_tbuf_local_time(&tb_now);\n\t\tstrbuf_addstr(buf, tb_now.buf);\n\t\tstrbuf_addch(buf, ' ');\n\n\t\tif (file && *file)\n\t\t\tstrbuf_addf(buf, \"%s:%d \", file, line);\n\t\twhile (buf->len < TR2FMT_NORMAL_FL_WIDTH)\n\t\t\tstrbuf_addch(buf, ' ');\n\t}\n}\n\nstatic void normal_io_write_fl(const char *file, int line,\n\t\t\t       const struct strbuf *buf_payload)\n{\n\tstruct strbuf buf_line = STRBUF_INIT;\n\n\tnormal_fmt_prepare(file, line, &buf_line);\n\tstrbuf_addbuf(&buf_line, buf_payload);\n\ttr2_dst_write_line(&tr2dst_normal, &buf_line);\n\tstrbuf_release(&buf_line);\n}\n\nstatic void fn_version_fl(const char *file, int line)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addf(&buf_payload, \"version %s\", git_version_string);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_start_fl(const char *file, int line,\n\t\t\tuint64_t us_elapsed_absolute, const char **argv)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addstr(&buf_payload, \"start \");\n\tsq_quote_argv_pretty(&buf_payload, argv);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_exit_fl(const char *file, int line, uint64_t us_elapsed_absolute,\n\t\t       int code)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\tdouble elapsed = (double)us_elapsed_absolute / 1000000.0;\n\n\tstrbuf_addf(&buf_payload, \"exit elapsed:%.6f code:%d\", elapsed, code);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_signal(uint64_t us_elapsed_absolute, int signo)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\tdouble elapsed = (double)us_elapsed_absolute / 1000000.0;\n\n\tstrbuf_addf(&buf_payload, \"signal elapsed:%.6f code:%d\", elapsed,\n\t\t    signo);\n\tnormal_io_write_fl(__FILE__, __LINE__, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_atexit(uint64_t us_elapsed_absolute, int code)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\tdouble elapsed = (double)us_elapsed_absolute / 1000000.0;\n\n\tstrbuf_addf(&buf_payload, \"atexit elapsed:%.6f code:%d\", elapsed, code);\n\tnormal_io_write_fl(__FILE__, __LINE__, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void maybe_append_string_va(struct strbuf *buf, const char *fmt,\n\t\t\t\t   va_list ap)\n{\n\tif (fmt && *fmt) {\n\t\tva_list copy_ap;\n\n\t\tva_copy(copy_ap, ap);\n\t\tstrbuf_vaddf(buf, fmt, copy_ap);\n\t\tva_end(copy_ap);\n\t\treturn;\n\t}\n\n\tif (fmt && *fmt) {\n\t\tstrbuf_addstr(buf, fmt);\n\t\treturn;\n\t}\n}\n\nstatic void fn_error_va_fl(const char *file, int line, const char *fmt,\n\t\t\t   va_list ap)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addstr(&buf_payload, \"error \");\n\tmaybe_append_string_va(&buf_payload, fmt, ap);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_command_path_fl(const char *file, int line, const char *pathname)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addf(&buf_payload, \"cmd_path %s\", pathname);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_command_name_fl(const char *file, int line, const char *name,\n\t\t\t       const char *hierarchy)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addf(&buf_payload, \"cmd_name %s\", name);\n\tif (hierarchy && *hierarchy)\n\t\tstrbuf_addf(&buf_payload, \" (%s)\", hierarchy);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_command_mode_fl(const char *file, int line, const char *mode)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addf(&buf_payload, \"cmd_mode %s\", mode);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_alias_fl(const char *file, int line, const char *alias,\n\t\t\tconst char **argv)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addf(&buf_payload, \"alias %s ->\", alias);\n\tsq_quote_argv_pretty(&buf_payload, argv);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_child_start_fl(const char *file, int line,\n\t\t\t      uint64_t us_elapsed_absolute,\n\t\t\t      const struct child_process *cmd)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addf(&buf_payload, \"child_start[%d] \", cmd->trace2_child_id);\n\n\tif (cmd->dir) {\n\t\tstrbuf_addstr(&buf_payload, \" cd\");\n\t\tsq_quote_buf_pretty(&buf_payload, cmd->dir);\n\t\tstrbuf_addstr(&buf_payload, \"; \");\n\t}\n\n\t/*\n\t * TODO if (cmd->env) { Consider dumping changes to environment. }\n\t * See trace_add_env() in run-command.c as used by original trace.c\n\t */\n\n\tif (cmd->git_cmd)\n\t\tstrbuf_addstr(&buf_payload, \"git\");\n\tsq_quote_argv_pretty(&buf_payload, cmd->argv);\n\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_child_exit_fl(const char *file, int line,\n\t\t\t     uint64_t us_elapsed_absolute, int cid, int pid,\n\t\t\t     int code, uint64_t us_elapsed_child)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\tdouble elapsed = (double)us_elapsed_child / 1000000.0;\n\n\tstrbuf_addf(&buf_payload, \"child_exit[%d] pid:%d code:%d elapsed:%.6f\",\n\t\t    cid, pid, code, elapsed);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_exec_fl(const char *file, int line, uint64_t us_elapsed_absolute,\n\t\t       int exec_id, const char *exe, const char **argv)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addf(&buf_payload, \"exec[%d] \", exec_id);\n\tif (exe)\n\t\tstrbuf_addstr(&buf_payload, exe);\n\tsq_quote_argv_pretty(&buf_payload, argv);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_exec_result_fl(const char *file, int line,\n\t\t\t      uint64_t us_elapsed_absolute, int exec_id,\n\t\t\t      int code)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addf(&buf_payload, \"exec_result[%d] code:%d\", exec_id, code);\n\tif (code > 0)\n\t\tstrbuf_addf(&buf_payload, \" err:%s\", strerror(code));\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_param_fl(const char *file, int line, const char *param,\n\t\t\tconst char *value)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addf(&buf_payload, \"def_param %s=%s\", param, value);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_repo_fl(const char *file, int line,\n\t\t       const struct repository *repo)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tstrbuf_addstr(&buf_payload, \"worktree \");\n\tsq_quote_buf_pretty(&buf_payload, repo->worktree);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstatic void fn_printf_va_fl(const char *file, int line,\n\t\t\t    uint64_t us_elapsed_absolute, const char *fmt,\n\t\t\t    va_list ap)\n{\n\tstruct strbuf buf_payload = STRBUF_INIT;\n\n\tmaybe_append_string_va(&buf_payload, fmt, ap);\n\tnormal_io_write_fl(file, line, &buf_payload);\n\tstrbuf_release(&buf_payload);\n}\n\nstruct tr2_tgt tr2_tgt_normal = {\n\t&tr2dst_normal,\n\n\tfn_init,\n\tfn_term,\n\n\tfn_version_fl,\n\tfn_start_fl,\n\tfn_exit_fl,\n\tfn_signal,\n\tfn_atexit,\n\tfn_error_va_fl,\n\tfn_command_path_fl,\n\tfn_command_name_fl,\n\tfn_command_mode_fl,\n\tfn_alias_fl,\n\tfn_child_start_fl,\n\tfn_child_exit_fl,\n\tNULL, /* thread_start */\n\tNULL, /* thread_exit */\n\tfn_exec_fl,\n\tfn_exec_result_fl,\n\tfn_param_fl,\n\tfn_repo_fl,\n\tNULL, /* region_enter */\n\tNULL, /* region_leave */\n\tNULL, /* data */\n\tNULL, /* data_json */\n\tfn_printf_va_fl,\n};\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "00b116d797c844cd7320542a9829e94ee1e0311c",
  "sha1_ok": true,
  "size": 8436
}
