{
  "content": {
    "base64": "IyEvYmluL3NoCgp0ZXN0X2Rlc2NyaXB0aW9uPSdnaXQgYWRkIGluIHNwYXJzZSBjaGVja2VkIG91dCB3b3JraW5nIHRyZWVzJwoKLiAuL3Rlc3QtbGliLnNoCgpTUEFSU0VfRU5UUllfQkxPQj0iIgoKIyBPcHRpb25hbGx5IHRha2UgYSBwcmludGYgZm9ybWF0IHN0cmluZyB0byB3cml0ZSB0byB0aGUgc3BhcnNlX2VudHJ5IGZpbGUKc2V0dXBfc3BhcnNlX2VudHJ5ICgpIHsKCSMgJ3NwYXJzZV9lbnRyeScgbWlnaHQgYWxyZWFkeSBiZSBpbiB0aGUgaW5kZXggd2l0aCB0aGUgc2tpcC13b3JrdHJlZQoJIyBiaXQgc2V0LiBSZW1vdmUgaXQgc28gdGhhdCB0aGUgc3Vic2VxdWVudCBnaXQgYWRkIGNhbiB1cGRhdGUgaXQuCglnaXQgdXBkYXRlLWluZGV4IC0tZm9yY2UtcmVtb3ZlIHNwYXJzZV9lbnRyeSAmJgoJaWYgdGVzdCAkIyAtZXEgMQoJdGhlbgoJCXByaW50ZiAiJDEiID5zcGFyc2VfZW50cnkKCWVsc2UKCQk+c3BhcnNlX2VudHJ5CglmaSAmJgoJZ2l0IGFkZCBzcGFyc2VfZW50cnkgJiYKCWdpdCB1cGRhdGUtaW5kZXggLS1za2lwLXdvcmt0cmVlIHNwYXJzZV9lbnRyeSAmJgoJU1BBUlNFX0VOVFJZX0JMT0I9JChnaXQgcmV2LXBhcnNlIDpzcGFyc2VfZW50cnkpCn0KCnRlc3Rfc3BhcnNlX2VudHJ5X3VuY2hhbmdlZCAoKSB7CgllY2hvICIxMDA2NDQgJFNQQVJTRV9FTlRSWV9CTE9CIDAJc3BhcnNlX2VudHJ5IiA+ZXhwZWN0ZWQgJiYKCWdpdCBscy1maWxlcyAtLXN0YWdlIHNwYXJzZV9lbnRyeSA+YWN0dWFsICYmCgl0ZXN0X2NtcCBleHBlY3RlZCBhY3R1YWwKfQoKc2V0dXBfZ2l0aWdub3JlICgpIHsKCXRlc3Rfd2hlbl9maW5pc2hlZCBybSAtZiAuZ2l0aWdub3JlICYmCgljYXQgPi5naXRpZ25vcmUgPDwtRU9GCgkqCgkhL3NwYXJzZV9lbnRyeQoJRU9GCn0KCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2dpdCBhZGQgZG9lcyBub3QgcmVtb3ZlIHNwYXJzZSBlbnRyaWVzJyAnCglzZXR1cF9zcGFyc2VfZW50cnkgJiYKCXJtIHNwYXJzZV9lbnRyeSAmJgoJZ2l0IGFkZCBzcGFyc2VfZW50cnkgJiYKCXRlc3Rfc3BhcnNlX2VudHJ5X3VuY2hhbmdlZAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdnaXQgYWRkIC1BIGRvZXMgbm90IHJlbW92ZSBzcGFyc2UgZW50cmllcycgJwoJc2V0dXBfc3BhcnNlX2VudHJ5ICYmCglybSBzcGFyc2VfZW50cnkgJiYKCXNldHVwX2dpdGlnbm9yZSAmJgoJZ2l0IGFkZCAtQSAmJgoJdGVzdF9zcGFyc2VfZW50cnlfdW5jaGFuZ2VkCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2dpdCBhZGQgLiBkb2VzIG5vdCByZW1vdmUgc3BhcnNlIGVudHJpZXMnICcKCXNldHVwX3NwYXJzZV9lbnRyeSAmJgoJcm0gc3BhcnNlX2VudHJ5ICYmCglzZXR1cF9naXRpZ25vcmUgJiYKCWdpdCBhZGQgLiAmJgoJdGVzdF9zcGFyc2VfZW50cnlfdW5jaGFuZ2VkCicKCmZvciBvcHQgaW4gIiIgLWYgLXUgLS1pZ25vcmUtcmVtb3ZhbCAtLWRyeS1ydW4KZG8KCXRlc3RfZXhwZWN0X3N1Y2Nlc3MgImdpdCBhZGQke29wdDorICRvcHR9IGRvZXMgbm90IHVwZGF0ZSBzcGFyc2UgZW50cmllcyIgJwoJCXNldHVwX3NwYXJzZV9lbnRyeSAmJgoJCWVjaG8gbW9kaWZpZWQgPnNwYXJzZV9lbnRyeSAmJgoJCWdpdCBhZGQgJG9wdCBzcGFyc2VfZW50cnkgJiYKCQl0ZXN0X3NwYXJzZV9lbnRyeV91bmNoYW5nZWQKCScKZG9uZQoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZ2l0IGFkZCAtLXJlZnJlc2ggZG9lcyBub3QgdXBkYXRlIHNwYXJzZSBlbnRyaWVzJyAnCglzZXR1cF9zcGFyc2VfZW50cnkgJiYKCWdpdCBscy1maWxlcyAtLWRlYnVnIHNwYXJzZV9lbnRyeSB8IGdyZXAgbXRpbWUgPmJlZm9yZSAmJgoJdGVzdC10b29sIGNobXRpbWUgLTYwIHNwYXJzZV9lbnRyeSAmJgoJZ2l0IGFkZCAtLXJlZnJlc2ggc3BhcnNlX2VudHJ5ICYmCglnaXQgbHMtZmlsZXMgLS1kZWJ1ZyBzcGFyc2VfZW50cnkgfCBncmVwIG10aW1lID5hZnRlciAmJgoJdGVzdF9jbXAgYmVmb3JlIGFmdGVyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2dpdCBhZGQgLS1jaG1vZCBkb2VzIG5vdCB1cGRhdGUgc3BhcnNlIGVudHJpZXMnICcKCXNldHVwX3NwYXJzZV9lbnRyeSAmJgoJZ2l0IGFkZCAtLWNobW9kPSt4IHNwYXJzZV9lbnRyeSAmJgoJdGVzdF9zcGFyc2VfZW50cnlfdW5jaGFuZ2VkICYmCgkhIHRlc3QgLXggc3BhcnNlX2VudHJ5CicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2dpdCBhZGQgLS1yZW5vcm1hbGl6ZSBkb2VzIG5vdCB1cGRhdGUgc3BhcnNlIGVudHJpZXMnICcKCXRlc3RfY29uZmlnIGNvcmUuYXV0b2NybGYgZmFsc2UgJiYKCXNldHVwX3NwYXJzZV9lbnRyeSAiTElORU9ORVxyXG5MSU5FVFdPXHJcbiIgJiYKCWVjaG8gInNwYXJzZV9lbnRyeSB0ZXh0PWF1dG8iID4uZ2l0YXR0cmlidXRlcyAmJgoJZ2l0IGFkZCAtLXJlbm9ybWFsaXplIHNwYXJzZV9lbnRyeSAmJgoJdGVzdF9zcGFyc2VfZW50cnlfdW5jaGFuZ2VkCicKCnRlc3RfZG9uZQo=",
    "text": "#!/bin/sh\n\ntest_description='git add in sparse checked out working trees'\n\n. ./test-lib.sh\n\nSPARSE_ENTRY_BLOB=\"\"\n\n# Optionally take a printf format string to write to the sparse_entry file\nsetup_sparse_entry () {\n\t# 'sparse_entry' might already be in the index with the skip-worktree\n\t# bit set. Remove it so that the subsequent git add can update it.\n\tgit update-index --force-remove sparse_entry &&\n\tif test $# -eq 1\n\tthen\n\t\tprintf \"$1\" >sparse_entry\n\telse\n\t\t>sparse_entry\n\tfi &&\n\tgit add sparse_entry &&\n\tgit update-index --skip-worktree sparse_entry &&\n\tSPARSE_ENTRY_BLOB=$(git rev-parse :sparse_entry)\n}\n\ntest_sparse_entry_unchanged () {\n\techo \"100644 $SPARSE_ENTRY_BLOB 0\tsparse_entry\" >expected &&\n\tgit ls-files --stage sparse_entry >actual &&\n\ttest_cmp expected actual\n}\n\nsetup_gitignore () {\n\ttest_when_finished rm -f .gitignore &&\n\tcat >.gitignore <<-EOF\n\t*\n\t!/sparse_entry\n\tEOF\n}\n\ntest_expect_success 'git add does not remove sparse entries' '\n\tsetup_sparse_entry &&\n\trm sparse_entry &&\n\tgit add sparse_entry &&\n\ttest_sparse_entry_unchanged\n'\n\ntest_expect_success 'git add -A does not remove sparse entries' '\n\tsetup_sparse_entry &&\n\trm sparse_entry &&\n\tsetup_gitignore &&\n\tgit add -A &&\n\ttest_sparse_entry_unchanged\n'\n\ntest_expect_success 'git add . does not remove sparse entries' '\n\tsetup_sparse_entry &&\n\trm sparse_entry &&\n\tsetup_gitignore &&\n\tgit add . &&\n\ttest_sparse_entry_unchanged\n'\n\nfor opt in \"\" -f -u --ignore-removal --dry-run\ndo\n\ttest_expect_success \"git add${opt:+ $opt} does not update sparse entries\" '\n\t\tsetup_sparse_entry &&\n\t\techo modified >sparse_entry &&\n\t\tgit add $opt sparse_entry &&\n\t\ttest_sparse_entry_unchanged\n\t'\ndone\n\ntest_expect_success 'git add --refresh does not update sparse entries' '\n\tsetup_sparse_entry &&\n\tgit ls-files --debug sparse_entry | grep mtime >before &&\n\ttest-tool chmtime -60 sparse_entry &&\n\tgit add --refresh sparse_entry &&\n\tgit ls-files --debug sparse_entry | grep mtime >after &&\n\ttest_cmp before after\n'\n\ntest_expect_success 'git add --chmod does not update sparse entries' '\n\tsetup_sparse_entry &&\n\tgit add --chmod=+x sparse_entry &&\n\ttest_sparse_entry_unchanged &&\n\t! test -x sparse_entry\n'\n\ntest_expect_success 'git add --renormalize does not update sparse entries' '\n\ttest_config core.autocrlf false &&\n\tsetup_sparse_entry \"LINEONE\\r\\nLINETWO\\r\\n\" &&\n\techo \"sparse_entry text=auto\" >.gitattributes &&\n\tgit add --renormalize sparse_entry &&\n\ttest_sparse_entry_unchanged\n'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "00b10ac877d31895ccdf3b2ae74137845cdffde7",
  "sha1_ok": true,
  "size": 2453
}
