{
  "content": {
    "base64": "IyEvYmluL3NoCiMgVGNsIGlnbm9yZXMgdGhlIG5leHQgbGluZSAtKi0gdGNsIC0qLSBcCmV4ZWMgd2lzaCAiJDAiIC0tICIkQCIKCiMgQ29weXJpZ2h0IChDKSAyMDA2IFNoYXduIFBlYXJjZSwgUGF1bCBNYWNrZXJyYXMuICBBbGwgcmlnaHRzIHJlc2VydmVkLgojIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyBpdCBtYXkgYmUgdXNlZCwgY29waWVkLCBtb2RpZmllZAojIGFuZCBkaXN0cmlidXRlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbmNlLAojIGVpdGhlciB2ZXJzaW9uIDIsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgpzZXQgYXBwbmFtZSBbbGluZGV4IFtmaWxlIHNwbGl0ICRhcmd2MF0gZW5kXQpzZXQgZ2l0ZGlyIHt9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjCiMjIGNvbmZpZwoKcHJvYyBsb2FkX3JlcG9fY29uZmlnIHt9IHsKCWdsb2JhbCByZXBvX2NvbmZpZwoJZ2xvYmFsIGNmZ190cnVzdF9tdGltZQoKCWFycmF5IHVuc2V0IHJlcG9fY29uZmlnCgljYXRjaCB7CgkJc2V0IGZkX3JjIFtvcGVuICJ8IGdpdCByZXBvLWNvbmZpZyAtLWxpc3QiIHJdCgkJd2hpbGUge1tnZXRzICRmZF9yYyBsaW5lXSA+PSAwfSB7CgkJCWlmIHtbcmVnZXhwIHteKFtePV0rKT0oLiopJH0gJGxpbmUgbGluZSBuYW1lIHZhbHVlXX0gewoJCQkJbGFwcGVuZCByZXBvX2NvbmZpZygkbmFtZSkgJHZhbHVlCgkJCX0KCQl9CgkJY2xvc2UgJGZkX3JjCgl9CgoJaWYge1tjYXRjaCB7c2V0IGNmZ190cnVzdF9tdGltZSBcCgkJCVtsaW5kZXggJHJlcG9fY29uZmlnKGd1aS50cnVzdG10aW1lKSAwXQoJCX1dfSB7CgkJc2V0IGNmZ190cnVzdF9tdGltZSBmYWxzZQoJfQp9Cgpwcm9jIHNhdmVfbXlfY29uZmlnIHt9IHsKCWdsb2JhbCByZXBvX2NvbmZpZwoJZ2xvYmFsIGNmZ190cnVzdF9tdGltZQoKCWlmIHtbY2F0Y2gge3NldCByY190cnVzdE1UaW1lICRyZXBvX2NvbmZpZyhndWkudHJ1c3RtdGltZSl9XX0gewoJCXNldCByY190cnVzdE1UaW1lIFtsaXN0IGZhbHNlXQoJfQoJaWYgeyRjZmdfdHJ1c3RfbXRpbWUgIT0gW2xpbmRleCAkcmNfdHJ1c3RNVGltZSAwXX0gewoJCWV4ZWMgZ2l0IHJlcG8tY29uZmlnIGd1aS50cnVzdE1UaW1lICRjZmdfdHJ1c3RfbXRpbWUKCQlzZXQgcmVwb19jb25maWcoZ3VpLnRydXN0bXRpbWUpIFtsaXN0ICRjZmdfdHJ1c3RfbXRpbWVdCgl9CgoJc2V0IGNmZ19nZW9tZXRyeSBbd20gZ2VvbWV0cnkgLl0KCWFwcGVuZCBjZmdfZ2VvbWV0cnkgIiBbbGluZGV4IFsudnBhbmUgc2FzaCBjb29yZCAwXSAxXSIKCWFwcGVuZCBjZmdfZ2VvbWV0cnkgIiBbbGluZGV4IFsudnBhbmUuZmlsZXMgc2FzaCBjb29yZCAwXSAwXSIKCWlmIHtbY2F0Y2gge3NldCByY19nZW9tZXRyeSAkcmVwb19jb25maWcoZ3VpLmdlb21ldHJ5KX1dfSB7CgkJc2V0IHJjX2dlb21ldHJ5IFtsaXN0IFtsaXN0XV0KCX0KCWlmIHskY2ZnX2dlb21ldHJ5ICE9IFtsaW5kZXggJHJjX2dlb21ldHJ5IDBdfSB7CgkJZXhlYyBnaXQgcmVwby1jb25maWcgZ3VpLmdlb21ldHJ5ICRjZmdfZ2VvbWV0cnkKCQlzZXQgcmVwb19jb25maWcoZ3VpLmdlb21ldHJ5KSBbbGlzdCAkY2ZnX2dlb21ldHJ5XQoJfQp9Cgpwcm9jIGVycm9yX3BvcHVwIHttc2d9IHsKCWdsb2JhbCBnaXRkaXIgYXBwbmFtZQoKCXNldCB0aXRsZSAkYXBwbmFtZQoJaWYgeyRnaXRkaXIgIT0ge319IHsKCQlhcHBlbmQgdGl0bGUgeyAofQoJCWFwcGVuZCB0aXRsZSBbbGluZGV4IFwKCQkJW2ZpbGUgc3BsaXQgW2ZpbGUgbm9ybWFsaXplIFtmaWxlIGRpcm5hbWUgJGdpdGRpcl1dXSBcCgkJCWVuZF0KCQlhcHBlbmQgdGl0bGUgeyl9Cgl9Cgl0a19tZXNzYWdlQm94IFwKCQktcGFyZW50IC4gXAoJCS1pY29uIGVycm9yIFwKCQktdHlwZSBvayBcCgkJLXRpdGxlICIkdGl0bGU6IGVycm9yIiBcCgkJLW1lc3NhZ2UgJG1zZwp9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjCiMjIHJlcG9zaXRvcnkgc2V0dXAKCmlmIHsgICBbY2F0Y2gge3NldCBjZHVwIFtleGVjIGdpdCByZXYtcGFyc2UgLS1zaG93LWNkdXBdfSBlcnJdCgl8fCBbY2F0Y2gge3NldCBnaXRkaXIgW2V4ZWMgZ2l0IHJldi1wYXJzZSAtLWdpdC1kaXJdfSBlcnJdfSB7CgljYXRjaCB7d20gd2l0aGRyYXcgLn0KCWVycm9yX3BvcHVwICJDYW5ub3QgZmluZCB0aGUgZ2l0IGRpcmVjdG9yeTpcblxuJGVyciIKCWV4aXQgMQp9CmlmIHskY2R1cCAhPSAiIn0gewoJY2QgJGNkdXAKfQp1bnNldCBjZHVwCgppZiB7JGFwcG5hbWUgPT0ge2dpdC1jaXRvb2x9fSB7CglzZXQgc2luZ2xlX2NvbW1pdCAxCn0KCmxvYWRfcmVwb19jb25maWcKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMKIyMgdGFzayBtYW5hZ2VtZW50CgpzZXQgc2luZ2xlX2NvbW1pdCAwCnNldCBzdGF0dXNfYWN0aXZlIDAKc2V0IGRpZmZfYWN0aXZlIDAKc2V0IHVwZGF0ZV9hY3RpdmUgMApzZXQgY29tbWl0X2FjdGl2ZSAwCnNldCB1cGRhdGVfaW5kZXhfZmQge30KCnNldCBkaXNhYmxlX29uX2xvY2sgW2xpc3RdCnNldCBpbmRleF9sb2NrX3R5cGUgbm9uZQoKc2V0IEhFQUQge30Kc2V0IFBBUkVOVCB7fQpzZXQgY29tbWl0X3R5cGUge30KCnByb2MgbG9ja19pbmRleCB7dHlwZX0gewoJZ2xvYmFsIGluZGV4X2xvY2tfdHlwZSBkaXNhYmxlX29uX2xvY2sKCglpZiB7JGluZGV4X2xvY2tfdHlwZSA9PSB7bm9uZX19IHsKCQlzZXQgaW5kZXhfbG9ja190eXBlICR0eXBlCgkJZm9yZWFjaCB3ICRkaXNhYmxlX29uX2xvY2sgewoJCQl1cGxldmVsICMwICR3IGRpc2FibGVkCgkJfQoJCXJldHVybiAxCgl9IGVsc2VpZiB7JGluZGV4X2xvY2tfdHlwZSA9PSB7YmVnaW4tdXBkYXRlfSAmJiAkdHlwZSA9PSB7dXBkYXRlfX0gewoJCXNldCBpbmRleF9sb2NrX3R5cGUgJHR5cGUKCQlyZXR1cm4gMQoJfQoJcmV0dXJuIDAKfQoKcHJvYyB1bmxvY2tfaW5kZXgge30gewoJZ2xvYmFsIGluZGV4X2xvY2tfdHlwZSBkaXNhYmxlX29uX2xvY2sKCglzZXQgaW5kZXhfbG9ja190eXBlIG5vbmUKCWZvcmVhY2ggdyAkZGlzYWJsZV9vbl9sb2NrIHsKCQl1cGxldmVsICMwICR3IG5vcm1hbAoJfQp9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjCiMjIHN0YXR1cwoKcHJvYyByZXBvc2l0b3J5X3N0YXRlIHtoZHZhciBjdHZhcn0gewoJZ2xvYmFsIGdpdGRpcgoJdXB2YXIgJGhkdmFyIGhkICRjdHZhciBjdAoKCWlmIHtbY2F0Y2gge3NldCBoZCBbZXhlYyBnaXQgcmV2LXBhcnNlIC0tdmVyaWZ5IEhFQURdfV19IHsKCQlzZXQgY3QgaW5pdGlhbAoJfSBlbHNlaWYge1tmaWxlIGV4aXN0cyBbZmlsZSBqb2luICRnaXRkaXIgTUVSR0VfSEVBRF1dfSB7CgkJc2V0IGN0IG1lcmdlCgl9IGVsc2UgewoJCXNldCBjdCBub3JtYWwKCX0KfQoKcHJvYyB1cGRhdGVfc3RhdHVzIHt7ZmluYWwgUmVhZHkufX0gewoJZ2xvYmFsIEhFQUQgUEFSRU5UIGNvbW1pdF90eXBlCglnbG9iYWwgdWlfaW5kZXggdWlfb3RoZXIgdWlfc3RhdHVzX3ZhbHVlIHVpX2NvbW0KCWdsb2JhbCBzdGF0dXNfYWN0aXZlIGZpbGVfc3RhdGVzCglnbG9iYWwgY2ZnX3RydXN0X210aW1lCgoJaWYgeyRzdGF0dXNfYWN0aXZlIHx8ICFbbG9ja19pbmRleCByZWFkXX0gcmV0dXJuCgoJcmVwb3NpdG9yeV9zdGF0ZSBuZXdfSEVBRCBuZXdfdHlwZQoJaWYgeyRjb21taXRfdHlwZSA9PSB7YW1lbmR9IAoJCSYmICRuZXdfdHlwZSA9PSB7bm9ybWFsfQoJCSYmICRuZXdfSEVBRCA9PSAkSEVBRH0gewoJfSBlbHNlIHsKCQlzZXQgSEVBRCAkbmV3X0hFQUQKCQlzZXQgUEFSRU5UICRuZXdfSEVBRAoJCXNldCBjb21taXRfdHlwZSAkbmV3X3R5cGUKCX0KCglhcnJheSB1bnNldCBmaWxlX3N0YXRlcwoKCWlmIHshWyR1aV9jb21tIGVkaXQgbW9kaWZpZWRdCgkJfHwgW3N0cmluZyB0cmltIFskdWlfY29tbSBnZXQgMC4wIGVuZF1dID09IHt9fSB7CgkJaWYge1tsb2FkX21lc3NhZ2UgR0lUR1VJX01TR119IHsKCQl9IGVsc2VpZiB7W2xvYWRfbWVzc2FnZSBNRVJHRV9NU0ddfSB7CgkJfSBlbHNlaWYge1tsb2FkX21lc3NhZ2UgU1FVQVNIX01TR119IHsKCQl9CgkJJHVpX2NvbW0gZWRpdCBtb2RpZmllZCBmYWxzZQoJCSR1aV9jb21tIGVkaXQgcmVzZXQKCX0KCglpZiB7JGNmZ190cnVzdF9tdGltZSA9PSB7dHJ1ZX19IHsKCQl1cGRhdGVfc3RhdHVzX3N0YWdlMiB7fSAkZmluYWwKCX0gZWxzZSB7CgkJc2V0IHN0YXR1c19hY3RpdmUgMQoJCXNldCB1aV9zdGF0dXNfdmFsdWUge1JlZnJlc2hpbmcgZmlsZSBzdGF0dXMuLi59CgkJc2V0IGZkX3JmIFtvcGVuICJ8IGdpdCB1cGRhdGUtaW5kZXggLXEgLS11bm1lcmdlZCAtLXJlZnJlc2giIHJdCgkJZmNvbmZpZ3VyZSAkZmRfcmYgLWJsb2NraW5nIDAgLXRyYW5zbGF0aW9uIGJpbmFyeQoJCWZpbGVldmVudCAkZmRfcmYgcmVhZGFibGUgXAoJCQlbbGlzdCB1cGRhdGVfc3RhdHVzX3N0YWdlMiAkZmRfcmYgJGZpbmFsXQoJfQp9Cgpwcm9jIHVwZGF0ZV9zdGF0dXNfc3RhZ2UyIHtmZCBmaW5hbH0gewoJZ2xvYmFsIGdpdGRpciBQQVJFTlQgY29tbWl0X3R5cGUKCWdsb2JhbCB1aV9pbmRleCB1aV9vdGhlciB1aV9zdGF0dXNfdmFsdWUgdWlfY29tbQoJZ2xvYmFsIHN0YXR1c19hY3RpdmUKCWdsb2JhbCBidWZfcmRpIGJ1Zl9yZGYgYnVmX3JsbwoKCWlmIHskZmQgIT0ge319IHsKCQlyZWFkICRmZAoJCWlmIHshW2VvZiAkZmRdfSByZXR1cm4KCQljbG9zZSAkZmQKCX0KCglzZXQgbHNfb3RoZXJzIFtsaXN0IHwgZ2l0IGxzLWZpbGVzIC0tb3RoZXJzIC16IFwKCQktLWV4Y2x1ZGUtcGVyLWRpcmVjdG9yeT0uZ2l0aWdub3JlXQoJc2V0IGluZm9fZXhjbHVkZSBbZmlsZSBqb2luICRnaXRkaXIgaW5mbyBleGNsdWRlXQoJaWYge1tmaWxlIHJlYWRhYmxlICRpbmZvX2V4Y2x1ZGVdfSB7CgkJbGFwcGVuZCBsc19vdGhlcnMgIi0tZXhjbHVkZS1mcm9tPSRpbmZvX2V4Y2x1ZGUiCgl9CgoJc2V0IGJ1Zl9yZGkge30KCXNldCBidWZfcmRmIHt9CglzZXQgYnVmX3JsbyB7fQoKCXNldCBzdGF0dXNfYWN0aXZlIDMKCXNldCB1aV9zdGF0dXNfdmFsdWUge1NjYW5uaW5nIGZvciBtb2RpZmllZCBmaWxlcyAuLi59CglzZXQgZmRfZGkgW29wZW4gInwgZ2l0IGRpZmYtaW5kZXggLS1jYWNoZWQgLXogJFBBUkVOVCIgcl0KCXNldCBmZF9kZiBbb3BlbiAifCBnaXQgZGlmZi1maWxlcyAteiIgcl0KCXNldCBmZF9sbyBbb3BlbiAkbHNfb3RoZXJzIHJdCgoJZmNvbmZpZ3VyZSAkZmRfZGkgLWJsb2NraW5nIDAgLXRyYW5zbGF0aW9uIGJpbmFyeQoJZmNvbmZpZ3VyZSAkZmRfZGYgLWJsb2NraW5nIDAgLXRyYW5zbGF0aW9uIGJpbmFyeQoJZmNvbmZpZ3VyZSAkZmRfbG8gLWJsb2NraW5nIDAgLXRyYW5zbGF0aW9uIGJpbmFyeQoJZmlsZWV2ZW50ICRmZF9kaSByZWFkYWJsZSBbbGlzdCByZWFkX2RpZmZfaW5kZXggJGZkX2RpICRmaW5hbF0KCWZpbGVldmVudCAkZmRfZGYgcmVhZGFibGUgW2xpc3QgcmVhZF9kaWZmX2ZpbGVzICRmZF9kZiAkZmluYWxdCglmaWxlZXZlbnQgJGZkX2xvIHJlYWRhYmxlIFtsaXN0IHJlYWRfbHNfb3RoZXJzICRmZF9sbyAkZmluYWxdCn0KCnByb2MgbG9hZF9tZXNzYWdlIHtmaWxlfSB7CglnbG9iYWwgZ2l0ZGlyIHVpX2NvbW0KCglzZXQgZiBbZmlsZSBqb2luICRnaXRkaXIgJGZpbGVdCglpZiB7W2ZpbGUgaXNmaWxlICRmXX0gewoJCWlmIHtbY2F0Y2gge3NldCBmZCBbb3BlbiAkZiByXX1dfSB7CgkJCXJldHVybiAwCgkJfQoJCXNldCBjb250ZW50IFtzdHJpbmcgdHJpbSBbcmVhZCAkZmRdXQoJCWNsb3NlICRmZAoJCSR1aV9jb21tIGRlbGV0ZSAwLjAgZW5kCgkJJHVpX2NvbW0gaW5zZXJ0IGVuZCAkY29udGVudAoJCXJldHVybiAxCgl9CglyZXR1cm4gMAp9Cgpwcm9jIHJlYWRfZGlmZl9pbmRleCB7ZmQgZmluYWx9IHsKCWdsb2JhbCBidWZfcmRpCgoJYXBwZW5kIGJ1Zl9yZGkgW3JlYWQgJGZkXQoJc2V0IGMgMAoJc2V0IG4gW3N0cmluZyBsZW5ndGggJGJ1Zl9yZGldCgl3aGlsZSB7JGMgPCAkbn0gewoJCXNldCB6MSBbc3RyaW5nIGZpcnN0ICJcMCIgJGJ1Zl9yZGkgJGNdCgkJaWYgeyR6MSA9PSAtMX0gYnJlYWsKCQlpbmNyIHoxCgkJc2V0IHoyIFtzdHJpbmcgZmlyc3QgIlwwIiAkYnVmX3JkaSAkejFdCgkJaWYgeyR6MiA9PSAtMX0gYnJlYWsKCgkJc2V0IGMgJHoyCgkJaW5jciB6MiAtMQoJCWRpc3BsYXlfZmlsZSBcCgkJCVtzdHJpbmcgcmFuZ2UgJGJ1Zl9yZGkgJHoxICR6Ml0gXAoJCQlbc3RyaW5nIGluZGV4ICRidWZfcmRpIFtleHByICR6MSAtIDJdXV8KCQlpbmNyIGMKCX0KCWlmIHskYyA8ICRufSB7CgkJc2V0IGJ1Zl9yZGkgW3N0cmluZyByYW5nZSAkYnVmX3JkaSAkYyBlbmRdCgl9IGVsc2UgewoJCXNldCBidWZfcmRpIHt9Cgl9CgoJc3RhdHVzX2VvZiAkZmQgYnVmX3JkaSAkZmluYWwKfQoKcHJvYyByZWFkX2RpZmZfZmlsZXMge2ZkIGZpbmFsfSB7CglnbG9iYWwgYnVmX3JkZgoKCWFwcGVuZCBidWZfcmRmIFtyZWFkICRmZF0KCXNldCBjIDAKCXNldCBuIFtzdHJpbmcgbGVuZ3RoICRidWZfcmRmXQoJd2hpbGUgeyRjIDwgJG59IHsKCQlzZXQgejEgW3N0cmluZyBmaXJzdCAiXDAiICRidWZfcmRmICRjXQoJCWlmIHskejEgPT0gLTF9IGJyZWFrCgkJaW5jciB6MQoJCXNldCB6MiBbc3RyaW5nIGZpcnN0ICJcMCIgJGJ1Zl9yZGYgJHoxXQoJCWlmIHskejIgPT0gLTF9IGJyZWFrCgoJCXNldCBjICR6MgoJCWluY3IgejIgLTEKCQlkaXNwbGF5X2ZpbGUgXAoJCQlbc3RyaW5nIHJhbmdlICRidWZfcmRmICR6MSAkejJdIFwKCQkJX1tzdHJpbmcgaW5kZXggJGJ1Zl9yZGYgW2V4cHIgJHoxIC0gMl1dCgkJaW5jciBjCgl9CglpZiB7JGMgPCAkbn0gewoJCXNldCBidWZfcmRmIFtzdHJpbmcgcmFuZ2UgJGJ1Zl9yZGYgJGMgZW5kXQoJfSBlbHNlIHsKCQlzZXQgYnVmX3JkZiB7fQoJfQoKCXN0YXR1c19lb2YgJGZkIGJ1Zl9yZGYgJGZpbmFsCn0KCnByb2MgcmVhZF9sc19vdGhlcnMge2ZkIGZpbmFsfSB7CglnbG9iYWwgYnVmX3JsbwoKCWFwcGVuZCBidWZfcmxvIFtyZWFkICRmZF0KCXNldCBwY2sgW3NwbGl0ICRidWZfcmxvICJcMCJdCglzZXQgYnVmX3JsbyBbbGluZGV4ICRwY2sgZW5kXQoJZm9yZWFjaCBwIFtscmFuZ2UgJHBjayAwIGVuZC0xXSB7CgkJZGlzcGxheV9maWxlICRwIF9PCgl9CglzdGF0dXNfZW9mICRmZCBidWZfcmxvICRmaW5hbAp9Cgpwcm9jIHN0YXR1c19lb2Yge2ZkIGJ1ZiBmaW5hbH0gewoJZ2xvYmFsIHN0YXR1c19hY3RpdmUgdWlfc3RhdHVzX3ZhbHVlCgl1cHZhciAkYnVmIHRvX2NsZWFyCgoJaWYge1tlb2YgJGZkXX0gewoJCXNldCB0b19jbGVhciB7fQoJCWNsb3NlICRmZAoKCQlpZiB7W2luY3Igc3RhdHVzX2FjdGl2ZSAtMV0gPT0gMH0gewoJCQlkaXNwbGF5X2FsbF9maWxlcwoJCQl1bmxvY2tfaW5kZXgKCQkJcmVzaG93X2RpZmYKCQkJc2V0IHVpX3N0YXR1c192YWx1ZSAkZmluYWwKCQl9Cgl9Cn0KCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMKIyMgZGlmZgoKcHJvYyBjbGVhcl9kaWZmIHt9IHsKCWdsb2JhbCB1aV9kaWZmIHVpX2ZuYW1lX3ZhbHVlIHVpX2ZzdGF0dXNfdmFsdWUgdWlfaW5kZXggdWlfb3RoZXIKCgkkdWlfZGlmZiBjb25mIC1zdGF0ZSBub3JtYWwKCSR1aV9kaWZmIGRlbGV0ZSAwLjAgZW5kCgkkdWlfZGlmZiBjb25mIC1zdGF0ZSBkaXNhYmxlZAoKCXNldCB1aV9mbmFtZV92YWx1ZSB7fQoJc2V0IHVpX2ZzdGF0dXNfdmFsdWUge30KCgkkdWlfaW5kZXggdGFnIHJlbW92ZSBpbl9kaWZmIDAuMCBlbmQKCSR1aV9vdGhlciB0YWcgcmVtb3ZlIGluX2RpZmYgMC4wIGVuZAp9Cgpwcm9jIHJlc2hvd19kaWZmIHt9IHsKCWdsb2JhbCB1aV9mbmFtZV92YWx1ZSB1aV9zdGF0dXNfdmFsdWUgZmlsZV9zdGF0ZXMKCglpZiB7JHVpX2ZuYW1lX3ZhbHVlID09IHt9CgkJfHwgW2NhdGNoIHtzZXQgcyAkZmlsZV9zdGF0ZXMoJHVpX2ZuYW1lX3ZhbHVlKX1dfSB7CgkJY2xlYXJfZGlmZgoJfSBlbHNlIHsKCQlzaG93X2RpZmYgJHVpX2ZuYW1lX3ZhbHVlCgl9Cn0KCnByb2Mgc2hvd19kaWZmIHtwYXRoIHt3IHt9fSB7bG5vIHt9fX0gewoJZ2xvYmFsIGZpbGVfc3RhdGVzIGZpbGVfbGlzdHMKCWdsb2JhbCBQQVJFTlQgZGlmZl8zd2F5IGRpZmZfYWN0aXZlCglnbG9iYWwgdWlfZGlmZiB1aV9mbmFtZV92YWx1ZSB1aV9mc3RhdHVzX3ZhbHVlIHVpX3N0YXR1c192YWx1ZQoKCWlmIHskZGlmZl9hY3RpdmUgfHwgIVtsb2NrX2luZGV4IHJlYWRdfSByZXR1cm4KCgljbGVhcl9kaWZmCglpZiB7JHcgPT0ge30gfHwgJGxubyA9PSB7fX0gewoJCWZvcmVhY2ggdyBbYXJyYXkgbmFtZXMgZmlsZV9saXN0c10gewoJCQlzZXQgbG5vIFtsc2VhcmNoIC1zb3J0ZWQgJGZpbGVfbGlzdHMoJHcpICRwYXRoXQoJCQlpZiB7JGxubyA+PSAwfSB7CgkJCQlpbmNyIGxubwoJCQkJYnJlYWsKCQkJfQoJCX0KCX0KCWlmIHskdyAhPSB7fSAmJiAkbG5vID49IDF9IHsKCQkkdyB0YWcgYWRkIGluX2RpZmYgJGxuby4wIFtleHByICRsbm8gKyAxXS4wCgl9CgoJc2V0IHMgJGZpbGVfc3RhdGVzKCRwYXRoKQoJc2V0IG0gW2xpbmRleCAkcyAwXQoJc2V0IGRpZmZfM3dheSAwCglzZXQgZGlmZl9hY3RpdmUgMQoJc2V0IHVpX2ZuYW1lX3ZhbHVlIFtlc2NhcGVfcGF0aCAkcGF0aF0KCXNldCB1aV9mc3RhdHVzX3ZhbHVlIFttYXBkZXNjICRtICRwYXRoXQoJc2V0IHVpX3N0YXR1c192YWx1ZSAiTG9hZGluZyBkaWZmIG9mIFtlc2NhcGVfcGF0aCAkcGF0aF0uLi4iCgoJc2V0IGNtZCBbbGlzdCB8IGdpdCBkaWZmLWluZGV4IC1wICRQQVJFTlQgLS0gJHBhdGhdCglzd2l0Y2ggJG0gewoJTU0gewoJCXNldCBjbWQgW2xpc3QgfCBnaXQgZGlmZi1pbmRleCAtcCAtYyAkUEFSRU5UICRwYXRoXQoJfQoJX08gewoJCWlmIHtbY2F0Y2ggewoJCQkJc2V0IGZkIFtvcGVuICRwYXRoIHJdCgkJCQlzZXQgY29udGVudCBbcmVhZCAkZmRdCgkJCQljbG9zZSAkZmQKCQkJfSBlcnIgXX0gewoJCQlzZXQgZGlmZl9hY3RpdmUgMAoJCQl1bmxvY2tfaW5kZXgKCQkJc2V0IHVpX3N0YXR1c192YWx1ZSAiVW5hYmxlIHRvIGRpc3BsYXkgW2VzY2FwZV9wYXRoICRwYXRoXSIKCQkJZXJyb3JfcG9wdXAgIkVycm9yIGxvYWRpbmcgZmlsZTpcblxuJGVyciIKCQkJcmV0dXJuCgkJfQoJCSR1aV9kaWZmIGNvbmYgLXN0YXRlIG5vcm1hbAoJCSR1aV9kaWZmIGluc2VydCBlbmQgJGNvbnRlbnQKCQkkdWlfZGlmZiBjb25mIC1zdGF0ZSBkaXNhYmxlZAoJCXNldCBkaWZmX2FjdGl2ZSAwCgkJdW5sb2NrX2luZGV4CgkJc2V0IHVpX3N0YXR1c192YWx1ZSB7UmVhZHkufQoJCXJldHVybgoJfQoJfQoKCWlmIHtbY2F0Y2gge3NldCBmZCBbb3BlbiAkY21kIHJdfSBlcnJdfSB7CgkJc2V0IGRpZmZfYWN0aXZlIDAKCQl1bmxvY2tfaW5kZXgKCQlzZXQgdWlfc3RhdHVzX3ZhbHVlICJVbmFibGUgdG8gZGlzcGxheSBbZXNjYXBlX3BhdGggJHBhdGhdIgoJCWVycm9yX3BvcHVwICJFcnJvciBsb2FkaW5nIGRpZmY6XG5cbiRlcnIiCgkJcmV0dXJuCgl9CgoJZmNvbmZpZ3VyZSAkZmQgLWJsb2NraW5nIDAgLXRyYW5zbGF0aW9uIGF1dG8KCWZpbGVldmVudCAkZmQgcmVhZGFibGUgW2xpc3QgcmVhZF9kaWZmICRmZF0KfQoKcHJvYyByZWFkX2RpZmYge2ZkfSB7CglnbG9iYWwgdWlfZGlmZiB1aV9zdGF0dXNfdmFsdWUgZGlmZl8zd2F5IGRpZmZfYWN0aXZlCgoJd2hpbGUge1tnZXRzICRmZCBsaW5lXSA+PSAwfSB7CgkJaWYge1tzdHJpbmcgbWF0Y2gge2RpZmYgLS1naXQgKn0gJGxpbmVdfSBjb250aW51ZQoJCWlmIHtbc3RyaW5nIG1hdGNoIHtkaWZmIC0tY29tYmluZWQgKn0gJGxpbmVdfSBjb250aW51ZQoJCWlmIHtbc3RyaW5nIG1hdGNoIHstLS0gKn0gJGxpbmVdfSBjb250aW51ZQoJCWlmIHtbc3RyaW5nIG1hdGNoIHsrKysgKn0gJGxpbmVdfSBjb250aW51ZQoJCWlmIHtbc3RyaW5nIG1hdGNoIGluZGV4KiAkbGluZV19IHsKCQkJaWYge1tzdHJpbmcgZmlyc3QgLCAkbGluZV0gPj0gMH0gewoJCQkJc2V0IGRpZmZfM3dheSAxCgkJCX0KCQl9CgoJCSR1aV9kaWZmIGNvbmYgLXN0YXRlIG5vcm1hbAoJCWlmIHshJGRpZmZfM3dheX0gewoJCQlzZXQgeCBbc3RyaW5nIGluZGV4ICRsaW5lIDBdCgkJCXN3aXRjaCAtLSAkeCB7CgkJCSJAIiB7c2V0IHRhZ3MgZGF9CgkJCSIrIiB7c2V0IHRhZ3MgZHB9CgkJCSItIiB7c2V0IHRhZ3MgZG19CgkJCWRlZmF1bHQge3NldCB0YWdzIHt9fQoJCQl9CgkJfSBlbHNlIHsKCQkJc2V0IHggW3N0cmluZyByYW5nZSAkbGluZSAwIDFdCgkJCXN3aXRjaCAtLSAkeCB7CgkJCWRlZmF1bHQge3NldCB0YWdzIHt9fQoJCQkiQEAiIHtzZXQgdGFncyBkYX0KCQkJIisrIiB7c2V0IHRhZ3MgZHA7IHNldCB4ICIgKyJ9CgkJCSIgKyIge3NldCB0YWdzIHtkaSBib2xkfTsgc2V0IHggIisrIn0KCQkJIisgIiB7c2V0IHRhZ3MgZG5pOyBzZXQgeCAiLSsifQoJCQkiLS0iIHtzZXQgdGFncyBkbTsgc2V0IHggIiAtIn0KCQkJIiAtIiB7c2V0IHRhZ3Mge2RtIGJvbGR9OyBzZXQgeCAiLS0ifQoJCQkiLSAiIHtzZXQgdGFncyBkaTsgc2V0IHggIistIn0KCQkJZGVmYXVsdCB7c2V0IHRhZ3Mge319CgkJCX0KCQkJc2V0IGxpbmUgW3N0cmluZyByZXBsYWNlICRsaW5lIDAgMSAkeF0KCQl9CgkJJHVpX2RpZmYgaW5zZXJ0IGVuZCAkbGluZSAkdGFncwoJCSR1aV9kaWZmIGluc2VydCBlbmQgIlxuIgoJCSR1aV9kaWZmIGNvbmYgLXN0YXRlIGRpc2FibGVkCgl9CgoJaWYge1tlb2YgJGZkXX0gewoJCWNsb3NlICRmZAoJCXNldCBkaWZmX2FjdGl2ZSAwCgkJdW5sb2NrX2luZGV4CgkJc2V0IHVpX3N0YXR1c192YWx1ZSB7UmVhZHkufQoJfQp9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjCiMjIGNvbW1pdAoKcHJvYyBsb2FkX2xhc3RfY29tbWl0IHt9IHsKCWdsb2JhbCBIRUFEIFBBUkVOVCBjb21taXRfdHlwZSB1aV9jb21tCgoJaWYgeyRjb21taXRfdHlwZSA9PSB7YW1lbmR9fSByZXR1cm4KCWlmIHskY29tbWl0X3R5cGUgIT0ge25vcm1hbH19IHsKCQllcnJvcl9wb3B1cCAiQ2FuJ3QgYW1lbmQgYSAkY29tbWl0X3R5cGUgY29tbWl0LiIKCQlyZXR1cm4KCX0KCglzZXQgbXNnIHt9CglzZXQgcGFyZW50IHt9CglzZXQgcGFyZW50X2NvdW50IDAKCWlmIHtbY2F0Y2ggewoJCQlzZXQgZmQgW29wZW4gInwgZ2l0IGNhdC1maWxlIGNvbW1pdCAkSEVBRCIgcl0KCQkJd2hpbGUge1tnZXRzICRmZCBsaW5lXSA+IDB9IHsKCQkJCWlmIHtbc3RyaW5nIG1hdGNoIHtwYXJlbnQgKn0gJGxpbmVdfSB7CgkJCQkJc2V0IHBhcmVudCBbc3RyaW5nIHJhbmdlICRsaW5lIDcgZW5kXQoJCQkJCWluY3IgcGFyZW50X2NvdW50CgkJCQl9CgkJCX0KCQkJc2V0IG1zZyBbc3RyaW5nIHRyaW0gW3JlYWQgJGZkXV0KCQkJY2xvc2UgJGZkCgkJfSBlcnJdfSB7CgkJZXJyb3JfcG9wdXAgIkVycm9yIGxvYWRpbmcgY29tbWl0IGRhdGEgZm9yIGFtZW5kOlxuXG4kZXJyIgoJCXJldHVybgoJfQoKCWlmIHskcGFyZW50X2NvdW50ID09IDB9IHsKCQlzZXQgY29tbWl0X3R5cGUgYW1lbmQKCQlzZXQgSEVBRCB7fQoJCXNldCBQQVJFTlQge30KCQl1cGRhdGVfc3RhdHVzCgl9IGVsc2VpZiB7JHBhcmVudF9jb3VudCA9PSAxfSB7CgkJc2V0IGNvbW1pdF90eXBlIGFtZW5kCgkJc2V0IFBBUkVOVCAkcGFyZW50CgkJJHVpX2NvbW0gZGVsZXRlIDAuMCBlbmQKCQkkdWlfY29tbSBpbnNlcnQgZW5kICRtc2cKCQkkdWlfY29tbSBlZGl0IG1vZGlmaWVkIGZhbHNlCgkJJHVpX2NvbW0gZWRpdCByZXNldAoJCXVwZGF0ZV9zdGF0dXMKCX0gZWxzZSB7CgkJZXJyb3JfcG9wdXAge1lvdSBjYW4ndCBhbWVuZCBhIG1lcmdlIGNvbW1pdC59CgkJcmV0dXJuCgl9Cn0KCnByb2MgY29tbWl0X3RyZWUge30gewoJZ2xvYmFsIHRjbF9wbGF0Zm9ybSBIRUFEIGdpdGRpciBjb21taXRfdHlwZSBmaWxlX3N0YXRlcwoJZ2xvYmFsIGNvbW1pdF9hY3RpdmUgdWlfc3RhdHVzX3ZhbHVlCglnbG9iYWwgdWlfY29tbQoKCWlmIHskY29tbWl0X2FjdGl2ZSB8fCAhW2xvY2tfaW5kZXggdXBkYXRlXX0gcmV0dXJuCgoJIyAtLSBPdXIgaW4gbWVtb3J5IHN0YXRlIHNob3VsZCBtYXRjaCB0aGUgcmVwb3NpdG9yeS4KCSMKCXJlcG9zaXRvcnlfc3RhdGUgY3VySEVBRCBjdXJfdHlwZQoJaWYgeyRjb21taXRfdHlwZSA9PSB7YW1lbmR9IAoJCSYmICRjdXJfdHlwZSA9PSB7bm9ybWFsfQoJCSYmICRjdXJIRUFEID09ICRIRUFEfSB7Cgl9IGVsc2VpZiB7JGNvbW1pdF90eXBlICE9ICRjdXJfdHlwZSB8fCAkSEVBRCAhPSAkY3VySEVBRH0gewoJCWVycm9yX3BvcHVwIHtMYXN0IHNjYW5uZWQgc3RhdGUgZG9lcyBub3QgbWF0Y2ggcmVwb3NpdG9yeSBzdGF0ZS4KCkl0cyBoaWdobHkgbGlrZWx5IHRoYXQgYW5vdGhlciBHaXQgcHJvZ3JhbSBtb2RpZmllZCB0aGUKcmVwb3NpdG9yeSBzaW5jZSBvdXIgbGFzdCBzY2FuLiAgQSByZXNjYW4gaXMgcmVxdWlyZWQKYmVmb3JlIGNvbW1pdHRpbmcuCn0KCQl1bmxvY2tfaW5kZXgKCQl1cGRhdGVfc3RhdHVzCgkJcmV0dXJuCgl9CgoJIyAtLSBBdCBsZWFzdCBvbmUgZmlsZSBzaG91bGQgZGlmZmVyIGluIHRoZSBpbmRleC4KCSMKCXNldCBmaWxlc19yZWFkeSAwCglmb3JlYWNoIHBhdGggW2FycmF5IG5hbWVzIGZpbGVfc3RhdGVzXSB7CgkJc2V0IHMgJGZpbGVfc3RhdGVzKCRwYXRoKQoJCXN3aXRjaCAtZ2xvYiAtLSBbbGluZGV4ICRzIDBdIHsKCQlfPyB7Y29udGludWV9CgkJQT8gLQoJCUQ/IC0KCQlNPyB7c2V0IGZpbGVzX3JlYWR5IDE7IGJyZWFrfQoJCVU/IHsKCQkJZXJyb3JfcG9wdXAgIlVubWVyZ2VkIGZpbGVzIGNhbm5vdCBiZSBjb21taXR0ZWQuCgpGaWxlIFtlc2NhcGVfcGF0aCAkcGF0aF0gaGFzIG1lcmdlIGNvbmZsaWN0cy4KWW91IG11c3QgcmVzb2x2ZSB0aGVtIGFuZCBpbmNsdWRlIHRoZSBmaWxlIGJlZm9yZSBjb21taXR0aW5nLgoiCgkJCXVubG9ja19pbmRleAoJCQlyZXR1cm4KCQl9CgkJZGVmYXVsdCB7CgkJCWVycm9yX3BvcHVwICJVbmtub3duIGZpbGUgc3RhdGUgW2xpbmRleCAkcyAwXSBkZXRlY3RlZC4KCkZpbGUgW2VzY2FwZV9wYXRoICRwYXRoXSBjYW5ub3QgYmUgY29tbWl0dGVkIGJ5IHRoaXMgcHJvZ3JhbS4KIgoJCX0KCQl9Cgl9CglpZiB7ISRmaWxlc19yZWFkeX0gewoJCWVycm9yX3BvcHVwIHtObyBpbmNsdWRlZCBmaWxlcyB0byBjb21taXQuCgpZb3UgbXVzdCBpbmNsdWRlIGF0IGxlYXN0IDEgZmlsZSBiZWZvcmUgeW91IGNhbiBjb21taXQuCn0KCQl1bmxvY2tfaW5kZXgKCQlyZXR1cm4KCX0KCgkjIC0tIEEgbWVzc2FnZSBpcyByZXF1aXJlZC4KCSMKCXNldCBtc2cgW3N0cmluZyB0cmltIFskdWlfY29tbSBnZXQgMS4wIGVuZF1dCglpZiB7JG1zZyA9PSB7fX0gewoJCWVycm9yX3BvcHVwIHtQbGVhc2Ugc3VwcGx5IGEgY29tbWl0IG1lc3NhZ2UuCgpBIGdvb2QgY29tbWl0IG1lc3NhZ2UgaGFzIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgoKLSBGaXJzdCBsaW5lOiBEZXNjcmliZSBpbiBvbmUgc2VudGFuY2Ugd2hhdCB5b3UgZGlkLgotIFNlY29uZCBsaW5lOiBCbGFuawotIFJlbWFpbmluZyBsaW5lczogRGVzY3JpYmUgd2h5IHRoaXMgY2hhbmdlIGlzIGdvb2QuCn0KCQl1bmxvY2tfaW5kZXgKCQlyZXR1cm4KCX0KCgkjIC0tIEFzayB0aGUgcHJlLWNvbW1pdCBob29rIGZvciB0aGUgZ28tYWhlYWQuCgkjCglzZXQgcGNob29rIFtmaWxlIGpvaW4gJGdpdGRpciBob29rcyBwcmUtY29tbWl0XQoJaWYgeyR0Y2xfcGxhdGZvcm0ocGxhdGZvcm0pID09IHt3aW5kb3dzfSAmJiBbZmlsZSBpc2ZpbGUgJHBjaG9va119IHsKCQlzZXQgcGNob29rIFtsaXN0IHNoIC1jIFwKCQkJImlmIHRlc3QgLXggXCIkcGNob29rXCI7IHRoZW4gZXhlYyBcIiRwY2hvb2tcIjsgZmkiXQoJfSBlbHNlaWYge1tmaWxlIGV4ZWN1dGFibGUgJHBjaG9va119IHsKCQlzZXQgcGNob29rIFtsaXN0ICRwY2hvb2tdCgl9IGVsc2UgewoJCXNldCBwY2hvb2sge30KCX0KCWlmIHskcGNob29rICE9IHt9ICYmIFtjYXRjaCB7ZXZhbCBleGVjICRwY2hvb2t9IGVycl19IHsKCQlob29rX2ZhaWxlZF9wb3B1cCBwcmUtY29tbWl0ICRlcnIKCQl1bmxvY2tfaW5kZXgKCQlyZXR1cm4KCX0KCgkjIC0tIFdyaXRlIHRoZSB0cmVlIGluIHRoZSBiYWNrZ3JvdW5kLgoJIwoJc2V0IGNvbW1pdF9hY3RpdmUgMQoJc2V0IHVpX3N0YXR1c192YWx1ZSB7Q29tbWl0dGluZyBjaGFuZ2VzLi4ufQoKCXNldCBmZF93dCBbb3BlbiAifCBnaXQgd3JpdGUtdHJlZSIgcl0KCWZpbGVldmVudCAkZmRfd3QgcmVhZGFibGUgW2xpc3QgY29tbWl0X3N0YWdlMiAkZmRfd3QgJGN1ckhFQUQgJG1zZ10KfQoKcHJvYyBjb21taXRfc3RhZ2UyIHtmZF93dCBjdXJIRUFEIG1zZ30gewoJZ2xvYmFsIHNpbmdsZV9jb21taXQgZ2l0ZGlyIEhFQUQgUEFSRU5UIGNvbW1pdF90eXBlCglnbG9iYWwgY29tbWl0X2FjdGl2ZSB1aV9zdGF0dXNfdmFsdWUgdWlfY29tbQoJZ2xvYmFsIGZpbGVfc3RhdGVzCgoJZ2V0cyAkZmRfd3QgdHJlZV9pZAoJaWYgeyR0cmVlX2lkID09IHt9IHx8IFtjYXRjaCB7Y2xvc2UgJGZkX3d0fSBlcnJdfSB7CgkJZXJyb3JfcG9wdXAgIndyaXRlLXRyZWUgZmFpbGVkOlxuXG4kZXJyIgoJCXNldCBjb21taXRfYWN0aXZlIDAKCQlzZXQgdWlfc3RhdHVzX3ZhbHVlIHtDb21taXQgZmFpbGVkLn0KCQl1bmxvY2tfaW5kZXgKCQlyZXR1cm4KCX0KCgkjIC0tIENyZWF0ZSB0aGUgY29tbWl0LgoJIwoJc2V0IGNtZCBbbGlzdCBnaXQgY29tbWl0LXRyZWUgJHRyZWVfaWRdCglpZiB7JFBBUkVOVCAhPSB7fX0gewoJCWxhcHBlbmQgY21kIC1wICRQQVJFTlQKCX0KCWlmIHskY29tbWl0X3R5cGUgPT0ge21lcmdlfX0gewoJCWlmIHtbY2F0Y2ggewoJCQkJc2V0IGZkX21oIFtvcGVuIFtmaWxlIGpvaW4gJGdpdGRpciBNRVJHRV9IRUFEXSByXQoJCQkJd2hpbGUge1tnZXRzICRmZF9taCBtZXJnZV9oZWFkXSA+PSAwfSB7CgkJCQkJbGFwcGVuZCBjbWQgLXAgJG1lcmdlX2hlYWQKCQkJCX0KCQkJCWNsb3NlICRmZF9taAoJCQl9IGVycl19IHsKCQkJZXJyb3JfcG9wdXAgIkxvYWRpbmcgTUVSR0VfSEVBRCBmYWlsZWQ6XG5cbiRlcnIiCgkJCXNldCBjb21taXRfYWN0aXZlIDAKCQkJc2V0IHVpX3N0YXR1c192YWx1ZSB7Q29tbWl0IGZhaWxlZC59CgkJCXVubG9ja19pbmRleAoJCQlyZXR1cm4KCQl9Cgl9CglpZiB7JFBBUkVOVCA9PSB7fX0gewoJCSMgZ2l0IGNvbW1pdC10cmVlIHdyaXRlcyB0byBzdGRlcnIgZHVyaW5nIGluaXRpYWwgY29tbWl0LgoJCWxhcHBlbmQgY21kIDI+L2Rldi9udWxsCgl9CglsYXBwZW5kIGNtZCA8PCAkbXNnCglpZiB7W2NhdGNoIHtzZXQgY210X2lkIFtldmFsIGV4ZWMgJGNtZF19IGVycl19IHsKCQllcnJvcl9wb3B1cCAiY29tbWl0LXRyZWUgZmFpbGVkOlxuXG4kZXJyIgoJCXNldCBjb21taXRfYWN0aXZlIDAKCQlzZXQgdWlfc3RhdHVzX3ZhbHVlIHtDb21taXQgZmFpbGVkLn0KCQl1bmxvY2tfaW5kZXgKCQlyZXR1cm4KCX0KCgkjIC0tIFVwZGF0ZSB0aGUgSEVBRCByZWYuCgkjCglzZXQgcmVmbG9nbSBjb21taXQKCWlmIHskY29tbWl0X3R5cGUgIT0ge25vcm1hbH19IHsKCQlhcHBlbmQgcmVmbG9nbSAiICgkY29tbWl0X3R5cGUpIgoJfQoJc2V0IGkgW3N0cmluZyBmaXJzdCAiXG4iICRtc2ddCglpZiB7JGkgPj0gMH0gewoJCWFwcGVuZCByZWZsb2dtIHs6IH0gW3N0cmluZyByYW5nZSAkbXNnIDAgW2V4cHIgJGkgLSAxXV0KCX0gZWxzZSB7CgkJYXBwZW5kIHJlZmxvZ20gezogfSAkbXNnCgl9CglzZXQgY21kIFtsaXN0IGdpdCB1cGRhdGUtcmVmIC1tICRyZWZsb2dtIEhFQUQgJGNtdF9pZCAkY3VySEVBRF0KCWlmIHtbY2F0Y2gge2V2YWwgZXhlYyAkY21kfSBlcnJdfSB7CgkJZXJyb3JfcG9wdXAgInVwZGF0ZS1yZWYgZmFpbGVkOlxuXG4kZXJyIgoJCXNldCBjb21taXRfYWN0aXZlIDAKCQlzZXQgdWlfc3RhdHVzX3ZhbHVlIHtDb21taXQgZmFpbGVkLn0KCQl1bmxvY2tfaW5kZXgKCQlyZXR1cm4KCX0KCgkjIC0tIENsZWFudXAgYWZ0ZXIgb3Vyc2VsdmVzLgoJIwoJY2F0Y2gge2ZpbGUgZGVsZXRlIFtmaWxlIGpvaW4gJGdpdGRpciBNRVJHRV9IRUFEXX0KCWNhdGNoIHtmaWxlIGRlbGV0ZSBbZmlsZSBqb2luICRnaXRkaXIgTUVSR0VfTVNHXX0KCWNhdGNoIHtmaWxlIGRlbGV0ZSBbZmlsZSBqb2luICRnaXRkaXIgU1FVQVNIX01TR119CgljYXRjaCB7ZmlsZSBkZWxldGUgW2ZpbGUgam9pbiAkZ2l0ZGlyIEdJVEdVSV9NU0ddfQoKCSMgLS0gTGV0IHJlcmVyZSBkbyBpdHMgdGhpbmcuCgkjCglpZiB7W2ZpbGUgaXNkaXJlY3RvcnkgW2ZpbGUgam9pbiAkZ2l0ZGlyIHJyLWNhY2hlXV19IHsKCQljYXRjaCB7ZXhlYyBnaXQgcmVyZXJlfQoJfQoKCSR1aV9jb21tIGRlbGV0ZSAwLjAgZW5kCgkkdWlfY29tbSBlZGl0IG1vZGlmaWVkIGZhbHNlCgkkdWlfY29tbSBlZGl0IHJlc2V0CgoJaWYgeyRzaW5nbGVfY29tbWl0fSBkb19xdWl0CgoJIyAtLSBVcGRhdGUgc3RhdHVzIHdpdGhvdXQgaW52b2tpbmcgYW55IGdpdCBjb21tYW5kcy4KCSMKCXNldCBjb21taXRfYWN0aXZlIDAKCXNldCBjb21taXRfdHlwZSBub3JtYWwKCXNldCBIRUFEICRjbXRfaWQKCXNldCBQQVJFTlQgJGNtdF9pZAoKCWZvcmVhY2ggcGF0aCBbYXJyYXkgbmFtZXMgZmlsZV9zdGF0ZXNdIHsKCQlzZXQgcyAkZmlsZV9zdGF0ZXMoJHBhdGgpCgkJc2V0IG0gW2xpbmRleCAkcyAwXQoJCXN3aXRjaCAtZ2xvYiAtLSAkbSB7CgkJQT8gLQoJCU0/IC0KCQlEPyB7c2V0IG0gX1tzdHJpbmcgaW5kZXggJG0gMV19CgkJfQoKCQlpZiB7JG0gPT0ge19ffX0gewoJCQl1bnNldCBmaWxlX3N0YXRlcygkcGF0aCkKCQl9IGVsc2UgewoJCQlsc2V0IGZpbGVfc3RhdGVzKCRwYXRoKSAwICRtCgkJfQoJfQoKCWRpc3BsYXlfYWxsX2ZpbGVzCgl1bmxvY2tfaW5kZXgKCXJlc2hvd19kaWZmCglzZXQgdWlfc3RhdHVzX3ZhbHVlIFwKCQkiQ2hhbmdlcyBjb21taXR0ZWQgYXMgW3N0cmluZyByYW5nZSAkY210X2lkIDAgN10uIgp9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjCiMjIGZldGNoIHB1bGwgcHVzaAoKcHJvYyBmZXRjaF9mcm9tIHtyZW1vdGV9IHsKCXNldCB3IFtuZXdfY29uc29sZSAiZmV0Y2ggJHJlbW90ZSIgXAoJCSJGZXRjaGluZyBuZXcgY2hhbmdlcyBmcm9tICRyZW1vdGUiXQoJc2V0IGNtZCBbbGlzdCBnaXQgZmV0Y2hdCglsYXBwZW5kIGNtZCAkcmVtb3RlCgljb25zb2xlX2V4ZWMgJHcgJGNtZAp9Cgpwcm9jIHB1bGxfcmVtb3RlIHtyZW1vdGUgYnJhbmNofSB7CglnbG9iYWwgSEVBRCBjb21taXRfdHlwZQoJZ2xvYmFsIGZpbGVfc3RhdGVzCgoJaWYgeyFbbG9ja19pbmRleCB1cGRhdGVdfSByZXR1cm4KCgkjIC0tIE91ciBpbiBtZW1vcnkgc3RhdGUgc2hvdWxkIG1hdGNoIHRoZSByZXBvc2l0b3J5LgoJIwoJcmVwb3NpdG9yeV9zdGF0ZSBjdXJIRUFEIGN1cl90eXBlCglpZiB7JGNvbW1pdF90eXBlICE9ICRjdXJfdHlwZSB8fCAkSEVBRCAhPSAkY3VySEVBRH0gewoJCWVycm9yX3BvcHVwIHtMYXN0IHNjYW5uZWQgc3RhdGUgZG9lcyBub3QgbWF0Y2ggcmVwb3NpdG9yeSBzdGF0ZS4KCkl0cyBoaWdobHkgbGlrZWx5IHRoYXQgYW5vdGhlciBHaXQgcHJvZ3JhbSBtb2RpZmllZCB0aGUKcmVwb3NpdG9yeSBzaW5jZSBvdXIgbGFzdCBzY2FuLiAgQSByZXNjYW4gaXMgcmVxdWlyZWQKYmVmb3JlIGEgcHVsbCBjYW4gYmUgc3RhcnRlZC4KfQoJCXVubG9ja19pbmRleAoJCXVwZGF0ZV9zdGF0dXMKCQlyZXR1cm4KCX0KCgkjIC0tIE5vIGRpZmZlcmVuY2VzIHNob3VsZCBleGlzdCBiZWZvcmUgYSBwdWxsLgoJIwoJaWYge1thcnJheSBzaXplIGZpbGVfc3RhdGVzXSAhPSAwfSB7CgkJZXJyb3JfcG9wdXAge1VuY29tbWl0dGVkIGJ1dCBtb2RpZmllZCBmaWxlcyBhcmUgcHJlc2VudC4KCllvdSBzaG91bGQgbm90IHBlcmZvcm0gYSBwdWxsIHdpdGggdW5tb2RpZmllZCBmaWxlcyBpbiB5b3VyIHdvcmtpbmcKZGlyZWN0b3J5IGFzIEdpdCB3b3VsZCBiZSB1bmFibGUgdG8gcmVjb3ZlciBmcm9tIGFuIGluY29ycmVjdCBtZXJnZS4KCkNvbW1pdCBvciB0aHJvdyBhd2F5IGFsbCBjaGFuZ2VzIGJlZm9yZSBzdGFydGluZyBhIHB1bGwgb3BlcmF0aW9uLgp9CgkJdW5sb2NrX2luZGV4CgkJcmV0dXJuCgl9CgoJc2V0IHcgW25ld19jb25zb2xlICJwdWxsICRyZW1vdGUgJGJyYW5jaCIgXAoJCSJQdWxsaW5nIG5ldyBjaGFuZ2VzIGZyb20gYnJhbmNoICRicmFuY2ggaW4gJHJlbW90ZSJdCglzZXQgY21kIFtsaXN0IGdpdCBwdWxsXQoJbGFwcGVuZCBjbWQgJHJlbW90ZQoJbGFwcGVuZCBjbWQgJGJyYW5jaAoJY29uc29sZV9leGVjICR3ICRjbWQgW2xpc3QgcG9zdF9wdWxsX3JlbW90ZSAkcmVtb3RlICRicmFuY2hdCn0KCnByb2MgcG9zdF9wdWxsX3JlbW90ZSB7cmVtb3RlIGJyYW5jaCBzdWNjZXNzfSB7CglnbG9iYWwgSEVBRCBQQVJFTlQgY29tbWl0X3R5cGUKCWdsb2JhbCB1aV9zdGF0dXNfdmFsdWUKCgl1bmxvY2tfaW5kZXgKCWlmIHskc3VjY2Vzc30gewoJCXJlcG9zaXRvcnlfc3RhdGUgSEVBRCBjb21taXRfdHlwZQoJCXNldCBQQVJFTlQgJEhFQUQKCQlzZXQgJHVpX3N0YXR1c192YWx1ZSB7UmVhZHkufQoJfSBlbHNlIHsKCQl1cGRhdGVfc3RhdHVzIFwKCQkJIkNvbmZsaWN0cyBkZXRlY3RlZCB3aGlsZSBwdWxsaW5nICRicmFuY2ggZnJvbSAkcmVtb3RlLiIKCX0KfQoKcHJvYyBwdXNoX3RvIHtyZW1vdGV9IHsKCXNldCB3IFtuZXdfY29uc29sZSAicHVzaCAkcmVtb3RlIiBcCgkJIlB1c2hpbmcgY2hhbmdlcyB0byAkcmVtb3RlIl0KCXNldCBjbWQgW2xpc3QgZ2l0IHB1c2hdCglsYXBwZW5kIGNtZCAkcmVtb3RlCgljb25zb2xlX2V4ZWMgJHcgJGNtZAp9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjCiMjIHVpIGhlbHBlcnMKCnByb2MgbWFwY29sIHtzdGF0ZSBwYXRofSB7CglnbG9iYWwgYWxsX2NvbHMgdWlfb3RoZXIKCglpZiB7W2NhdGNoIHtzZXQgciAkYWxsX2NvbHMoJHN0YXRlKX1dfSB7CgkJcHV0cyAiZXJyb3I6IG5vIGNvbHVtbiBmb3Igc3RhdGU9eyRzdGF0ZX0gJHBhdGgiCgkJcmV0dXJuICR1aV9vdGhlcgoJfQoJcmV0dXJuICRyCn0KCnByb2MgbWFwaWNvbiB7c3RhdGUgcGF0aH0gewoJZ2xvYmFsIGFsbF9pY29ucwoKCWlmIHtbY2F0Y2gge3NldCByICRhbGxfaWNvbnMoJHN0YXRlKX1dfSB7CgkJcHV0cyAiZXJyb3I6IG5vIGljb24gZm9yIHN0YXRlPXskc3RhdGV9ICRwYXRoIgoJCXJldHVybiBmaWxlX3BsYWluCgl9CglyZXR1cm4gJHIKfQoKcHJvYyBtYXBkZXNjIHtzdGF0ZSBwYXRofSB7CglnbG9iYWwgYWxsX2Rlc2NzCgoJaWYge1tjYXRjaCB7c2V0IHIgJGFsbF9kZXNjcygkc3RhdGUpfV19IHsKCQlwdXRzICJlcnJvcjogbm8gZGVzYyBmb3Igc3RhdGU9eyRzdGF0ZX0gJHBhdGgiCgkJcmV0dXJuICRzdGF0ZQoJfQoJcmV0dXJuICRyCn0KCnByb2MgZXNjYXBlX3BhdGgge3BhdGh9IHsKCXJlZ3N1YiAtYWxsICJcbiIgJHBhdGggIlxcbiIgcGF0aAoJcmV0dXJuICRwYXRoCn0KCnNldCBuZXh0X2ljb25faWQgMAoKcHJvYyBtZXJnZV9zdGF0ZSB7cGF0aCBuZXdfc3RhdGV9IHsKCWdsb2JhbCBmaWxlX3N0YXRlcyBuZXh0X2ljb25faWQKCglzZXQgczAgW3N0cmluZyBpbmRleCAkbmV3X3N0YXRlIDBdCglzZXQgczEgW3N0cmluZyBpbmRleCAkbmV3X3N0YXRlIDFdCgoJaWYge1tjYXRjaCB7c2V0IGluZm8gJGZpbGVfc3RhdGVzKCRwYXRoKX1dfSB7CgkJc2V0IHN0YXRlIF9fCgkJc2V0IGljb24gbltpbmNyIG5leHRfaWNvbl9pZF0KCX0gZWxzZSB7CgkJc2V0IHN0YXRlIFtsaW5kZXggJGluZm8gMF0KCQlzZXQgaWNvbiBbbGluZGV4ICRpbmZvIDFdCgl9CgoJaWYgeyRzMCA9PSB7X319IHsKCQlzZXQgczAgW3N0cmluZyBpbmRleCAkc3RhdGUgMF0KCX0gZWxzZWlmIHskczAgPT0geyp9fSB7CgkJc2V0IHMwIF8KCX0KCglpZiB7JHMxID09IHtffX0gewoJCXNldCBzMSBbc3RyaW5nIGluZGV4ICRzdGF0ZSAxXQoJfSBlbHNlaWYgeyRzMSA9PSB7Kn19IHsKCQlzZXQgczEgXwoJfQoKCXNldCBmaWxlX3N0YXRlcygkcGF0aCkgW2xpc3QgJHMwJHMxICRpY29uXQoJcmV0dXJuICRzdGF0ZQp9Cgpwcm9jIGRpc3BsYXlfZmlsZSB7cGF0aCBzdGF0ZX0gewoJZ2xvYmFsIHVpX2luZGV4IHVpX290aGVyCglnbG9iYWwgZmlsZV9zdGF0ZXMgZmlsZV9saXN0cyBzdGF0dXNfYWN0aXZlCgoJc2V0IG9sZF9tIFttZXJnZV9zdGF0ZSAkcGF0aCAkc3RhdGVdCglpZiB7JHN0YXR1c19hY3RpdmV9IHJldHVybgoKCXNldCBzICRmaWxlX3N0YXRlcygkcGF0aCkKCXNldCBuZXdfbSBbbGluZGV4ICRzIDBdCglzZXQgbmV3X3cgW21hcGNvbCAkbmV3X20gJHBhdGhdIAoJc2V0IG9sZF93IFttYXBjb2wgJG9sZF9tICRwYXRoXQoJc2V0IG5ld19pY29uIFttYXBpY29uICRuZXdfbSAkcGF0aF0KCglpZiB7JG5ld193ICE9ICRvbGRfd30gewoJCXNldCBsbm8gW2xzZWFyY2ggLXNvcnRlZCAkZmlsZV9saXN0cygkb2xkX3cpICRwYXRoXQoJCWlmIHskbG5vID49IDB9IHsKCQkJaW5jciBsbm8KCQkJJG9sZF93IGNvbmYgLXN0YXRlIG5vcm1hbAoJCQkkb2xkX3cgZGVsZXRlICRsbm8uMCBbZXhwciAkbG5vICsgMV0uMAoJCQkkb2xkX3cgY29uZiAtc3RhdGUgZGlzYWJsZWQKCQl9CgoJCWxhcHBlbmQgZmlsZV9saXN0cygkbmV3X3cpICRwYXRoCgkJc2V0IGZpbGVfbGlzdHMoJG5ld193KSBbbHNvcnQgJGZpbGVfbGlzdHMoJG5ld193KV0KCQlzZXQgbG5vIFtsc2VhcmNoIC1zb3J0ZWQgJGZpbGVfbGlzdHMoJG5ld193KSAkcGF0aF0KCQlpbmNyIGxubwoJCSRuZXdfdyBjb25mIC1zdGF0ZSBub3JtYWwKCQkkbmV3X3cgaW1hZ2UgY3JlYXRlICRsbm8uMCBcCgkJCS1hbGlnbiBjZW50ZXIgLXBhZHggNSAtcGFkeSAxIFwKCQkJLW5hbWUgW2xpbmRleCAkcyAxXSBcCgkJCS1pbWFnZSAkbmV3X2ljb24KCQkkbmV3X3cgaW5zZXJ0ICRsbm8uMSAiW2VzY2FwZV9wYXRoICRwYXRoXVxuIgoJCSRuZXdfdyBjb25mIC1zdGF0ZSBkaXNhYmxlZAoJfSBlbHNlaWYgeyRuZXdfaWNvbiAhPSBbbWFwaWNvbiAkb2xkX20gJHBhdGhdfSB7CgkJJG5ld193IGNvbmYgLXN0YXRlIG5vcm1hbAoJCSRuZXdfdyBpbWFnZSBjb25mIFtsaW5kZXggJHMgMV0gLWltYWdlICRuZXdfaWNvbgoJCSRuZXdfdyBjb25mIC1zdGF0ZSBkaXNhYmxlZAoJfQp9Cgpwcm9jIGRpc3BsYXlfYWxsX2ZpbGVzIHt9IHsKCWdsb2JhbCB1aV9pbmRleCB1aV9vdGhlciBmaWxlX3N0YXRlcyBmaWxlX2xpc3RzCgoJJHVpX2luZGV4IGNvbmYgLXN0YXRlIG5vcm1hbAoJJHVpX290aGVyIGNvbmYgLXN0YXRlIG5vcm1hbAoKCSR1aV9pbmRleCBkZWxldGUgMC4wIGVuZAoJJHVpX290aGVyIGRlbGV0ZSAwLjAgZW5kCgoJc2V0IGZpbGVfbGlzdHMoJHVpX2luZGV4KSBbbGlzdF0KCXNldCBmaWxlX2xpc3RzKCR1aV9vdGhlcikgW2xpc3RdCgoJZm9yZWFjaCBwYXRoIFtsc29ydCBbYXJyYXkgbmFtZXMgZmlsZV9zdGF0ZXNdXSB7CgkJc2V0IHMgJGZpbGVfc3RhdGVzKCRwYXRoKQoJCXNldCBtIFtsaW5kZXggJHMgMF0KCQlzZXQgdyBbbWFwY29sICRtICRwYXRoXQoJCWxhcHBlbmQgZmlsZV9saXN0cygkdykgJHBhdGgKCQkkdyBpbWFnZSBjcmVhdGUgZW5kIFwKCQkJLWFsaWduIGNlbnRlciAtcGFkeCA1IC1wYWR5IDEgXAoJCQktbmFtZSBbbGluZGV4ICRzIDFdIFwKCQkJLWltYWdlIFttYXBpY29uICRtICRwYXRoXQoJCSR3IGluc2VydCBlbmQgIltlc2NhcGVfcGF0aCAkcGF0aF1cbiIKCX0KCgkkdWlfaW5kZXggY29uZiAtc3RhdGUgZGlzYWJsZWQKCSR1aV9vdGhlciBjb25mIC1zdGF0ZSBkaXNhYmxlZAp9Cgpwcm9jIHdpdGhfdXBkYXRlX2luZGV4IHtib2R5fSB7CglnbG9iYWwgdXBkYXRlX2luZGV4X2ZkCgoJaWYgeyR1cGRhdGVfaW5kZXhfZmQgPT0ge319IHsKCQlpZiB7IVtsb2NrX2luZGV4IHVwZGF0ZV19IHJldHVybgoJCXNldCB1cGRhdGVfaW5kZXhfZmQgW29wZW4gXAoJCQkifCBnaXQgdXBkYXRlLWluZGV4IC0tYWRkIC0tcmVtb3ZlIC16IC0tc3RkaW4iIFwKCQkJd10KCQlmY29uZmlndXJlICR1cGRhdGVfaW5kZXhfZmQgLXRyYW5zbGF0aW9uIGJpbmFyeQoJCXVwbGV2ZWwgMSAkYm9keQoJCWNsb3NlICR1cGRhdGVfaW5kZXhfZmQKCQlzZXQgdXBkYXRlX2luZGV4X2ZkIHt9CgkJdW5sb2NrX2luZGV4Cgl9IGVsc2UgewoJCXVwbGV2ZWwgMSAkYm9keQoJfQp9Cgpwcm9jIHVwZGF0ZV9pbmRleCB7cGF0aH0gewoJZ2xvYmFsIHVwZGF0ZV9pbmRleF9mZAoKCWlmIHskdXBkYXRlX2luZGV4X2ZkID09IHt9fSB7CgkJZXJyb3Ige25vdCBpbiB3aXRoX3VwZGF0ZV9pbmRleH0KCX0gZWxzZSB7CgkJcHV0cyAtbm9uZXdsaW5lICR1cGRhdGVfaW5kZXhfZmQgIiRwYXRoXDAiCgl9Cn0KCnByb2MgdG9nZ2xlX21vZGUge3BhdGh9IHsKCWdsb2JhbCBmaWxlX3N0YXRlcyB1aV9mbmFtZV92YWx1ZQoKCXNldCBzICRmaWxlX3N0YXRlcygkcGF0aCkKCXNldCBtIFtsaW5kZXggJHMgMF0KCglzd2l0Y2ggLS0gJG0gewoJQU0gLQoJX08ge3NldCBuZXcgQSp9CglfTSAtCglNTSB7c2V0IG5ldyBNKn0KCUFEIC0KCV9EIHtzZXQgbmV3IEQqfQoJZGVmYXVsdCB7cmV0dXJufQoJfQoKCXdpdGhfdXBkYXRlX2luZGV4IHt1cGRhdGVfaW5kZXggJHBhdGh9CglkaXNwbGF5X2ZpbGUgJHBhdGggJG5ldwoJaWYgeyR1aV9mbmFtZV92YWx1ZSA9PSAkcGF0aH0gewoJCXNob3dfZGlmZiAkcGF0aAoJfQp9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjCiMjIHJlbW90ZSBtYW5hZ2VtZW50Cgpwcm9jIGxvYWRfYWxsX3JlbW90ZXMge30gewoJZ2xvYmFsIGdpdGRpciBhbGxfcmVtb3RlcyByZXBvX2NvbmZpZwoKCXNldCBhbGxfcmVtb3RlcyBbbGlzdF0KCXNldCBybV9kaXIgW2ZpbGUgam9pbiAkZ2l0ZGlyIHJlbW90ZXNdCglpZiB7W2ZpbGUgaXNkaXJlY3RvcnkgJHJtX2Rpcl19IHsKCQlzZXQgYWxsX3JlbW90ZXMgW2NvbmNhdCAkYWxsX3JlbW90ZXMgW2dsb2IgXAoJCQktdHlwZXMgZiBcCgkJCS10YWlscyBcCgkJCS1ub2NvbXBsYWluIFwKCQkJLWRpcmVjdG9yeSAkcm1fZGlyICpdXQoJfQoKCWZvcmVhY2ggbGluZSBbYXJyYXkgbmFtZXMgcmVwb19jb25maWcgcmVtb3RlLioudXJsXSB7CgkJaWYge1tyZWdleHAgXnJlbW90ZVwuKC4qKVwudXJsXCQgJGxpbmUgbGluZSBuYW1lXX0gewoJCQlsYXBwZW5kIGFsbF9yZW1vdGVzICRuYW1lCgkJfQoJfQoKCXNldCBhbGxfcmVtb3RlcyBbbHNvcnQgLXVuaXF1ZSAkYWxsX3JlbW90ZXNdCn0KCnByb2MgcG9wdWxhdGVfcmVtb3RlX21lbnUge20gcGZ4IG9wfSB7CglnbG9iYWwgYWxsX3JlbW90ZXMgZm9udF91aQoKCWZvcmVhY2ggcmVtb3RlICRhbGxfcmVtb3RlcyB7CgkJJG0gYWRkIGNvbW1hbmQgLWxhYmVsICIkcGZ4ICRyZW1vdGUuLi4iIFwKCQkJLWNvbW1hbmQgW2xpc3QgJG9wICRyZW1vdGVdIFwKCQkJLWZvbnQgJGZvbnRfdWkKCX0KfQoKcHJvYyBwb3B1bGF0ZV9wdWxsX21lbnUge219IHsKCWdsb2JhbCBnaXRkaXIgcmVwb19jb25maWcgYWxsX3JlbW90ZXMgZm9udF91aSBkaXNhYmxlX29uX2xvY2sKCglmb3JlYWNoIHJlbW90ZSAkYWxsX3JlbW90ZXMgewoJCXNldCByYiB7fQoJCWlmIHtbYXJyYXkgZ2V0IHJlcG9fY29uZmlnIHJlbW90ZS4kcmVtb3RlLnVybF0gIT0ge319IHsKCQkJaWYge1thcnJheSBnZXQgcmVwb19jb25maWcgcmVtb3RlLiRyZW1vdGUuZmV0Y2hdICE9IHt9fSB7CgkJCQlyZWdleHAge14oW146XSspOn0gXAoJCQkJCVtsaW5kZXggJHJlcG9fY29uZmlnKHJlbW90ZS4kcmVtb3RlLmZldGNoKSAwXSBcCgkJCQkJbGluZSByYgoJCQl9CgkJfSBlbHNlIHsKCQkJY2F0Y2ggewoJCQkJc2V0IGZkIFtvcGVuIFtmaWxlIGpvaW4gJGdpdGRpciByZW1vdGVzICRyZW1vdGVdIHJdCgkJCQl3aGlsZSB7W2dldHMgJGZkIGxpbmVdID49IDB9IHsKCQkJCQlpZiB7W3JlZ2V4cCB7XlB1bGw6WyBcdF0qKFteOl0rKTp9ICRsaW5lIGxpbmUgcmJdfSB7CgkJCQkJCWJyZWFrCgkJCQkJfQoJCQkJfQoJCQkJY2xvc2UgJGZkCgkJCX0KCQl9CgoJCXNldCByYl9zaG9ydCAkcmIKCQlyZWdzdWIgXnJlZnMvaGVhZHMvICRyYiB7fSByYl9zaG9ydAoJCWlmIHskcmJfc2hvcnQgIT0ge319IHsKCQkJJG0gYWRkIGNvbW1hbmQgXAoJCQkJLWxhYmVsICJCcmFuY2ggJHJiX3Nob3J0IGZyb20gJHJlbW90ZS4uLiIgXAoJCQkJLWNvbW1hbmQgW2xpc3QgcHVsbF9yZW1vdGUgJHJlbW90ZSAkcmJdIFwKCQkJCS1mb250ICRmb250X3VpCgkJCWxhcHBlbmQgZGlzYWJsZV9vbl9sb2NrIFwKCQkJCVtsaXN0ICRtIGVudHJ5Y29uZiBbJG0gaW5kZXggbGFzdF0gLXN0YXRlXQoJCX0KCX0KfQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIwojIyBpY29ucwoKc2V0IGZpbGVtYXNrIHsKI2RlZmluZSBtYXNrX3dpZHRoIDE0CiNkZWZpbmUgbWFza19oZWlnaHQgMTUKc3RhdGljIHVuc2lnbmVkIGNoYXIgbWFza19iaXRzW10gPSB7CiAgIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsCiAgIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsCiAgIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWYsIDB4ZmUsIDB4MWZ9Owp9CgppbWFnZSBjcmVhdGUgYml0bWFwIGZpbGVfcGxhaW4gLWJhY2tncm91bmQgd2hpdGUgLWZvcmVncm91bmQgYmxhY2sgLWRhdGEgewojZGVmaW5lIHBsYWluX3dpZHRoIDE0CiNkZWZpbmUgcGxhaW5faGVpZ2h0IDE1CnN0YXRpYyB1bnNpZ25lZCBjaGFyIHBsYWluX2JpdHNbXSA9IHsKICAgMHhmZSwgMHgwMSwgMHgwMiwgMHgwMywgMHgwMiwgMHgwNSwgMHgwMiwgMHgwOSwgMHgwMiwgMHgxZiwgMHgwMiwgMHgxMCwKICAgMHgwMiwgMHgxMCwgMHgwMiwgMHgxMCwgMHgwMiwgMHgxMCwgMHgwMiwgMHgxMCwgMHgwMiwgMHgxMCwgMHgwMiwgMHgxMCwKICAgMHgwMiwgMHgxMCwgMHgwMiwgMHgxMCwgMHhmZSwgMHgxZn07Cn0gLW1hc2tkYXRhICRmaWxlbWFzawoKaW1hZ2UgY3JlYXRlIGJpdG1hcCBmaWxlX21vZCAtYmFja2dyb3VuZCB3aGl0ZSAtZm9yZWdyb3VuZCBibHVlIC1kYXRhIHsKI2RlZmluZSBtb2Rfd2lkdGggMTQKI2RlZmluZSBtb2RfaGVpZ2h0IDE1CnN0YXRpYyB1bnNpZ25lZCBjaGFyIG1vZF9iaXRzW10gPSB7CiAgIDB4ZmUsIDB4MDEsIDB4MDIsIDB4MDMsIDB4N2EsIDB4MDUsIDB4MDIsIDB4MDksIDB4N2EsIDB4MWYsIDB4MDIsIDB4MTAsCiAgIDB4ZmEsIDB4MTcsIDB4MDIsIDB4MTAsIDB4ZmEsIDB4MTcsIDB4MDIsIDB4MTAsIDB4ZmEsIDB4MTcsIDB4MDIsIDB4MTAsCiAgIDB4ZmEsIDB4MTcsIDB4MDIsIDB4MTAsIDB4ZmUsIDB4MWZ9Owp9IC1tYXNrZGF0YSAkZmlsZW1hc2sKCmltYWdlIGNyZWF0ZSBiaXRtYXAgZmlsZV9mdWxsdGljayAtYmFja2dyb3VuZCB3aGl0ZSAtZm9yZWdyb3VuZCAiIzAwNzAwMCIgLWRhdGEgewojZGVmaW5lIGZpbGVfZnVsbHRpY2tfd2lkdGggMTQKI2RlZmluZSBmaWxlX2Z1bGx0aWNrX2hlaWdodCAxNQpzdGF0aWMgdW5zaWduZWQgY2hhciBmaWxlX2Z1bGx0aWNrX2JpdHNbXSA9IHsKICAgMHhmZSwgMHgwMSwgMHgwMiwgMHgxYSwgMHgwMiwgMHgwYywgMHgwMiwgMHgwYywgMHgwMiwgMHgxNiwgMHgwMiwgMHgxNiwKICAgMHgwMiwgMHgxMywgMHgwMCwgMHgxMywgMHg4NiwgMHgxMSwgMHg4YywgMHgxMSwgMHhkOCwgMHgxMCwgMHhmMiwgMHgxMCwKICAgMHg2MiwgMHgxMCwgMHgwMiwgMHgxMCwgMHhmZSwgMHgxZn07Cn0gLW1hc2tkYXRhICRmaWxlbWFzawoKaW1hZ2UgY3JlYXRlIGJpdG1hcCBmaWxlX3BhcnR0aWNrIC1iYWNrZ3JvdW5kIHdoaXRlIC1mb3JlZ3JvdW5kICIjMDA1MDUwIiAtZGF0YSB7CiNkZWZpbmUgcGFydHRpY2tfd2lkdGggMTQKI2RlZmluZSBwYXJ0dGlja19oZWlnaHQgMTUKc3RhdGljIHVuc2lnbmVkIGNoYXIgcGFydHRpY2tfYml0c1tdID0gewogICAweGZlLCAweDAxLCAweDAyLCAweDAzLCAweDdhLCAweDA1LCAweDAyLCAweDA5LCAweDdhLCAweDFmLCAweDAyLCAweDEwLAogICAweDdhLCAweDE0LCAweDAyLCAweDE2LCAweDAyLCAweDEzLCAweDhhLCAweDExLCAweGRhLCAweDEwLCAweDcyLCAweDEwLAogICAweDIyLCAweDEwLCAweDAyLCAweDEwLCAweGZlLCAweDFmfTsKfSAtbWFza2RhdGEgJGZpbGVtYXNrCgppbWFnZSBjcmVhdGUgYml0bWFwIGZpbGVfcXVlc3Rpb24gLWJhY2tncm91bmQgd2hpdGUgLWZvcmVncm91bmQgYmxhY2sgLWRhdGEgewojZGVmaW5lIGZpbGVfcXVlc3Rpb25fd2lkdGggMTQKI2RlZmluZSBmaWxlX3F1ZXN0aW9uX2hlaWdodCAxNQpzdGF0aWMgdW5zaWduZWQgY2hhciBmaWxlX3F1ZXN0aW9uX2JpdHNbXSA9IHsKICAgMHhmZSwgMHgwMSwgMHgwMiwgMHgwMiwgMHhlMiwgMHgwNCwgMHhmMiwgMHgwOSwgMHgxYSwgMHgxYiwgMHgwYSwgMHgxMywKICAgMHg4MiwgMHgxMSwgMHhjMiwgMHgxMCwgMHg2MiwgMHgxMCwgMHg2MiwgMHgxMCwgMHgwMiwgMHgxMCwgMHg2MiwgMHgxMCwKICAgMHg2MiwgMHgxMCwgMHgwMiwgMHgxMCwgMHhmZSwgMHgxZn07Cn0gLW1hc2tkYXRhICRmaWxlbWFzawoKaW1hZ2UgY3JlYXRlIGJpdG1hcCBmaWxlX3JlbW92ZWQgLWJhY2tncm91bmQgd2hpdGUgLWZvcmVncm91bmQgcmVkIC1kYXRhIHsKI2RlZmluZSBmaWxlX3JlbW92ZWRfd2lkdGggMTQKI2RlZmluZSBmaWxlX3JlbW92ZWRfaGVpZ2h0IDE1CnN0YXRpYyB1bnNpZ25lZCBjaGFyIGZpbGVfcmVtb3ZlZF9iaXRzW10gPSB7CiAgIDB4ZmUsIDB4MDEsIDB4MDIsIDB4MDMsIDB4MDIsIDB4MDUsIDB4MDIsIDB4MDksIDB4MDIsIDB4MWYsIDB4MDIsIDB4MTAsCiAgIDB4MWEsIDB4MTYsIDB4MzIsIDB4MTMsIDB4ZTIsIDB4MTEsIDB4YzIsIDB4MTAsIDB4ZTIsIDB4MTEsIDB4MzIsIDB4MTMsCiAgIDB4MWEsIDB4MTYsIDB4MDIsIDB4MTAsIDB4ZmUsIDB4MWZ9Owp9IC1tYXNrZGF0YSAkZmlsZW1hc2sKCmltYWdlIGNyZWF0ZSBiaXRtYXAgZmlsZV9tZXJnZSAtYmFja2dyb3VuZCB3aGl0ZSAtZm9yZWdyb3VuZCBibHVlIC1kYXRhIHsKI2RlZmluZSBmaWxlX21lcmdlX3dpZHRoIDE0CiNkZWZpbmUgZmlsZV9tZXJnZV9oZWlnaHQgMTUKc3RhdGljIHVuc2lnbmVkIGNoYXIgZmlsZV9tZXJnZV9iaXRzW10gPSB7CiAgIDB4ZmUsIDB4MDEsIDB4MDIsIDB4MDMsIDB4NjIsIDB4MDUsIDB4NjIsIDB4MDksIDB4NjIsIDB4MWYsIDB4NjIsIDB4MTAsCiAgIDB4ZmEsIDB4MTEsIDB4ZjIsIDB4MTAsIDB4NjIsIDB4MTAsIDB4MDIsIDB4MTAsIDB4ZmEsIDB4MTcsIDB4MDIsIDB4MTAsCiAgIDB4ZmEsIDB4MTcsIDB4MDIsIDB4MTAsIDB4ZmUsIDB4MWZ9Owp9IC1tYXNrZGF0YSAkZmlsZW1hc2sKCnNldCB1aV9pbmRleCAudnBhbmUuZmlsZXMuaW5kZXgubGlzdApzZXQgdWlfb3RoZXIgLnZwYW5lLmZpbGVzLm90aGVyLmxpc3QKc2V0IG1heF9zdGF0dXNfZGVzYyAwCmZvcmVhY2ggaSB7CgkJe19fIGkgcGxhaW4gICAgIlVubW9kaWZpZWQifQoJCXtfTSBpIG1vZCAgICAgICJNb2RpZmllZCJ9CgkJe01fIGkgZnVsbHRpY2sgIkNoZWNrZWQgaW4ifQoJCXtNTSBpIHBhcnR0aWNrICJQYXJ0aWFsbHkgaW5jbHVkZWQifQoKCQl7X08gbyBwbGFpbiAgICAiVW50cmFja2VkIn0KCQl7QV8gbyBmdWxsdGljayAiQWRkZWQifQoJCXtBTSBvIHBhcnR0aWNrICJQYXJ0aWFsbHkgYWRkZWQifQoJCXtBRCBvIHF1ZXN0aW9uICJBZGRlZCAoYnV0IG5vdyBnb25lKSJ9CgoJCXtfRCBpIHF1ZXN0aW9uICJNaXNzaW5nIn0KCQl7RF8gaSByZW1vdmVkICAiUmVtb3ZlZCJ9CgkJe0REIGkgcmVtb3ZlZCAgIlJlbW92ZWQifQoJCXtETyBpIHJlbW92ZWQgICJSZW1vdmVkIChzdGlsbCBleGlzdHMpIn0KCgkJe1VNIGkgbWVyZ2UgICAgIk1lcmdlIGNvbmZsaWN0cyJ9CgkJe1VfIGkgbWVyZ2UgICAgIk1lcmdlIGNvbmZsaWN0cyJ9Cgl9IHsKCWlmIHskbWF4X3N0YXR1c19kZXNjIDwgW3N0cmluZyBsZW5ndGggW2xpbmRleCAkaSAzXV19IHsKCQlzZXQgbWF4X3N0YXR1c19kZXNjIFtzdHJpbmcgbGVuZ3RoIFtsaW5kZXggJGkgM11dCgl9CglpZiB7W2xpbmRleCAkaSAxXSA9PSB7aX19IHsKCQlzZXQgYWxsX2NvbHMoW2xpbmRleCAkaSAwXSkgJHVpX2luZGV4Cgl9IGVsc2UgewoJCXNldCBhbGxfY29scyhbbGluZGV4ICRpIDBdKSAkdWlfb3RoZXIKCX0KCXNldCBhbGxfaWNvbnMoW2xpbmRleCAkaSAwXSkgZmlsZV9bbGluZGV4ICRpIDJdCglzZXQgYWxsX2Rlc2NzKFtsaW5kZXggJGkgMF0pIFtsaW5kZXggJGkgM10KfQp1bnNldCBmaWxlbWFzayBpCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjCiMjIHV0aWwKCnByb2MgaG9va19mYWlsZWRfcG9wdXAge2hvb2sgbXNnfSB7CglnbG9iYWwgZ2l0ZGlyIGZvbnRfdWkgZm9udF9kaWZmIGFwcG5hbWUKCglzZXQgdyAuaG9va2ZhaWwKCXRvcGxldmVsICR3Cgl3bSB0cmFuc2llbnQgJHcgLgoKCWZyYW1lICR3Lm0KCWxhYmVsICR3Lm0ubDEgLXRleHQgIiRob29rIGhvb2sgZmFpbGVkOiIgXAoJCS1hbmNob3IgdyBcCgkJLWp1c3RpZnkgbGVmdCBcCgkJLWZvbnQgW2NvbmNhdCAkZm9udF91aSBib2xkXQoJdGV4dCAkdy5tLnQgXAoJCS1iYWNrZ3JvdW5kIHdoaXRlIC1ib3JkZXJ3aWR0aCAxIFwKCQktcmVsaWVmIHN1bmtlbiBcCgkJLXdpZHRoIDgwIC1oZWlnaHQgMTAgXAoJCS1mb250ICRmb250X2RpZmYgXAoJCS15c2Nyb2xsY29tbWFuZCBbbGlzdCAkdy5tLnNieSBzZXRdCglsYWJlbCAkdy5tLmwyIFwKCQktdGV4dCB7WW91IG11c3QgY29ycmVjdCB0aGUgYWJvdmUgZXJyb3JzIGJlZm9yZSBjb21taXR0aW5nLn0gXAoJCS1hbmNob3IgdyBcCgkJLWp1c3RpZnkgbGVmdCBcCgkJLWZvbnQgW2NvbmNhdCAkZm9udF91aSBib2xkXQoJc2Nyb2xsYmFyICR3Lm0uc2J5IC1jb21tYW5kIFtsaXN0ICR3Lm0udCB5dmlld10KCXBhY2sgJHcubS5sMSAtc2lkZSB0b3AgLWZpbGwgeAoJcGFjayAkdy5tLmwyIC1zaWRlIGJvdHRvbSAtZmlsbCB4CglwYWNrICR3Lm0uc2J5IC1zaWRlIHJpZ2h0IC1maWxsIHkKCXBhY2sgJHcubS50IC1zaWRlIGxlZnQgLWZpbGwgYm90aCAtZXhwYW5kIDEKCXBhY2sgJHcubSAtc2lkZSB0b3AgLWZpbGwgYm90aCAtZXhwYW5kIDEgLXBhZHggNSAtcGFkeSAxMAoKCSR3Lm0udCBpbnNlcnQgMS4wICRtc2cKCSR3Lm0udCBjb25mIC1zdGF0ZSBkaXNhYmxlZAoKCWJ1dHRvbiAkdy5vayAtdGV4dCBPSyBcCgkJLXdpZHRoIDE1IFwKCQktZm9udCAkZm9udF91aSBcCgkJLWNvbW1hbmQgImRlc3Ryb3kgJHciCglwYWNrICR3Lm9rIC1zaWRlIGJvdHRvbQoKCWJpbmQgJHcgPFZpc2liaWxpdHk+ICJncmFiICR3OyBmb2N1cyAkdyIKCWJpbmQgJHcgPEtleS1SZXR1cm4+ICJkZXN0cm95ICR3IgoJd20gdGl0bGUgJHcgIiRhcHBuYW1lIChbbGluZGV4IFtmaWxlIHNwbGl0IFwKCQlbZmlsZSBub3JtYWxpemUgW2ZpbGUgZGlybmFtZSAkZ2l0ZGlyXV1dIFwKCQllbmRdKTogZXJyb3IiCgl0a3dhaXQgd2luZG93ICR3Cn0KCnNldCBuZXh0X2NvbnNvbGVfaWQgMAoKcHJvYyBuZXdfY29uc29sZSB7c2hvcnRfdGl0bGUgbG9uZ190aXRsZX0gewoJZ2xvYmFsIG5leHRfY29uc29sZV9pZCBjb25zb2xlX2RhdGEKCXNldCB3IC5jb25zb2xlW2luY3IgbmV4dF9jb25zb2xlX2lkXQoJc2V0IGNvbnNvbGVfZGF0YSgkdykgW2xpc3QgJHNob3J0X3RpdGxlICRsb25nX3RpdGxlXQoJcmV0dXJuIFtjb25zb2xlX2luaXQgJHddCn0KCnByb2MgY29uc29sZV9pbml0IHt3fSB7CglnbG9iYWwgY29uc29sZV9jciBjb25zb2xlX2RhdGEKCWdsb2JhbCBnaXRkaXIgYXBwbmFtZSBmb250X3VpIGZvbnRfZGlmZiBNMUIKCglzZXQgY29uc29sZV9jcigkdykgMS4wCgl0b3BsZXZlbCAkdwoJZnJhbWUgJHcubQoJbGFiZWwgJHcubS5sMSAtdGV4dCAiW2xpbmRleCAkY29uc29sZV9kYXRhKCR3KSAxXToiIFwKCQktYW5jaG9yIHcgXAoJCS1qdXN0aWZ5IGxlZnQgXAoJCS1mb250IFtjb25jYXQgJGZvbnRfdWkgYm9sZF0KCXRleHQgJHcubS50IFwKCQktYmFja2dyb3VuZCB3aGl0ZSAtYm9yZGVyd2lkdGggMSBcCgkJLXJlbGllZiBzdW5rZW4gXAoJCS13aWR0aCA4MCAtaGVpZ2h0IDEwIFwKCQktZm9udCAkZm9udF9kaWZmIFwKCQktc3RhdGUgZGlzYWJsZWQgXAoJCS15c2Nyb2xsY29tbWFuZCBbbGlzdCAkdy5tLnNieSBzZXRdCglsYWJlbCAkdy5tLnMgLWFuY2hvciB3IFwKCQktanVzdGlmeSBsZWZ0IFwKCQktZm9udCBbY29uY2F0ICRmb250X3VpIGJvbGRdCglzY3JvbGxiYXIgJHcubS5zYnkgLWNvbW1hbmQgW2xpc3QgJHcubS50IHl2aWV3XQoJcGFjayAkdy5tLmwxIC1zaWRlIHRvcCAtZmlsbCB4CglwYWNrICR3Lm0ucyAtc2lkZSBib3R0b20gLWZpbGwgeAoJcGFjayAkdy5tLnNieSAtc2lkZSByaWdodCAtZmlsbCB5CglwYWNrICR3Lm0udCAtc2lkZSBsZWZ0IC1maWxsIGJvdGggLWV4cGFuZCAxCglwYWNrICR3Lm0gLXNpZGUgdG9wIC1maWxsIGJvdGggLWV4cGFuZCAxIC1wYWR4IDUgLXBhZHkgMTAKCgltZW51ICR3LmN0eG0gLXRlYXJvZmYgMAoJJHcuY3R4bSBhZGQgY29tbWFuZCAtbGFiZWwgIkNvcHkiIFwKCQktZm9udCAkZm9udF91aSBcCgkJLWNvbW1hbmQgInRrX3RleHRDb3B5ICR3Lm0udCIKCSR3LmN0eG0gYWRkIGNvbW1hbmQgLWxhYmVsICJTZWxlY3QgQWxsIiBcCgkJLWZvbnQgJGZvbnRfdWkgXAoJCS1jb21tYW5kICIkdy5tLnQgdGFnIGFkZCBzZWwgMC4wIGVuZCIKCSR3LmN0eG0gYWRkIGNvbW1hbmQgLWxhYmVsICJDb3B5IEFsbCIgXAoJCS1mb250ICRmb250X3VpIFwKCQktY29tbWFuZCAiCgkJCSR3Lm0udCB0YWcgYWRkIHNlbCAwLjAgZW5kCgkJCXRrX3RleHRDb3B5ICR3Lm0udAoJCQkkdy5tLnQgdGFnIHJlbW92ZSBzZWwgMC4wIGVuZAoJCSIKCglidXR0b24gJHcub2sgLXRleHQge1J1bm5pbmcuLi59IFwKCQktd2lkdGggMTUgXAoJCS1mb250ICRmb250X3VpIFwKCQktc3RhdGUgZGlzYWJsZWQgXAoJCS1jb21tYW5kICJkZXN0cm95ICR3IgoJcGFjayAkdy5vayAtc2lkZSBib3R0b20KCgliaW5kICR3Lm0udCA8QW55LUJ1dHRvbi0zPiAidGtfcG9wdXAgJHcuY3R4bSAlWCAlWSIKCWJpbmQgJHcubS50IDwkTTFCLUtleS1hPiAiJHcubS50IHRhZyBhZGQgc2VsIDAuMCBlbmQ7YnJlYWsiCgliaW5kICR3Lm0udCA8JE0xQi1LZXktQT4gIiR3Lm0udCB0YWcgYWRkIHNlbCAwLjAgZW5kO2JyZWFrIgoJYmluZCAkdyA8VmlzaWJpbGl0eT4gImZvY3VzICR3IgoJd20gdGl0bGUgJHcgIiRhcHBuYW1lIChbbGluZGV4IFtmaWxlIHNwbGl0IFwKCQlbZmlsZSBub3JtYWxpemUgW2ZpbGUgZGlybmFtZSAkZ2l0ZGlyXV1dIFwKCQllbmRdKTogW2xpbmRleCAkY29uc29sZV9kYXRhKCR3KSAwXSIKCXJldHVybiAkdwp9Cgpwcm9jIGNvbnNvbGVfZXhlYyB7dyBjbWQge2FmdGVyIHt9fX0gewoJZ2xvYmFsIHRjbF9wbGF0Zm9ybQoKCSMgLS0gV2luZG93cyB0b3NzZXMgdGhlIGVudmlyb21lbnQgd2hlbiB3ZSBleGVjIG91ciBjaGlsZC4KCSMgICAgQnV0IG1vc3QgdXNlcnMgbmVlZCB0aGF0IHNvIHdlIGhhdmUgdG8gcmVsb2dpbi4gOi0oCgkjCglpZiB7JHRjbF9wbGF0Zm9ybShwbGF0Zm9ybSkgPT0ge3dpbmRvd3N9fSB7CgkJc2V0IGNtZCBbbGlzdCBzaCAtLWxvZ2luIC1jICJjZCBcIltwd2RdXCIgJiYgW2pvaW4gJGNtZCB7IH1dIl0KCX0KCgkjIC0tIFRjbCB3b24ndCBsZXQgdXMgcmVkaXJlY3QgYm90aCBzdGRvdXQgYW5kIHN0ZGVyciB0bwoJIyAgICB0aGUgc2FtZSBwaXBlLiAgU28gcGFzcyBpdCB0aHJvdWdoIGNhdC4uLgoJIwoJc2V0IGNtZCBbY29uY2F0IHwgJGNtZCB8JiBjYXRdCgoJc2V0IGZkX2YgW29wZW4gJGNtZCByXQoJZmNvbmZpZ3VyZSAkZmRfZiAtYmxvY2tpbmcgMCAtdHJhbnNsYXRpb24gYmluYXJ5CglmaWxlZXZlbnQgJGZkX2YgcmVhZGFibGUgW2xpc3QgY29uc29sZV9yZWFkICR3ICRmZF9mICRhZnRlcl0KfQoKcHJvYyBjb25zb2xlX3JlYWQge3cgZmQgYWZ0ZXJ9IHsKCWdsb2JhbCBjb25zb2xlX2NyIGNvbnNvbGVfZGF0YQoKCXNldCBidWYgW3JlYWQgJGZkXQoJaWYgeyRidWYgIT0ge319IHsKCQlpZiB7IVt3aW5mbyBleGlzdHMgJHddfSB7Y29uc29sZV9pbml0ICR3fQoJCSR3Lm0udCBjb25mIC1zdGF0ZSBub3JtYWwKCQlzZXQgYyAwCgkJc2V0IG4gW3N0cmluZyBsZW5ndGggJGJ1Zl0KCQl3aGlsZSB7JGMgPCAkbn0gewoJCQlzZXQgY3IgW3N0cmluZyBmaXJzdCAiXHIiICRidWYgJGNdCgkJCXNldCBsZiBbc3RyaW5nIGZpcnN0ICJcbiIgJGJ1ZiAkY10KCQkJaWYgeyRjciA8IDB9IHtzZXQgY3IgW2V4cHIgJG4gKyAxXX0KCQkJaWYgeyRsZiA8IDB9IHtzZXQgbGYgW2V4cHIgJG4gKyAxXX0KCgkJCWlmIHskbGYgPCAkY3J9IHsKCQkJCSR3Lm0udCBpbnNlcnQgZW5kIFtzdHJpbmcgcmFuZ2UgJGJ1ZiAkYyAkbGZdCgkJCQlzZXQgY29uc29sZV9jcigkdykgWyR3Lm0udCBpbmRleCB7ZW5kIC0xY31dCgkJCQlzZXQgYyAkbGYKCQkJCWluY3IgYwoJCQl9IGVsc2UgewoJCQkJJHcubS50IGRlbGV0ZSAkY29uc29sZV9jcigkdykgZW5kCgkJCQkkdy5tLnQgaW5zZXJ0IGVuZCAiXG4iCgkJCQkkdy5tLnQgaW5zZXJ0IGVuZCBbc3RyaW5nIHJhbmdlICRidWYgJGMgJGNyXQoJCQkJc2V0IGMgJGNyCgkJCQlpbmNyIGMKCQkJfQoJCX0KCQkkdy5tLnQgY29uZiAtc3RhdGUgZGlzYWJsZWQKCQkkdy5tLnQgc2VlIGVuZAoJfQoKCWZjb25maWd1cmUgJGZkIC1ibG9ja2luZyAxCglpZiB7W2VvZiAkZmRdfSB7CgkJaWYge1tjYXRjaCB7Y2xvc2UgJGZkfV19IHsKCQkJaWYgeyFbd2luZm8gZXhpc3RzICR3XX0ge2NvbnNvbGVfaW5pdCAkd30KCQkJJHcubS5zIGNvbmYgLWJhY2tncm91bmQgcmVkIC10ZXh0IHtFcnJvcjogQ29tbWFuZCBGYWlsZWR9CgkJCSR3Lm9rIGNvbmYgLXRleHQgQ2xvc2UKCQkJJHcub2sgY29uZiAtc3RhdGUgbm9ybWFsCgkJCXNldCBvayAwCgkJfSBlbHNlaWYge1t3aW5mbyBleGlzdHMgJHddfSB7CgkJCSR3Lm0ucyBjb25mIC1iYWNrZ3JvdW5kIGdyZWVuIC10ZXh0IHtTdWNjZXNzfQoJCQkkdy5vayBjb25mIC10ZXh0IENsb3NlCgkJCSR3Lm9rIGNvbmYgLXN0YXRlIG5vcm1hbAoJCQlzZXQgb2sgMQoJCX0KCQlhcnJheSB1bnNldCBjb25zb2xlX2NyICR3CgkJYXJyYXkgdW5zZXQgY29uc29sZV9kYXRhICR3CgkJaWYgeyRhZnRlciAhPSB7fX0gewoJCQl1cGxldmVsICMwICRhZnRlciAkb2sKCQl9CgkJcmV0dXJuCgl9CglmY29uZmlndXJlICRmZCAtYmxvY2tpbmcgMAp9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjCiMjIHVpIGNvbW1hbmRzCgpzZXQgc3RhcnRpbmdfZ2l0a19tc2cge1BsZWFzZSB3YWl0Li4uIFN0YXJ0aW5nIGdpdGsuLi59Cgpwcm9jIGRvX2dpdGsge30gewoJZ2xvYmFsIHRjbF9wbGF0Zm9ybSB1aV9zdGF0dXNfdmFsdWUgc3RhcnRpbmdfZ2l0a19tc2cKCglzZXQgdWlfc3RhdHVzX3ZhbHVlICRzdGFydGluZ19naXRrX21zZwoJYWZ0ZXIgMTAwMDAgewoJCWlmIHskdWlfc3RhdHVzX3ZhbHVlID09ICRzdGFydGluZ19naXRrX21zZ30gewoJCQlzZXQgdWlfc3RhdHVzX3ZhbHVlIHtSZWFkeS59CgkJfQoJfQoKCWlmIHskdGNsX3BsYXRmb3JtKHBsYXRmb3JtKSA9PSB7d2luZG93c319IHsKCQlleGVjIHNoIC1jIGdpdGsgJgoJfSBlbHNlIHsKCQlleGVjIGdpdGsgJgoJfQp9Cgpwcm9jIGRvX3JlcGFjayB7fSB7CglzZXQgdyBbbmV3X2NvbnNvbGUgInJlcGFjayIgIlJlcGFja2luZyB0aGUgb2JqZWN0IGRhdGFiYXNlIl0KCXNldCBjbWQgW2xpc3QgZ2l0IHJlcGFja10KCWxhcHBlbmQgY21kIC1hCglsYXBwZW5kIGNtZCAtZAoJY29uc29sZV9leGVjICR3ICRjbWQKfQoKc2V0IHF1aXR0aW5nIDAKCnByb2MgZG9fcXVpdCB7fSB7CglnbG9iYWwgZ2l0ZGlyIHVpX2NvbW0gcXVpdHRpbmcKCglpZiB7JHF1aXR0aW5nfSByZXR1cm4KCXNldCBxdWl0dGluZyAxCgoJc2V0IHNhdmUgW2ZpbGUgam9pbiAkZ2l0ZGlyIEdJVEdVSV9NU0ddCglzZXQgbXNnIFtzdHJpbmcgdHJpbSBbJHVpX2NvbW0gZ2V0IDAuMCBlbmRdXQoJaWYge1skdWlfY29tbSBlZGl0IG1vZGlmaWVkXSAmJiAkbXNnICE9IHt9fSB7CgkJY2F0Y2ggewoJCQlzZXQgZmQgW29wZW4gJHNhdmUgd10KCQkJcHV0cyAkZmQgW3N0cmluZyB0cmltIFskdWlfY29tbSBnZXQgMC4wIGVuZF1dCgkJCWNsb3NlICRmZAoJCX0KCX0gZWxzZWlmIHskbXNnID09IHt9ICYmIFtmaWxlIGV4aXN0cyAkc2F2ZV19IHsKCQlmaWxlIGRlbGV0ZSAkc2F2ZQoJfQoKCXNhdmVfbXlfY29uZmlnCglkZXN0cm95IC4KfQoKcHJvYyBkb19yZXNjYW4ge30gewoJdXBkYXRlX3N0YXR1cwp9Cgpwcm9jIGRvX2luY2x1ZGVfYWxsIHt9IHsKCWdsb2JhbCB1cGRhdGVfYWN0aXZlIHVpX3N0YXR1c192YWx1ZQoKCWlmIHskdXBkYXRlX2FjdGl2ZSB8fCAhW2xvY2tfaW5kZXggYmVnaW4tdXBkYXRlXX0gcmV0dXJuCgoJc2V0IHVwZGF0ZV9hY3RpdmUgMQoJc2V0IHVpX3N0YXR1c192YWx1ZSB7SW5jbHVkaW5nIGFsbCBtb2RpZmllZCBmaWxlcy4uLn0KCWFmdGVyIDEgewoJCXdpdGhfdXBkYXRlX2luZGV4IHsKCQkJZm9yZWFjaCBwYXRoIFthcnJheSBuYW1lcyBmaWxlX3N0YXRlc10gewoJCQkJc2V0IHMgJGZpbGVfc3RhdGVzKCRwYXRoKQoJCQkJc2V0IG0gW2xpbmRleCAkcyAwXQoJCQkJc3dpdGNoIC0tICRtIHsKCQkJCUFNIC0KCQkJCU1NIC0KCQkJCV9NIC0KCQkJCV9EIHt0b2dnbGVfbW9kZSAkcGF0aH0KCQkJCX0KCQkJfQoJCX0KCQlzZXQgdXBkYXRlX2FjdGl2ZSAwCgkJc2V0IHVpX3N0YXR1c192YWx1ZSB7UmVhZHkufQoJfQp9CgpzZXQgR0lUX0NPTU1JVFRFUl9JREVOVCB7fQoKcHJvYyBkb19zaWdub2ZmIHt9IHsKCWdsb2JhbCB1aV9jb21tIEdJVF9DT01NSVRURVJfSURFTlQKCglpZiB7JEdJVF9DT01NSVRURVJfSURFTlQgPT0ge319IHsKCQlpZiB7W2NhdGNoIHtzZXQgbWUgW2V4ZWMgZ2l0IHZhciBHSVRfQ09NTUlUVEVSX0lERU5UXX0gZXJyXX0gewoJCQllcnJvcl9wb3B1cCAiVW5hYmxlIHRvIG9idGFpbiB5b3VyIGlkZW50aXR5OlxuXG4kZXJyIgoJCQlyZXR1cm4KCQl9CgkJaWYgeyFbcmVnZXhwIHteKC4qKSBbMC05XSsgWy0rMC05XSskfSBcCgkJCSRtZSBtZSBHSVRfQ09NTUlUVEVSX0lERU5UXX0gewoJCQllcnJvcl9wb3B1cCAiSW52YWxpZCBHSVRfQ09NTUlUVEVSX0lERU5UOlxuXG4kbWUiCgkJCXJldHVybgoJCX0KCX0KCglzZXQgc29iICJTaWduZWQtb2ZmLWJ5OiAkR0lUX0NPTU1JVFRFUl9JREVOVCIKCXNldCBsYXN0IFskdWlfY29tbSBnZXQge2VuZCAtMWMgbGluZXN0YXJ0fSB7ZW5kIC0xY31dCglpZiB7JGxhc3QgIT0gJHNvYn0gewoJCSR1aV9jb21tIGVkaXQgc2VwYXJhdG9yCgkJaWYgeyRsYXN0ICE9IHt9CgkJCSYmICFbcmVnZXhwIHteW0EtWl1bQS1aYS16XSotW0EtWmEtei1dKzogKn0gJGxhc3RdfSB7CgkJCSR1aV9jb21tIGluc2VydCBlbmQgIlxuIgoJCX0KCQkkdWlfY29tbSBpbnNlcnQgZW5kICJcbiRzb2IiCgkJJHVpX2NvbW0gZWRpdCBzZXBhcmF0b3IKCQkkdWlfY29tbSBzZWUgZW5kCgl9Cn0KCnByb2MgZG9fYW1lbmRfbGFzdCB7fSB7Cglsb2FkX2xhc3RfY29tbWl0Cn0KCnByb2MgZG9fY29tbWl0IHt9IHsKCWNvbW1pdF90cmVlCn0KCiMgc2hpZnQgPT0gMTogbGVmdCBjbGljawojICAgICAgICAgIDM6IHJpZ2h0IGNsaWNrICAKcHJvYyBjbGljayB7dyB4IHkgc2hpZnQgd3ggd3l9IHsKCWdsb2JhbCB1aV9pbmRleCB1aV9vdGhlciBmaWxlX2xpc3RzCgoJc2V0IHBvcyBbc3BsaXQgWyR3IGluZGV4IEAkeCwkeV0gLl0KCXNldCBsbm8gW2xpbmRleCAkcG9zIDBdCglzZXQgY29sIFtsaW5kZXggJHBvcyAxXQoJc2V0IHBhdGggW2xpbmRleCAkZmlsZV9saXN0cygkdykgW2V4cHIgJGxubyAtIDFdXQoJaWYgeyRwYXRoID09IHt9fSByZXR1cm4KCglpZiB7JGNvbCA+IDAgJiYgJHNoaWZ0ID09IDF9IHsKCQlzaG93X2RpZmYgJHBhdGggJHcgJGxubwoJfQp9Cgpwcm9jIHVuY2xpY2sge3cgeCB5fSB7CglnbG9iYWwgZmlsZV9saXN0cwoKCXNldCBwb3MgW3NwbGl0IFskdyBpbmRleCBAJHgsJHldIC5dCglzZXQgbG5vIFtsaW5kZXggJHBvcyAwXQoJc2V0IGNvbCBbbGluZGV4ICRwb3MgMV0KCXNldCBwYXRoIFtsaW5kZXggJGZpbGVfbGlzdHMoJHcpIFtleHByICRsbm8gLSAxXV0KCWlmIHskcGF0aCA9PSB7fX0gcmV0dXJuCgoJaWYgeyRjb2wgPT0gMH0gewoJCXRvZ2dsZV9tb2RlICRwYXRoCgl9Cn0KCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMKIyMgdWkgaW5pdAoKc2V0IGZvbnRfdWkge0hlbHZldGljYSAxMH0Kc2V0IGZvbnRfZGlmZiB7Q291cmllciAxMH0Kc2V0IGN1cnNvcl9wdHIgbGVmdF9wdHIKCnN3aXRjaCAtZ2xvYiAtLSAiJHRjbF9wbGF0Zm9ybShwbGF0Zm9ybSksJHRjbF9wbGF0Zm9ybShvcykiIHsKd2luZG93cywqICAge3NldCBNMUIgQ29udHJvbDsgc2V0IE0xVCBDdHJsfQp1bml4LERhcndpbiB7c2V0IE0xQiBNMTsgc2V0IE0xVCBDbWR9CiogICAgICAgICAgIHtzZXQgTTFCIE0xOyBzZXQgTTFUIE0xfQp9CgojIC0tIE1lbnUgQmFyCm1lbnUgLm1iYXIgLXRlYXJvZmYgMAoubWJhciBhZGQgY2FzY2FkZSAtbGFiZWwgUHJvamVjdCAtbWVudSAubWJhci5wcm9qZWN0Ci5tYmFyIGFkZCBjYXNjYWRlIC1sYWJlbCBFZGl0IC1tZW51IC5tYmFyLmVkaXQKLm1iYXIgYWRkIGNhc2NhZGUgLWxhYmVsIENvbW1pdCAtbWVudSAubWJhci5jb21taXQKLm1iYXIgYWRkIGNhc2NhZGUgLWxhYmVsIEZldGNoIC1tZW51IC5tYmFyLmZldGNoCi5tYmFyIGFkZCBjYXNjYWRlIC1sYWJlbCBQdWxsIC1tZW51IC5tYmFyLnB1bGwKLm1iYXIgYWRkIGNhc2NhZGUgLWxhYmVsIFB1c2ggLW1lbnUgLm1iYXIucHVzaAoubWJhciBhZGQgY2FzY2FkZSAtbGFiZWwgT3B0aW9ucyAtbWVudSAubWJhci5vcHRpb25zCi4gY29uZmlndXJlIC1tZW51IC5tYmFyCgojIC0tIFByb2plY3QgTWVudQptZW51IC5tYmFyLnByb2plY3QKLm1iYXIucHJvamVjdCBhZGQgY29tbWFuZCAtbGFiZWwgVmlzdWFsaXplIFwKCS1jb21tYW5kIGRvX2dpdGsgXAoJLWZvbnQgJGZvbnRfdWkKLm1iYXIucHJvamVjdCBhZGQgY29tbWFuZCAtbGFiZWwge1JlcGFjayBEYXRhYmFzZX0gXAoJLWNvbW1hbmQgZG9fcmVwYWNrIFwKCS1mb250ICRmb250X3VpCi5tYmFyLnByb2plY3QgYWRkIGNvbW1hbmQgLWxhYmVsIFF1aXQgXAoJLWNvbW1hbmQgZG9fcXVpdCBcCgktYWNjZWxlcmF0b3IgJE0xVC1RIFwKCS1mb250ICRmb250X3VpCgojIC0tIEVkaXQgTWVudQojCm1lbnUgLm1iYXIuZWRpdAoubWJhci5lZGl0IGFkZCBjb21tYW5kIC1sYWJlbCBVbmRvIFwKCS1jb21tYW5kIHtjYXRjaCB7W2ZvY3VzXSBlZGl0IHVuZG99fSBcCgktYWNjZWxlcmF0b3IgJE0xVC1aIFwKCS1mb250ICRmb250X3VpCi5tYmFyLmVkaXQgYWRkIGNvbW1hbmQgLWxhYmVsIFJlZG8gXAoJLWNvbW1hbmQge2NhdGNoIHtbZm9jdXNdIGVkaXQgcmVkb319IFwKCS1hY2NlbGVyYXRvciAkTTFULVkgXAoJLWZvbnQgJGZvbnRfdWkKLm1iYXIuZWRpdCBhZGQgc2VwYXJhdG9yCi5tYmFyLmVkaXQgYWRkIGNvbW1hbmQgLWxhYmVsIEN1dCBcCgktY29tbWFuZCB7Y2F0Y2gge3RrX3RleHRDdXQgW2ZvY3VzXX19IFwKCS1hY2NlbGVyYXRvciAkTTFULVggXAoJLWZvbnQgJGZvbnRfdWkKLm1iYXIuZWRpdCBhZGQgY29tbWFuZCAtbGFiZWwgQ29weSBcCgktY29tbWFuZCB7Y2F0Y2gge3RrX3RleHRDb3B5IFtmb2N1c119fSBcCgktYWNjZWxlcmF0b3IgJE0xVC1DIFwKCS1mb250ICRmb250X3VpCi5tYmFyLmVkaXQgYWRkIGNvbW1hbmQgLWxhYmVsIFBhc3RlIFwKCS1jb21tYW5kIHtjYXRjaCB7dGtfdGV4dFBhc3RlIFtmb2N1c107IFtmb2N1c10gc2VlIGluc2VydH19IFwKCS1hY2NlbGVyYXRvciAkTTFULVYgXAoJLWZvbnQgJGZvbnRfdWkKLm1iYXIuZWRpdCBhZGQgY29tbWFuZCAtbGFiZWwgRGVsZXRlIFwKCS1jb21tYW5kIHtjYXRjaCB7W2ZvY3VzXSBkZWxldGUgc2VsLmZpcnN0IHNlbC5sYXN0fX0gXAoJLWFjY2VsZXJhdG9yIERlbCBcCgktZm9udCAkZm9udF91aQoubWJhci5lZGl0IGFkZCBzZXBhcmF0b3IKLm1iYXIuZWRpdCBhZGQgY29tbWFuZCAtbGFiZWwge1NlbGVjdCBBbGx9IFwKCS1jb21tYW5kIHtjYXRjaCB7W2ZvY3VzXSB0YWcgYWRkIHNlbCAwLjAgZW5kfX0gXAoJLWFjY2VsZXJhdG9yICRNMVQtQSBcCgktZm9udCAkZm9udF91aQoKIyAtLSBDb21taXQgTWVudQptZW51IC5tYmFyLmNvbW1pdAoubWJhci5jb21taXQgYWRkIGNvbW1hbmQgLWxhYmVsIFJlc2NhbiBcCgktY29tbWFuZCBkb19yZXNjYW4gXAoJLWFjY2VsZXJhdG9yIEY1IFwKCS1mb250ICRmb250X3VpCmxhcHBlbmQgZGlzYWJsZV9vbl9sb2NrIFwKCVtsaXN0IC5tYmFyLmNvbW1pdCBlbnRyeWNvbmYgWy5tYmFyLmNvbW1pdCBpbmRleCBsYXN0XSAtc3RhdGVdCi5tYmFyLmNvbW1pdCBhZGQgY29tbWFuZCAtbGFiZWwge0FtZW5kIExhc3QgQ29tbWl0fSBcCgktY29tbWFuZCBkb19hbWVuZF9sYXN0IFwKCS1mb250ICRmb250X3VpCmxhcHBlbmQgZGlzYWJsZV9vbl9sb2NrIFwKCVtsaXN0IC5tYmFyLmNvbW1pdCBlbnRyeWNvbmYgWy5tYmFyLmNvbW1pdCBpbmRleCBsYXN0XSAtc3RhdGVdCi5tYmFyLmNvbW1pdCBhZGQgY29tbWFuZCAtbGFiZWwge0luY2x1ZGUgQWxsIEZpbGVzfSBcCgktY29tbWFuZCBkb19pbmNsdWRlX2FsbCBcCgktYWNjZWxlcmF0b3IgJE0xVC1JIFwKCS1mb250ICRmb250X3VpCmxhcHBlbmQgZGlzYWJsZV9vbl9sb2NrIFwKCVtsaXN0IC5tYmFyLmNvbW1pdCBlbnRyeWNvbmYgWy5tYmFyLmNvbW1pdCBpbmRleCBsYXN0XSAtc3RhdGVdCi5tYmFyLmNvbW1pdCBhZGQgY29tbWFuZCAtbGFiZWwge1NpZ24gT2ZmfSBcCgktY29tbWFuZCBkb19zaWdub2ZmIFwKCS1hY2NlbGVyYXRvciAkTTFULVMgXAoJLWZvbnQgJGZvbnRfdWkKLm1iYXIuY29tbWl0IGFkZCBjb21tYW5kIC1sYWJlbCBDb21taXQgXAoJLWNvbW1hbmQgZG9fY29tbWl0IFwKCS1hY2NlbGVyYXRvciAkTTFULVJldHVybiBcCgktZm9udCAkZm9udF91aQpsYXBwZW5kIGRpc2FibGVfb25fbG9jayBcCglbbGlzdCAubWJhci5jb21taXQgZW50cnljb25mIFsubWJhci5jb21taXQgaW5kZXggbGFzdF0gLXN0YXRlXQoKIyAtLSBGZXRjaCBNZW51Cm1lbnUgLm1iYXIuZmV0Y2gKCiMgLS0gUHVsbCBNZW51Cm1lbnUgLm1iYXIucHVsbAoKIyAtLSBQdXNoIE1lbnUKbWVudSAubWJhci5wdXNoCgojIC0tIE9wdGlvbnMgTWVudQptZW51IC5tYmFyLm9wdGlvbnMKLm1iYXIub3B0aW9ucyBhZGQgY2hlY2tidXR0b24gXAoJLWxhYmVsIHtUcnVzdCBGaWxlIE1vZGlmaWNhdGlvbiBUaW1lc3RhbXBzfSBcCgktZm9udCAkZm9udF91aSBcCgktb2ZmdmFsdWUgZmFsc2UgXAoJLW9udmFsdWUgdHJ1ZSBcCgktdmFyaWFibGUgY2ZnX3RydXN0X210aW1lCgojIC0tIE1haW4gV2luZG93IExheW91dApwYW5lZHdpbmRvdyAudnBhbmUgLW9yaWVudCB2ZXJ0aWNhbApwYW5lZHdpbmRvdyAudnBhbmUuZmlsZXMgLW9yaWVudCBob3Jpem9udGFsCi52cGFuZSBhZGQgLnZwYW5lLmZpbGVzIC1zdGlja3kgbnNldyAtaGVpZ2h0IDEwMCAtd2lkdGggNDAwCnBhY2sgLnZwYW5lIC1hbmNob3IgbiAtc2lkZSB0b3AgLWZpbGwgYm90aCAtZXhwYW5kIDEKCiMgLS0gSW5kZXggRmlsZSBMaXN0CmZyYW1lIC52cGFuZS5maWxlcy5pbmRleCAtaGVpZ2h0IDEwMCAtd2lkdGggNDAwCmxhYmVsIC52cGFuZS5maWxlcy5pbmRleC50aXRsZSAtdGV4dCB7TW9kaWZpZWQgRmlsZXN9IFwKCS1iYWNrZ3JvdW5kIGdyZWVuIFwKCS1mb250ICRmb250X3VpCnRleHQgJHVpX2luZGV4IC1iYWNrZ3JvdW5kIHdoaXRlIC1ib3JkZXJ3aWR0aCAwIFwKCS13aWR0aCA0MCAtaGVpZ2h0IDEwIFwKCS1mb250ICRmb250X3VpIFwKCS1jdXJzb3IgJGN1cnNvcl9wdHIgXAoJLXlzY3JvbGxjb21tYW5kIHsudnBhbmUuZmlsZXMuaW5kZXguc2Igc2V0fSBcCgktc3RhdGUgZGlzYWJsZWQKc2Nyb2xsYmFyIC52cGFuZS5maWxlcy5pbmRleC5zYiAtY29tbWFuZCBbbGlzdCAkdWlfaW5kZXggeXZpZXddCnBhY2sgLnZwYW5lLmZpbGVzLmluZGV4LnRpdGxlIC1zaWRlIHRvcCAtZmlsbCB4CnBhY2sgLnZwYW5lLmZpbGVzLmluZGV4LnNiIC1zaWRlIHJpZ2h0IC1maWxsIHkKcGFjayAkdWlfaW5kZXggLXNpZGUgbGVmdCAtZmlsbCBib3RoIC1leHBhbmQgMQoudnBhbmUuZmlsZXMgYWRkIC52cGFuZS5maWxlcy5pbmRleCAtc3RpY2t5IG5zZXcKCiMgLS0gT3RoZXIgKEFkZCkgRmlsZSBMaXN0CmZyYW1lIC52cGFuZS5maWxlcy5vdGhlciAtaGVpZ2h0IDEwMCAtd2lkdGggMTAwCmxhYmVsIC52cGFuZS5maWxlcy5vdGhlci50aXRsZSAtdGV4dCB7VW50cmFja2VkIEZpbGVzfSBcCgktYmFja2dyb3VuZCByZWQgXAoJLWZvbnQgJGZvbnRfdWkKdGV4dCAkdWlfb3RoZXIgLWJhY2tncm91bmQgd2hpdGUgLWJvcmRlcndpZHRoIDAgXAoJLXdpZHRoIDQwIC1oZWlnaHQgMTAgXAoJLWZvbnQgJGZvbnRfdWkgXAoJLWN1cnNvciAkY3Vyc29yX3B0ciBcCgkteXNjcm9sbGNvbW1hbmQgey52cGFuZS5maWxlcy5vdGhlci5zYiBzZXR9IFwKCS1zdGF0ZSBkaXNhYmxlZApzY3JvbGxiYXIgLnZwYW5lLmZpbGVzLm90aGVyLnNiIC1jb21tYW5kIFtsaXN0ICR1aV9vdGhlciB5dmlld10KcGFjayAudnBhbmUuZmlsZXMub3RoZXIudGl0bGUgLXNpZGUgdG9wIC1maWxsIHgKcGFjayAudnBhbmUuZmlsZXMub3RoZXIuc2IgLXNpZGUgcmlnaHQgLWZpbGwgeQpwYWNrICR1aV9vdGhlciAtc2lkZSBsZWZ0IC1maWxsIGJvdGggLWV4cGFuZCAxCi52cGFuZS5maWxlcyBhZGQgLnZwYW5lLmZpbGVzLm90aGVyIC1zdGlja3kgbnNldwoKJHVpX2luZGV4IHRhZyBjb25mIGluX2RpZmYgLWZvbnQgW2NvbmNhdCAkZm9udF91aSBib2xkXQokdWlfb3RoZXIgdGFnIGNvbmYgaW5fZGlmZiAtZm9udCBbY29uY2F0ICRmb250X3VpIGJvbGRdCgojIC0tIERpZmYgYW5kIENvbW1pdCBBcmVhCmZyYW1lIC52cGFuZS5sb3dlciAtaGVpZ2h0IDQwMCAtd2lkdGggNDAwCmZyYW1lIC52cGFuZS5sb3dlci5jb21tYXJlYQpmcmFtZSAudnBhbmUubG93ZXIuZGlmZiAtcmVsaWVmIHN1bmtlbiAtYm9yZGVyd2lkdGggMQpwYWNrIC52cGFuZS5sb3dlci5jb21tYXJlYSAtc2lkZSB0b3AgLWZpbGwgeApwYWNrIC52cGFuZS5sb3dlci5kaWZmIC1zaWRlIGJvdHRvbSAtZmlsbCBib3RoIC1leHBhbmQgMQoudnBhbmUgYWRkIC52cGFuZS5sb3dlciAtc3RpY2sgbnNldwoKIyAtLSBDb21taXQgQXJlYSBCdXR0b25zCmZyYW1lIC52cGFuZS5sb3dlci5jb21tYXJlYS5idXR0b25zCmxhYmVsIC52cGFuZS5sb3dlci5jb21tYXJlYS5idXR0b25zLmwgLXRleHQge30gXAoJLWFuY2hvciB3IFwKCS1qdXN0aWZ5IGxlZnQgXAoJLWZvbnQgJGZvbnRfdWkKcGFjayAudnBhbmUubG93ZXIuY29tbWFyZWEuYnV0dG9ucy5sIC1zaWRlIHRvcCAtZmlsbCB4CnBhY2sgLnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1dHRvbnMgLXNpZGUgbGVmdCAtZmlsbCB5CgpidXR0b24gLnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1dHRvbnMucmVzY2FuIC10ZXh0IHtSZXNjYW59IFwKCS1jb21tYW5kIGRvX3Jlc2NhbiBcCgktZm9udCAkZm9udF91aQpwYWNrIC52cGFuZS5sb3dlci5jb21tYXJlYS5idXR0b25zLnJlc2NhbiAtc2lkZSB0b3AgLWZpbGwgeApsYXBwZW5kIGRpc2FibGVfb25fbG9jayBcCgl7LnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1dHRvbnMucmVzY2FuIGNvbmYgLXN0YXRlfQoKYnV0dG9uIC52cGFuZS5sb3dlci5jb21tYXJlYS5idXR0b25zLmFtZW5kIC10ZXh0IHtBbWVuZCBMYXN0fSBcCgktY29tbWFuZCBkb19hbWVuZF9sYXN0IFwKCS1mb250ICRmb250X3VpCnBhY2sgLnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1dHRvbnMuYW1lbmQgLXNpZGUgdG9wIC1maWxsIHgKbGFwcGVuZCBkaXNhYmxlX29uX2xvY2sgXAoJey52cGFuZS5sb3dlci5jb21tYXJlYS5idXR0b25zLmFtZW5kIGNvbmYgLXN0YXRlfQoKYnV0dG9uIC52cGFuZS5sb3dlci5jb21tYXJlYS5idXR0b25zLmluY2FsbCAtdGV4dCB7SW5jbHVkZSBBbGx9IFwKCS1jb21tYW5kIGRvX2luY2x1ZGVfYWxsIFwKCS1mb250ICRmb250X3VpCnBhY2sgLnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1dHRvbnMuaW5jYWxsIC1zaWRlIHRvcCAtZmlsbCB4CmxhcHBlbmQgZGlzYWJsZV9vbl9sb2NrIFwKCXsudnBhbmUubG93ZXIuY29tbWFyZWEuYnV0dG9ucy5pbmNhbGwgY29uZiAtc3RhdGV9CgpidXR0b24gLnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1dHRvbnMuc2lnbm9mZiAtdGV4dCB7U2lnbiBPZmZ9IFwKCS1jb21tYW5kIGRvX3NpZ25vZmYgXAoJLWZvbnQgJGZvbnRfdWkKcGFjayAudnBhbmUubG93ZXIuY29tbWFyZWEuYnV0dG9ucy5zaWdub2ZmIC1zaWRlIHRvcCAtZmlsbCB4CgpidXR0b24gLnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1dHRvbnMuY29tbWl0IC10ZXh0IHtDb21taXR9IFwKCS1jb21tYW5kIGRvX2NvbW1pdCBcCgktZm9udCAkZm9udF91aQpwYWNrIC52cGFuZS5sb3dlci5jb21tYXJlYS5idXR0b25zLmNvbW1pdCAtc2lkZSB0b3AgLWZpbGwgeApsYXBwZW5kIGRpc2FibGVfb25fbG9jayBcCgl7LnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1dHRvbnMuY29tbWl0IGNvbmYgLXN0YXRlfQoKIyAtLSBDb21taXQgTWVzc2FnZSBCdWZmZXIKZnJhbWUgLnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1ZmZlcgpzZXQgdWlfY29tbSAudnBhbmUubG93ZXIuY29tbWFyZWEuYnVmZmVyLnQKc2V0IHVpX2NvbWwgLnZwYW5lLmxvd2VyLmNvbW1hcmVhLmJ1ZmZlci5sCmxhYmVsICR1aV9jb21sIC10ZXh0IHtDb21taXQgTWVzc2FnZTp9IFwKCS1hbmNob3IgdyBcCgktanVzdGlmeSBsZWZ0IFwKCS1mb250ICRmb250X3VpCnRyYWNlIGFkZCB2YXJpYWJsZSBjb21taXRfdHlwZSB3cml0ZSB7dXBsZXZlbCAjMCB7Cglzd2l0Y2ggLWdsb2IgJGNvbW1pdF90eXBlIFwKCWluaXRpYWwgeyR1aV9jb21sIGNvbmYgLXRleHQge0luaXRpYWwgQ29tbWl0IE1lc3NhZ2U6fX0gXAoJYW1lbmQgICB7JHVpX2NvbWwgY29uZiAtdGV4dCB7QW1lbmRlZCBDb21taXQgTWVzc2FnZTp9fSBcCgltZXJnZSAgIHskdWlfY29tbCBjb25mIC10ZXh0IHtNZXJnZSBDb21taXQgTWVzc2FnZTp9fSBcCgkqICAgICAgIHskdWlfY29tbCBjb25mIC10ZXh0IHtDb21taXQgTWVzc2FnZTp9fQp9fQp0ZXh0ICR1aV9jb21tIC1iYWNrZ3JvdW5kIHdoaXRlIC1ib3JkZXJ3aWR0aCAxIFwKCS11bmRvIHRydWUgXAoJLW1heHVuZG8gMjAgXAoJLWF1dG9zZXBhcmF0b3JzIHRydWUgXAoJLXJlbGllZiBzdW5rZW4gXAoJLXdpZHRoIDc1IC1oZWlnaHQgOSAtd3JhcCBub25lIFwKCS1mb250ICRmb250X2RpZmYgXAoJLXlzY3JvbGxjb21tYW5kIHsudnBhbmUubG93ZXIuY29tbWFyZWEuYnVmZmVyLnNieSBzZXR9CnNjcm9sbGJhciAudnBhbmUubG93ZXIuY29tbWFyZWEuYnVmZmVyLnNieSBcCgktY29tbWFuZCBbbGlzdCAkdWlfY29tbSB5dmlld10KcGFjayAkdWlfY29tbCAtc2lkZSB0b3AgLWZpbGwgeApwYWNrIC52cGFuZS5sb3dlci5jb21tYXJlYS5idWZmZXIuc2J5IC1zaWRlIHJpZ2h0IC1maWxsIHkKcGFjayAkdWlfY29tbSAtc2lkZSBsZWZ0IC1maWxsIHkKcGFjayAudnBhbmUubG93ZXIuY29tbWFyZWEuYnVmZmVyIC1zaWRlIGxlZnQgLWZpbGwgeQoKIyAtLSBDb21taXQgTWVzc2FnZSBCdWZmZXIgQ29udGV4dCBNZW51CiMKbWVudSAkdWlfY29tbS5jdHhtIC10ZWFyb2ZmIDAKJHVpX2NvbW0uY3R4bSBhZGQgY29tbWFuZCAtbGFiZWwgIkN1dCIgXAoJLWZvbnQgJGZvbnRfdWkgXAoJLWNvbW1hbmQgInRrX3RleHRDdXQgJHVpX2NvbW0iCiR1aV9jb21tLmN0eG0gYWRkIGNvbW1hbmQgLWxhYmVsICJDb3B5IiBcCgktZm9udCAkZm9udF91aSBcCgktY29tbWFuZCAidGtfdGV4dENvcHkgJHVpX2NvbW0iCiR1aV9jb21tLmN0eG0gYWRkIGNvbW1hbmQgLWxhYmVsICJQYXN0ZSIgXAoJLWZvbnQgJGZvbnRfdWkgXAoJLWNvbW1hbmQgInRrX3RleHRQYXN0ZSAkdWlfY29tbSIKJHVpX2NvbW0uY3R4bSBhZGQgY29tbWFuZCAtbGFiZWwgIkRlbGV0ZSIgXAoJLWZvbnQgJGZvbnRfdWkgXAoJLWNvbW1hbmQgIiR1aV9jb21tIGRlbGV0ZSBzZWwuZmlyc3Qgc2VsLmxhc3QiCiR1aV9jb21tLmN0eG0gYWRkIHNlcGFyYXRvcgokdWlfY29tbS5jdHhtIGFkZCBjb21tYW5kIC1sYWJlbCAiU2VsZWN0IEFsbCIgXAoJLWZvbnQgJGZvbnRfdWkgXAoJLWNvbW1hbmQgIiR1aV9jb21tIHRhZyBhZGQgc2VsIDAuMCBlbmQiCiR1aV9jb21tLmN0eG0gYWRkIGNvbW1hbmQgLWxhYmVsICJDb3B5IEFsbCIgXAoJLWZvbnQgJGZvbnRfdWkgXAoJLWNvbW1hbmQgIgoJCSR1aV9jb21tIHRhZyBhZGQgc2VsIDAuMCBlbmQKCQl0a190ZXh0Q29weSAkdWlfY29tbQoJCSR1aV9jb21tIHRhZyByZW1vdmUgc2VsIDAuMCBlbmQKCSIKJHVpX2NvbW0uY3R4bSBhZGQgc2VwYXJhdG9yCiR1aV9jb21tLmN0eG0gYWRkIGNvbW1hbmQgLWxhYmVsICJTaWduIE9mZiIgXAoJLWZvbnQgJGZvbnRfdWkgXAoJLWNvbW1hbmQgZG9fc2lnbm9mZgpiaW5kICR1aV9jb21tIDxBbnktQnV0dG9uLTM+ICJ0a19wb3B1cCAkdWlfY29tbS5jdHhtICVYICVZIgoKIyAtLSBEaWZmIEhlYWRlcgpzZXQgdWlfZm5hbWVfdmFsdWUge30Kc2V0IHVpX2ZzdGF0dXNfdmFsdWUge30KZnJhbWUgLnZwYW5lLmxvd2VyLmRpZmYuaGVhZGVyIC1iYWNrZ3JvdW5kIG9yYW5nZQpsYWJlbCAudnBhbmUubG93ZXIuZGlmZi5oZWFkZXIubDEgLXRleHQge0ZpbGU6fSBcCgktYmFja2dyb3VuZCBvcmFuZ2UgXAoJLWZvbnQgJGZvbnRfdWkKbGFiZWwgLnZwYW5lLmxvd2VyLmRpZmYuaGVhZGVyLmwyIC10ZXh0dmFyaWFibGUgdWlfZm5hbWVfdmFsdWUgXAoJLWJhY2tncm91bmQgb3JhbmdlIFwKCS1hbmNob3IgdyBcCgktanVzdGlmeSBsZWZ0IFwKCS1mb250ICRmb250X3VpCmxhYmVsIC52cGFuZS5sb3dlci5kaWZmLmhlYWRlci5sMyAtdGV4dCB7U3RhdHVzOn0gXAoJLWJhY2tncm91bmQgb3JhbmdlIFwKCS1mb250ICRmb250X3VpCmxhYmVsIC52cGFuZS5sb3dlci5kaWZmLmhlYWRlci5sNCAtdGV4dHZhcmlhYmxlIHVpX2ZzdGF0dXNfdmFsdWUgXAoJLWJhY2tncm91bmQgb3JhbmdlIFwKCS13aWR0aCAkbWF4X3N0YXR1c19kZXNjIFwKCS1hbmNob3IgdyBcCgktanVzdGlmeSBsZWZ0IFwKCS1mb250ICRmb250X3VpCnBhY2sgLnZwYW5lLmxvd2VyLmRpZmYuaGVhZGVyLmwxIC1zaWRlIGxlZnQKcGFjayAudnBhbmUubG93ZXIuZGlmZi5oZWFkZXIubDIgLXNpZGUgbGVmdCAtZmlsbCB4CnBhY2sgLnZwYW5lLmxvd2VyLmRpZmYuaGVhZGVyLmw0IC1zaWRlIHJpZ2h0CnBhY2sgLnZwYW5lLmxvd2VyLmRpZmYuaGVhZGVyLmwzIC1zaWRlIHJpZ2h0CgojIC0tIERpZmYgQm9keQpmcmFtZSAudnBhbmUubG93ZXIuZGlmZi5ib2R5CnNldCB1aV9kaWZmIC52cGFuZS5sb3dlci5kaWZmLmJvZHkudAp0ZXh0ICR1aV9kaWZmIC1iYWNrZ3JvdW5kIHdoaXRlIC1ib3JkZXJ3aWR0aCAwIFwKCS13aWR0aCA4MCAtaGVpZ2h0IDE1IC13cmFwIG5vbmUgXAoJLWZvbnQgJGZvbnRfZGlmZiBcCgkteHNjcm9sbGNvbW1hbmQgey52cGFuZS5sb3dlci5kaWZmLmJvZHkuc2J4IHNldH0gXAoJLXlzY3JvbGxjb21tYW5kIHsudnBhbmUubG93ZXIuZGlmZi5ib2R5LnNieSBzZXR9IFwKCS1zdGF0ZSBkaXNhYmxlZApzY3JvbGxiYXIgLnZwYW5lLmxvd2VyLmRpZmYuYm9keS5zYnggLW9yaWVudCBob3Jpem9udGFsIFwKCS1jb21tYW5kIFtsaXN0ICR1aV9kaWZmIHh2aWV3XQpzY3JvbGxiYXIgLnZwYW5lLmxvd2VyLmRpZmYuYm9keS5zYnkgLW9yaWVudCB2ZXJ0aWNhbCBcCgktY29tbWFuZCBbbGlzdCAkdWlfZGlmZiB5dmlld10KcGFjayAudnBhbmUubG93ZXIuZGlmZi5ib2R5LnNieCAtc2lkZSBib3R0b20gLWZpbGwgeApwYWNrIC52cGFuZS5sb3dlci5kaWZmLmJvZHkuc2J5IC1zaWRlIHJpZ2h0IC1maWxsIHkKcGFjayAkdWlfZGlmZiAtc2lkZSBsZWZ0IC1maWxsIGJvdGggLWV4cGFuZCAxCnBhY2sgLnZwYW5lLmxvd2VyLmRpZmYuaGVhZGVyIC1zaWRlIHRvcCAtZmlsbCB4CnBhY2sgLnZwYW5lLmxvd2VyLmRpZmYuYm9keSAtc2lkZSBib3R0b20gLWZpbGwgYm90aCAtZXhwYW5kIDEKCiR1aV9kaWZmIHRhZyBjb25mIGRtIC1mb3JlZ3JvdW5kIHJlZAokdWlfZGlmZiB0YWcgY29uZiBkcCAtZm9yZWdyb3VuZCBibHVlCiR1aV9kaWZmIHRhZyBjb25mIGRhIC1mb250IFtjb25jYXQgJGZvbnRfZGlmZiBib2xkXQokdWlfZGlmZiB0YWcgY29uZiBkaSAtZm9yZWdyb3VuZCAiIzAwYTAwMCIKJHVpX2RpZmYgdGFnIGNvbmYgZG5pIC1mb3JlZ3JvdW5kICIjYTAwMGEwIgokdWlfZGlmZiB0YWcgY29uZiBib2xkIC1mb250IFtjb25jYXQgJGZvbnRfZGlmZiBib2xkXQoKIyAtLSBEaWZmIEJvZHkgQ29udGV4dCBNZW51CiMKbWVudSAkdWlfZGlmZi5jdHhtIC10ZWFyb2ZmIDAKJHVpX2RpZmYuY3R4bSBhZGQgY29tbWFuZCAtbGFiZWwgIkNvcHkiIFwKCS1mb250ICRmb250X3VpIFwKCS1jb21tYW5kICJ0a190ZXh0Q29weSAkdWlfZGlmZiIKJHVpX2RpZmYuY3R4bSBhZGQgY29tbWFuZCAtbGFiZWwgIlNlbGVjdCBBbGwiIFwKCS1mb250ICRmb250X3VpIFwKCS1jb21tYW5kICIkdWlfZGlmZiB0YWcgYWRkIHNlbCAwLjAgZW5kIgokdWlfZGlmZi5jdHhtIGFkZCBjb21tYW5kIC1sYWJlbCAiQ29weSBBbGwiIFwKCS1mb250ICRmb250X3VpIFwKCS1jb21tYW5kICIKCQkkdWlfZGlmZiB0YWcgYWRkIHNlbCAwLjAgZW5kCgkJdGtfdGV4dENvcHkgJHVpX2RpZmYKCQkkdWlfZGlmZiB0YWcgcmVtb3ZlIHNlbCAwLjAgZW5kCgkiCmJpbmQgJHVpX2RpZmYgPEFueS1CdXR0b24tMz4gInRrX3BvcHVwICR1aV9kaWZmLmN0eG0gJVggJVkiCgojIC0tIFN0YXR1cyBCYXIKc2V0IHVpX3N0YXR1c192YWx1ZSB7SW5pdGlhbGl6aW5nLi4ufQpsYWJlbCAuc3RhdHVzIC10ZXh0dmFyaWFibGUgdWlfc3RhdHVzX3ZhbHVlIFwKCS1hbmNob3IgdyBcCgktanVzdGlmeSBsZWZ0IFwKCS1ib3JkZXJ3aWR0aCAxIFwKCS1yZWxpZWYgc3Vua2VuIFwKCS1mb250ICRmb250X3VpCnBhY2sgLnN0YXR1cyAtYW5jaG9yIHcgLXNpZGUgYm90dG9tIC1maWxsIHgKCiMgLS0gTG9hZCBnZW9tZXRyeQpjYXRjaCB7CnNldCBnbSBbbGluZGV4ICRyZXBvX2NvbmZpZyhndWkuZ2VvbWV0cnkpIDBdCndtIGdlb21ldHJ5IC4gW2xpbmRleCAkZ20gMF0KLnZwYW5lIHNhc2ggcGxhY2UgMCBcCglbbGluZGV4IFsudnBhbmUgc2FzaCBjb29yZCAwXSAwXSBcCglbbGluZGV4ICRnbSAxXQoudnBhbmUuZmlsZXMgc2FzaCBwbGFjZSAwIFwKCVtsaW5kZXggJGdtIDJdIFwKCVtsaW5kZXggWy52cGFuZS5maWxlcyBzYXNoIGNvb3JkIDBdIDFdCnVuc2V0IGdtCn0KCiMgLS0gS2V5IEJpbmRpbmdzCmJpbmQgJHVpX2NvbW0gPCRNMUItS2V5LVJldHVybj4ge2RvX2NvbW1pdDticmVha30KYmluZCAkdWlfY29tbSA8JE0xQi1LZXktaT4ge2RvX2luY2x1ZGVfYWxsO2JyZWFrfQpiaW5kICR1aV9jb21tIDwkTTFCLUtleS1JPiB7ZG9faW5jbHVkZV9hbGw7YnJlYWt9CmJpbmQgJHVpX2NvbW0gPCRNMUItS2V5LXg+IHt0a190ZXh0Q3V0ICVXO2JyZWFrfQpiaW5kICR1aV9jb21tIDwkTTFCLUtleS1YPiB7dGtfdGV4dEN1dCAlVzticmVha30KYmluZCAkdWlfY29tbSA8JE0xQi1LZXktYz4ge3RrX3RleHRDb3B5ICVXO2JyZWFrfQpiaW5kICR1aV9jb21tIDwkTTFCLUtleS1DPiB7dGtfdGV4dENvcHkgJVc7YnJlYWt9CmJpbmQgJHVpX2NvbW0gPCRNMUItS2V5LXY+IHt0a190ZXh0UGFzdGUgJVc7ICVXIHNlZSBpbnNlcnQ7IGJyZWFrfQpiaW5kICR1aV9jb21tIDwkTTFCLUtleS1WPiB7dGtfdGV4dFBhc3RlICVXOyAlVyBzZWUgaW5zZXJ0OyBicmVha30KYmluZCAkdWlfY29tbSA8JE0xQi1LZXktYT4geyVXIHRhZyBhZGQgc2VsIDAuMCBlbmQ7YnJlYWt9CmJpbmQgJHVpX2NvbW0gPCRNMUItS2V5LUE+IHslVyB0YWcgYWRkIHNlbCAwLjAgZW5kO2JyZWFrfQoKYmluZCAkdWlfZGlmZiA8JE0xQi1LZXkteD4ge3RrX3RleHRDb3B5ICVXO2JyZWFrfQpiaW5kICR1aV9kaWZmIDwkTTFCLUtleS1YPiB7dGtfdGV4dENvcHkgJVc7YnJlYWt9CmJpbmQgJHVpX2RpZmYgPCRNMUItS2V5LWM+IHt0a190ZXh0Q29weSAlVzticmVha30KYmluZCAkdWlfZGlmZiA8JE0xQi1LZXktQz4ge3RrX3RleHRDb3B5ICVXO2JyZWFrfQpiaW5kICR1aV9kaWZmIDwkTTFCLUtleS12PiB7YnJlYWt9CmJpbmQgJHVpX2RpZmYgPCRNMUItS2V5LVY+IHticmVha30KYmluZCAkdWlfZGlmZiA8JE0xQi1LZXktYT4geyVXIHRhZyBhZGQgc2VsIDAuMCBlbmQ7YnJlYWt9CmJpbmQgJHVpX2RpZmYgPCRNMUItS2V5LUE+IHslVyB0YWcgYWRkIHNlbCAwLjAgZW5kO2JyZWFrfQpiaW5kICR1aV9kaWZmIDxLZXktVXA+ICAgICB7Y2F0Y2ggeyVXIHl2aWV3IHNjcm9sbCAtMSB1bml0c307YnJlYWt9CmJpbmQgJHVpX2RpZmYgPEtleS1Eb3duPiAgIHtjYXRjaCB7JVcgeXZpZXcgc2Nyb2xsICAxIHVuaXRzfTticmVha30KYmluZCAkdWlfZGlmZiA8S2V5LUxlZnQ+ICAge2NhdGNoIHslVyB4dmlldyBzY3JvbGwgLTEgdW5pdHN9O2JyZWFrfQpiaW5kICR1aV9kaWZmIDxLZXktUmlnaHQ+ICB7Y2F0Y2ggeyVXIHh2aWV3IHNjcm9sbCAgMSB1bml0c307YnJlYWt9CgpiaW5kIC4gICA8RGVzdHJveT4gZG9fcXVpdApiaW5kIGFsbCA8S2V5LUY1PiBkb19yZXNjYW4KYmluZCBhbGwgPCRNMUItS2V5LXI+IGRvX3Jlc2NhbgpiaW5kIGFsbCA8JE0xQi1LZXktUj4gZG9fcmVzY2FuCmJpbmQgLiAgIDwkTTFCLUtleS1zPiBkb19zaWdub2ZmCmJpbmQgLiAgIDwkTTFCLUtleS1TPiBkb19zaWdub2ZmCmJpbmQgLiAgIDwkTTFCLUtleS1pPiBkb19pbmNsdWRlX2FsbApiaW5kIC4gICA8JE0xQi1LZXktST4gZG9faW5jbHVkZV9hbGwKYmluZCAuICAgPCRNMUItS2V5LVJldHVybj4gZG9fY29tbWl0CmJpbmQgYWxsIDwkTTFCLUtleS1xPiBkb19xdWl0CmJpbmQgYWxsIDwkTTFCLUtleS1RPiBkb19xdWl0CmJpbmQgYWxsIDwkTTFCLUtleS13PiB7ZGVzdHJveSBbd2luZm8gdG9wbGV2ZWwgJVddfQpiaW5kIGFsbCA8JE0xQi1LZXktVz4ge2Rlc3Ryb3kgW3dpbmZvIHRvcGxldmVsICVXXX0KZm9yZWFjaCBpIFtsaXN0ICR1aV9pbmRleCAkdWlfb3RoZXJdIHsKCWJpbmQgJGkgPEJ1dHRvbi0xPiB7Y2xpY2sgJVcgJXggJXkgMSAlWCAlWTsgYnJlYWt9CgliaW5kICRpIDxCdXR0b24tMz4ge2NsaWNrICVXICV4ICV5IDMgJVggJVk7IGJyZWFrfQoJYmluZCAkaSA8QnV0dG9uUmVsZWFzZS0xPiB7dW5jbGljayAlVyAleCAleTsgYnJlYWt9Cn0KdW5zZXQgaQoKc2V0IGZpbGVfbGlzdHMoJHVpX2luZGV4KSBbbGlzdF0Kc2V0IGZpbGVfbGlzdHMoJHVpX290aGVyKSBbbGlzdF0KCndtIHRpdGxlIC4gIiRhcHBuYW1lIChbZmlsZSBub3JtYWxpemUgW2ZpbGUgZGlybmFtZSAkZ2l0ZGlyXV0pIgpmb2N1cyAtZm9yY2UgJHVpX2NvbW0KbG9hZF9hbGxfcmVtb3Rlcwpwb3B1bGF0ZV9yZW1vdGVfbWVudSAubWJhci5mZXRjaCBGcm9tIGZldGNoX2Zyb20KcG9wdWxhdGVfcmVtb3RlX21lbnUgLm1iYXIucHVzaCBUbyBwdXNoX3RvCnBvcHVsYXRlX3B1bGxfbWVudSAubWJhci5wdWxsCnVwZGF0ZV9zdGF0dXMK",
    "text": "#!/bin/sh\n# Tcl ignores the next line -*- tcl -*- \\\nexec wish \"$0\" -- \"$@\"\n\n# Copyright (C) 2006 Shawn Pearce, Paul Mackerras.  All rights reserved.\n# This program is free software; it may be used, copied, modified\n# and distributed under the terms of the GNU General Public Licence,\n# either version 2, or (at your option) any later version.\n\nset appname [lindex [file split $argv0] end]\nset gitdir {}\n\n######################################################################\n##\n## config\n\nproc load_repo_config {} {\n\tglobal repo_config\n\tglobal cfg_trust_mtime\n\n\tarray unset repo_config\n\tcatch {\n\t\tset fd_rc [open \"| git repo-config --list\" r]\n\t\twhile {[gets $fd_rc line] >= 0} {\n\t\t\tif {[regexp {^([^=]+)=(.*)$} $line line name value]} {\n\t\t\t\tlappend repo_config($name) $value\n\t\t\t}\n\t\t}\n\t\tclose $fd_rc\n\t}\n\n\tif {[catch {set cfg_trust_mtime \\\n\t\t\t[lindex $repo_config(gui.trustmtime) 0]\n\t\t}]} {\n\t\tset cfg_trust_mtime false\n\t}\n}\n\nproc save_my_config {} {\n\tglobal repo_config\n\tglobal cfg_trust_mtime\n\n\tif {[catch {set rc_trustMTime $repo_config(gui.trustmtime)}]} {\n\t\tset rc_trustMTime [list false]\n\t}\n\tif {$cfg_trust_mtime != [lindex $rc_trustMTime 0]} {\n\t\texec git repo-config gui.trustMTime $cfg_trust_mtime\n\t\tset repo_config(gui.trustmtime) [list $cfg_trust_mtime]\n\t}\n\n\tset cfg_geometry [wm geometry .]\n\tappend cfg_geometry \" [lindex [.vpane sash coord 0] 1]\"\n\tappend cfg_geometry \" [lindex [.vpane.files sash coord 0] 0]\"\n\tif {[catch {set rc_geometry $repo_config(gui.geometry)}]} {\n\t\tset rc_geometry [list [list]]\n\t}\n\tif {$cfg_geometry != [lindex $rc_geometry 0]} {\n\t\texec git repo-config gui.geometry $cfg_geometry\n\t\tset repo_config(gui.geometry) [list $cfg_geometry]\n\t}\n}\n\nproc error_popup {msg} {\n\tglobal gitdir appname\n\n\tset title $appname\n\tif {$gitdir != {}} {\n\t\tappend title { (}\n\t\tappend title [lindex \\\n\t\t\t[file split [file normalize [file dirname $gitdir]]] \\\n\t\t\tend]\n\t\tappend title {)}\n\t}\n\ttk_messageBox \\\n\t\t-parent . \\\n\t\t-icon error \\\n\t\t-type ok \\\n\t\t-title \"$title: error\" \\\n\t\t-message $msg\n}\n\n######################################################################\n##\n## repository setup\n\nif {   [catch {set cdup [exec git rev-parse --show-cdup]} err]\n\t|| [catch {set gitdir [exec git rev-parse --git-dir]} err]} {\n\tcatch {wm withdraw .}\n\terror_popup \"Cannot find the git directory:\\n\\n$err\"\n\texit 1\n}\nif {$cdup != \"\"} {\n\tcd $cdup\n}\nunset cdup\n\nif {$appname == {git-citool}} {\n\tset single_commit 1\n}\n\nload_repo_config\n\n######################################################################\n##\n## task management\n\nset single_commit 0\nset status_active 0\nset diff_active 0\nset update_active 0\nset commit_active 0\nset update_index_fd {}\n\nset disable_on_lock [list]\nset index_lock_type none\n\nset HEAD {}\nset PARENT {}\nset commit_type {}\n\nproc lock_index {type} {\n\tglobal index_lock_type disable_on_lock\n\n\tif {$index_lock_type == {none}} {\n\t\tset index_lock_type $type\n\t\tforeach w $disable_on_lock {\n\t\t\tuplevel #0 $w disabled\n\t\t}\n\t\treturn 1\n\t} elseif {$index_lock_type == {begin-update} && $type == {update}} {\n\t\tset index_lock_type $type\n\t\treturn 1\n\t}\n\treturn 0\n}\n\nproc unlock_index {} {\n\tglobal index_lock_type disable_on_lock\n\n\tset index_lock_type none\n\tforeach w $disable_on_lock {\n\t\tuplevel #0 $w normal\n\t}\n}\n\n######################################################################\n##\n## status\n\nproc repository_state {hdvar ctvar} {\n\tglobal gitdir\n\tupvar $hdvar hd $ctvar ct\n\n\tif {[catch {set hd [exec git rev-parse --verify HEAD]}]} {\n\t\tset ct initial\n\t} elseif {[file exists [file join $gitdir MERGE_HEAD]]} {\n\t\tset ct merge\n\t} else {\n\t\tset ct normal\n\t}\n}\n\nproc update_status {{final Ready.}} {\n\tglobal HEAD PARENT commit_type\n\tglobal ui_index ui_other ui_status_value ui_comm\n\tglobal status_active file_states\n\tglobal cfg_trust_mtime\n\n\tif {$status_active || ![lock_index read]} return\n\n\trepository_state new_HEAD new_type\n\tif {$commit_type == {amend} \n\t\t&& $new_type == {normal}\n\t\t&& $new_HEAD == $HEAD} {\n\t} else {\n\t\tset HEAD $new_HEAD\n\t\tset PARENT $new_HEAD\n\t\tset commit_type $new_type\n\t}\n\n\tarray unset file_states\n\n\tif {![$ui_comm edit modified]\n\t\t|| [string trim [$ui_comm get 0.0 end]] == {}} {\n\t\tif {[load_message GITGUI_MSG]} {\n\t\t} elseif {[load_message MERGE_MSG]} {\n\t\t} elseif {[load_message SQUASH_MSG]} {\n\t\t}\n\t\t$ui_comm edit modified false\n\t\t$ui_comm edit reset\n\t}\n\n\tif {$cfg_trust_mtime == {true}} {\n\t\tupdate_status_stage2 {} $final\n\t} else {\n\t\tset status_active 1\n\t\tset ui_status_value {Refreshing file status...}\n\t\tset fd_rf [open \"| git update-index -q --unmerged --refresh\" r]\n\t\tfconfigure $fd_rf -blocking 0 -translation binary\n\t\tfileevent $fd_rf readable \\\n\t\t\t[list update_status_stage2 $fd_rf $final]\n\t}\n}\n\nproc update_status_stage2 {fd final} {\n\tglobal gitdir PARENT commit_type\n\tglobal ui_index ui_other ui_status_value ui_comm\n\tglobal status_active\n\tglobal buf_rdi buf_rdf buf_rlo\n\n\tif {$fd != {}} {\n\t\tread $fd\n\t\tif {![eof $fd]} return\n\t\tclose $fd\n\t}\n\n\tset ls_others [list | git ls-files --others -z \\\n\t\t--exclude-per-directory=.gitignore]\n\tset info_exclude [file join $gitdir info exclude]\n\tif {[file readable $info_exclude]} {\n\t\tlappend ls_others \"--exclude-from=$info_exclude\"\n\t}\n\n\tset buf_rdi {}\n\tset buf_rdf {}\n\tset buf_rlo {}\n\n\tset status_active 3\n\tset ui_status_value {Scanning for modified files ...}\n\tset fd_di [open \"| git diff-index --cached -z $PARENT\" r]\n\tset fd_df [open \"| git diff-files -z\" r]\n\tset fd_lo [open $ls_others r]\n\n\tfconfigure $fd_di -blocking 0 -translation binary\n\tfconfigure $fd_df -blocking 0 -translation binary\n\tfconfigure $fd_lo -blocking 0 -translation binary\n\tfileevent $fd_di readable [list read_diff_index $fd_di $final]\n\tfileevent $fd_df readable [list read_diff_files $fd_df $final]\n\tfileevent $fd_lo readable [list read_ls_others $fd_lo $final]\n}\n\nproc load_message {file} {\n\tglobal gitdir ui_comm\n\n\tset f [file join $gitdir $file]\n\tif {[file isfile $f]} {\n\t\tif {[catch {set fd [open $f r]}]} {\n\t\t\treturn 0\n\t\t}\n\t\tset content [string trim [read $fd]]\n\t\tclose $fd\n\t\t$ui_comm delete 0.0 end\n\t\t$ui_comm insert end $content\n\t\treturn 1\n\t}\n\treturn 0\n}\n\nproc read_diff_index {fd final} {\n\tglobal buf_rdi\n\n\tappend buf_rdi [read $fd]\n\tset c 0\n\tset n [string length $buf_rdi]\n\twhile {$c < $n} {\n\t\tset z1 [string first \"\\0\" $buf_rdi $c]\n\t\tif {$z1 == -1} break\n\t\tincr z1\n\t\tset z2 [string first \"\\0\" $buf_rdi $z1]\n\t\tif {$z2 == -1} break\n\n\t\tset c $z2\n\t\tincr z2 -1\n\t\tdisplay_file \\\n\t\t\t[string range $buf_rdi $z1 $z2] \\\n\t\t\t[string index $buf_rdi [expr $z1 - 2]]_\n\t\tincr c\n\t}\n\tif {$c < $n} {\n\t\tset buf_rdi [string range $buf_rdi $c end]\n\t} else {\n\t\tset buf_rdi {}\n\t}\n\n\tstatus_eof $fd buf_rdi $final\n}\n\nproc read_diff_files {fd final} {\n\tglobal buf_rdf\n\n\tappend buf_rdf [read $fd]\n\tset c 0\n\tset n [string length $buf_rdf]\n\twhile {$c < $n} {\n\t\tset z1 [string first \"\\0\" $buf_rdf $c]\n\t\tif {$z1 == -1} break\n\t\tincr z1\n\t\tset z2 [string first \"\\0\" $buf_rdf $z1]\n\t\tif {$z2 == -1} break\n\n\t\tset c $z2\n\t\tincr z2 -1\n\t\tdisplay_file \\\n\t\t\t[string range $buf_rdf $z1 $z2] \\\n\t\t\t_[string index $buf_rdf [expr $z1 - 2]]\n\t\tincr c\n\t}\n\tif {$c < $n} {\n\t\tset buf_rdf [string range $buf_rdf $c end]\n\t} else {\n\t\tset buf_rdf {}\n\t}\n\n\tstatus_eof $fd buf_rdf $final\n}\n\nproc read_ls_others {fd final} {\n\tglobal buf_rlo\n\n\tappend buf_rlo [read $fd]\n\tset pck [split $buf_rlo \"\\0\"]\n\tset buf_rlo [lindex $pck end]\n\tforeach p [lrange $pck 0 end-1] {\n\t\tdisplay_file $p _O\n\t}\n\tstatus_eof $fd buf_rlo $final\n}\n\nproc status_eof {fd buf final} {\n\tglobal status_active ui_status_value\n\tupvar $buf to_clear\n\n\tif {[eof $fd]} {\n\t\tset to_clear {}\n\t\tclose $fd\n\n\t\tif {[incr status_active -1] == 0} {\n\t\t\tdisplay_all_files\n\t\t\tunlock_index\n\t\t\treshow_diff\n\t\t\tset ui_status_value $final\n\t\t}\n\t}\n}\n\n######################################################################\n##\n## diff\n\nproc clear_diff {} {\n\tglobal ui_diff ui_fname_value ui_fstatus_value ui_index ui_other\n\n\t$ui_diff conf -state normal\n\t$ui_diff delete 0.0 end\n\t$ui_diff conf -state disabled\n\n\tset ui_fname_value {}\n\tset ui_fstatus_value {}\n\n\t$ui_index tag remove in_diff 0.0 end\n\t$ui_other tag remove in_diff 0.0 end\n}\n\nproc reshow_diff {} {\n\tglobal ui_fname_value ui_status_value file_states\n\n\tif {$ui_fname_value == {}\n\t\t|| [catch {set s $file_states($ui_fname_value)}]} {\n\t\tclear_diff\n\t} else {\n\t\tshow_diff $ui_fname_value\n\t}\n}\n\nproc show_diff {path {w {}} {lno {}}} {\n\tglobal file_states file_lists\n\tglobal PARENT diff_3way diff_active\n\tglobal ui_diff ui_fname_value ui_fstatus_value ui_status_value\n\n\tif {$diff_active || ![lock_index read]} return\n\n\tclear_diff\n\tif {$w == {} || $lno == {}} {\n\t\tforeach w [array names file_lists] {\n\t\t\tset lno [lsearch -sorted $file_lists($w) $path]\n\t\t\tif {$lno >= 0} {\n\t\t\t\tincr lno\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\tif {$w != {} && $lno >= 1} {\n\t\t$w tag add in_diff $lno.0 [expr $lno + 1].0\n\t}\n\n\tset s $file_states($path)\n\tset m [lindex $s 0]\n\tset diff_3way 0\n\tset diff_active 1\n\tset ui_fname_value [escape_path $path]\n\tset ui_fstatus_value [mapdesc $m $path]\n\tset ui_status_value \"Loading diff of [escape_path $path]...\"\n\n\tset cmd [list | git diff-index -p $PARENT -- $path]\n\tswitch $m {\n\tMM {\n\t\tset cmd [list | git diff-index -p -c $PARENT $path]\n\t}\n\t_O {\n\t\tif {[catch {\n\t\t\t\tset fd [open $path r]\n\t\t\t\tset content [read $fd]\n\t\t\t\tclose $fd\n\t\t\t} err ]} {\n\t\t\tset diff_active 0\n\t\t\tunlock_index\n\t\t\tset ui_status_value \"Unable to display [escape_path $path]\"\n\t\t\terror_popup \"Error loading file:\\n\\n$err\"\n\t\t\treturn\n\t\t}\n\t\t$ui_diff conf -state normal\n\t\t$ui_diff insert end $content\n\t\t$ui_diff conf -state disabled\n\t\tset diff_active 0\n\t\tunlock_index\n\t\tset ui_status_value {Ready.}\n\t\treturn\n\t}\n\t}\n\n\tif {[catch {set fd [open $cmd r]} err]} {\n\t\tset diff_active 0\n\t\tunlock_index\n\t\tset ui_status_value \"Unable to display [escape_path $path]\"\n\t\terror_popup \"Error loading diff:\\n\\n$err\"\n\t\treturn\n\t}\n\n\tfconfigure $fd -blocking 0 -translation auto\n\tfileevent $fd readable [list read_diff $fd]\n}\n\nproc read_diff {fd} {\n\tglobal ui_diff ui_status_value diff_3way diff_active\n\n\twhile {[gets $fd line] >= 0} {\n\t\tif {[string match {diff --git *} $line]} continue\n\t\tif {[string match {diff --combined *} $line]} continue\n\t\tif {[string match {--- *} $line]} continue\n\t\tif {[string match {+++ *} $line]} continue\n\t\tif {[string match index* $line]} {\n\t\t\tif {[string first , $line] >= 0} {\n\t\t\t\tset diff_3way 1\n\t\t\t}\n\t\t}\n\n\t\t$ui_diff conf -state normal\n\t\tif {!$diff_3way} {\n\t\t\tset x [string index $line 0]\n\t\t\tswitch -- $x {\n\t\t\t\"@\" {set tags da}\n\t\t\t\"+\" {set tags dp}\n\t\t\t\"-\" {set tags dm}\n\t\t\tdefault {set tags {}}\n\t\t\t}\n\t\t} else {\n\t\t\tset x [string range $line 0 1]\n\t\t\tswitch -- $x {\n\t\t\tdefault {set tags {}}\n\t\t\t\"@@\" {set tags da}\n\t\t\t\"++\" {set tags dp; set x \" +\"}\n\t\t\t\" +\" {set tags {di bold}; set x \"++\"}\n\t\t\t\"+ \" {set tags dni; set x \"-+\"}\n\t\t\t\"--\" {set tags dm; set x \" -\"}\n\t\t\t\" -\" {set tags {dm bold}; set x \"--\"}\n\t\t\t\"- \" {set tags di; set x \"+-\"}\n\t\t\tdefault {set tags {}}\n\t\t\t}\n\t\t\tset line [string replace $line 0 1 $x]\n\t\t}\n\t\t$ui_diff insert end $line $tags\n\t\t$ui_diff insert end \"\\n\"\n\t\t$ui_diff conf -state disabled\n\t}\n\n\tif {[eof $fd]} {\n\t\tclose $fd\n\t\tset diff_active 0\n\t\tunlock_index\n\t\tset ui_status_value {Ready.}\n\t}\n}\n\n######################################################################\n##\n## commit\n\nproc load_last_commit {} {\n\tglobal HEAD PARENT commit_type ui_comm\n\n\tif {$commit_type == {amend}} return\n\tif {$commit_type != {normal}} {\n\t\terror_popup \"Can't amend a $commit_type commit.\"\n\t\treturn\n\t}\n\n\tset msg {}\n\tset parent {}\n\tset parent_count 0\n\tif {[catch {\n\t\t\tset fd [open \"| git cat-file commit $HEAD\" r]\n\t\t\twhile {[gets $fd line] > 0} {\n\t\t\t\tif {[string match {parent *} $line]} {\n\t\t\t\t\tset parent [string range $line 7 end]\n\t\t\t\t\tincr parent_count\n\t\t\t\t}\n\t\t\t}\n\t\t\tset msg [string trim [read $fd]]\n\t\t\tclose $fd\n\t\t} err]} {\n\t\terror_popup \"Error loading commit data for amend:\\n\\n$err\"\n\t\treturn\n\t}\n\n\tif {$parent_count == 0} {\n\t\tset commit_type amend\n\t\tset HEAD {}\n\t\tset PARENT {}\n\t\tupdate_status\n\t} elseif {$parent_count == 1} {\n\t\tset commit_type amend\n\t\tset PARENT $parent\n\t\t$ui_comm delete 0.0 end\n\t\t$ui_comm insert end $msg\n\t\t$ui_comm edit modified false\n\t\t$ui_comm edit reset\n\t\tupdate_status\n\t} else {\n\t\terror_popup {You can't amend a merge commit.}\n\t\treturn\n\t}\n}\n\nproc commit_tree {} {\n\tglobal tcl_platform HEAD gitdir commit_type file_states\n\tglobal commit_active ui_status_value\n\tglobal ui_comm\n\n\tif {$commit_active || ![lock_index update]} return\n\n\t# -- Our in memory state should match the repository.\n\t#\n\trepository_state curHEAD cur_type\n\tif {$commit_type == {amend} \n\t\t&& $cur_type == {normal}\n\t\t&& $curHEAD == $HEAD} {\n\t} elseif {$commit_type != $cur_type || $HEAD != $curHEAD} {\n\t\terror_popup {Last scanned state does not match repository state.\n\nIts highly likely that another Git program modified the\nrepository since our last scan.  A rescan is required\nbefore committing.\n}\n\t\tunlock_index\n\t\tupdate_status\n\t\treturn\n\t}\n\n\t# -- At least one file should differ in the index.\n\t#\n\tset files_ready 0\n\tforeach path [array names file_states] {\n\t\tset s $file_states($path)\n\t\tswitch -glob -- [lindex $s 0] {\n\t\t_? {continue}\n\t\tA? -\n\t\tD? -\n\t\tM? {set files_ready 1; break}\n\t\tU? {\n\t\t\terror_popup \"Unmerged files cannot be committed.\n\nFile [escape_path $path] has merge conflicts.\nYou must resolve them and include the file before committing.\n\"\n\t\t\tunlock_index\n\t\t\treturn\n\t\t}\n\t\tdefault {\n\t\t\terror_popup \"Unknown file state [lindex $s 0] detected.\n\nFile [escape_path $path] cannot be committed by this program.\n\"\n\t\t}\n\t\t}\n\t}\n\tif {!$files_ready} {\n\t\terror_popup {No included files to commit.\n\nYou must include at least 1 file before you can commit.\n}\n\t\tunlock_index\n\t\treturn\n\t}\n\n\t# -- A message is required.\n\t#\n\tset msg [string trim [$ui_comm get 1.0 end]]\n\tif {$msg == {}} {\n\t\terror_popup {Please supply a commit message.\n\nA good commit message has the following format:\n\n- First line: Describe in one sentance what you did.\n- Second line: Blank\n- Remaining lines: Describe why this change is good.\n}\n\t\tunlock_index\n\t\treturn\n\t}\n\n\t# -- Ask the pre-commit hook for the go-ahead.\n\t#\n\tset pchook [file join $gitdir hooks pre-commit]\n\tif {$tcl_platform(platform) == {windows} && [file isfile $pchook]} {\n\t\tset pchook [list sh -c \\\n\t\t\t\"if test -x \\\"$pchook\\\"; then exec \\\"$pchook\\\"; fi\"]\n\t} elseif {[file executable $pchook]} {\n\t\tset pchook [list $pchook]\n\t} else {\n\t\tset pchook {}\n\t}\n\tif {$pchook != {} && [catch {eval exec $pchook} err]} {\n\t\thook_failed_popup pre-commit $err\n\t\tunlock_index\n\t\treturn\n\t}\n\n\t# -- Write the tree in the background.\n\t#\n\tset commit_active 1\n\tset ui_status_value {Committing changes...}\n\n\tset fd_wt [open \"| git write-tree\" r]\n\tfileevent $fd_wt readable [list commit_stage2 $fd_wt $curHEAD $msg]\n}\n\nproc commit_stage2 {fd_wt curHEAD msg} {\n\tglobal single_commit gitdir HEAD PARENT commit_type\n\tglobal commit_active ui_status_value ui_comm\n\tglobal file_states\n\n\tgets $fd_wt tree_id\n\tif {$tree_id == {} || [catch {close $fd_wt} err]} {\n\t\terror_popup \"write-tree failed:\\n\\n$err\"\n\t\tset commit_active 0\n\t\tset ui_status_value {Commit failed.}\n\t\tunlock_index\n\t\treturn\n\t}\n\n\t# -- Create the commit.\n\t#\n\tset cmd [list git commit-tree $tree_id]\n\tif {$PARENT != {}} {\n\t\tlappend cmd -p $PARENT\n\t}\n\tif {$commit_type == {merge}} {\n\t\tif {[catch {\n\t\t\t\tset fd_mh [open [file join $gitdir MERGE_HEAD] r]\n\t\t\t\twhile {[gets $fd_mh merge_head] >= 0} {\n\t\t\t\t\tlappend cmd -p $merge_head\n\t\t\t\t}\n\t\t\t\tclose $fd_mh\n\t\t\t} err]} {\n\t\t\terror_popup \"Loading MERGE_HEAD failed:\\n\\n$err\"\n\t\t\tset commit_active 0\n\t\t\tset ui_status_value {Commit failed.}\n\t\t\tunlock_index\n\t\t\treturn\n\t\t}\n\t}\n\tif {$PARENT == {}} {\n\t\t# git commit-tree writes to stderr during initial commit.\n\t\tlappend cmd 2>/dev/null\n\t}\n\tlappend cmd << $msg\n\tif {[catch {set cmt_id [eval exec $cmd]} err]} {\n\t\terror_popup \"commit-tree failed:\\n\\n$err\"\n\t\tset commit_active 0\n\t\tset ui_status_value {Commit failed.}\n\t\tunlock_index\n\t\treturn\n\t}\n\n\t# -- Update the HEAD ref.\n\t#\n\tset reflogm commit\n\tif {$commit_type != {normal}} {\n\t\tappend reflogm \" ($commit_type)\"\n\t}\n\tset i [string first \"\\n\" $msg]\n\tif {$i >= 0} {\n\t\tappend reflogm {: } [string range $msg 0 [expr $i - 1]]\n\t} else {\n\t\tappend reflogm {: } $msg\n\t}\n\tset cmd [list git update-ref -m $reflogm HEAD $cmt_id $curHEAD]\n\tif {[catch {eval exec $cmd} err]} {\n\t\terror_popup \"update-ref failed:\\n\\n$err\"\n\t\tset commit_active 0\n\t\tset ui_status_value {Commit failed.}\n\t\tunlock_index\n\t\treturn\n\t}\n\n\t# -- Cleanup after ourselves.\n\t#\n\tcatch {file delete [file join $gitdir MERGE_HEAD]}\n\tcatch {file delete [file join $gitdir MERGE_MSG]}\n\tcatch {file delete [file join $gitdir SQUASH_MSG]}\n\tcatch {file delete [file join $gitdir GITGUI_MSG]}\n\n\t# -- Let rerere do its thing.\n\t#\n\tif {[file isdirectory [file join $gitdir rr-cache]]} {\n\t\tcatch {exec git rerere}\n\t}\n\n\t$ui_comm delete 0.0 end\n\t$ui_comm edit modified false\n\t$ui_comm edit reset\n\n\tif {$single_commit} do_quit\n\n\t# -- Update status without invoking any git commands.\n\t#\n\tset commit_active 0\n\tset commit_type normal\n\tset HEAD $cmt_id\n\tset PARENT $cmt_id\n\n\tforeach path [array names file_states] {\n\t\tset s $file_states($path)\n\t\tset m [lindex $s 0]\n\t\tswitch -glob -- $m {\n\t\tA? -\n\t\tM? -\n\t\tD? {set m _[string index $m 1]}\n\t\t}\n\n\t\tif {$m == {__}} {\n\t\t\tunset file_states($path)\n\t\t} else {\n\t\t\tlset file_states($path) 0 $m\n\t\t}\n\t}\n\n\tdisplay_all_files\n\tunlock_index\n\treshow_diff\n\tset ui_status_value \\\n\t\t\"Changes committed as [string range $cmt_id 0 7].\"\n}\n\n######################################################################\n##\n## fetch pull push\n\nproc fetch_from {remote} {\n\tset w [new_console \"fetch $remote\" \\\n\t\t\"Fetching new changes from $remote\"]\n\tset cmd [list git fetch]\n\tlappend cmd $remote\n\tconsole_exec $w $cmd\n}\n\nproc pull_remote {remote branch} {\n\tglobal HEAD commit_type\n\tglobal file_states\n\n\tif {![lock_index update]} return\n\n\t# -- Our in memory state should match the repository.\n\t#\n\trepository_state curHEAD cur_type\n\tif {$commit_type != $cur_type || $HEAD != $curHEAD} {\n\t\terror_popup {Last scanned state does not match repository state.\n\nIts highly likely that another Git program modified the\nrepository since our last scan.  A rescan is required\nbefore a pull can be started.\n}\n\t\tunlock_index\n\t\tupdate_status\n\t\treturn\n\t}\n\n\t# -- No differences should exist before a pull.\n\t#\n\tif {[array size file_states] != 0} {\n\t\terror_popup {Uncommitted but modified files are present.\n\nYou should not perform a pull with unmodified files in your working\ndirectory as Git would be unable to recover from an incorrect merge.\n\nCommit or throw away all changes before starting a pull operation.\n}\n\t\tunlock_index\n\t\treturn\n\t}\n\n\tset w [new_console \"pull $remote $branch\" \\\n\t\t\"Pulling new changes from branch $branch in $remote\"]\n\tset cmd [list git pull]\n\tlappend cmd $remote\n\tlappend cmd $branch\n\tconsole_exec $w $cmd [list post_pull_remote $remote $branch]\n}\n\nproc post_pull_remote {remote branch success} {\n\tglobal HEAD PARENT commit_type\n\tglobal ui_status_value\n\n\tunlock_index\n\tif {$success} {\n\t\trepository_state HEAD commit_type\n\t\tset PARENT $HEAD\n\t\tset $ui_status_value {Ready.}\n\t} else {\n\t\tupdate_status \\\n\t\t\t\"Conflicts detected while pulling $branch from $remote.\"\n\t}\n}\n\nproc push_to {remote} {\n\tset w [new_console \"push $remote\" \\\n\t\t\"Pushing changes to $remote\"]\n\tset cmd [list git push]\n\tlappend cmd $remote\n\tconsole_exec $w $cmd\n}\n\n######################################################################\n##\n## ui helpers\n\nproc mapcol {state path} {\n\tglobal all_cols ui_other\n\n\tif {[catch {set r $all_cols($state)}]} {\n\t\tputs \"error: no column for state={$state} $path\"\n\t\treturn $ui_other\n\t}\n\treturn $r\n}\n\nproc mapicon {state path} {\n\tglobal all_icons\n\n\tif {[catch {set r $all_icons($state)}]} {\n\t\tputs \"error: no icon for state={$state} $path\"\n\t\treturn file_plain\n\t}\n\treturn $r\n}\n\nproc mapdesc {state path} {\n\tglobal all_descs\n\n\tif {[catch {set r $all_descs($state)}]} {\n\t\tputs \"error: no desc for state={$state} $path\"\n\t\treturn $state\n\t}\n\treturn $r\n}\n\nproc escape_path {path} {\n\tregsub -all \"\\n\" $path \"\\\\n\" path\n\treturn $path\n}\n\nset next_icon_id 0\n\nproc merge_state {path new_state} {\n\tglobal file_states next_icon_id\n\n\tset s0 [string index $new_state 0]\n\tset s1 [string index $new_state 1]\n\n\tif {[catch {set info $file_states($path)}]} {\n\t\tset state __\n\t\tset icon n[incr next_icon_id]\n\t} else {\n\t\tset state [lindex $info 0]\n\t\tset icon [lindex $info 1]\n\t}\n\n\tif {$s0 == {_}} {\n\t\tset s0 [string index $state 0]\n\t} elseif {$s0 == {*}} {\n\t\tset s0 _\n\t}\n\n\tif {$s1 == {_}} {\n\t\tset s1 [string index $state 1]\n\t} elseif {$s1 == {*}} {\n\t\tset s1 _\n\t}\n\n\tset file_states($path) [list $s0$s1 $icon]\n\treturn $state\n}\n\nproc display_file {path state} {\n\tglobal ui_index ui_other\n\tglobal file_states file_lists status_active\n\n\tset old_m [merge_state $path $state]\n\tif {$status_active} return\n\n\tset s $file_states($path)\n\tset new_m [lindex $s 0]\n\tset new_w [mapcol $new_m $path] \n\tset old_w [mapcol $old_m $path]\n\tset new_icon [mapicon $new_m $path]\n\n\tif {$new_w != $old_w} {\n\t\tset lno [lsearch -sorted $file_lists($old_w) $path]\n\t\tif {$lno >= 0} {\n\t\t\tincr lno\n\t\t\t$old_w conf -state normal\n\t\t\t$old_w delete $lno.0 [expr $lno + 1].0\n\t\t\t$old_w conf -state disabled\n\t\t}\n\n\t\tlappend file_lists($new_w) $path\n\t\tset file_lists($new_w) [lsort $file_lists($new_w)]\n\t\tset lno [lsearch -sorted $file_lists($new_w) $path]\n\t\tincr lno\n\t\t$new_w conf -state normal\n\t\t$new_w image create $lno.0 \\\n\t\t\t-align center -padx 5 -pady 1 \\\n\t\t\t-name [lindex $s 1] \\\n\t\t\t-image $new_icon\n\t\t$new_w insert $lno.1 \"[escape_path $path]\\n\"\n\t\t$new_w conf -state disabled\n\t} elseif {$new_icon != [mapicon $old_m $path]} {\n\t\t$new_w conf -state normal\n\t\t$new_w image conf [lindex $s 1] -image $new_icon\n\t\t$new_w conf -state disabled\n\t}\n}\n\nproc display_all_files {} {\n\tglobal ui_index ui_other file_states file_lists\n\n\t$ui_index conf -state normal\n\t$ui_other conf -state normal\n\n\t$ui_index delete 0.0 end\n\t$ui_other delete 0.0 end\n\n\tset file_lists($ui_index) [list]\n\tset file_lists($ui_other) [list]\n\n\tforeach path [lsort [array names file_states]] {\n\t\tset s $file_states($path)\n\t\tset m [lindex $s 0]\n\t\tset w [mapcol $m $path]\n\t\tlappend file_lists($w) $path\n\t\t$w image create end \\\n\t\t\t-align center -padx 5 -pady 1 \\\n\t\t\t-name [lindex $s 1] \\\n\t\t\t-image [mapicon $m $path]\n\t\t$w insert end \"[escape_path $path]\\n\"\n\t}\n\n\t$ui_index conf -state disabled\n\t$ui_other conf -state disabled\n}\n\nproc with_update_index {body} {\n\tglobal update_index_fd\n\n\tif {$update_index_fd == {}} {\n\t\tif {![lock_index update]} return\n\t\tset update_index_fd [open \\\n\t\t\t\"| git update-index --add --remove -z --stdin\" \\\n\t\t\tw]\n\t\tfconfigure $update_index_fd -translation binary\n\t\tuplevel 1 $body\n\t\tclose $update_index_fd\n\t\tset update_index_fd {}\n\t\tunlock_index\n\t} else {\n\t\tuplevel 1 $body\n\t}\n}\n\nproc update_index {path} {\n\tglobal update_index_fd\n\n\tif {$update_index_fd == {}} {\n\t\terror {not in with_update_index}\n\t} else {\n\t\tputs -nonewline $update_index_fd \"$path\\0\"\n\t}\n}\n\nproc toggle_mode {path} {\n\tglobal file_states ui_fname_value\n\n\tset s $file_states($path)\n\tset m [lindex $s 0]\n\n\tswitch -- $m {\n\tAM -\n\t_O {set new A*}\n\t_M -\n\tMM {set new M*}\n\tAD -\n\t_D {set new D*}\n\tdefault {return}\n\t}\n\n\twith_update_index {update_index $path}\n\tdisplay_file $path $new\n\tif {$ui_fname_value == $path} {\n\t\tshow_diff $path\n\t}\n}\n\n######################################################################\n##\n## remote management\n\nproc load_all_remotes {} {\n\tglobal gitdir all_remotes repo_config\n\n\tset all_remotes [list]\n\tset rm_dir [file join $gitdir remotes]\n\tif {[file isdirectory $rm_dir]} {\n\t\tset all_remotes [concat $all_remotes [glob \\\n\t\t\t-types f \\\n\t\t\t-tails \\\n\t\t\t-nocomplain \\\n\t\t\t-directory $rm_dir *]]\n\t}\n\n\tforeach line [array names repo_config remote.*.url] {\n\t\tif {[regexp ^remote\\.(.*)\\.url\\$ $line line name]} {\n\t\t\tlappend all_remotes $name\n\t\t}\n\t}\n\n\tset all_remotes [lsort -unique $all_remotes]\n}\n\nproc populate_remote_menu {m pfx op} {\n\tglobal all_remotes font_ui\n\n\tforeach remote $all_remotes {\n\t\t$m add command -label \"$pfx $remote...\" \\\n\t\t\t-command [list $op $remote] \\\n\t\t\t-font $font_ui\n\t}\n}\n\nproc populate_pull_menu {m} {\n\tglobal gitdir repo_config all_remotes font_ui disable_on_lock\n\n\tforeach remote $all_remotes {\n\t\tset rb {}\n\t\tif {[array get repo_config remote.$remote.url] != {}} {\n\t\t\tif {[array get repo_config remote.$remote.fetch] != {}} {\n\t\t\t\tregexp {^([^:]+):} \\\n\t\t\t\t\t[lindex $repo_config(remote.$remote.fetch) 0] \\\n\t\t\t\t\tline rb\n\t\t\t}\n\t\t} else {\n\t\t\tcatch {\n\t\t\t\tset fd [open [file join $gitdir remotes $remote] r]\n\t\t\t\twhile {[gets $fd line] >= 0} {\n\t\t\t\t\tif {[regexp {^Pull:[ \\t]*([^:]+):} $line line rb]} {\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tclose $fd\n\t\t\t}\n\t\t}\n\n\t\tset rb_short $rb\n\t\tregsub ^refs/heads/ $rb {} rb_short\n\t\tif {$rb_short != {}} {\n\t\t\t$m add command \\\n\t\t\t\t-label \"Branch $rb_short from $remote...\" \\\n\t\t\t\t-command [list pull_remote $remote $rb] \\\n\t\t\t\t-font $font_ui\n\t\t\tlappend disable_on_lock \\\n\t\t\t\t[list $m entryconf [$m index last] -state]\n\t\t}\n\t}\n}\n\n######################################################################\n##\n## icons\n\nset filemask {\n#define mask_width 14\n#define mask_height 15\nstatic unsigned char mask_bits[] = {\n   0xfe, 0x1f, 0xfe, 0x1f, 0xfe, 0x1f, 0xfe, 0x1f, 0xfe, 0x1f, 0xfe, 0x1f,\n   0xfe, 0x1f, 0xfe, 0x1f, 0xfe, 0x1f, 0xfe, 0x1f, 0xfe, 0x1f, 0xfe, 0x1f,\n   0xfe, 0x1f, 0xfe, 0x1f, 0xfe, 0x1f};\n}\n\nimage create bitmap file_plain -background white -foreground black -data {\n#define plain_width 14\n#define plain_height 15\nstatic unsigned char plain_bits[] = {\n   0xfe, 0x01, 0x02, 0x03, 0x02, 0x05, 0x02, 0x09, 0x02, 0x1f, 0x02, 0x10,\n   0x02, 0x10, 0x02, 0x10, 0x02, 0x10, 0x02, 0x10, 0x02, 0x10, 0x02, 0x10,\n   0x02, 0x10, 0x02, 0x10, 0xfe, 0x1f};\n} -maskdata $filemask\n\nimage create bitmap file_mod -background white -foreground blue -data {\n#define mod_width 14\n#define mod_height 15\nstatic unsigned char mod_bits[] = {\n   0xfe, 0x01, 0x02, 0x03, 0x7a, 0x05, 0x02, 0x09, 0x7a, 0x1f, 0x02, 0x10,\n   0xfa, 0x17, 0x02, 0x10, 0xfa, 0x17, 0x02, 0x10, 0xfa, 0x17, 0x02, 0x10,\n   0xfa, 0x17, 0x02, 0x10, 0xfe, 0x1f};\n} -maskdata $filemask\n\nimage create bitmap file_fulltick -background white -foreground \"#007000\" -data {\n#define file_fulltick_width 14\n#define file_fulltick_height 15\nstatic unsigned char file_fulltick_bits[] = {\n   0xfe, 0x01, 0x02, 0x1a, 0x02, 0x0c, 0x02, 0x0c, 0x02, 0x16, 0x02, 0x16,\n   0x02, 0x13, 0x00, 0x13, 0x86, 0x11, 0x8c, 0x11, 0xd8, 0x10, 0xf2, 0x10,\n   0x62, 0x10, 0x02, 0x10, 0xfe, 0x1f};\n} -maskdata $filemask\n\nimage create bitmap file_parttick -background white -foreground \"#005050\" -data {\n#define parttick_width 14\n#define parttick_height 15\nstatic unsigned char parttick_bits[] = {\n   0xfe, 0x01, 0x02, 0x03, 0x7a, 0x05, 0x02, 0x09, 0x7a, 0x1f, 0x02, 0x10,\n   0x7a, 0x14, 0x02, 0x16, 0x02, 0x13, 0x8a, 0x11, 0xda, 0x10, 0x72, 0x10,\n   0x22, 0x10, 0x02, 0x10, 0xfe, 0x1f};\n} -maskdata $filemask\n\nimage create bitmap file_question -background white -foreground black -data {\n#define file_question_width 14\n#define file_question_height 15\nstatic unsigned char file_question_bits[] = {\n   0xfe, 0x01, 0x02, 0x02, 0xe2, 0x04, 0xf2, 0x09, 0x1a, 0x1b, 0x0a, 0x13,\n   0x82, 0x11, 0xc2, 0x10, 0x62, 0x10, 0x62, 0x10, 0x02, 0x10, 0x62, 0x10,\n   0x62, 0x10, 0x02, 0x10, 0xfe, 0x1f};\n} -maskdata $filemask\n\nimage create bitmap file_removed -background white -foreground red -data {\n#define file_removed_width 14\n#define file_removed_height 15\nstatic unsigned char file_removed_bits[] = {\n   0xfe, 0x01, 0x02, 0x03, 0x02, 0x05, 0x02, 0x09, 0x02, 0x1f, 0x02, 0x10,\n   0x1a, 0x16, 0x32, 0x13, 0xe2, 0x11, 0xc2, 0x10, 0xe2, 0x11, 0x32, 0x13,\n   0x1a, 0x16, 0x02, 0x10, 0xfe, 0x1f};\n} -maskdata $filemask\n\nimage create bitmap file_merge -background white -foreground blue -data {\n#define file_merge_width 14\n#define file_merge_height 15\nstatic unsigned char file_merge_bits[] = {\n   0xfe, 0x01, 0x02, 0x03, 0x62, 0x05, 0x62, 0x09, 0x62, 0x1f, 0x62, 0x10,\n   0xfa, 0x11, 0xf2, 0x10, 0x62, 0x10, 0x02, 0x10, 0xfa, 0x17, 0x02, 0x10,\n   0xfa, 0x17, 0x02, 0x10, 0xfe, 0x1f};\n} -maskdata $filemask\n\nset ui_index .vpane.files.index.list\nset ui_other .vpane.files.other.list\nset max_status_desc 0\nforeach i {\n\t\t{__ i plain    \"Unmodified\"}\n\t\t{_M i mod      \"Modified\"}\n\t\t{M_ i fulltick \"Checked in\"}\n\t\t{MM i parttick \"Partially included\"}\n\n\t\t{_O o plain    \"Untracked\"}\n\t\t{A_ o fulltick \"Added\"}\n\t\t{AM o parttick \"Partially added\"}\n\t\t{AD o question \"Added (but now gone)\"}\n\n\t\t{_D i question \"Missing\"}\n\t\t{D_ i removed  \"Removed\"}\n\t\t{DD i removed  \"Removed\"}\n\t\t{DO i removed  \"Removed (still exists)\"}\n\n\t\t{UM i merge    \"Merge conflicts\"}\n\t\t{U_ i merge    \"Merge conflicts\"}\n\t} {\n\tif {$max_status_desc < [string length [lindex $i 3]]} {\n\t\tset max_status_desc [string length [lindex $i 3]]\n\t}\n\tif {[lindex $i 1] == {i}} {\n\t\tset all_cols([lindex $i 0]) $ui_index\n\t} else {\n\t\tset all_cols([lindex $i 0]) $ui_other\n\t}\n\tset all_icons([lindex $i 0]) file_[lindex $i 2]\n\tset all_descs([lindex $i 0]) [lindex $i 3]\n}\nunset filemask i\n\n######################################################################\n##\n## util\n\nproc hook_failed_popup {hook msg} {\n\tglobal gitdir font_ui font_diff appname\n\n\tset w .hookfail\n\ttoplevel $w\n\twm transient $w .\n\n\tframe $w.m\n\tlabel $w.m.l1 -text \"$hook hook failed:\" \\\n\t\t-anchor w \\\n\t\t-justify left \\\n\t\t-font [concat $font_ui bold]\n\ttext $w.m.t \\\n\t\t-background white -borderwidth 1 \\\n\t\t-relief sunken \\\n\t\t-width 80 -height 10 \\\n\t\t-font $font_diff \\\n\t\t-yscrollcommand [list $w.m.sby set]\n\tlabel $w.m.l2 \\\n\t\t-text {You must correct the above errors before committing.} \\\n\t\t-anchor w \\\n\t\t-justify left \\\n\t\t-font [concat $font_ui bold]\n\tscrollbar $w.m.sby -command [list $w.m.t yview]\n\tpack $w.m.l1 -side top -fill x\n\tpack $w.m.l2 -side bottom -fill x\n\tpack $w.m.sby -side right -fill y\n\tpack $w.m.t -side left -fill both -expand 1\n\tpack $w.m -side top -fill both -expand 1 -padx 5 -pady 10\n\n\t$w.m.t insert 1.0 $msg\n\t$w.m.t conf -state disabled\n\n\tbutton $w.ok -text OK \\\n\t\t-width 15 \\\n\t\t-font $font_ui \\\n\t\t-command \"destroy $w\"\n\tpack $w.ok -side bottom\n\n\tbind $w <Visibility> \"grab $w; focus $w\"\n\tbind $w <Key-Return> \"destroy $w\"\n\twm title $w \"$appname ([lindex [file split \\\n\t\t[file normalize [file dirname $gitdir]]] \\\n\t\tend]): error\"\n\ttkwait window $w\n}\n\nset next_console_id 0\n\nproc new_console {short_title long_title} {\n\tglobal next_console_id console_data\n\tset w .console[incr next_console_id]\n\tset console_data($w) [list $short_title $long_title]\n\treturn [console_init $w]\n}\n\nproc console_init {w} {\n\tglobal console_cr console_data\n\tglobal gitdir appname font_ui font_diff M1B\n\n\tset console_cr($w) 1.0\n\ttoplevel $w\n\tframe $w.m\n\tlabel $w.m.l1 -text \"[lindex $console_data($w) 1]:\" \\\n\t\t-anchor w \\\n\t\t-justify left \\\n\t\t-font [concat $font_ui bold]\n\ttext $w.m.t \\\n\t\t-background white -borderwidth 1 \\\n\t\t-relief sunken \\\n\t\t-width 80 -height 10 \\\n\t\t-font $font_diff \\\n\t\t-state disabled \\\n\t\t-yscrollcommand [list $w.m.sby set]\n\tlabel $w.m.s -anchor w \\\n\t\t-justify left \\\n\t\t-font [concat $font_ui bold]\n\tscrollbar $w.m.sby -command [list $w.m.t yview]\n\tpack $w.m.l1 -side top -fill x\n\tpack $w.m.s -side bottom -fill x\n\tpack $w.m.sby -side right -fill y\n\tpack $w.m.t -side left -fill both -expand 1\n\tpack $w.m -side top -fill both -expand 1 -padx 5 -pady 10\n\n\tmenu $w.ctxm -tearoff 0\n\t$w.ctxm add command -label \"Copy\" \\\n\t\t-font $font_ui \\\n\t\t-command \"tk_textCopy $w.m.t\"\n\t$w.ctxm add command -label \"Select All\" \\\n\t\t-font $font_ui \\\n\t\t-command \"$w.m.t tag add sel 0.0 end\"\n\t$w.ctxm add command -label \"Copy All\" \\\n\t\t-font $font_ui \\\n\t\t-command \"\n\t\t\t$w.m.t tag add sel 0.0 end\n\t\t\ttk_textCopy $w.m.t\n\t\t\t$w.m.t tag remove sel 0.0 end\n\t\t\"\n\n\tbutton $w.ok -text {Running...} \\\n\t\t-width 15 \\\n\t\t-font $font_ui \\\n\t\t-state disabled \\\n\t\t-command \"destroy $w\"\n\tpack $w.ok -side bottom\n\n\tbind $w.m.t <Any-Button-3> \"tk_popup $w.ctxm %X %Y\"\n\tbind $w.m.t <$M1B-Key-a> \"$w.m.t tag add sel 0.0 end;break\"\n\tbind $w.m.t <$M1B-Key-A> \"$w.m.t tag add sel 0.0 end;break\"\n\tbind $w <Visibility> \"focus $w\"\n\twm title $w \"$appname ([lindex [file split \\\n\t\t[file normalize [file dirname $gitdir]]] \\\n\t\tend]): [lindex $console_data($w) 0]\"\n\treturn $w\n}\n\nproc console_exec {w cmd {after {}}} {\n\tglobal tcl_platform\n\n\t# -- Windows tosses the enviroment when we exec our child.\n\t#    But most users need that so we have to relogin. :-(\n\t#\n\tif {$tcl_platform(platform) == {windows}} {\n\t\tset cmd [list sh --login -c \"cd \\\"[pwd]\\\" && [join $cmd { }]\"]\n\t}\n\n\t# -- Tcl won't let us redirect both stdout and stderr to\n\t#    the same pipe.  So pass it through cat...\n\t#\n\tset cmd [concat | $cmd |& cat]\n\n\tset fd_f [open $cmd r]\n\tfconfigure $fd_f -blocking 0 -translation binary\n\tfileevent $fd_f readable [list console_read $w $fd_f $after]\n}\n\nproc console_read {w fd after} {\n\tglobal console_cr console_data\n\n\tset buf [read $fd]\n\tif {$buf != {}} {\n\t\tif {![winfo exists $w]} {console_init $w}\n\t\t$w.m.t conf -state normal\n\t\tset c 0\n\t\tset n [string length $buf]\n\t\twhile {$c < $n} {\n\t\t\tset cr [string first \"\\r\" $buf $c]\n\t\t\tset lf [string first \"\\n\" $buf $c]\n\t\t\tif {$cr < 0} {set cr [expr $n + 1]}\n\t\t\tif {$lf < 0} {set lf [expr $n + 1]}\n\n\t\t\tif {$lf < $cr} {\n\t\t\t\t$w.m.t insert end [string range $buf $c $lf]\n\t\t\t\tset console_cr($w) [$w.m.t index {end -1c}]\n\t\t\t\tset c $lf\n\t\t\t\tincr c\n\t\t\t} else {\n\t\t\t\t$w.m.t delete $console_cr($w) end\n\t\t\t\t$w.m.t insert end \"\\n\"\n\t\t\t\t$w.m.t insert end [string range $buf $c $cr]\n\t\t\t\tset c $cr\n\t\t\t\tincr c\n\t\t\t}\n\t\t}\n\t\t$w.m.t conf -state disabled\n\t\t$w.m.t see end\n\t}\n\n\tfconfigure $fd -blocking 1\n\tif {[eof $fd]} {\n\t\tif {[catch {close $fd}]} {\n\t\t\tif {![winfo exists $w]} {console_init $w}\n\t\t\t$w.m.s conf -background red -text {Error: Command Failed}\n\t\t\t$w.ok conf -text Close\n\t\t\t$w.ok conf -state normal\n\t\t\tset ok 0\n\t\t} elseif {[winfo exists $w]} {\n\t\t\t$w.m.s conf -background green -text {Success}\n\t\t\t$w.ok conf -text Close\n\t\t\t$w.ok conf -state normal\n\t\t\tset ok 1\n\t\t}\n\t\tarray unset console_cr $w\n\t\tarray unset console_data $w\n\t\tif {$after != {}} {\n\t\t\tuplevel #0 $after $ok\n\t\t}\n\t\treturn\n\t}\n\tfconfigure $fd -blocking 0\n}\n\n######################################################################\n##\n## ui commands\n\nset starting_gitk_msg {Please wait... Starting gitk...}\n\nproc do_gitk {} {\n\tglobal tcl_platform ui_status_value starting_gitk_msg\n\n\tset ui_status_value $starting_gitk_msg\n\tafter 10000 {\n\t\tif {$ui_status_value == $starting_gitk_msg} {\n\t\t\tset ui_status_value {Ready.}\n\t\t}\n\t}\n\n\tif {$tcl_platform(platform) == {windows}} {\n\t\texec sh -c gitk &\n\t} else {\n\t\texec gitk &\n\t}\n}\n\nproc do_repack {} {\n\tset w [new_console \"repack\" \"Repacking the object database\"]\n\tset cmd [list git repack]\n\tlappend cmd -a\n\tlappend cmd -d\n\tconsole_exec $w $cmd\n}\n\nset quitting 0\n\nproc do_quit {} {\n\tglobal gitdir ui_comm quitting\n\n\tif {$quitting} return\n\tset quitting 1\n\n\tset save [file join $gitdir GITGUI_MSG]\n\tset msg [string trim [$ui_comm get 0.0 end]]\n\tif {[$ui_comm edit modified] && $msg != {}} {\n\t\tcatch {\n\t\t\tset fd [open $save w]\n\t\t\tputs $fd [string trim [$ui_comm get 0.0 end]]\n\t\t\tclose $fd\n\t\t}\n\t} elseif {$msg == {} && [file exists $save]} {\n\t\tfile delete $save\n\t}\n\n\tsave_my_config\n\tdestroy .\n}\n\nproc do_rescan {} {\n\tupdate_status\n}\n\nproc do_include_all {} {\n\tglobal update_active ui_status_value\n\n\tif {$update_active || ![lock_index begin-update]} return\n\n\tset update_active 1\n\tset ui_status_value {Including all modified files...}\n\tafter 1 {\n\t\twith_update_index {\n\t\t\tforeach path [array names file_states] {\n\t\t\t\tset s $file_states($path)\n\t\t\t\tset m [lindex $s 0]\n\t\t\t\tswitch -- $m {\n\t\t\t\tAM -\n\t\t\t\tMM -\n\t\t\t\t_M -\n\t\t\t\t_D {toggle_mode $path}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tset update_active 0\n\t\tset ui_status_value {Ready.}\n\t}\n}\n\nset GIT_COMMITTER_IDENT {}\n\nproc do_signoff {} {\n\tglobal ui_comm GIT_COMMITTER_IDENT\n\n\tif {$GIT_COMMITTER_IDENT == {}} {\n\t\tif {[catch {set me [exec git var GIT_COMMITTER_IDENT]} err]} {\n\t\t\terror_popup \"Unable to obtain your identity:\\n\\n$err\"\n\t\t\treturn\n\t\t}\n\t\tif {![regexp {^(.*) [0-9]+ [-+0-9]+$} \\\n\t\t\t$me me GIT_COMMITTER_IDENT]} {\n\t\t\terror_popup \"Invalid GIT_COMMITTER_IDENT:\\n\\n$me\"\n\t\t\treturn\n\t\t}\n\t}\n\n\tset sob \"Signed-off-by: $GIT_COMMITTER_IDENT\"\n\tset last [$ui_comm get {end -1c linestart} {end -1c}]\n\tif {$last != $sob} {\n\t\t$ui_comm edit separator\n\t\tif {$last != {}\n\t\t\t&& ![regexp {^[A-Z][A-Za-z]*-[A-Za-z-]+: *} $last]} {\n\t\t\t$ui_comm insert end \"\\n\"\n\t\t}\n\t\t$ui_comm insert end \"\\n$sob\"\n\t\t$ui_comm edit separator\n\t\t$ui_comm see end\n\t}\n}\n\nproc do_amend_last {} {\n\tload_last_commit\n}\n\nproc do_commit {} {\n\tcommit_tree\n}\n\n# shift == 1: left click\n#          3: right click  \nproc click {w x y shift wx wy} {\n\tglobal ui_index ui_other file_lists\n\n\tset pos [split [$w index @$x,$y] .]\n\tset lno [lindex $pos 0]\n\tset col [lindex $pos 1]\n\tset path [lindex $file_lists($w) [expr $lno - 1]]\n\tif {$path == {}} return\n\n\tif {$col > 0 && $shift == 1} {\n\t\tshow_diff $path $w $lno\n\t}\n}\n\nproc unclick {w x y} {\n\tglobal file_lists\n\n\tset pos [split [$w index @$x,$y] .]\n\tset lno [lindex $pos 0]\n\tset col [lindex $pos 1]\n\tset path [lindex $file_lists($w) [expr $lno - 1]]\n\tif {$path == {}} return\n\n\tif {$col == 0} {\n\t\ttoggle_mode $path\n\t}\n}\n\n######################################################################\n##\n## ui init\n\nset font_ui {Helvetica 10}\nset font_diff {Courier 10}\nset cursor_ptr left_ptr\n\nswitch -glob -- \"$tcl_platform(platform),$tcl_platform(os)\" {\nwindows,*   {set M1B Control; set M1T Ctrl}\nunix,Darwin {set M1B M1; set M1T Cmd}\n*           {set M1B M1; set M1T M1}\n}\n\n# -- Menu Bar\nmenu .mbar -tearoff 0\n.mbar add cascade -label Project -menu .mbar.project\n.mbar add cascade -label Edit -menu .mbar.edit\n.mbar add cascade -label Commit -menu .mbar.commit\n.mbar add cascade -label Fetch -menu .mbar.fetch\n.mbar add cascade -label Pull -menu .mbar.pull\n.mbar add cascade -label Push -menu .mbar.push\n.mbar add cascade -label Options -menu .mbar.options\n. configure -menu .mbar\n\n# -- Project Menu\nmenu .mbar.project\n.mbar.project add command -label Visualize \\\n\t-command do_gitk \\\n\t-font $font_ui\n.mbar.project add command -label {Repack Database} \\\n\t-command do_repack \\\n\t-font $font_ui\n.mbar.project add command -label Quit \\\n\t-command do_quit \\\n\t-accelerator $M1T-Q \\\n\t-font $font_ui\n\n# -- Edit Menu\n#\nmenu .mbar.edit\n.mbar.edit add command -label Undo \\\n\t-command {catch {[focus] edit undo}} \\\n\t-accelerator $M1T-Z \\\n\t-font $font_ui\n.mbar.edit add command -label Redo \\\n\t-command {catch {[focus] edit redo}} \\\n\t-accelerator $M1T-Y \\\n\t-font $font_ui\n.mbar.edit add separator\n.mbar.edit add command -label Cut \\\n\t-command {catch {tk_textCut [focus]}} \\\n\t-accelerator $M1T-X \\\n\t-font $font_ui\n.mbar.edit add command -label Copy \\\n\t-command {catch {tk_textCopy [focus]}} \\\n\t-accelerator $M1T-C \\\n\t-font $font_ui\n.mbar.edit add command -label Paste \\\n\t-command {catch {tk_textPaste [focus]; [focus] see insert}} \\\n\t-accelerator $M1T-V \\\n\t-font $font_ui\n.mbar.edit add command -label Delete \\\n\t-command {catch {[focus] delete sel.first sel.last}} \\\n\t-accelerator Del \\\n\t-font $font_ui\n.mbar.edit add separator\n.mbar.edit add command -label {Select All} \\\n\t-command {catch {[focus] tag add sel 0.0 end}} \\\n\t-accelerator $M1T-A \\\n\t-font $font_ui\n\n# -- Commit Menu\nmenu .mbar.commit\n.mbar.commit add command -label Rescan \\\n\t-command do_rescan \\\n\t-accelerator F5 \\\n\t-font $font_ui\nlappend disable_on_lock \\\n\t[list .mbar.commit entryconf [.mbar.commit index last] -state]\n.mbar.commit add command -label {Amend Last Commit} \\\n\t-command do_amend_last \\\n\t-font $font_ui\nlappend disable_on_lock \\\n\t[list .mbar.commit entryconf [.mbar.commit index last] -state]\n.mbar.commit add command -label {Include All Files} \\\n\t-command do_include_all \\\n\t-accelerator $M1T-I \\\n\t-font $font_ui\nlappend disable_on_lock \\\n\t[list .mbar.commit entryconf [.mbar.commit index last] -state]\n.mbar.commit add command -label {Sign Off} \\\n\t-command do_signoff \\\n\t-accelerator $M1T-S \\\n\t-font $font_ui\n.mbar.commit add command -label Commit \\\n\t-command do_commit \\\n\t-accelerator $M1T-Return \\\n\t-font $font_ui\nlappend disable_on_lock \\\n\t[list .mbar.commit entryconf [.mbar.commit index last] -state]\n\n# -- Fetch Menu\nmenu .mbar.fetch\n\n# -- Pull Menu\nmenu .mbar.pull\n\n# -- Push Menu\nmenu .mbar.push\n\n# -- Options Menu\nmenu .mbar.options\n.mbar.options add checkbutton \\\n\t-label {Trust File Modification Timestamps} \\\n\t-font $font_ui \\\n\t-offvalue false \\\n\t-onvalue true \\\n\t-variable cfg_trust_mtime\n\n# -- Main Window Layout\npanedwindow .vpane -orient vertical\npanedwindow .vpane.files -orient horizontal\n.vpane add .vpane.files -sticky nsew -height 100 -width 400\npack .vpane -anchor n -side top -fill both -expand 1\n\n# -- Index File List\nframe .vpane.files.index -height 100 -width 400\nlabel .vpane.files.index.title -text {Modified Files} \\\n\t-background green \\\n\t-font $font_ui\ntext $ui_index -background white -borderwidth 0 \\\n\t-width 40 -height 10 \\\n\t-font $font_ui \\\n\t-cursor $cursor_ptr \\\n\t-yscrollcommand {.vpane.files.index.sb set} \\\n\t-state disabled\nscrollbar .vpane.files.index.sb -command [list $ui_index yview]\npack .vpane.files.index.title -side top -fill x\npack .vpane.files.index.sb -side right -fill y\npack $ui_index -side left -fill both -expand 1\n.vpane.files add .vpane.files.index -sticky nsew\n\n# -- Other (Add) File List\nframe .vpane.files.other -height 100 -width 100\nlabel .vpane.files.other.title -text {Untracked Files} \\\n\t-background red \\\n\t-font $font_ui\ntext $ui_other -background white -borderwidth 0 \\\n\t-width 40 -height 10 \\\n\t-font $font_ui \\\n\t-cursor $cursor_ptr \\\n\t-yscrollcommand {.vpane.files.other.sb set} \\\n\t-state disabled\nscrollbar .vpane.files.other.sb -command [list $ui_other yview]\npack .vpane.files.other.title -side top -fill x\npack .vpane.files.other.sb -side right -fill y\npack $ui_other -side left -fill both -expand 1\n.vpane.files add .vpane.files.other -sticky nsew\n\n$ui_index tag conf in_diff -font [concat $font_ui bold]\n$ui_other tag conf in_diff -font [concat $font_ui bold]\n\n# -- Diff and Commit Area\nframe .vpane.lower -height 400 -width 400\nframe .vpane.lower.commarea\nframe .vpane.lower.diff -relief sunken -borderwidth 1\npack .vpane.lower.commarea -side top -fill x\npack .vpane.lower.diff -side bottom -fill both -expand 1\n.vpane add .vpane.lower -stick nsew\n\n# -- Commit Area Buttons\nframe .vpane.lower.commarea.buttons\nlabel .vpane.lower.commarea.buttons.l -text {} \\\n\t-anchor w \\\n\t-justify left \\\n\t-font $font_ui\npack .vpane.lower.commarea.buttons.l -side top -fill x\npack .vpane.lower.commarea.buttons -side left -fill y\n\nbutton .vpane.lower.commarea.buttons.rescan -text {Rescan} \\\n\t-command do_rescan \\\n\t-font $font_ui\npack .vpane.lower.commarea.buttons.rescan -side top -fill x\nlappend disable_on_lock \\\n\t{.vpane.lower.commarea.buttons.rescan conf -state}\n\nbutton .vpane.lower.commarea.buttons.amend -text {Amend Last} \\\n\t-command do_amend_last \\\n\t-font $font_ui\npack .vpane.lower.commarea.buttons.amend -side top -fill x\nlappend disable_on_lock \\\n\t{.vpane.lower.commarea.buttons.amend conf -state}\n\nbutton .vpane.lower.commarea.buttons.incall -text {Include All} \\\n\t-command do_include_all \\\n\t-font $font_ui\npack .vpane.lower.commarea.buttons.incall -side top -fill x\nlappend disable_on_lock \\\n\t{.vpane.lower.commarea.buttons.incall conf -state}\n\nbutton .vpane.lower.commarea.buttons.signoff -text {Sign Off} \\\n\t-command do_signoff \\\n\t-font $font_ui\npack .vpane.lower.commarea.buttons.signoff -side top -fill x\n\nbutton .vpane.lower.commarea.buttons.commit -text {Commit} \\\n\t-command do_commit \\\n\t-font $font_ui\npack .vpane.lower.commarea.buttons.commit -side top -fill x\nlappend disable_on_lock \\\n\t{.vpane.lower.commarea.buttons.commit conf -state}\n\n# -- Commit Message Buffer\nframe .vpane.lower.commarea.buffer\nset ui_comm .vpane.lower.commarea.buffer.t\nset ui_coml .vpane.lower.commarea.buffer.l\nlabel $ui_coml -text {Commit Message:} \\\n\t-anchor w \\\n\t-justify left \\\n\t-font $font_ui\ntrace add variable commit_type write {uplevel #0 {\n\tswitch -glob $commit_type \\\n\tinitial {$ui_coml conf -text {Initial Commit Message:}} \\\n\tamend   {$ui_coml conf -text {Amended Commit Message:}} \\\n\tmerge   {$ui_coml conf -text {Merge Commit Message:}} \\\n\t*       {$ui_coml conf -text {Commit Message:}}\n}}\ntext $ui_comm -background white -borderwidth 1 \\\n\t-undo true \\\n\t-maxundo 20 \\\n\t-autoseparators true \\\n\t-relief sunken \\\n\t-width 75 -height 9 -wrap none \\\n\t-font $font_diff \\\n\t-yscrollcommand {.vpane.lower.commarea.buffer.sby set}\nscrollbar .vpane.lower.commarea.buffer.sby \\\n\t-command [list $ui_comm yview]\npack $ui_coml -side top -fill x\npack .vpane.lower.commarea.buffer.sby -side right -fill y\npack $ui_comm -side left -fill y\npack .vpane.lower.commarea.buffer -side left -fill y\n\n# -- Commit Message Buffer Context Menu\n#\nmenu $ui_comm.ctxm -tearoff 0\n$ui_comm.ctxm add command -label \"Cut\" \\\n\t-font $font_ui \\\n\t-command \"tk_textCut $ui_comm\"\n$ui_comm.ctxm add command -label \"Copy\" \\\n\t-font $font_ui \\\n\t-command \"tk_textCopy $ui_comm\"\n$ui_comm.ctxm add command -label \"Paste\" \\\n\t-font $font_ui \\\n\t-command \"tk_textPaste $ui_comm\"\n$ui_comm.ctxm add command -label \"Delete\" \\\n\t-font $font_ui \\\n\t-command \"$ui_comm delete sel.first sel.last\"\n$ui_comm.ctxm add separator\n$ui_comm.ctxm add command -label \"Select All\" \\\n\t-font $font_ui \\\n\t-command \"$ui_comm tag add sel 0.0 end\"\n$ui_comm.ctxm add command -label \"Copy All\" \\\n\t-font $font_ui \\\n\t-command \"\n\t\t$ui_comm tag add sel 0.0 end\n\t\ttk_textCopy $ui_comm\n\t\t$ui_comm tag remove sel 0.0 end\n\t\"\n$ui_comm.ctxm add separator\n$ui_comm.ctxm add command -label \"Sign Off\" \\\n\t-font $font_ui \\\n\t-command do_signoff\nbind $ui_comm <Any-Button-3> \"tk_popup $ui_comm.ctxm %X %Y\"\n\n# -- Diff Header\nset ui_fname_value {}\nset ui_fstatus_value {}\nframe .vpane.lower.diff.header -background orange\nlabel .vpane.lower.diff.header.l1 -text {File:} \\\n\t-background orange \\\n\t-font $font_ui\nlabel .vpane.lower.diff.header.l2 -textvariable ui_fname_value \\\n\t-background orange \\\n\t-anchor w \\\n\t-justify left \\\n\t-font $font_ui\nlabel .vpane.lower.diff.header.l3 -text {Status:} \\\n\t-background orange \\\n\t-font $font_ui\nlabel .vpane.lower.diff.header.l4 -textvariable ui_fstatus_value \\\n\t-background orange \\\n\t-width $max_status_desc \\\n\t-anchor w \\\n\t-justify left \\\n\t-font $font_ui\npack .vpane.lower.diff.header.l1 -side left\npack .vpane.lower.diff.header.l2 -side left -fill x\npack .vpane.lower.diff.header.l4 -side right\npack .vpane.lower.diff.header.l3 -side right\n\n# -- Diff Body\nframe .vpane.lower.diff.body\nset ui_diff .vpane.lower.diff.body.t\ntext $ui_diff -background white -borderwidth 0 \\\n\t-width 80 -height 15 -wrap none \\\n\t-font $font_diff \\\n\t-xscrollcommand {.vpane.lower.diff.body.sbx set} \\\n\t-yscrollcommand {.vpane.lower.diff.body.sby set} \\\n\t-state disabled\nscrollbar .vpane.lower.diff.body.sbx -orient horizontal \\\n\t-command [list $ui_diff xview]\nscrollbar .vpane.lower.diff.body.sby -orient vertical \\\n\t-command [list $ui_diff yview]\npack .vpane.lower.diff.body.sbx -side bottom -fill x\npack .vpane.lower.diff.body.sby -side right -fill y\npack $ui_diff -side left -fill both -expand 1\npack .vpane.lower.diff.header -side top -fill x\npack .vpane.lower.diff.body -side bottom -fill both -expand 1\n\n$ui_diff tag conf dm -foreground red\n$ui_diff tag conf dp -foreground blue\n$ui_diff tag conf da -font [concat $font_diff bold]\n$ui_diff tag conf di -foreground \"#00a000\"\n$ui_diff tag conf dni -foreground \"#a000a0\"\n$ui_diff tag conf bold -font [concat $font_diff bold]\n\n# -- Diff Body Context Menu\n#\nmenu $ui_diff.ctxm -tearoff 0\n$ui_diff.ctxm add command -label \"Copy\" \\\n\t-font $font_ui \\\n\t-command \"tk_textCopy $ui_diff\"\n$ui_diff.ctxm add command -label \"Select All\" \\\n\t-font $font_ui \\\n\t-command \"$ui_diff tag add sel 0.0 end\"\n$ui_diff.ctxm add command -label \"Copy All\" \\\n\t-font $font_ui \\\n\t-command \"\n\t\t$ui_diff tag add sel 0.0 end\n\t\ttk_textCopy $ui_diff\n\t\t$ui_diff tag remove sel 0.0 end\n\t\"\nbind $ui_diff <Any-Button-3> \"tk_popup $ui_diff.ctxm %X %Y\"\n\n# -- Status Bar\nset ui_status_value {Initializing...}\nlabel .status -textvariable ui_status_value \\\n\t-anchor w \\\n\t-justify left \\\n\t-borderwidth 1 \\\n\t-relief sunken \\\n\t-font $font_ui\npack .status -anchor w -side bottom -fill x\n\n# -- Load geometry\ncatch {\nset gm [lindex $repo_config(gui.geometry) 0]\nwm geometry . [lindex $gm 0]\n.vpane sash place 0 \\\n\t[lindex [.vpane sash coord 0] 0] \\\n\t[lindex $gm 1]\n.vpane.files sash place 0 \\\n\t[lindex $gm 2] \\\n\t[lindex [.vpane.files sash coord 0] 1]\nunset gm\n}\n\n# -- Key Bindings\nbind $ui_comm <$M1B-Key-Return> {do_commit;break}\nbind $ui_comm <$M1B-Key-i> {do_include_all;break}\nbind $ui_comm <$M1B-Key-I> {do_include_all;break}\nbind $ui_comm <$M1B-Key-x> {tk_textCut %W;break}\nbind $ui_comm <$M1B-Key-X> {tk_textCut %W;break}\nbind $ui_comm <$M1B-Key-c> {tk_textCopy %W;break}\nbind $ui_comm <$M1B-Key-C> {tk_textCopy %W;break}\nbind $ui_comm <$M1B-Key-v> {tk_textPaste %W; %W see insert; break}\nbind $ui_comm <$M1B-Key-V> {tk_textPaste %W; %W see insert; break}\nbind $ui_comm <$M1B-Key-a> {%W tag add sel 0.0 end;break}\nbind $ui_comm <$M1B-Key-A> {%W tag add sel 0.0 end;break}\n\nbind $ui_diff <$M1B-Key-x> {tk_textCopy %W;break}\nbind $ui_diff <$M1B-Key-X> {tk_textCopy %W;break}\nbind $ui_diff <$M1B-Key-c> {tk_textCopy %W;break}\nbind $ui_diff <$M1B-Key-C> {tk_textCopy %W;break}\nbind $ui_diff <$M1B-Key-v> {break}\nbind $ui_diff <$M1B-Key-V> {break}\nbind $ui_diff <$M1B-Key-a> {%W tag add sel 0.0 end;break}\nbind $ui_diff <$M1B-Key-A> {%W tag add sel 0.0 end;break}\nbind $ui_diff <Key-Up>     {catch {%W yview scroll -1 units};break}\nbind $ui_diff <Key-Down>   {catch {%W yview scroll  1 units};break}\nbind $ui_diff <Key-Left>   {catch {%W xview scroll -1 units};break}\nbind $ui_diff <Key-Right>  {catch {%W xview scroll  1 units};break}\n\nbind .   <Destroy> do_quit\nbind all <Key-F5> do_rescan\nbind all <$M1B-Key-r> do_rescan\nbind all <$M1B-Key-R> do_rescan\nbind .   <$M1B-Key-s> do_signoff\nbind .   <$M1B-Key-S> do_signoff\nbind .   <$M1B-Key-i> do_include_all\nbind .   <$M1B-Key-I> do_include_all\nbind .   <$M1B-Key-Return> do_commit\nbind all <$M1B-Key-q> do_quit\nbind all <$M1B-Key-Q> do_quit\nbind all <$M1B-Key-w> {destroy [winfo toplevel %W]}\nbind all <$M1B-Key-W> {destroy [winfo toplevel %W]}\nforeach i [list $ui_index $ui_other] {\n\tbind $i <Button-1> {click %W %x %y 1 %X %Y; break}\n\tbind $i <Button-3> {click %W %x %y 3 %X %Y; break}\n\tbind $i <ButtonRelease-1> {unclick %W %x %y; break}\n}\nunset i\n\nset file_lists($ui_index) [list]\nset file_lists($ui_other) [list]\n\nwm title . \"$appname ([file normalize [file dirname $gitdir]])\"\nfocus -force $ui_comm\nload_all_remotes\npopulate_remote_menu .mbar.fetch From fetch_from\npopulate_remote_menu .mbar.push To push_to\npopulate_pull_menu .mbar.pull\nupdate_status\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "008eeb44607cfb96aacc0823214c912ea74324d7",
  "sha1_ok": true,
  "size": 50040
}
