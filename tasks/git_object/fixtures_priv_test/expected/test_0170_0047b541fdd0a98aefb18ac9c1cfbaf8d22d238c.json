{
  "content": {
    "base64": "IyEvYmluL3NoCiMKIyAgICAgICAgLC0tLUUtLS4gICAqSC0tLS0tLS0tLS0uICAgICAgICAgICAgICogbWFya3MgIVRSRUVTQU1FIHBhcmVudCBwYXRocwojICAgICAgIC8gICAgICAgIFwgLyAgICAgICAgICAgICBcKgojICpBLS0qQi0tLUQtLSpGLSpHLS0tLS0tLS0tSy0qTC0qTQojICAgXCAgICAgLyogICAgICAgXCAgICAgICAvCiMgICAgYC1DLScgICAgICAgICAgYC0qSS0qSgojCiMgQSBjcmVhdGVzICJmaWxlIiwgQiBhbmQgRiBjaGFuZ2UgaXQuCiMgT2RkIG1lcmdlIEcgdGFrZXMgdGhlIG9sZCB2ZXJzaW9uIGZyb20gQi4KIyBJIGNoYW5nZXMgaXQsIGJ1dCBKIHJldmVydHMgaXQsIHNvIEsgaXMgVFJFRVNBTUUgdG8gYm90aCBwYXJlbnRzLgojIEggYW5kIEwgYm90aCBjaGFuZ2UgImZpbGUiLCBhbmQgTSBtZXJnZXMgdGhvc2UgY2hhbmdlcy4KCnRlc3RfZGVzY3JpcHRpb249J1RSRUVTQU1FIGFuZCBsaW1pdGluZycKCi4gLi90ZXN0LWxpYi5zaAoKbm90ZSAoKSB7CglnaXQgdGFnICIkMSIKfQoKdW5ub3RlICgpIHsKCWdpdCBuYW1lLXJldiAtLXRhZ3MgLS1zdGRpbiB8IHNlZCAtZSAic3wkX3g0MCAodGFncy9cKFteKV0qXCkpXChbIAldXCl8XDFcMnxnIgp9Cgp0ZXN0X2V4cGVjdF9zdWNjZXNzIHNldHVwICcKCXRlc3RfY29tbWl0ICJJbml0aWFsIGZpbGUiIGZpbGUgIkhpIHRoZXJlIiBBICYmCglnaXQgYnJhbmNoIG90aGVyLWJyYW5jaCAmJgoKCXRlc3RfY29tbWl0ICJmaWxlPUhlbGxvIiBmaWxlICJIZWxsbyIgQiAmJgoJZ2l0IGJyYW5jaCB0aGlyZC1icmFuY2ggJiYKCglnaXQgY2hlY2tvdXQgb3RoZXItYnJhbmNoICYmCgl0ZXN0X2NvbW1pdCAiQWRkZWQgb3RoZXIiIG90aGVyICJIZWxsbyIgQyAmJgoKCWdpdCBjaGVja291dCBtYXN0ZXIgJiYKCXRlc3RfbWVyZ2UgRCBvdGhlci1icmFuY2ggJiYKCglnaXQgY2hlY2tvdXQgdGhpcmQtYnJhbmNoICYmCgl0ZXN0X2NvbW1pdCAiVGhpcmQgZmlsZSIgdGhpcmQgIk5vdGhpbmciIEUgJiYKCglnaXQgY2hlY2tvdXQgbWFzdGVyICYmCgl0ZXN0X2NvbW1pdCAiZmlsZT1CbGFoIiBmaWxlICJCbGFoIiBGICYmCgoJdGVzdF90aWNrICYmIGdpdCBtZXJnZSAtLW5vLWNvbW1pdCB0aGlyZC1icmFuY2ggJiYKCWdpdCBjaGVja291dCB0aGlyZC1icmFuY2ggZmlsZSAmJgoJZ2l0IGNvbW1pdCAmJgoJbm90ZSBHICYmCglnaXQgYnJhbmNoIGZpZGRsZXItYnJhbmNoICYmCgoJZ2l0IGNoZWNrb3V0IC1iIHBhcnQyLWJyYW5jaCAmJgoJdGVzdF9jb21taXQgImZpbGU9UGFydCAyIiBmaWxlICJQYXJ0IDIiIEggJiYKCglnaXQgY2hlY2tvdXQgZmlkZGxlci1icmFuY2ggJiYKCXRlc3RfY29tbWl0ICJCYWQgY29tbWl0IiBmaWxlICJTaWxseSIgSSAmJgoKCXRlc3RfdGljayAmJiBnaXQgcmV2ZXJ0IEkgJiYgbm90ZSBKICYmCgoJZ2l0IGNoZWNrb3V0IG1hc3RlciAmJgoJdGVzdF90aWNrICYmIGdpdCBtZXJnZSAtLW5vLWZmIGZpZGRsZXItYnJhbmNoICYmCglub3RlIEsKCgl0ZXN0X2NvbW1pdCAiZmlsZT1QYXJ0IDEiIGZpbGUgIlBhcnQgMSIgTCAmJgoKCXRlc3RfdGljayAmJiB0ZXN0X211c3RfZmFpbCBnaXQgbWVyZ2UgcGFydDItYnJhbmNoICYmCgl0ZXN0X2NvbW1pdCBNIGZpbGUgIlBhcnRzIDErMiIKJwoKY2hlY2tfb3V0Y29tZSAoKSB7CglvdXRjb21lPSQxCglzaGlmdAoKCWNhc2UgIiQxIiBpbgoJKiIoIiopCgkJRk1UPSIlUAklSCB8ICVzIgoJCW11bmdlX2FjdHVhbD0iCgkJCXMvXlwoW14JXSpcKQlcKFteIF0qXCkgLiovKFwxKVwyLwoJCQlzLyAvL2cKCQkJcy8oKS8vCgkJIgoJCTs7CgkqKQoJCUZNVD0iJUggfCAlcyIKCQltdW5nZV9hY3R1YWw9InMvXlwoW14gXSpcKSAuKi9cMS8iCgkJOzsKCWVzYWMgJiYKCXByaW50ZiAiJXNcbiIgJDEgPmV4cGVjdCAmJgoJc2hpZnQKCglwYXJhbT0iJCoiICYmCgl0ZXN0X2V4cGVjdF8kb3V0Y29tZSAibG9nICRwYXJhbSIgJwoJCWdpdCBsb2cgLS1mb3JtYXQ9IiRGTVQiICRwYXJhbSB8CgkJdW5ub3RlID5hY3R1YWwgJiYKCQlzZWQgLWUgIiRtdW5nZV9hY3R1YWwiIDxhY3R1YWwgPmNoZWNrICYmCgkJdGVzdF9jbXAgZXhwZWN0IGNoZWNrIHx8IHsKCQkJY2F0IGFjdHVhbAoJCQlmYWxzZQoJCX0KCScKfQoKY2hlY2tfcmVzdWx0ICgpIHsKCWNoZWNrX291dGNvbWUgc3VjY2VzcyAiJEAiCn0KCiMgT2RkIG1lcmdlIEcgZHJvcHMgYSBjaGFuZ2UgaW4gRi4gSW1wb3J0YW50IHRoYXQgRyBpcyBsaXN0ZWQgaW4gYWxsCiMgZXhjZXB0IHRoZSBtb3N0IGJhc2ljIGxpc3QuIEFjaGlldmluZyB0aGlzIG1lYW5zIG5vcm1hbCBtZXJnZSBEIHdpbGwgYWxzbyBiZQojIHNob3duIGluIG5vcm1hbCBmdWxsLWhpc3RvcnksIGFzIHdlIGNhbid0IGRpc3Rpbmd1aXNoIHVubGVzcyB3ZSBkbyBhCiMgc2ltcGxpZmljYXRpb24gcGFzcy4gQWZ0ZXIgc2ltcGxpZmljYXRpb24sIEQgaXMgZHJvcHBlZCBidXQgRyByZW1haW5zLgojIEFsc28sIG1lcmdlIHNpbXBsaWZpY2F0aW9uIG9mIEcgc2hvdWxkIG5vdCBkcm9wIHRoZSBwYXJlbnQgQiB0aGF0IHRoZSBkZWZhdWx0CiMgc2ltcGxlIGhpc3RvcnkgZm9sbG93cy4KY2hlY2tfcmVzdWx0ICdNIEwgSyBKIEkgSCBHIEYgRSBEIEMgQiBBJwpjaGVja19yZXN1bHQgJyhMSClNIChLKUwgKEdKKUsgKEkpSiAoRylJIChHKUggKEZFKUcgKEQpRiAoQilFIChCQylEIChBKUMgKEEpQiBBJwpjaGVja19yZXN1bHQgJ00gSCBMIEsgSiBJIEcgRSBGIEQgQyBCIEEnIC0tdG9wby1vcmRlcgpjaGVja19yZXN1bHQgJ00gTCBIIEIgQScgLS0gZmlsZQpjaGVja19yZXN1bHQgJyhMSClNIChCKUwgKEIpSCAoQSlCIEEnIC0tcGFyZW50cyAtLSBmaWxlCmNoZWNrX3Jlc3VsdCAnTSBMIEogSSBIIEcgRiBEIEIgQScgLS1mdWxsLWhpc3RvcnkgLS0gZmlsZQpjaGVja19yZXN1bHQgJyhMSClNIChLKUwgKEdKKUsgKEkpSiAoRylJIChHKUggKEZCKUcgKEQpRiAoQkEpRCAoQSlCIEEnIC0tZnVsbC1oaXN0b3J5IC0tcGFyZW50cyAtLSBmaWxlCmNoZWNrX291dGNvbWUgZmFpbHVyZSAnKExIKU0gKEcpSCAoSilMIChJKUogKEcpSSAoRkIpRyAoQilGIChBKUIgQScgLS1zaW1wbGlmeS1tZXJnZXMgLS0gZmlsZSAjIGRyb3BzIHBhcmVudCBCIGZyb20gRwpjaGVja19yZXN1bHQgJ00gTCBLIEcgRiBEIEIgQScgLS1maXJzdC1wYXJlbnQKY2hlY2tfcmVzdWx0ICdNIEwgRyBGIEIgQScgLS1maXJzdC1wYXJlbnQgLS0gZmlsZQoKIyBDaGVjayB0aGF0IG9kZCBtZXJnZSBHIHJlbWFpbnMgc2hvd24gd2hlbiBGIGlzIHRoZSBib3R0b20uCmNoZWNrX3Jlc3VsdCAnTSBMIEsgSiBJIEggRyBFJyBGLi5NCmNoZWNrX3Jlc3VsdCAnTSBIIEwgSyBKIEkgRyBFJyBGLi5NIC0tdG9wby1vcmRlcgpjaGVja19yZXN1bHQgJ00gTCBIJyBGLi5NIC0tIGZpbGUKY2hlY2tfcmVzdWx0ICcoTEgpTSAoQilMIChCKUgnIC0tcGFyZW50cyBGLi5NIC0tIGZpbGUKY2hlY2tfcmVzdWx0ICdNIEwgSiBJIEggRycgRi4uTSAtLWZ1bGwtaGlzdG9yeSAtLSBmaWxlCmNoZWNrX3Jlc3VsdCAnKExIKU0gKEspTCAoR0opSyAoSSlKIChHKUkgKEcpSCAoRkIpRycgRi4uTSAtLWZ1bGwtaGlzdG9yeSAtLXBhcmVudHMgLS0gZmlsZQpjaGVja19vdXRjb21lIGZhaWx1cmUgJyhMSClNIChHKUggKEopTCAoSSlKIChHKUkgKEZCKUcnIEYuLk0gLS1zaW1wbGlmeS1tZXJnZXMgLS0gZmlsZSAjIGRyb3BzIHBhcmVudCBCIGZyb20gRwpjaGVja19yZXN1bHQgJ00gTCBLIEogSSBIIEcnIEYuLk0gLS1hbmNlc3RyeS1wYXRoCmNoZWNrX3Jlc3VsdCAnTSBMIEogSSBIIEcnIEYuLk0gLS1hbmNlc3RyeS1wYXRoIC0tIGZpbGUKY2hlY2tfcmVzdWx0ICcoTEgpTSAoSylMIChHSilLIChJKUogKEcpSSAoRylIIChGRSlHJyBGLi5NIC0tYW5jZXN0cnktcGF0aCAtLXBhcmVudHMgLS0gZmlsZQpjaGVja19yZXN1bHQgJyhMSClNIChHKUggKEopTCAoSSlKIChHKUkgKEZFKUcnIEYuLk0gLS1hbmNlc3RyeS1wYXRoIC0tc2ltcGxpZnktbWVyZ2VzIC0tIGZpbGUKY2hlY2tfcmVzdWx0ICdNIEwgSyBHJyBGLi5NIC0tZmlyc3QtcGFyZW50CmNoZWNrX3Jlc3VsdCAnTSBMIEcnIEYuLk0gLS1maXJzdC1wYXJlbnQgLS0gZmlsZQoKIyBOb3RlIHRoYXQgRyBpcyBwcnVuZWQgd2hlbiBFIGlzIHRoZSBib3R0b20sIGV2ZW4gaWYgaXQncyB0aGUgc2FtZSBjb21taXQgbGlzdAojIElmIHdlIHdhbnQgaGlzdG9yeSBzaW5jZSBFLCB0aGVuIHdlJ3JlIHF1aXRlIGhhcHB5IHRvIGlnbm9yZSBHIHRoYXQgdG9vayBFLgpjaGVja19yZXN1bHQgJ00gTCBLIEogSSBIIEcnIEUuLk0gLS1hbmNlc3RyeS1wYXRoCmNoZWNrX291dGNvbWUgZmFpbHVyZSAnTSBMIEogSSBIJyBFLi5NIC0tYW5jZXN0cnktcGF0aCAtLSBmaWxlICMgaW5jbHVkZXMgRwpjaGVja19vdXRjb21lIGZhaWx1cmUgJyhMSClNIChLKUwgKEVKKUsgKEkpSiAoRSlJIChFKUgnIEUuLk0gLS1hbmNlc3RyeS1wYXRoIC0tcGFyZW50cyAtLSBmaWxlICMgaW5jbHVkZXMgRwpjaGVja19vdXRjb21lIGZhaWx1cmUgJyhMSClNIChFKUggKEopTCAoSSlKIChFKUknIEUuLk0gLS1hbmNlc3RyeS1wYXRoIC0tc2ltcGxpZnktbWVyZ2VzIC0tIGZpbGUgIyBpbmNsdWRlcyBHCgojIFNob3VsZCBzdGlsbCBiZSBhYmxlIHRvIGlnbm9yZSBJLUogYnJhbmNoIGluIHNpbXBsZSBsb2csIGRlc3BpdGUgbGltaXRpbmcKIyB0byBHLgpjaGVja19yZXN1bHQgJ00gTCBLIEogSSBIJyBHLi5NCmNoZWNrX3Jlc3VsdCAnTSBIIEwgSyBKIEknIEcuLk0gLS10b3BvLW9yZGVyCmNoZWNrX291dGNvbWUgZmFpbHVyZSAnTSBMIEgnIEcuLk0gLS0gZmlsZSAjIGluY2x1ZGVzIEogSQpjaGVja19vdXRjb21lIGZhaWx1cmUgJyhMSClNIChHKUwgKEcpSCcgRy4uTSAtLXBhcmVudHMgLS0gZmlsZSAjIGluY2x1ZGVzIEogSQpjaGVja19yZXN1bHQgJ00gTCBKIEkgSCcgRy4uTSAtLWZ1bGwtaGlzdG9yeSAtLSBmaWxlCmNoZWNrX3Jlc3VsdCAnTSBMIEsgSiBJIEgnIEcuLk0gLS1mdWxsLWhpc3RvcnkgLS1wYXJlbnRzIC0tIGZpbGUKY2hlY2tfcmVzdWx0ICdNIEggTCBKIEknIEcuLk0gLS1zaW1wbGlmeS1tZXJnZXMgLS0gZmlsZQpjaGVja19yZXN1bHQgJ00gTCBLIEogSSBIJyBHLi5NIC0tYW5jZXN0cnktcGF0aApjaGVja19yZXN1bHQgJ00gTCBKIEkgSCcgRy4uTSAtLWFuY2VzdHJ5LXBhdGggLS0gZmlsZQpjaGVja19yZXN1bHQgJ00gTCBLIEogSSBIJyBHLi5NIC0tYW5jZXN0cnktcGF0aCAtLXBhcmVudHMgLS0gZmlsZQpjaGVja19yZXN1bHQgJ00gSCBMIEogSScgRy4uTSAtLWFuY2VzdHJ5LXBhdGggLS1zaW1wbGlmeS1tZXJnZXMgLS0gZmlsZQoKIyBCLi5GIHNob3VsZCBiZSBhYmxlIHRvIHNpbXBsaWZ5IHRoZSBtZXJnZSBEIGZyb20gaXJyZWxldmFudCBzaWRlIGJyYW5jaCBDLgojIERlZmF1bHQgbG9nIHNob3VsZCBhbHNvIGJlIGZyZWUgdG8gZm9sbG93IEItRCwgYW5kIGlnbm9yZSBDLgojIEJ1dCAtLWZ1bGwtaGlzdG9yeSBzaG91bGRuJ3QgZHJvcCBEIG9uIGl0cyBvd24gLSB3aXRob3V0IHNpbXBsaWZpY2F0aW9uLAojIHdlIGNhbid0IGRlY2lkZSBpZiB0aGUgbWVyZ2UgZnJvbSBJTlRFUkVTVElORyBjb21taXQgQyB3YXMgc2Vuc2libGUuCmNoZWNrX3Jlc3VsdCAnRiBEIEMnIEIuLkYKY2hlY2tfb3V0Y29tZSBmYWlsdXJlICdGJyBCLi5GIC0tIGZpbGUgIyBpbmNsdWRlcyBECmNoZWNrX291dGNvbWUgZmFpbHVyZSAnKEIpRicgQi4uRiAtLXBhcmVudHMgLS0gZmlsZSAjIGluY2x1ZGVzIEQKY2hlY2tfcmVzdWx0ICdGIEQnIEIuLkYgLS1mdWxsLWhpc3RvcnkgLS0gZmlsZQpjaGVja19yZXN1bHQgJyhEKUYgKEJBKUQnIEIuLkYgLS1mdWxsLWhpc3RvcnkgLS1wYXJlbnRzIC0tIGZpbGUKY2hlY2tfcmVzdWx0ICcoQilGJyBCLi5GIC0tc2ltcGxpZnktbWVyZ2VzIC0tIGZpbGUKY2hlY2tfcmVzdWx0ICdGIEQnIEIuLkYgLS1hbmNlc3RyeS1wYXRoCmNoZWNrX291dGNvbWUgZmFpbHVyZSAnRicgQi4uRiAtLWFuY2VzdHJ5LXBhdGggLS0gZmlsZSAjIGluY2x1ZGVzIEQKY2hlY2tfb3V0Y29tZSBmYWlsdXJlICdGJyBCLi5GIC0tYW5jZXN0cnktcGF0aCAtLXBhcmVudHMgLS0gZmlsZSAjIGluY2x1ZGVzIEQKY2hlY2tfb3V0Y29tZSBmYWlsdXJlICdGJyBCLi5GIC0tYW5jZXN0cnktcGF0aCAtLXNpbXBsaWZ5LW1lcmdlcyAtLSBmaWxlICMgaW5jbHVkZXMgRApjaGVja19yZXN1bHQgJ0YgRCcgQi4uRiAtLWZpcnN0LXBhcmVudApjaGVja19yZXN1bHQgJ0YnIEIuLkYgLS1maXJzdC1wYXJlbnQgLS0gZmlsZQoKIyBFLi4uRiBzaG91bGQgYmUgZXF1aXZhbGVudCB0byBFIEYgXkIsIGFuZCBiZSBhYmxlIHRvIGRyb3AgRCBhcyBhYm92ZS4KY2hlY2tfb3V0Y29tZSBmYWlsdXJlICdGJyBFIEYgXkIgLS0gZmlsZSAjIGluY2x1ZGVzIEQKY2hlY2tfb3V0Y29tZSBmYWlsdXJlICdGJyBFLi4uRiAtLSBmaWxlICMgaW5jbHVkZXMgRAoKIyBBbnkgc29ydCBvZiBmdWxsIGhpc3Rvcnkgb2YgQy4uRiBzaG91bGQgc2hvdyBELCBhcyBpdCdzIHRoZSBjb25uZWN0aW9uIHRvIEMsCiMgYW5kIGl0IGRpZmZlcnMgZnJvbSBpdC4KY2hlY2tfcmVzdWx0ICdGIEQgQicgQy4uRgpjaGVja19yZXN1bHQgJ0YgQicgQy4uRiAtLSBmaWxlCmNoZWNrX3Jlc3VsdCAnKEIpRiAoQSlCJyBDLi5GIC0tcGFyZW50cyAtLSBmaWxlCmNoZWNrX3Jlc3VsdCAnRiBEIEInIEMuLkYgLS1mdWxsLWhpc3RvcnkgLS0gZmlsZQpjaGVja19yZXN1bHQgJyhEKUYgKEJDKUQgKEEpQicgQy4uRiAtLWZ1bGwtaGlzdG9yeSAtLXBhcmVudHMgLS0gZmlsZQpjaGVja19yZXN1bHQgJyhEKUYgKEJDKUQgKEEpQicgQy4uRiAtLXNpbXBsaWZ5LW1lcmdlcyAtLSBmaWxlCmNoZWNrX3Jlc3VsdCAnRiBEJyBDLi5GIC0tYW5jZXN0cnktcGF0aApjaGVja19yZXN1bHQgJ0YgRCcgQy4uRiAtLWFuY2VzdHJ5LXBhdGggLS0gZmlsZQpjaGVja19yZXN1bHQgJ0YgRCcgQy4uRiAtLWFuY2VzdHJ5LXBhdGggLS1wYXJlbnRzIC0tIGZpbGUKY2hlY2tfcmVzdWx0ICdGIEQnIEMuLkYgLS1hbmNlc3RyeS1wYXRoIC0tc2ltcGxpZnktbWVyZ2VzIC0tIGZpbGUKY2hlY2tfcmVzdWx0ICdGIEQgQicgQy4uRiAtLWZpcnN0LXBhcmVudApjaGVja19yZXN1bHQgJ0YgQicgQy4uRiAtLWZpcnN0LXBhcmVudCAtLSBmaWxlCgoKdGVzdF9kb25lCg==",
    "text": "#!/bin/sh\n#\n#        ,---E--.   *H----------.             * marks !TREESAME parent paths\n#       /        \\ /             \\*\n# *A--*B---D--*F-*G---------K-*L-*M\n#   \\     /*       \\       /\n#    `-C-'          `-*I-*J\n#\n# A creates \"file\", B and F change it.\n# Odd merge G takes the old version from B.\n# I changes it, but J reverts it, so K is TREESAME to both parents.\n# H and L both change \"file\", and M merges those changes.\n\ntest_description='TREESAME and limiting'\n\n. ./test-lib.sh\n\nnote () {\n\tgit tag \"$1\"\n}\n\nunnote () {\n\tgit name-rev --tags --stdin | sed -e \"s|$_x40 (tags/\\([^)]*\\))\\([ \t]\\)|\\1\\2|g\"\n}\n\ntest_expect_success setup '\n\ttest_commit \"Initial file\" file \"Hi there\" A &&\n\tgit branch other-branch &&\n\n\ttest_commit \"file=Hello\" file \"Hello\" B &&\n\tgit branch third-branch &&\n\n\tgit checkout other-branch &&\n\ttest_commit \"Added other\" other \"Hello\" C &&\n\n\tgit checkout master &&\n\ttest_merge D other-branch &&\n\n\tgit checkout third-branch &&\n\ttest_commit \"Third file\" third \"Nothing\" E &&\n\n\tgit checkout master &&\n\ttest_commit \"file=Blah\" file \"Blah\" F &&\n\n\ttest_tick && git merge --no-commit third-branch &&\n\tgit checkout third-branch file &&\n\tgit commit &&\n\tnote G &&\n\tgit branch fiddler-branch &&\n\n\tgit checkout -b part2-branch &&\n\ttest_commit \"file=Part 2\" file \"Part 2\" H &&\n\n\tgit checkout fiddler-branch &&\n\ttest_commit \"Bad commit\" file \"Silly\" I &&\n\n\ttest_tick && git revert I && note J &&\n\n\tgit checkout master &&\n\ttest_tick && git merge --no-ff fiddler-branch &&\n\tnote K\n\n\ttest_commit \"file=Part 1\" file \"Part 1\" L &&\n\n\ttest_tick && test_must_fail git merge part2-branch &&\n\ttest_commit M file \"Parts 1+2\"\n'\n\ncheck_outcome () {\n\toutcome=$1\n\tshift\n\n\tcase \"$1\" in\n\t*\"(\"*)\n\t\tFMT=\"%P\t%H | %s\"\n\t\tmunge_actual=\"\n\t\t\ts/^\\([^\t]*\\)\t\\([^ ]*\\) .*/(\\1)\\2/\n\t\t\ts/ //g\n\t\t\ts/()//\n\t\t\"\n\t\t;;\n\t*)\n\t\tFMT=\"%H | %s\"\n\t\tmunge_actual=\"s/^\\([^ ]*\\) .*/\\1/\"\n\t\t;;\n\tesac &&\n\tprintf \"%s\\n\" $1 >expect &&\n\tshift\n\n\tparam=\"$*\" &&\n\ttest_expect_$outcome \"log $param\" '\n\t\tgit log --format=\"$FMT\" $param |\n\t\tunnote >actual &&\n\t\tsed -e \"$munge_actual\" <actual >check &&\n\t\ttest_cmp expect check || {\n\t\t\tcat actual\n\t\t\tfalse\n\t\t}\n\t'\n}\n\ncheck_result () {\n\tcheck_outcome success \"$@\"\n}\n\n# Odd merge G drops a change in F. Important that G is listed in all\n# except the most basic list. Achieving this means normal merge D will also be\n# shown in normal full-history, as we can't distinguish unless we do a\n# simplification pass. After simplification, D is dropped but G remains.\n# Also, merge simplification of G should not drop the parent B that the default\n# simple history follows.\ncheck_result 'M L K J I H G F E D C B A'\ncheck_result '(LH)M (K)L (GJ)K (I)J (G)I (G)H (FE)G (D)F (B)E (BC)D (A)C (A)B A'\ncheck_result 'M H L K J I G E F D C B A' --topo-order\ncheck_result 'M L H B A' -- file\ncheck_result '(LH)M (B)L (B)H (A)B A' --parents -- file\ncheck_result 'M L J I H G F D B A' --full-history -- file\ncheck_result '(LH)M (K)L (GJ)K (I)J (G)I (G)H (FB)G (D)F (BA)D (A)B A' --full-history --parents -- file\ncheck_outcome failure '(LH)M (G)H (J)L (I)J (G)I (FB)G (B)F (A)B A' --simplify-merges -- file # drops parent B from G\ncheck_result 'M L K G F D B A' --first-parent\ncheck_result 'M L G F B A' --first-parent -- file\n\n# Check that odd merge G remains shown when F is the bottom.\ncheck_result 'M L K J I H G E' F..M\ncheck_result 'M H L K J I G E' F..M --topo-order\ncheck_result 'M L H' F..M -- file\ncheck_result '(LH)M (B)L (B)H' --parents F..M -- file\ncheck_result 'M L J I H G' F..M --full-history -- file\ncheck_result '(LH)M (K)L (GJ)K (I)J (G)I (G)H (FB)G' F..M --full-history --parents -- file\ncheck_outcome failure '(LH)M (G)H (J)L (I)J (G)I (FB)G' F..M --simplify-merges -- file # drops parent B from G\ncheck_result 'M L K J I H G' F..M --ancestry-path\ncheck_result 'M L J I H G' F..M --ancestry-path -- file\ncheck_result '(LH)M (K)L (GJ)K (I)J (G)I (G)H (FE)G' F..M --ancestry-path --parents -- file\ncheck_result '(LH)M (G)H (J)L (I)J (G)I (FE)G' F..M --ancestry-path --simplify-merges -- file\ncheck_result 'M L K G' F..M --first-parent\ncheck_result 'M L G' F..M --first-parent -- file\n\n# Note that G is pruned when E is the bottom, even if it's the same commit list\n# If we want history since E, then we're quite happy to ignore G that took E.\ncheck_result 'M L K J I H G' E..M --ancestry-path\ncheck_outcome failure 'M L J I H' E..M --ancestry-path -- file # includes G\ncheck_outcome failure '(LH)M (K)L (EJ)K (I)J (E)I (E)H' E..M --ancestry-path --parents -- file # includes G\ncheck_outcome failure '(LH)M (E)H (J)L (I)J (E)I' E..M --ancestry-path --simplify-merges -- file # includes G\n\n# Should still be able to ignore I-J branch in simple log, despite limiting\n# to G.\ncheck_result 'M L K J I H' G..M\ncheck_result 'M H L K J I' G..M --topo-order\ncheck_outcome failure 'M L H' G..M -- file # includes J I\ncheck_outcome failure '(LH)M (G)L (G)H' G..M --parents -- file # includes J I\ncheck_result 'M L J I H' G..M --full-history -- file\ncheck_result 'M L K J I H' G..M --full-history --parents -- file\ncheck_result 'M H L J I' G..M --simplify-merges -- file\ncheck_result 'M L K J I H' G..M --ancestry-path\ncheck_result 'M L J I H' G..M --ancestry-path -- file\ncheck_result 'M L K J I H' G..M --ancestry-path --parents -- file\ncheck_result 'M H L J I' G..M --ancestry-path --simplify-merges -- file\n\n# B..F should be able to simplify the merge D from irrelevant side branch C.\n# Default log should also be free to follow B-D, and ignore C.\n# But --full-history shouldn't drop D on its own - without simplification,\n# we can't decide if the merge from INTERESTING commit C was sensible.\ncheck_result 'F D C' B..F\ncheck_outcome failure 'F' B..F -- file # includes D\ncheck_outcome failure '(B)F' B..F --parents -- file # includes D\ncheck_result 'F D' B..F --full-history -- file\ncheck_result '(D)F (BA)D' B..F --full-history --parents -- file\ncheck_result '(B)F' B..F --simplify-merges -- file\ncheck_result 'F D' B..F --ancestry-path\ncheck_outcome failure 'F' B..F --ancestry-path -- file # includes D\ncheck_outcome failure 'F' B..F --ancestry-path --parents -- file # includes D\ncheck_outcome failure 'F' B..F --ancestry-path --simplify-merges -- file # includes D\ncheck_result 'F D' B..F --first-parent\ncheck_result 'F' B..F --first-parent -- file\n\n# E...F should be equivalent to E F ^B, and be able to drop D as above.\ncheck_outcome failure 'F' E F ^B -- file # includes D\ncheck_outcome failure 'F' E...F -- file # includes D\n\n# Any sort of full history of C..F should show D, as it's the connection to C,\n# and it differs from it.\ncheck_result 'F D B' C..F\ncheck_result 'F B' C..F -- file\ncheck_result '(B)F (A)B' C..F --parents -- file\ncheck_result 'F D B' C..F --full-history -- file\ncheck_result '(D)F (BC)D (A)B' C..F --full-history --parents -- file\ncheck_result '(D)F (BC)D (A)B' C..F --simplify-merges -- file\ncheck_result 'F D' C..F --ancestry-path\ncheck_result 'F D' C..F --ancestry-path -- file\ncheck_result 'F D' C..F --ancestry-path --parents -- file\ncheck_result 'F D' C..F --ancestry-path --simplify-merges -- file\ncheck_result 'F D B' C..F --first-parent\ncheck_result 'F B' C..F --first-parent -- file\n\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "0047b541fdd0a98aefb18ac9c1cfbaf8d22d238c",
  "sha1_ok": true,
  "size": 7123
}
