{
  "content": {
    "base64": "IyEvYmluL3NoCiMgQ29weXJpZ2h0IChjKSAyMDA3LCBOYW5ha28gU2hpcmFpc2hpCgpVU0FHRT0nWyB8IGxpc3QgfCBzaG93IHwgYXBwbHkgfCBjbGVhcl0nCgpTVUJESVJFQ1RPUllfT0s9WWVzCi4gZ2l0LXNoLXNldHVwCnJlcXVpcmVfd29ya190cmVlCmNkX3RvX3RvcGxldmVsCgpUTVA9IiRHSVRfRElSLy5naXQtc3Rhc2guJCQiCnRyYXAgJ3JtIC1mICIkVE1QLSoiJyAwCgpyZWZfc3Rhc2g9cmVmcy9zdGFzaAoKbm9fY2hhbmdlcyAoKSB7CglnaXQgZGlmZi1pbmRleCAtLXF1aWV0IC0tY2FjaGVkIEhFQUQgJiYKCWdpdCBkaWZmLWZpbGVzIC0tcXVpZXQKfQoKY2xlYXJfc3Rhc2ggKCkgewoJaWYgY3VycmVudD0kKGdpdCByZXYtcGFyc2UgLS12ZXJpZnkgJHJlZl9zdGFzaCAyPi9kZXYvbnVsbCkKCXRoZW4KCQlnaXQgdXBkYXRlLXJlZiAtZCByZWZzL3N0YXNoICRjdXJyZW50CglmaQp9CgpzYXZlX3N0YXNoICgpIHsKCXN0YXNoX21zZz0iJDEiCgoJaWYgbm9fY2hhbmdlcwoJdGhlbgoJCWVjaG8gPiYyICdObyBsb2NhbCBjaGFuZ2VzIHRvIHNhdmUnCgkJZXhpdCAwCglmaQoJdGVzdCAtZiAiJEdJVF9ESVIvbG9ncy8kcmVmX3N0YXNoIiB8fAoJCWNsZWFyX3N0YXNoIHx8IGRpZSAiQ2Fubm90IGluaXRpYWxpemUgc3Rhc2giCgoJIyBNYWtlIHN1cmUgdGhlIHJlZmxvZyBmb3Igc3Rhc2ggaXMga2VwdC4KCTogPj4iJEdJVF9ESVIvbG9ncy8kcmVmX3N0YXNoIgoKCSMgc3RhdGUgb2YgdGhlIGJhc2UgY29tbWl0CglpZiBiX2NvbW1pdD0kKGdpdCByZXYtcGFyc2UgLS12ZXJpZnkgSEVBRCkKCXRoZW4KCQloZWFkPSQoZ2l0IGxvZyAtLWFiYnJldi1jb21taXQgLS1wcmV0dHk9b25lbGluZSAtbiAxIEhFQUQpCgllbHNlCgkJZGllICJZb3UgZG8gbm90IGhhdmUgdGhlIGluaXRpYWwgY29tbWl0IHlldCIKCWZpCgoJaWYgYnJhbmNoPSQoZ2l0IHN5bWJvbGljLXJlZiAtcSBIRUFEKQoJdGhlbgoJCWJyYW5jaD0ke2JyYW5jaCNyZWZzL2hlYWRzL30KCWVsc2UKCQlicmFuY2g9JyhubyBicmFuY2gpJwoJZmkKCW1zZz0kKHByaW50ZiAnJXM6ICVzJyAiJGJyYW5jaCIgIiRoZWFkIikKCgkjIHN0YXRlIG9mIHRoZSBpbmRleAoJaV90cmVlPSQoZ2l0IHdyaXRlLXRyZWUpICYmCglpX2NvbW1pdD0kKHByaW50ZiAnaW5kZXggb24gJXMnICIkbXNnIiB8CgkJZ2l0IGNvbW1pdC10cmVlICRpX3RyZWUgLXAgJGJfY29tbWl0KSB8fAoJCWRpZSAiQ2Fubm90IHNhdmUgdGhlIGN1cnJlbnQgaW5kZXggc3RhdGUiCgoJIyBzdGF0ZSBvZiB0aGUgd29ya2luZyB0cmVlCgl3X3RyZWU9JCggKAoJCXJtIC1mICIkVE1QLWluZGV4IiAmJgoJCWNwIC1wICR7R0lUX0lOREVYX0ZJTEUtIiRHSVRfRElSL2luZGV4In0gIiRUTVAtaW5kZXgiICYmCgkJR0lUX0lOREVYX0ZJTEU9IiRUTVAtaW5kZXgiICYmCgkJZXhwb3J0IEdJVF9JTkRFWF9GSUxFICYmCgkJZ2l0IHJlYWQtdHJlZSAtbSAkaV90cmVlICYmCgkJZ2l0IGFkZCAtdSAmJgoJCWdpdCB3cml0ZS10cmVlICYmCgkJcm0gLWYgIiRUTVAtaW5kZXgiCgkpICkgfHwKCQlkaWUgIkNhbm5vdCBzYXZlIHRoZSBjdXJyZW50IHdvcmt0cmVlIHN0YXRlIgoKCSMgY3JlYXRlIHRoZSBzdGFzaAoJaWYgdGVzdCAteiAiJHN0YXNoX21zZyIKCXRoZW4KCQlzdGFzaF9tc2c9JChwcmludGYgJ1dJUCBvbiAlcycgIiRtc2ciKQoJZWxzZQoJCXN0YXNoX21zZz0kKHByaW50ZiAnT24gJXM6ICVzJyAiJGJyYW5jaCIgIiRzdGFzaF9tc2ciKQoJZmkKCXdfY29tbWl0PSQocHJpbnRmICclc1xuJyAiJHN0YXNoX21zZyIgfAoJCWdpdCBjb21taXQtdHJlZSAkd190cmVlIC1wICRiX2NvbW1pdCAtcCAkaV9jb21taXQpIHx8CgkJZGllICJDYW5ub3QgcmVjb3JkIHdvcmtpbmcgdHJlZSBzdGF0ZSIKCglnaXQgdXBkYXRlLXJlZiAtbSAiJHN0YXNoX21zZyIgJHJlZl9zdGFzaCAkd19jb21taXQgfHwKCQlkaWUgIkNhbm5vdCBzYXZlIHRoZSBjdXJyZW50IHN0YXR1cyIKCXByaW50ZiA+JjIgJ1NhdmVkICIlcyJcbicgIiRzdGFzaF9tc2ciCn0KCmhhdmVfc3Rhc2ggKCkgewoJZ2l0IHJldi1wYXJzZSAtLXZlcmlmeSAkcmVmX3N0YXNoID4vZGV2L251bGwgMj4mMQp9CgpsaXN0X3N0YXNoICgpIHsKCWhhdmVfc3Rhc2ggfHwgcmV0dXJuIDAKCWdpdCBsb2cgLS1wcmV0dHk9b25lbGluZSAtZyAiJEAiICRyZWZfc3Rhc2ggfAoJc2VkIC1uIC1lICdzL15bLjAtOWEtZl0qIHJlZnNcLy8vcCcKfQoKc2hvd19zdGFzaCAoKSB7CglmbGFncz0kKGdpdCByZXYtcGFyc2UgLS1uby1yZXZzIC0tZmxhZ3MgIiRAIikKCWlmIHRlc3QgLXogIiRmbGFncyIKCXRoZW4KCQlmbGFncz0tLXN0YXQKCWZpCglzPSQoZ2l0IHJldi1wYXJzZSAtLXJldnMtb25seSAtLW5vLWZsYWdzIC0tZGVmYXVsdCAkcmVmX3N0YXNoICIkQCIpCgoJd19jb21taXQ9JChnaXQgcmV2LXBhcnNlIC0tdmVyaWZ5ICIkcyIpICYmCgliX2NvbW1pdD0kKGdpdCByZXYtcGFyc2UgLS12ZXJpZnkgIiRzXiIpICYmCglnaXQgZGlmZiAkZmxhZ3MgJGJfY29tbWl0ICR3X2NvbW1pdAp9CgphcHBseV9zdGFzaCAoKSB7CglnaXQgZGlmZi1maWxlcyAtLXF1aWV0IHx8CgkJZGllICdDYW5ub3QgcmVzdG9yZSBvbiB0b3Agb2YgYSBkaXJ0eSBzdGF0ZScKCgl1bnN0YXNoX2luZGV4PQoJY2FzZSAiJDEiIGluCgktLWluZGV4KQoJCXVuc3Rhc2hfaW5kZXg9dAoJCXNoaWZ0Cgllc2FjCgoJIyBjdXJyZW50IGluZGV4IHN0YXRlCgljX3RyZWU9JChnaXQgd3JpdGUtdHJlZSkgfHwKCQlkaWUgJ0Nhbm5vdCBhcHBseSBhIHN0YXNoIGluIHRoZSBtaWRkbGUgb2YgYSBtZXJnZScKCglzPSQoZ2l0IHJldi1wYXJzZSAtLXJldnMtb25seSAtLW5vLWZsYWdzIC0tZGVmYXVsdCAkcmVmX3N0YXNoICIkQCIpICYmCgl3X3RyZWU9JChnaXQgcmV2LXBhcnNlIC0tdmVyaWZ5ICIkczoiKSAmJgoJYl90cmVlPSQoZ2l0IHJldi1wYXJzZSAtLXZlcmlmeSAiJHNeOiIpIHx8CgkJZGllICIkKjogbm8gdmFsaWQgc3Rhc2hlZCBzdGF0ZSBmb3VuZCIKCgl0ZXN0IC16ICIkdW5zdGFzaF9pbmRleCIgfHwgewoJCWdpdCBkaWZmIC0tYmluYXJ5ICRzXjJeLi4kc14yIHwgZ2l0IGFwcGx5IC0tY2FjaGVkCgkJdGVzdCAkPyAtbmUgMCAmJgoJCQlkaWUgJ0NvbmZsaWN0cyBpbiBpbmRleC4gVHJ5IHdpdGhvdXQgLS1pbmRleC4nCgkJdW5zdGFzaGVkX2luZGV4X3RyZWU9JChnaXQtd3JpdGUtdHJlZSkgfHwKCQkJZGllICdDb3VsZCBub3Qgc2F2ZSBpbmRleCB0cmVlJwoJCWdpdCByZXNldAoJfQoKCWV2YWwgIgoJCUdJVEhFQURfJHdfdHJlZT0nU3Rhc2hlZCBjaGFuZ2VzJyAmJgoJCUdJVEhFQURfJGNfdHJlZT0nVXBkYXRlZCB1cHN0cmVhbScgJiYKCQlHSVRIRUFEXyRiX3RyZWU9J1ZlcnNpb24gc3Rhc2ggd2FzIGJhc2VkIG9uJyAmJgoJCWV4cG9ydCBHSVRIRUFEXyR3X3RyZWUgR0lUSEVBRF8kY190cmVlIEdJVEhFQURfJGJfdHJlZQoJIgoKCWlmIGdpdC1tZXJnZS1yZWN1cnNpdmUgJGJfdHJlZSAtLSAkY190cmVlICR3X3RyZWUKCXRoZW4KCQkjIE5vIGNvbmZsaWN0CgkJYT0iJFRNUC1hZGRlZCIgJiYKCQlnaXQgZGlmZiAtLWNhY2hlZCAtLW5hbWUtb25seSAtLWRpZmYtZmlsdGVyPUEgJGNfdHJlZSA+IiRhIiAmJgoJCWdpdCByZWFkLXRyZWUgLS1yZXNldCAkY190cmVlICYmCgkJZ2l0IHVwZGF0ZS1pbmRleCAtLWFkZCAtLXN0ZGluIDwiJGEiIHx8CgkJCWRpZSAiQ2Fubm90IHVuc3RhZ2UgbW9kaWZpZWQgZmlsZXMiCgkJZ2l0LXN0YXR1cwoJCXJtIC1mICIkYSIKCQl0ZXN0IC16ICIkdW5zdGFzaF9pbmRleCIgfHwgZ2l0IHJlYWQtdHJlZSAkdW5zdGFzaGVkX2luZGV4X3RyZWUKCWVsc2UKCQkjIE1lcmdlIGNvbmZsaWN0OyBrZWVwIHRoZSBleGl0IHN0YXR1cyBmcm9tIG1lcmdlLXJlY3Vyc2l2ZQoJCXN0YXR1cz0kPwoJCXRlc3QgLXogIiR1bnN0YXNoX2luZGV4IiB8fCBlY2hvICdJbmRleCB3YXMgbm90IHVuc3Rhc2hlZC4nID4mMgoJCWV4aXQgJHN0YXR1cwoJZmkKfQoKIyBNYWluIGNvbW1hbmQgc2V0CmNhc2UgIiQxIiBpbgpsaXN0KQoJc2hpZnQKCWlmIHRlc3QgJCMgPSAwCgl0aGVuCgkJc2V0IHggLW4gMTAKCQlzaGlmdAoJZmkKCWxpc3Rfc3Rhc2ggIiRAIgoJOzsKc2hvdykKCXNoaWZ0CglzaG93X3N0YXNoICIkQCIKCTs7CmFwcGx5KQoJc2hpZnQKCWFwcGx5X3N0YXNoICIkQCIKCTs7CmNsZWFyKQoJY2xlYXJfc3Rhc2gKCTs7CmhlbHAgfCB1c2FnZSkKCXVzYWdlCgk7OwoqKQoJaWYgdGVzdCAkIyAtZ3QgMCAmJiB0ZXN0ICIkMSIgPSBzYXZlCgl0aGVuCgkJc2hpZnQKCWZpCglzYXZlX3N0YXNoICIkKiIgJiYgZ2l0LXJlc2V0IC0taGFyZAoJOzsKZXNhYwo=",
    "text": "#!/bin/sh\n# Copyright (c) 2007, Nanako Shiraishi\n\nUSAGE='[ | list | show | apply | clear]'\n\nSUBDIRECTORY_OK=Yes\n. git-sh-setup\nrequire_work_tree\ncd_to_toplevel\n\nTMP=\"$GIT_DIR/.git-stash.$$\"\ntrap 'rm -f \"$TMP-*\"' 0\n\nref_stash=refs/stash\n\nno_changes () {\n\tgit diff-index --quiet --cached HEAD &&\n\tgit diff-files --quiet\n}\n\nclear_stash () {\n\tif current=$(git rev-parse --verify $ref_stash 2>/dev/null)\n\tthen\n\t\tgit update-ref -d refs/stash $current\n\tfi\n}\n\nsave_stash () {\n\tstash_msg=\"$1\"\n\n\tif no_changes\n\tthen\n\t\techo >&2 'No local changes to save'\n\t\texit 0\n\tfi\n\ttest -f \"$GIT_DIR/logs/$ref_stash\" ||\n\t\tclear_stash || die \"Cannot initialize stash\"\n\n\t# Make sure the reflog for stash is kept.\n\t: >>\"$GIT_DIR/logs/$ref_stash\"\n\n\t# state of the base commit\n\tif b_commit=$(git rev-parse --verify HEAD)\n\tthen\n\t\thead=$(git log --abbrev-commit --pretty=oneline -n 1 HEAD)\n\telse\n\t\tdie \"You do not have the initial commit yet\"\n\tfi\n\n\tif branch=$(git symbolic-ref -q HEAD)\n\tthen\n\t\tbranch=${branch#refs/heads/}\n\telse\n\t\tbranch='(no branch)'\n\tfi\n\tmsg=$(printf '%s: %s' \"$branch\" \"$head\")\n\n\t# state of the index\n\ti_tree=$(git write-tree) &&\n\ti_commit=$(printf 'index on %s' \"$msg\" |\n\t\tgit commit-tree $i_tree -p $b_commit) ||\n\t\tdie \"Cannot save the current index state\"\n\n\t# state of the working tree\n\tw_tree=$( (\n\t\trm -f \"$TMP-index\" &&\n\t\tcp -p ${GIT_INDEX_FILE-\"$GIT_DIR/index\"} \"$TMP-index\" &&\n\t\tGIT_INDEX_FILE=\"$TMP-index\" &&\n\t\texport GIT_INDEX_FILE &&\n\t\tgit read-tree -m $i_tree &&\n\t\tgit add -u &&\n\t\tgit write-tree &&\n\t\trm -f \"$TMP-index\"\n\t) ) ||\n\t\tdie \"Cannot save the current worktree state\"\n\n\t# create the stash\n\tif test -z \"$stash_msg\"\n\tthen\n\t\tstash_msg=$(printf 'WIP on %s' \"$msg\")\n\telse\n\t\tstash_msg=$(printf 'On %s: %s' \"$branch\" \"$stash_msg\")\n\tfi\n\tw_commit=$(printf '%s\\n' \"$stash_msg\" |\n\t\tgit commit-tree $w_tree -p $b_commit -p $i_commit) ||\n\t\tdie \"Cannot record working tree state\"\n\n\tgit update-ref -m \"$stash_msg\" $ref_stash $w_commit ||\n\t\tdie \"Cannot save the current status\"\n\tprintf >&2 'Saved \"%s\"\\n' \"$stash_msg\"\n}\n\nhave_stash () {\n\tgit rev-parse --verify $ref_stash >/dev/null 2>&1\n}\n\nlist_stash () {\n\thave_stash || return 0\n\tgit log --pretty=oneline -g \"$@\" $ref_stash |\n\tsed -n -e 's/^[.0-9a-f]* refs\\///p'\n}\n\nshow_stash () {\n\tflags=$(git rev-parse --no-revs --flags \"$@\")\n\tif test -z \"$flags\"\n\tthen\n\t\tflags=--stat\n\tfi\n\ts=$(git rev-parse --revs-only --no-flags --default $ref_stash \"$@\")\n\n\tw_commit=$(git rev-parse --verify \"$s\") &&\n\tb_commit=$(git rev-parse --verify \"$s^\") &&\n\tgit diff $flags $b_commit $w_commit\n}\n\napply_stash () {\n\tgit diff-files --quiet ||\n\t\tdie 'Cannot restore on top of a dirty state'\n\n\tunstash_index=\n\tcase \"$1\" in\n\t--index)\n\t\tunstash_index=t\n\t\tshift\n\tesac\n\n\t# current index state\n\tc_tree=$(git write-tree) ||\n\t\tdie 'Cannot apply a stash in the middle of a merge'\n\n\ts=$(git rev-parse --revs-only --no-flags --default $ref_stash \"$@\") &&\n\tw_tree=$(git rev-parse --verify \"$s:\") &&\n\tb_tree=$(git rev-parse --verify \"$s^:\") ||\n\t\tdie \"$*: no valid stashed state found\"\n\n\ttest -z \"$unstash_index\" || {\n\t\tgit diff --binary $s^2^..$s^2 | git apply --cached\n\t\ttest $? -ne 0 &&\n\t\t\tdie 'Conflicts in index. Try without --index.'\n\t\tunstashed_index_tree=$(git-write-tree) ||\n\t\t\tdie 'Could not save index tree'\n\t\tgit reset\n\t}\n\n\teval \"\n\t\tGITHEAD_$w_tree='Stashed changes' &&\n\t\tGITHEAD_$c_tree='Updated upstream' &&\n\t\tGITHEAD_$b_tree='Version stash was based on' &&\n\t\texport GITHEAD_$w_tree GITHEAD_$c_tree GITHEAD_$b_tree\n\t\"\n\n\tif git-merge-recursive $b_tree -- $c_tree $w_tree\n\tthen\n\t\t# No conflict\n\t\ta=\"$TMP-added\" &&\n\t\tgit diff --cached --name-only --diff-filter=A $c_tree >\"$a\" &&\n\t\tgit read-tree --reset $c_tree &&\n\t\tgit update-index --add --stdin <\"$a\" ||\n\t\t\tdie \"Cannot unstage modified files\"\n\t\tgit-status\n\t\trm -f \"$a\"\n\t\ttest -z \"$unstash_index\" || git read-tree $unstashed_index_tree\n\telse\n\t\t# Merge conflict; keep the exit status from merge-recursive\n\t\tstatus=$?\n\t\ttest -z \"$unstash_index\" || echo 'Index was not unstashed.' >&2\n\t\texit $status\n\tfi\n}\n\n# Main command set\ncase \"$1\" in\nlist)\n\tshift\n\tif test $# = 0\n\tthen\n\t\tset x -n 10\n\t\tshift\n\tfi\n\tlist_stash \"$@\"\n\t;;\nshow)\n\tshift\n\tshow_stash \"$@\"\n\t;;\napply)\n\tshift\n\tapply_stash \"$@\"\n\t;;\nclear)\n\tclear_stash\n\t;;\nhelp | usage)\n\tusage\n\t;;\n*)\n\tif test $# -gt 0 && test \"$1\" = save\n\tthen\n\t\tshift\n\tfi\n\tsave_stash \"$*\" && git-reset --hard\n\t;;\nesac\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "0073e9df5f0e39738107f07919a6f12eafa5ae65",
  "sha1_ok": true,
  "size": 4310
}
