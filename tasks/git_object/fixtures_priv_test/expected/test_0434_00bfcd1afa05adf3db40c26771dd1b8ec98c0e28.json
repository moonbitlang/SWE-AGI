{
  "content": {
    "base64": "LyoKICogQW5vdGhlciBzdHVwaWQgcHJvZ3JhbSwgdGhpcyBvbmUgcGFyc2luZyB0aGUgaGVhZGVycyBvZiBhbgogKiBlbWFpbCB0byBmaWd1cmUgb3V0IGF1dGhvcnNoaXAgYW5kIHN1YmplY3QKICovCiNpbmNsdWRlICJidWlsdGluLmgiCiNpbmNsdWRlICJhYnNwYXRoLmgiCiNpbmNsdWRlICJlbnZpcm9ubWVudC5oIgojaW5jbHVkZSAiZ2V0dGV4dC5oIgojaW5jbHVkZSAic3RyYnVmLmgiCiNpbmNsdWRlICJtYWlsaW5mby5oIgojaW5jbHVkZSAicGFyc2Utb3B0aW9ucy5oIgoKc3RhdGljIGNvbnN0IGNoYXIgKiBjb25zdCBtYWlsaW5mb191c2FnZVtdID0gewoJLyogVFJBTlNMQVRPUlM6IGtlZXAgPD4gaW4gIjwiIG1haWwgIj4iIGluZm8uICovCglOXygiZ2l0IG1haWxpbmZvIFs8b3B0aW9ucz5dIDxtc2c+IDxwYXRjaD4gPCBtYWlsID5pbmZvIiksCglOVUxMLAp9OwoKc3RydWN0IG1ldGFpbmZvX2NoYXJzZXQKewoJZW51bSB7CgkJQ0hBUlNFVF9ERUZBVUxULAoJCUNIQVJTRVRfTk9fUkVFTkNPREUsCgkJQ0hBUlNFVF9FWFBMSUNJVCwKCX0gcG9saWN5OwoJY29uc3QgY2hhciAqY2hhcnNldDsKfTsKCnN0YXRpYyBpbnQgcGFyc2Vfb3B0X2V4cGxpY2l0X2VuY29kaW5nKGNvbnN0IHN0cnVjdCBvcHRpb24gKm9wdCwKCQkJCSAgICAgICBjb25zdCBjaGFyICphcmcsIGludCB1bnNldCkKewoJc3RydWN0IG1ldGFpbmZvX2NoYXJzZXQgKm1ldGFfY2hhcnNldCA9IG9wdC0+dmFsdWU7CgoJQlVHX09OX09QVF9ORUcodW5zZXQpOwoKCW1ldGFfY2hhcnNldC0+cG9saWN5ID0gQ0hBUlNFVF9FWFBMSUNJVDsKCW1ldGFfY2hhcnNldC0+Y2hhcnNldCA9IGFyZzsKCglyZXR1cm4gMDsKfQoKc3RhdGljIGludCBwYXJzZV9vcHRfcXVvdGVkX2NyKGNvbnN0IHN0cnVjdCBvcHRpb24gKm9wdCwgY29uc3QgY2hhciAqYXJnLCBpbnQgdW5zZXQpCnsKCUJVR19PTl9PUFRfTkVHKHVuc2V0KTsKCglpZiAobWFpbGluZm9fcGFyc2VfcXVvdGVkX2NyX2FjdGlvbihhcmcsIG9wdC0+dmFsdWUpICE9IDApCgkJcmV0dXJuIGVycm9yKF8oImJhZCBhY3Rpb24gJyVzJyBmb3IgJyVzJyIpLCBhcmcsICItLXF1b3RlZC1jciIpOwoJcmV0dXJuIDA7Cn0KCmludCBjbWRfbWFpbGluZm8oaW50IGFyZ2MsCgkJIGNvbnN0IGNoYXIgKiphcmd2LAoJCSBjb25zdCBjaGFyICpwcmVmaXgsCgkJIHN0cnVjdCByZXBvc2l0b3J5ICpyZXBvIFVOVVNFRCkKewoJc3RydWN0IG1ldGFpbmZvX2NoYXJzZXQgbWV0YV9jaGFyc2V0OwoJc3RydWN0IG1haWxpbmZvIG1pOwoJaW50IHN0YXR1czsKCWNoYXIgKm1zZ2ZpbGUsICpwYXRjaGZpbGU7CgoJc3RydWN0IG9wdGlvbiBvcHRpb25zW10gPSB7CgkJT1BUX0JPT0woJ2snLCBOVUxMLCAmbWkua2VlcF9zdWJqZWN0LCBOXygia2VlcCBzdWJqZWN0IikpLAoJCU9QVF9CT09MKCdiJywgTlVMTCwgJm1pLmtlZXBfbm9uX3BhdGNoX2JyYWNrZXRzX2luX3N1YmplY3QsCgkJCSBOXygia2VlcCBub24gcGF0Y2ggYnJhY2tldHMgaW4gc3ViamVjdCIpKSwKCQlPUFRfQk9PTCgnbScsICJtZXNzYWdlLWlkIiwgJm1pLmFkZF9tZXNzYWdlX2lkLAoJCQkgTl8oImNvcHkgTWVzc2FnZS1JRCB0byB0aGUgZW5kIG9mIGNvbW1pdCBtZXNzYWdlIikpLAoJCU9QVF9TRVRfSU5UX0YoJ3UnLCBOVUxMLCAmbWV0YV9jaGFyc2V0LnBvbGljeSwKCQkJICAgICAgTl8oInJlLWNvZGUgbWV0YWRhdGEgdG8gaTE4bi5jb21taXRFbmNvZGluZyIpLAoJCQkgICAgICBDSEFSU0VUX0RFRkFVTFQsIFBBUlNFX09QVF9OT05FRyksCgkJT1BUX1NFVF9JTlRfRignbicsIE5VTEwsICZtZXRhX2NoYXJzZXQucG9saWN5LAoJCQkgICAgICBOXygiZGlzYWJsZSBjaGFyc2V0IHJlLWNvZGluZyBvZiBtZXRhZGF0YSIpLAoJCQkgICAgICBDSEFSU0VUX05PX1JFRU5DT0RFLCBQQVJTRV9PUFRfTk9ORUcpLAoJCU9QVF9DQUxMQkFDS19GKDAsICJlbmNvZGluZyIsICZtZXRhX2NoYXJzZXQsIE5fKCJlbmNvZGluZyIpLAoJCQkgICAgICAgTl8oInJlLWNvZGUgbWV0YWRhdGEgdG8gdGhpcyBlbmNvZGluZyIpLAoJCQkgICAgICAgUEFSU0VfT1BUX05PTkVHLCBwYXJzZV9vcHRfZXhwbGljaXRfZW5jb2RpbmcpLAoJCU9QVF9CT09MKDAsICJzY2lzc29ycyIsICZtaS51c2Vfc2Npc3NvcnMsIE5fKCJ1c2Ugc2Npc3NvcnMiKSksCgkJT1BUX0NBTExCQUNLX0YoMCwgInF1b3RlZC1jciIsICZtaS5xdW90ZWRfY3IsIE5fKCI8YWN0aW9uPiIpLAoJCQkgICAgICAgTl8oImFjdGlvbiB3aGVuIHF1b3RlZCBDUiBpcyBmb3VuZCIpLAoJCQkgICAgICAgUEFSU0VfT1BUX05PTkVHLCBwYXJzZV9vcHRfcXVvdGVkX2NyKSwKCQlPUFRfSElEREVOX0JPT0woMCwgImluYm9keS1oZWFkZXJzIiwgJm1pLnVzZV9pbmJvZHlfaGVhZGVycywKCQkJIE5fKCJ1c2UgaGVhZGVycyBpbiBtZXNzYWdlJ3MgYm9keSIpKSwKCQlPUFRfRU5EKCkKCX07CgoJc2V0dXBfbWFpbGluZm8oJm1pKTsKCW1ldGFfY2hhcnNldC5wb2xpY3kgPSBDSEFSU0VUX0RFRkFVTFQ7CgoJYXJnYyA9IHBhcnNlX29wdGlvbnMoYXJnYywgYXJndiwgcHJlZml4LCBvcHRpb25zLCBtYWlsaW5mb191c2FnZSwgMCk7CgoJaWYgKGFyZ2MgIT0gMikKCQl1c2FnZV93aXRoX29wdGlvbnMobWFpbGluZm9fdXNhZ2UsIG9wdGlvbnMpOwoKCXN3aXRjaCAobWV0YV9jaGFyc2V0LnBvbGljeSkgewoJY2FzZSBDSEFSU0VUX0RFRkFVTFQ6CgkJbWkubWV0YWluZm9fY2hhcnNldCA9IGdldF9jb21taXRfb3V0cHV0X2VuY29kaW5nKCk7CgkJYnJlYWs7CgljYXNlIENIQVJTRVRfTk9fUkVFTkNPREU6CgkJbWkubWV0YWluZm9fY2hhcnNldCA9IE5VTEw7CgkJYnJlYWs7CgljYXNlIENIQVJTRVRfRVhQTElDSVQ6CgkJYnJlYWs7CglkZWZhdWx0OgoJCUJVRygiaW52YWxpZCBtZXRhX2NoYXJzZXQucG9saWN5Iik7Cgl9CgoJbWkuaW5wdXQgPSBzdGRpbjsKCW1pLm91dHB1dCA9IHN0ZG91dDsKCgltc2dmaWxlID0gcHJlZml4X2ZpbGVuYW1lKHByZWZpeCwgYXJndlswXSk7CglwYXRjaGZpbGUgPSBwcmVmaXhfZmlsZW5hbWUocHJlZml4LCBhcmd2WzFdKTsKCglzdGF0dXMgPSAhIW1haWxpbmZvKCZtaSwgbXNnZmlsZSwgcGF0Y2hmaWxlKTsKCWNsZWFyX21haWxpbmZvKCZtaSk7CgoJZnJlZShtc2dmaWxlKTsKCWZyZWUocGF0Y2hmaWxlKTsKCXJldHVybiBzdGF0dXM7Cn0K",
    "text": "/*\n * Another stupid program, this one parsing the headers of an\n * email to figure out authorship and subject\n */\n#include \"builtin.h\"\n#include \"abspath.h\"\n#include \"environment.h\"\n#include \"gettext.h\"\n#include \"strbuf.h\"\n#include \"mailinfo.h\"\n#include \"parse-options.h\"\n\nstatic const char * const mailinfo_usage[] = {\n\t/* TRANSLATORS: keep <> in \"<\" mail \">\" info. */\n\tN_(\"git mailinfo [<options>] <msg> <patch> < mail >info\"),\n\tNULL,\n};\n\nstruct metainfo_charset\n{\n\tenum {\n\t\tCHARSET_DEFAULT,\n\t\tCHARSET_NO_REENCODE,\n\t\tCHARSET_EXPLICIT,\n\t} policy;\n\tconst char *charset;\n};\n\nstatic int parse_opt_explicit_encoding(const struct option *opt,\n\t\t\t\t       const char *arg, int unset)\n{\n\tstruct metainfo_charset *meta_charset = opt->value;\n\n\tBUG_ON_OPT_NEG(unset);\n\n\tmeta_charset->policy = CHARSET_EXPLICIT;\n\tmeta_charset->charset = arg;\n\n\treturn 0;\n}\n\nstatic int parse_opt_quoted_cr(const struct option *opt, const char *arg, int unset)\n{\n\tBUG_ON_OPT_NEG(unset);\n\n\tif (mailinfo_parse_quoted_cr_action(arg, opt->value) != 0)\n\t\treturn error(_(\"bad action '%s' for '%s'\"), arg, \"--quoted-cr\");\n\treturn 0;\n}\n\nint cmd_mailinfo(int argc,\n\t\t const char **argv,\n\t\t const char *prefix,\n\t\t struct repository *repo UNUSED)\n{\n\tstruct metainfo_charset meta_charset;\n\tstruct mailinfo mi;\n\tint status;\n\tchar *msgfile, *patchfile;\n\n\tstruct option options[] = {\n\t\tOPT_BOOL('k', NULL, &mi.keep_subject, N_(\"keep subject\")),\n\t\tOPT_BOOL('b', NULL, &mi.keep_non_patch_brackets_in_subject,\n\t\t\t N_(\"keep non patch brackets in subject\")),\n\t\tOPT_BOOL('m', \"message-id\", &mi.add_message_id,\n\t\t\t N_(\"copy Message-ID to the end of commit message\")),\n\t\tOPT_SET_INT_F('u', NULL, &meta_charset.policy,\n\t\t\t      N_(\"re-code metadata to i18n.commitEncoding\"),\n\t\t\t      CHARSET_DEFAULT, PARSE_OPT_NONEG),\n\t\tOPT_SET_INT_F('n', NULL, &meta_charset.policy,\n\t\t\t      N_(\"disable charset re-coding of metadata\"),\n\t\t\t      CHARSET_NO_REENCODE, PARSE_OPT_NONEG),\n\t\tOPT_CALLBACK_F(0, \"encoding\", &meta_charset, N_(\"encoding\"),\n\t\t\t       N_(\"re-code metadata to this encoding\"),\n\t\t\t       PARSE_OPT_NONEG, parse_opt_explicit_encoding),\n\t\tOPT_BOOL(0, \"scissors\", &mi.use_scissors, N_(\"use scissors\")),\n\t\tOPT_CALLBACK_F(0, \"quoted-cr\", &mi.quoted_cr, N_(\"<action>\"),\n\t\t\t       N_(\"action when quoted CR is found\"),\n\t\t\t       PARSE_OPT_NONEG, parse_opt_quoted_cr),\n\t\tOPT_HIDDEN_BOOL(0, \"inbody-headers\", &mi.use_inbody_headers,\n\t\t\t N_(\"use headers in message's body\")),\n\t\tOPT_END()\n\t};\n\n\tsetup_mailinfo(&mi);\n\tmeta_charset.policy = CHARSET_DEFAULT;\n\n\targc = parse_options(argc, argv, prefix, options, mailinfo_usage, 0);\n\n\tif (argc != 2)\n\t\tusage_with_options(mailinfo_usage, options);\n\n\tswitch (meta_charset.policy) {\n\tcase CHARSET_DEFAULT:\n\t\tmi.metainfo_charset = get_commit_output_encoding();\n\t\tbreak;\n\tcase CHARSET_NO_REENCODE:\n\t\tmi.metainfo_charset = NULL;\n\t\tbreak;\n\tcase CHARSET_EXPLICIT:\n\t\tbreak;\n\tdefault:\n\t\tBUG(\"invalid meta_charset.policy\");\n\t}\n\n\tmi.input = stdin;\n\tmi.output = stdout;\n\n\tmsgfile = prefix_filename(prefix, argv[0]);\n\tpatchfile = prefix_filename(prefix, argv[1]);\n\n\tstatus = !!mailinfo(&mi, msgfile, patchfile);\n\tclear_mailinfo(&mi);\n\n\tfree(msgfile);\n\tfree(patchfile);\n\treturn status;\n}\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "00bfcd1afa05adf3db40c26771dd1b8ec98c0e28",
  "sha1_ok": true,
  "size": 3159
}
