{
  "content": {
    "base64": "I2luY2x1ZGUgImNhY2hlLmgiCiNpbmNsdWRlICJhbGlhcy5oIgojaW5jbHVkZSAiY29uZmlnLmgiCiNpbmNsdWRlICJzdHJpbmctbGlzdC5oIgoKc3RydWN0IGNvbmZpZ19hbGlhc19kYXRhIHsKCWNvbnN0IGNoYXIgKmFsaWFzOwoJY2hhciAqdjsKCXN0cnVjdCBzdHJpbmdfbGlzdCAqbGlzdDsKfTsKCnN0YXRpYyBpbnQgY29uZmlnX2FsaWFzX2NiKGNvbnN0IGNoYXIgKmtleSwgY29uc3QgY2hhciAqdmFsdWUsIHZvaWQgKmQpCnsKCXN0cnVjdCBjb25maWdfYWxpYXNfZGF0YSAqZGF0YSA9IGQ7Cgljb25zdCBjaGFyICpwOwoKCWlmICghc2tpcF9wcmVmaXgoa2V5LCAiYWxpYXMuIiwgJnApKQoJCXJldHVybiAwOwoKCWlmIChkYXRhLT5hbGlhcykgewoJCWlmICghc3RyY2FzZWNtcChwLCBkYXRhLT5hbGlhcykpCgkJCXJldHVybiBnaXRfY29uZmlnX3N0cmluZygoY29uc3QgY2hhciAqKikmZGF0YS0+diwKCQkJCQkJIGtleSwgdmFsdWUpOwoJfSBlbHNlIGlmIChkYXRhLT5saXN0KSB7CgkJc3RyaW5nX2xpc3RfYXBwZW5kKGRhdGEtPmxpc3QsIHApOwoJfQoKCXJldHVybiAwOwp9CgpjaGFyICphbGlhc19sb29rdXAoY29uc3QgY2hhciAqYWxpYXMpCnsKCXN0cnVjdCBjb25maWdfYWxpYXNfZGF0YSBkYXRhID0geyBhbGlhcywgTlVMTCB9OwoKCXJlYWRfZWFybHlfY29uZmlnKGNvbmZpZ19hbGlhc19jYiwgJmRhdGEpOwoKCXJldHVybiBkYXRhLnY7Cn0KCnZvaWQgbGlzdF9hbGlhc2VzKHN0cnVjdCBzdHJpbmdfbGlzdCAqbGlzdCkKewoJc3RydWN0IGNvbmZpZ19hbGlhc19kYXRhIGRhdGEgPSB7IE5VTEwsIE5VTEwsIGxpc3QgfTsKCglyZWFkX2Vhcmx5X2NvbmZpZyhjb25maWdfYWxpYXNfY2IsICZkYXRhKTsKfQoKI2RlZmluZSBTUExJVF9DTURMSU5FX0JBRF9FTkRJTkcgMQojZGVmaW5lIFNQTElUX0NNRExJTkVfVU5DTE9TRURfUVVPVEUgMgojZGVmaW5lIFNQTElUX0NNRExJTkVfQVJHQ19PVkVSRkxPVyAzCnN0YXRpYyBjb25zdCBjaGFyICpzcGxpdF9jbWRsaW5lX2Vycm9yc1tdID0gewoJTl8oImNtZGxpbmUgZW5kcyB3aXRoIFxcIiksCglOXygidW5jbG9zZWQgcXVvdGUiKSwKCU5fKCJ0b28gbWFueSBhcmd1bWVudHMiKSwKfTsKCmludCBzcGxpdF9jbWRsaW5lKGNoYXIgKmNtZGxpbmUsIGNvbnN0IGNoYXIgKioqYXJndikKewoJc2l6ZV90IHNyYywgZHN0LCBjb3VudCA9IDAsIHNpemUgPSAxNjsKCWNoYXIgcXVvdGVkID0gMDsKCglBTExPQ19BUlJBWSgqYXJndiwgc2l6ZSk7CgoJLyogc3BsaXQgYWxpYXNfc3RyaW5nICovCgkoKmFyZ3YpW2NvdW50KytdID0gY21kbGluZTsKCWZvciAoc3JjID0gZHN0ID0gMDsgY21kbGluZVtzcmNdOykgewoJCWNoYXIgYyA9IGNtZGxpbmVbc3JjXTsKCQlpZiAoIXF1b3RlZCAmJiBpc3NwYWNlKGMpKSB7CgkJCWNtZGxpbmVbZHN0KytdID0gMDsKCQkJd2hpbGUgKGNtZGxpbmVbKytzcmNdCgkJCQkJJiYgaXNzcGFjZShjbWRsaW5lW3NyY10pKQoJCQkJOyAvKiBza2lwICovCgkJCUFMTE9DX0dST1coKmFyZ3YsIGNvdW50ICsgMSwgc2l6ZSk7CgkJCSgqYXJndilbY291bnQrK10gPSBjbWRsaW5lICsgZHN0OwoJCX0gZWxzZSBpZiAoIXF1b3RlZCAmJiAoYyA9PSAnXCcnIHx8IGMgPT0gJyInKSkgewoJCQlxdW90ZWQgPSBjOwoJCQlzcmMrKzsKCQl9IGVsc2UgaWYgKGMgPT0gcXVvdGVkKSB7CgkJCXF1b3RlZCA9IDA7CgkJCXNyYysrOwoJCX0gZWxzZSB7CgkJCWlmIChjID09ICdcXCcgJiYgcXVvdGVkICE9ICdcJycpIHsKCQkJCXNyYysrOwoJCQkJYyA9IGNtZGxpbmVbc3JjXTsKCQkJCWlmICghYykgewoJCQkJCUZSRUVfQU5EX05VTEwoKmFyZ3YpOwoJCQkJCXJldHVybiAtU1BMSVRfQ01ETElORV9CQURfRU5ESU5HOwoJCQkJfQoJCQl9CgkJCWNtZGxpbmVbZHN0KytdID0gYzsKCQkJc3JjKys7CgkJfQoJfQoKCWNtZGxpbmVbZHN0XSA9IDA7CgoJaWYgKHF1b3RlZCkgewoJCUZSRUVfQU5EX05VTEwoKmFyZ3YpOwoJCXJldHVybiAtU1BMSVRfQ01ETElORV9VTkNMT1NFRF9RVU9URTsKCX0KCglpZiAoY291bnQgPj0gSU5UX01BWCkgewoJCUZSRUVfQU5EX05VTEwoKmFyZ3YpOwoJCXJldHVybiAtU1BMSVRfQ01ETElORV9BUkdDX09WRVJGTE9XOwoJfQoKCUFMTE9DX0dST1coKmFyZ3YsIGNvdW50ICsgMSwgc2l6ZSk7CgkoKmFyZ3YpW2NvdW50XSA9IE5VTEw7CgoJcmV0dXJuIGNvdW50Owp9Cgpjb25zdCBjaGFyICpzcGxpdF9jbWRsaW5lX3N0cmVycm9yKGludCBzcGxpdF9jbWRsaW5lX2Vycm5vKQp7CglyZXR1cm4gc3BsaXRfY21kbGluZV9lcnJvcnNbLXNwbGl0X2NtZGxpbmVfZXJybm8gLSAxXTsKfQo=",
    "text": "#include \"cache.h\"\n#include \"alias.h\"\n#include \"config.h\"\n#include \"string-list.h\"\n\nstruct config_alias_data {\n\tconst char *alias;\n\tchar *v;\n\tstruct string_list *list;\n};\n\nstatic int config_alias_cb(const char *key, const char *value, void *d)\n{\n\tstruct config_alias_data *data = d;\n\tconst char *p;\n\n\tif (!skip_prefix(key, \"alias.\", &p))\n\t\treturn 0;\n\n\tif (data->alias) {\n\t\tif (!strcasecmp(p, data->alias))\n\t\t\treturn git_config_string((const char **)&data->v,\n\t\t\t\t\t\t key, value);\n\t} else if (data->list) {\n\t\tstring_list_append(data->list, p);\n\t}\n\n\treturn 0;\n}\n\nchar *alias_lookup(const char *alias)\n{\n\tstruct config_alias_data data = { alias, NULL };\n\n\tread_early_config(config_alias_cb, &data);\n\n\treturn data.v;\n}\n\nvoid list_aliases(struct string_list *list)\n{\n\tstruct config_alias_data data = { NULL, NULL, list };\n\n\tread_early_config(config_alias_cb, &data);\n}\n\n#define SPLIT_CMDLINE_BAD_ENDING 1\n#define SPLIT_CMDLINE_UNCLOSED_QUOTE 2\n#define SPLIT_CMDLINE_ARGC_OVERFLOW 3\nstatic const char *split_cmdline_errors[] = {\n\tN_(\"cmdline ends with \\\\\"),\n\tN_(\"unclosed quote\"),\n\tN_(\"too many arguments\"),\n};\n\nint split_cmdline(char *cmdline, const char ***argv)\n{\n\tsize_t src, dst, count = 0, size = 16;\n\tchar quoted = 0;\n\n\tALLOC_ARRAY(*argv, size);\n\n\t/* split alias_string */\n\t(*argv)[count++] = cmdline;\n\tfor (src = dst = 0; cmdline[src];) {\n\t\tchar c = cmdline[src];\n\t\tif (!quoted && isspace(c)) {\n\t\t\tcmdline[dst++] = 0;\n\t\t\twhile (cmdline[++src]\n\t\t\t\t\t&& isspace(cmdline[src]))\n\t\t\t\t; /* skip */\n\t\t\tALLOC_GROW(*argv, count + 1, size);\n\t\t\t(*argv)[count++] = cmdline + dst;\n\t\t} else if (!quoted && (c == '\\'' || c == '\"')) {\n\t\t\tquoted = c;\n\t\t\tsrc++;\n\t\t} else if (c == quoted) {\n\t\t\tquoted = 0;\n\t\t\tsrc++;\n\t\t} else {\n\t\t\tif (c == '\\\\' && quoted != '\\'') {\n\t\t\t\tsrc++;\n\t\t\t\tc = cmdline[src];\n\t\t\t\tif (!c) {\n\t\t\t\t\tFREE_AND_NULL(*argv);\n\t\t\t\t\treturn -SPLIT_CMDLINE_BAD_ENDING;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcmdline[dst++] = c;\n\t\t\tsrc++;\n\t\t}\n\t}\n\n\tcmdline[dst] = 0;\n\n\tif (quoted) {\n\t\tFREE_AND_NULL(*argv);\n\t\treturn -SPLIT_CMDLINE_UNCLOSED_QUOTE;\n\t}\n\n\tif (count >= INT_MAX) {\n\t\tFREE_AND_NULL(*argv);\n\t\treturn -SPLIT_CMDLINE_ARGC_OVERFLOW;\n\t}\n\n\tALLOC_GROW(*argv, count + 1, size);\n\t(*argv)[count] = NULL;\n\n\treturn count;\n}\n\nconst char *split_cmdline_strerror(int split_cmdline_errno)\n{\n\treturn split_cmdline_errors[-split_cmdline_errno - 1];\n}\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "00abde081739436236aa077412c3b5b686144f42",
  "sha1_ok": true,
  "size": 2306
}
