{
  "content": {
    "base64": "I2lmbmRlZiBQQUNLX1JFVklOREVYX0gKI2RlZmluZSBQQUNLX1JFVklOREVYX0gKCi8qKgogKiBBIHJldmluZGV4IGFsbG93cyBjb252ZXJ0aW5nIGVmZmljaWVudGx5IGJldHdlZW4gdGhyZWUgcHJvcGVydGllcwogKiBvZiBhbiBvYmplY3Qgd2l0aGluIGEgcGFjazoKICoKICogLSBpbmRleCBwb3NpdGlvbjogdGhlIG51bWVyaWMgcG9zaXRpb24gd2l0aGluIHRoZSBsaXN0IG9mIHNvcnRlZCBvYmplY3QgaWRzCiAqICAgZm91bmQgaW4gdGhlIC5pZHggZmlsZQogKgogKiAtIHBhY2sgcG9zaXRpb246IHRoZSBudW1lcmljIHBvc2l0aW9uIHdpdGhpbiB0aGUgbGlzdCBvZiBvYmplY3RzIGluIHRoZWlyCiAqICAgb3JkZXIgd2l0aGluIHRoZSBhY3R1YWwgLnBhY2sgZmlsZSAoaS5lLiwgMCBpcyB0aGUgZmlyc3Qgb2JqZWN0IGluIHRoZQogKiAgIC5wYWNrLCAxIGlzIHRoZSBzZWNvbmQsIGFuZCBzbyBvbikKICoKICogLSBvZmZzZXQ6IHRoZSBieXRlIG9mZnNldCB3aXRoaW4gdGhlIC5wYWNrIGZpbGUgYXQgd2hpY2ggdGhlIG9iamVjdCBjb250ZW50cwogKiAgIGNhbiBiZSBmb3VuZAogKgogKiBUaGUgcmV2aW5kZXggY2FuIGFsc28gYmUgdXNlZCB3aXRoIGEgbXVsdGktcGFjayBpbmRleCAoTUlEWCkuIEluIHRoaXMKICogc2V0dGluZzoKICoKICogICAtIGluZGV4IHBvc2l0aW9uIHJlZmVycyB0byBhbiBvYmplY3QncyBudW1lcmljIHBvc2l0aW9uIHdpdGhpbiB0aGUgTUlEWAogKgogKiAgIC0gcGFjayBwb3NpdGlvbiByZWZlcnMgdG8gYW4gb2JqZWN0J3MgcG9zaXRpb24gd2l0aGluIGEgbm9uLWV4aXN0ZW50IHBhY2sKICogICAgIGRlc2NyaWJlZCBieSB0aGUgTUlEWC4gVGhlIHBhY2sgc3RydWN0dXJlIGlzIGRlc2NyaWJlZCBpbgogKiAgICAgZ2l0Zm9ybWF0LXBhY2soNSkuCiAqCiAqICAgICBJdCBpcyBlZmZlY3RpdmVseSBhIGNvbmNhdGFuYXRpb24gb2YgYWxsIHBhY2tzIGluIHRoZSBNSURYIChvcmRlcmVkIGJ5CiAqICAgICB0aGVpciBudW1lcmljIElEIHdpdGhpbiB0aGUgTUlEWCkgaW4gdGhlaXIgb3JpZ2luYWwgb3JkZXIgd2l0aGluIGVhY2gKICogICAgIHBhY2spLCByZW1vdmluZyBkdXBsaWNhdGVzLCBhbmQgcGxhY2luZyB0aGUgcHJlZmVycmVkIHBhY2sgKGlmIGFueSkKICogICAgIGZpcnN0LgogKi8KCgojZGVmaW5lIFJJRFhfU0lHTkFUVVJFIDB4NTI0OTQ0NTggLyogIlJJRFgiICovCiNkZWZpbmUgUklEWF9WRVJTSU9OIDEKCiNkZWZpbmUgR0lUX1RFU1RfTk9fV1JJVEVfUkVWX0lOREVYICJHSVRfVEVTVF9OT19XUklURV9SRVZfSU5ERVgiCiNkZWZpbmUgR0lUX1RFU1RfUkVWX0lOREVYX0RJRV9JTl9NRU1PUlkgIkdJVF9URVNUX1JFVl9JTkRFWF9ESUVfSU5fTUVNT1JZIgojZGVmaW5lIEdJVF9URVNUX1JFVl9JTkRFWF9ESUVfT05fRElTSyAiR0lUX1RFU1RfUkVWX0lOREVYX0RJRV9PTl9ESVNLIgoKc3RydWN0IHBhY2tlZF9naXQ7CnN0cnVjdCBtdWx0aV9wYWNrX2luZGV4OwpzdHJ1Y3QgcmVwb3NpdG9yeTsKCi8qCiAqIGxvYWRfcGFja19yZXZpbmRleCBwb3B1bGF0ZXMgdGhlIHJldmluZGV4J3MgaW50ZXJuYWwgZGF0YS1zdHJ1Y3R1cmVzIGZvciB0aGUKICogZ2l2ZW4gcGFjaywgcmV0dXJuaW5nIHplcm8gb24gc3VjY2VzcyBhbmQgYSBuZWdhdGl2ZSB2YWx1ZSBvdGhlcndpc2UuCiAqCiAqIElmIGEgJy5yZXYnIGZpbGUgaXMgcHJlc2VudCBpdCBpcyBtbWFwJ2QsIGFuZCBwb2ludGVycyBhcmUgYXNzaWduZWQgaW50byBpdAogKiAoaW5zdGVhZCBvZiB1c2luZyB0aGUgaW4tbWVtb3J5IHZhcmlhbnQpLgogKi8KaW50IGxvYWRfcGFja19yZXZpbmRleChzdHJ1Y3QgcmVwb3NpdG9yeSAqciwgc3RydWN0IHBhY2tlZF9naXQgKnApOwoKLyoKICogU3BlY2lmaWNhbGx5IGxvYWQgYSBwYWNrIHJldmluZGV4IGZyb20gZGlzay4KICoKICogUmV0dXJucyAwIG9uIHN1Y2Nlc3MsIDEgb24gIm5vIC5yZXYgZmlsZSIsIGFuZCAtMSB3aGVuIHRoZXJlIGlzIGFuCiAqIGVycm9yIHBhcnNpbmcgdGhlIC5yZXYgZmlsZS4KICovCmludCBsb2FkX3BhY2tfcmV2aW5kZXhfZnJvbV9kaXNrKHN0cnVjdCBwYWNrZWRfZ2l0ICpwKTsKCi8qCiAqIHZlcmlmeV9wYWNrX3JldmluZGV4IHZlcmlmaWVzIHRoYXQgdGhlIG9uLWRpc2sgcmV2LWluZGV4IGZvciB0aGUgZ2l2ZW4KICogcGFjay1maWxlIGlzIHRoZSBzYW1lIHRoYXQgd291bGQgYmUgY3JlYXRlZCBpZiB3cml0dGVuIGZyb20gc2NyYXRjaC4KICoKICogQSBuZWdhdGl2ZSBudW1iZXIgaXMgcmV0dXJuZWQgb24gZXJyb3IuCiAqLwppbnQgdmVyaWZ5X3BhY2tfcmV2aW5kZXgoc3RydWN0IHBhY2tlZF9naXQgKnApOwoKLyoKICogbG9hZF9taWR4X3JldmluZGV4IGxvYWRzIHRoZSAnLnJldicgZmlsZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbgogKiBtdWx0aS1wYWNrIGluZGV4IGJ5IG1tYXAtaW5nIGl0IGFuZCBhc3NpZ25pbmcgcG9pbnRlcnMgaW4gdGhlCiAqIG11bHRpX3BhY2tfaW5kZXggdG8gcG9pbnQgYXQgaXQuCiAqCiAqIEEgbmVnYXRpdmUgbnVtYmVyIGlzIHJldHVybmVkIG9uIGVycm9yLiBBIHBvc2l0aXZlIG51bWJlciBpcyByZXR1cm5lZCBpbgogKiBjYXNlIHRoZSBtdWx0aS1wYWNrLWluZGV4IGRvZXMgbm90IGhhdmUgYSByZXZlcnNlIGluZGV4LgogKi8KaW50IGxvYWRfbWlkeF9yZXZpbmRleChzdHJ1Y3QgbXVsdGlfcGFja19pbmRleCAqbSk7CgovKgogKiBGcmVlcyByZXNvdXJjZXMgYXNzb2NpYXRlZCB3aXRoIGEgbXVsdGktcGFjayByZXZlcnNlIGluZGV4LgogKgogKiBBIG5lZ2F0aXZlIG51bWJlciBpcyByZXR1cm5lZCBvbiBlcnJvci4KICovCmludCBjbG9zZV9taWR4X3JldmluZGV4KHN0cnVjdCBtdWx0aV9wYWNrX2luZGV4ICptKTsKCi8qCiAqIG9mZnNldF90b19wYWNrX3BvcyBjb252ZXJ0cyBhbiBvYmplY3Qgb2Zmc2V0IHRvIGEgcGFjayBwb3NpdGlvbi4gVGhpcwogKiBmdW5jdGlvbiByZXR1cm5zIHplcm8gb24gc3VjY2VzcywgYW5kIGEgbmVnYXRpdmUgbnVtYmVyIG90aGVyd2lzZS4gVGhlCiAqIHBhcmFtZXRlciAncG9zJyBpcyB1c2FibGUgb25seSBvbiBzdWNjZXNzLgogKgogKiBJZiB0aGUgcmV2ZXJzZSBpbmRleCBoYXMgbm90IHlldCBiZWVuIGxvYWRlZCwgdGhpcyBmdW5jdGlvbiBsb2FkcyBpdCBsYXppbHksCiAqIGFuZCByZXR1cm5zIGFuIG5lZ2F0aXZlIG51bWJlciBpZiBhbiBlcnJvciB3YXMgZW5jb3VudGVyZWQuCiAqCiAqIFRoaXMgZnVuY3Rpb24gcnVucyBpbiB0aW1lIE8obG9nIE4pIHdpdGggdGhlIG51bWJlciBvZiBvYmplY3RzIGluIHRoZSBwYWNrLgogKi8KaW50IG9mZnNldF90b19wYWNrX3BvcyhzdHJ1Y3QgcGFja2VkX2dpdCAqcCwgb2ZmX3Qgb2ZzLCB1aW50MzJfdCAqcG9zKTsKCi8qCiAqIHBhY2tfcG9zX3RvX2luZGV4IGNvbnZlcnRzIHRoZSBnaXZlbiBwYWNrLXJlbGF0aXZlIHBvc2l0aW9uICdwb3MnIGJ5CiAqIHJldHVybmluZyBhbiBpbmRleC1yZWxhdGl2ZSBwb3NpdGlvbi4KICoKICogSWYgdGhlIHJldmVyc2UgaW5kZXggaGFzIG5vdCB5ZXQgYmVlbiBsb2FkZWQsIG9yIHRoZSBwb3NpdGlvbiBpcyBvdXQgb2YKICogYm91bmRzLCB0aGlzIGZ1bmN0aW9uIGFib3J0cy4KICoKICogVGhpcyBmdW5jdGlvbiBydW5zIGluIGNvbnN0YW50IHRpbWUuCiAqLwp1aW50MzJfdCBwYWNrX3Bvc190b19pbmRleChzdHJ1Y3QgcGFja2VkX2dpdCAqcCwgdWludDMyX3QgcG9zKTsKCi8qCiAqIHBhY2tfcG9zX3RvX29mZnNldCBjb252ZXJ0cyB0aGUgZ2l2ZW4gcGFjay1yZWxhdGl2ZSBwb3NpdGlvbiAncG9zJyBpbnRvIGEKICogcGFjayBvZmZzZXQuIEZvciBhIHBhY2sgd2l0aCAnTicgb2JqZWN0cywgYXNraW5nIGZvciBwb3NpdGlvbiAnTicgd2lsbCByZXR1cm4KICogdGhlIHRvdGFsIHNpemUgKGluIGJ5dGVzKSBvZiB0aGUgcGFjay4KICoKICogSWYgdGhlIHJldmVyc2UgaW5kZXggaGFzIG5vdCB5ZXQgYmVlbiBsb2FkZWQsIG9yIHRoZSBwb3NpdGlvbiBpcyBvdXQgb2YKICogYm91bmRzLCB0aGlzIGZ1bmN0aW9uIGFib3J0cy4KICoKICogVGhpcyBmdW5jdGlvbiBydW5zIGluIGNvbnN0YW50IHRpbWUgdW5kZXIgYm90aCBpbi1tZW1vcnkgYW5kIG9uLWRpc2sgcmV2ZXJzZQogKiBpbmRleGVzLCBidXQgYW4gYWRkaXRpb25hbCBzdGVwIGlzIHRha2VuIHRvIGNvbnN1bHQgdGhlIGNvcnJlc3BvbmRpbmcgLmlkeAogKiBmaWxlIHdoZW4gdXNpbmcgdGhlIG9uLWRpc2sgZm9ybWF0LgogKi8Kb2ZmX3QgcGFja19wb3NfdG9fb2Zmc2V0KHN0cnVjdCBwYWNrZWRfZ2l0ICpwLCB1aW50MzJfdCBwb3MpOwoKLyoKICogcGFja19wb3NfdG9fbWlkeCBjb252ZXJ0cyB0aGUgb2JqZWN0IGF0IHBvc2l0aW9uICJwb3MiIHdpdGhpbiB0aGUgTUlEWAogKiBwc2V1ZG8tcGFjayBpbnRvIGEgTUlEWCBwb3NpdGlvbi4KICoKICogSWYgdGhlIHJldmVyc2UgaW5kZXggaGFzIG5vdCB5ZXQgYmVlbiBsb2FkZWQsIG9yIHRoZSBwb3NpdGlvbiBpcyBvdXQgb2YKICogYm91bmRzLCB0aGlzIGZ1bmN0aW9uIGFib3J0cy4KICoKICogVGhpcyBmdW5jdGlvbiBydW5zIGluIGNvbnN0YW50IHRpbWUuCiAqLwp1aW50MzJfdCBwYWNrX3Bvc190b19taWR4KHN0cnVjdCBtdWx0aV9wYWNrX2luZGV4ICptLCB1aW50MzJfdCBwb3MpOwoKLyoKICogbWlkeF90b19wYWNrX3BvcyBjb252ZXJ0cyBmcm9tIHRoZSBNSURYLXJlbGF0aXZlIHBvc2l0aW9uIGF0ICJhdCIgdG8gdGhlCiAqIGNvcnJlc3BvbmRpbmcgcGFjayBwb3NpdGlvbi4KICoKICogSWYgdGhlIHJldmVyc2UgaW5kZXggaGFzIG5vdCB5ZXQgYmVlbiBsb2FkZWQsIG9yIHRoZSBwb3NpdGlvbiBpcyBvdXQgb2YKICogYm91bmRzLCB0aGlzIGZ1bmN0aW9uIGFib3J0cy4KICoKICogVGhpcyBmdW5jdGlvbiBydW5zIGluIHRpbWUgTyhsb2cgTikgd2l0aCB0aGUgbnVtYmVyIG9mIG9iamVjdHMgaW4gdGhlIE1JRFguCiAqLwppbnQgbWlkeF90b19wYWNrX3BvcyhzdHJ1Y3QgbXVsdGlfcGFja19pbmRleCAqbWlkeCwgdWludDMyX3QgYXQsIHVpbnQzMl90ICpwb3MpOwoKaW50IG1pZHhfcGFpcl90b19wYWNrX3BvcyhzdHJ1Y3QgbXVsdGlfcGFja19pbmRleCAqbWlkeCwgdWludDMyX3QgcGFja19pZCwKCQkJICBvZmZfdCBvZnMsIHVpbnQzMl90ICpwb3MpOwoKI2VuZGlmCg==",
    "text": "#ifndef PACK_REVINDEX_H\n#define PACK_REVINDEX_H\n\n/**\n * A revindex allows converting efficiently between three properties\n * of an object within a pack:\n *\n * - index position: the numeric position within the list of sorted object ids\n *   found in the .idx file\n *\n * - pack position: the numeric position within the list of objects in their\n *   order within the actual .pack file (i.e., 0 is the first object in the\n *   .pack, 1 is the second, and so on)\n *\n * - offset: the byte offset within the .pack file at which the object contents\n *   can be found\n *\n * The revindex can also be used with a multi-pack index (MIDX). In this\n * setting:\n *\n *   - index position refers to an object's numeric position within the MIDX\n *\n *   - pack position refers to an object's position within a non-existent pack\n *     described by the MIDX. The pack structure is described in\n *     gitformat-pack(5).\n *\n *     It is effectively a concatanation of all packs in the MIDX (ordered by\n *     their numeric ID within the MIDX) in their original order within each\n *     pack), removing duplicates, and placing the preferred pack (if any)\n *     first.\n */\n\n\n#define RIDX_SIGNATURE 0x52494458 /* \"RIDX\" */\n#define RIDX_VERSION 1\n\n#define GIT_TEST_NO_WRITE_REV_INDEX \"GIT_TEST_NO_WRITE_REV_INDEX\"\n#define GIT_TEST_REV_INDEX_DIE_IN_MEMORY \"GIT_TEST_REV_INDEX_DIE_IN_MEMORY\"\n#define GIT_TEST_REV_INDEX_DIE_ON_DISK \"GIT_TEST_REV_INDEX_DIE_ON_DISK\"\n\nstruct packed_git;\nstruct multi_pack_index;\nstruct repository;\n\n/*\n * load_pack_revindex populates the revindex's internal data-structures for the\n * given pack, returning zero on success and a negative value otherwise.\n *\n * If a '.rev' file is present it is mmap'd, and pointers are assigned into it\n * (instead of using the in-memory variant).\n */\nint load_pack_revindex(struct repository *r, struct packed_git *p);\n\n/*\n * Specifically load a pack revindex from disk.\n *\n * Returns 0 on success, 1 on \"no .rev file\", and -1 when there is an\n * error parsing the .rev file.\n */\nint load_pack_revindex_from_disk(struct packed_git *p);\n\n/*\n * verify_pack_revindex verifies that the on-disk rev-index for the given\n * pack-file is the same that would be created if written from scratch.\n *\n * A negative number is returned on error.\n */\nint verify_pack_revindex(struct packed_git *p);\n\n/*\n * load_midx_revindex loads the '.rev' file corresponding to the given\n * multi-pack index by mmap-ing it and assigning pointers in the\n * multi_pack_index to point at it.\n *\n * A negative number is returned on error. A positive number is returned in\n * case the multi-pack-index does not have a reverse index.\n */\nint load_midx_revindex(struct multi_pack_index *m);\n\n/*\n * Frees resources associated with a multi-pack reverse index.\n *\n * A negative number is returned on error.\n */\nint close_midx_revindex(struct multi_pack_index *m);\n\n/*\n * offset_to_pack_pos converts an object offset to a pack position. This\n * function returns zero on success, and a negative number otherwise. The\n * parameter 'pos' is usable only on success.\n *\n * If the reverse index has not yet been loaded, this function loads it lazily,\n * and returns an negative number if an error was encountered.\n *\n * This function runs in time O(log N) with the number of objects in the pack.\n */\nint offset_to_pack_pos(struct packed_git *p, off_t ofs, uint32_t *pos);\n\n/*\n * pack_pos_to_index converts the given pack-relative position 'pos' by\n * returning an index-relative position.\n *\n * If the reverse index has not yet been loaded, or the position is out of\n * bounds, this function aborts.\n *\n * This function runs in constant time.\n */\nuint32_t pack_pos_to_index(struct packed_git *p, uint32_t pos);\n\n/*\n * pack_pos_to_offset converts the given pack-relative position 'pos' into a\n * pack offset. For a pack with 'N' objects, asking for position 'N' will return\n * the total size (in bytes) of the pack.\n *\n * If the reverse index has not yet been loaded, or the position is out of\n * bounds, this function aborts.\n *\n * This function runs in constant time under both in-memory and on-disk reverse\n * indexes, but an additional step is taken to consult the corresponding .idx\n * file when using the on-disk format.\n */\noff_t pack_pos_to_offset(struct packed_git *p, uint32_t pos);\n\n/*\n * pack_pos_to_midx converts the object at position \"pos\" within the MIDX\n * pseudo-pack into a MIDX position.\n *\n * If the reverse index has not yet been loaded, or the position is out of\n * bounds, this function aborts.\n *\n * This function runs in constant time.\n */\nuint32_t pack_pos_to_midx(struct multi_pack_index *m, uint32_t pos);\n\n/*\n * midx_to_pack_pos converts from the MIDX-relative position at \"at\" to the\n * corresponding pack position.\n *\n * If the reverse index has not yet been loaded, or the position is out of\n * bounds, this function aborts.\n *\n * This function runs in time O(log N) with the number of objects in the MIDX.\n */\nint midx_to_pack_pos(struct multi_pack_index *midx, uint32_t at, uint32_t *pos);\n\nint midx_pair_to_pack_pos(struct multi_pack_index *midx, uint32_t pack_id,\n\t\t\t  off_t ofs, uint32_t *pos);\n\n#endif\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "004289209191d0990ed2353b83338a1df05ace0c",
  "sha1_ok": true,
  "size": 5134
}
