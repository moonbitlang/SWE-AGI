{
  "content": {
    "base64": "IyEvYmluL3NoCiMKIyBDb3B5cmlnaHQgKGMpIDIwMTIgQXZlcnkgUGVubmFyYXVtCiMKdGVzdF9kZXNjcmlwdGlvbj0nQmFzaWMgcG9yY2VsYWluIHN1cHBvcnQgZm9yIHN1YnRyZWVzCgpUaGlzIHRlc3QgdmVyaWZpZXMgdGhlIGJhc2ljIG9wZXJhdGlvbiBvZiB0aGUgbWVyZ2UsIHB1bGwsIGFkZAphbmQgc3BsaXQgc3ViY29tbWFuZHMgb2YgZ2l0IHN1YnRyZWUuCicKClRFU1RfRElSRUNUT1JZPSQocHdkKS8uLi8uLi8uLi90CmV4cG9ydCBURVNUX0RJUkVDVE9SWQoKLiAuLi8uLi8uLi90L3Rlc3QtbGliLnNoCgpjcmVhdGUoKQp7CgllY2hvICIkMSIgPiIkMSIKCWdpdCBhZGQgIiQxIgp9CgoKY2hlY2tfZXF1YWwoKQp7Cgl0ZXN0X2RlYnVnICdlY2hvJwoJdGVzdF9kZWJ1ZyAiZWNobyBcImNoZWNrIGE6XCIgXCJ7JDF9XCIiCgl0ZXN0X2RlYnVnICJlY2hvIFwiICAgICAgYjpcIiBcInskMn1cIiIKCWlmIFsgIiQxIiA9ICIkMiIgXTsgdGhlbgoJCXJldHVybiAwCgllbHNlCgkJcmV0dXJuIDEKCWZpCn0KCmZpeG5sKCkKewoJdD0iIgoJd2hpbGUgcmVhZCB4OyBkbwoJCXQ9IiR0JHggIgoJZG9uZQoJZWNobyAkdAp9CgptdWx0aWxpbmUoKQp7Cgl3aGlsZSByZWFkIHg7IGRvCgkJc2V0IC0tICR4CgkJZm9yIGQgaW4gIiRAIjsgZG8KCQkJZWNobyAiJGQiCgkJZG9uZQoJZG9uZQp9Cgp1bmRvKCkKewoJZ2l0IHJlc2V0IC0taGFyZCBIRUFEfgp9CgpsYXN0X2NvbW1pdF9tZXNzYWdlKCkKewoJZ2l0IGxvZyAtLXByZXR0eT1mb3JtYXQ6JXMgLTEKfQoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnaW5pdCBzdWJwcm9qJyAnCgl0ZXN0X2NyZWF0ZV9yZXBvIHN1YnByb2oKJwoKIyBUbyB0aGUgc3VicHJvamVjdCEKY2Qgc3VicHJvagoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYWRkIHN1YjEnICcKCWNyZWF0ZSBzdWIxICYmCglnaXQgY29tbWl0IC1tICJzdWIxIiAmJgoJZ2l0IGJyYW5jaCBzdWIxICYmCglnaXQgYnJhbmNoIC1tIG1hc3RlciBzdWJwcm9qCicKCiMgU2F2ZSB0aGlzIGhhc2ggZm9yIHRlc3RpbmcgbGF0ZXIuCgpzdWJkaXJfaGFzaD0kKGdpdCByZXYtcGFyc2UgSEVBRCkKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2FkZCBzdWIyJyAnCgljcmVhdGUgc3ViMiAmJgoJZ2l0IGNvbW1pdCAtbSAic3ViMiIgJiYKCWdpdCBicmFuY2ggc3ViMgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhZGQgc3ViMycgJwoJY3JlYXRlIHN1YjMgJiYKCWdpdCBjb21taXQgLW0gInN1YjMiICYmCglnaXQgYnJhbmNoIHN1YjMKJwoKIyBCYWNrIHRvIG1haW5saW5lCmNkIC4uCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhZGQgbWFpbjQnICcKCWNyZWF0ZSBtYWluNCAmJgoJZ2l0IGNvbW1pdCAtbSAibWFpbjQiICYmCglnaXQgYnJhbmNoIC1tIG1hc3RlciBtYWlubGluZSAmJgoJZ2l0IGJyYW5jaCBzdWJkaXIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZmV0Y2ggc3VicHJvaiBoaXN0b3J5JyAnCglnaXQgZmV0Y2ggLi9zdWJwcm9qIHN1YjEgJiYKCWdpdCBicmFuY2ggc3ViMSBGRVRDSF9IRUFECicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ25vIHN1YnRyZWUgZXhpc3RzIGluIG1haW4gdHJlZScgJwoJdGVzdF9tdXN0X2ZhaWwgZ2l0IHN1YnRyZWUgbWVyZ2UgLS1wcmVmaXg9c3ViZGlyIHN1YjEKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbm8gcHVsbCBmcm9tIG5vbi1leGlzdGFudCBzdWJ0cmVlJyAnCgl0ZXN0X211c3RfZmFpbCBnaXQgc3VidHJlZSBwdWxsIC0tcHJlZml4PXN1YmRpciAuL3N1YnByb2ogc3ViMQonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdjaGVjayBpZiAtLW1lc3NhZ2Ugd29ya3MgZm9yIGFkZCcgJwoJZ2l0IHN1YnRyZWUgYWRkIC0tcHJlZml4PXN1YmRpciAtLW1lc3NhZ2U9IkFkZGVkIHN1YnByb2plY3QiIHN1YjEgJiYKCWNoZWNrX2VxdWFsICcnIiQobGFzdF9jb21taXRfbWVzc2FnZSkiJycgIkFkZGVkIHN1YnByb2plY3QiICYmCgl1bmRvCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2NoZWNrIGlmIC0tbWVzc2FnZSB3b3JrcyBhcyAtbSBhbmQgLS1wcmVmaXggYXMgLVAnICcKCWdpdCBzdWJ0cmVlIGFkZCAtUCBzdWJkaXIgLW0gIkFkZGVkIHN1YnByb2plY3QgdXNpbmcgZ2l0IHN1YnRyZWUiIHN1YjEgJiYKCWNoZWNrX2VxdWFsICcnIiQobGFzdF9jb21taXRfbWVzc2FnZSkiJycgIkFkZGVkIHN1YnByb2plY3QgdXNpbmcgZ2l0IHN1YnRyZWUiICYmCgl1bmRvCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2NoZWNrIGlmIC0tbWVzc2FnZSB3b3JrcyB3aXRoIHNxdWFzaCB0b28nICcKCWdpdCBzdWJ0cmVlIGFkZCAtUCBzdWJkaXIgLW0gIkFkZGVkIHN1YnByb2plY3Qgd2l0aCBzcXVhc2giIC0tc3F1YXNoIHN1YjEgJiYKCWNoZWNrX2VxdWFsICcnIiQobGFzdF9jb21taXRfbWVzc2FnZSkiJycgIkFkZGVkIHN1YnByb2plY3Qgd2l0aCBzcXVhc2giICYmCgl1bmRvCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2FkZCBzdWJwcm9qIHRvIG1haW5saW5lJyAnCglnaXQgc3VidHJlZSBhZGQgLS1wcmVmaXg9c3ViZGlyLyBGRVRDSF9IRUFEICYmCgljaGVja19lcXVhbCAnJyIkKGxhc3RfY29tbWl0X21lc3NhZ2UpIicnICJBZGQgJyInc3ViZGlyLyciJyBmcm9tIGNvbW1pdCAnIiciJycnIiQoZ2l0IHJldi1wYXJzZSBzdWIxKSInJyciJyInIgonCgojIHRoaXMgc2hvdWxkbid0IGFjdHVhbGx5IGRvIGFueXRoaW5nLCBzaW5jZSBGRVRDSF9IRUFEIGlzIGFscmVhZHkgYSBwYXJlbnQKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbWVyZ2UgZmV0Y2hlZCBzdWJwcm9qJyAnCglnaXQgbWVyZ2UgLW0gIm1lcmdlIC1zIC1vdXJzIiAtcyBvdXJzIEZFVENIX0hFQUQKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYWRkIG1haW4tc3ViNScgJwoJY3JlYXRlIHN1YmRpci9tYWluLXN1YjUgJiYKCWdpdCBjb21taXQgLW0gIm1haW4tc3ViNSIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYWRkIG1haW42JyAnCgljcmVhdGUgbWFpbjYgJiYKCWdpdCBjb21taXQgLW0gIm1haW42IGJvcmluZyIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYWRkIG1haW4tc3ViNycgJwoJY3JlYXRlIHN1YmRpci9tYWluLXN1YjcgJiYKCWdpdCBjb21taXQgLW0gIm1haW4tc3ViNyIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnZmV0Y2ggbmV3IHN1YnByb2ogaGlzdG9yeScgJwoJZ2l0IGZldGNoIC4vc3VicHJvaiBzdWIyICYmCglnaXQgYnJhbmNoIHN1YjIgRkVUQ0hfSEVBRAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdjaGVjayBpZiAtLW1lc3NhZ2Ugd29ya3MgZm9yIG1lcmdlJyAnCglnaXQgc3VidHJlZSBtZXJnZSAtLXByZWZpeD1zdWJkaXIgLW0gIk1lcmdlZCBjaGFuZ2VzIGZyb20gc3VicHJvamVjdCIgc3ViMiAmJgoJY2hlY2tfZXF1YWwgJyciJChsYXN0X2NvbW1pdF9tZXNzYWdlKSInJyAiTWVyZ2VkIGNoYW5nZXMgZnJvbSBzdWJwcm9qZWN0IiAmJgoJdW5kbwonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdjaGVjayBpZiAtLW1lc3NhZ2UgZm9yIG1lcmdlIHdvcmtzIHdpdGggc3F1YXNoIHRvbycgJwoJZ2l0IHN1YnRyZWUgbWVyZ2UgLS1wcmVmaXggc3ViZGlyIC1tICJNZXJnZWQgY2hhbmdlcyBmcm9tIHN1YnByb2plY3QgdXNpbmcgc3F1YXNoIiAtLXNxdWFzaCBzdWIyICYmCgljaGVja19lcXVhbCAnJyIkKGxhc3RfY29tbWl0X21lc3NhZ2UpIicnICJNZXJnZWQgY2hhbmdlcyBmcm9tIHN1YnByb2plY3QgdXNpbmcgc3F1YXNoIiAmJgoJdW5kbwonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdtZXJnZSBuZXcgc3VicHJvaiBoaXN0b3J5IGludG8gc3ViZGlyJyAnCglnaXQgc3VidHJlZSBtZXJnZSAtLXByZWZpeD1zdWJkaXIgRkVUQ0hfSEVBRCAmJgoJZ2l0IGJyYW5jaCBwcmUtc3BsaXQgJiYKCWNoZWNrX2VxdWFsICcnIiQobGFzdF9jb21taXRfbWVzc2FnZSkiJycgIk1lcmdlIGNvbW1pdCAnIiciJyIkKGdpdCByZXYtcGFyc2Ugc3ViMikiJyInIicgaW50byBtYWlubGluZSIgJiYKCXVuZG8KJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnQ2hlY2sgdGhhdCBwcmVmaXggYXJndW1lbnQgaXMgcmVxdWlyZWQgZm9yIHNwbGl0JyAnCgllY2hvICJZb3UgbXVzdCBwcm92aWRlIHRoZSAtLXByZWZpeCBvcHRpb24uIiA+IGV4cGVjdGVkICYmCgl0ZXN0X211c3RfZmFpbCBnaXQgc3VidHJlZSBzcGxpdCA+IGFjdHVhbCAyPiYxICYmCgl0ZXN0X2RlYnVnICJwcmludGYgJyInIidleHBlY3RlZDogJyInIiciICYmCgl0ZXN0X2RlYnVnICJjYXQgZXhwZWN0ZWQiICYmCgl0ZXN0X2RlYnVnICJwcmludGYgJyInIidhY3R1YWw6ICciJyInIiAmJgoJdGVzdF9kZWJ1ZyAiY2F0IGFjdHVhbCIgJiYKCXRlc3RfY21wIGV4cGVjdGVkIGFjdHVhbCAmJgoJcm0gLWYgZXhwZWN0ZWQgYWN0dWFsCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ0NoZWNrIHRoYXQgdGhlIDxwcmVmaXg+IGV4aXN0cyBmb3IgYSBzcGxpdCcgJwoJZWNobyAiJyInIidub24tZXhpc3RlbnQtZGlyZWN0b3J5JyInIiciIGRvZXMgbm90IGV4aXN0XDsgdXNlICInIiciJ2dpdCBzdWJ0cmVlIGFkZCciJyInIiA+IGV4cGVjdGVkICYmCgl0ZXN0X211c3RfZmFpbCBnaXQgc3VidHJlZSBzcGxpdCAtLXByZWZpeD1ub24tZXhpc3RlbnQtZGlyZWN0b3J5ID4gYWN0dWFsIDI+JjEgJiYKCXRlc3RfZGVidWcgInByaW50ZiAnIiciJ2V4cGVjdGVkOiAnIiciJyIgJiYKCXRlc3RfZGVidWcgImNhdCBleHBlY3RlZCIgJiYKCXRlc3RfZGVidWcgInByaW50ZiAnIiciJ2FjdHVhbDogJyInIiciICYmCgl0ZXN0X2RlYnVnICJjYXQgYWN0dWFsIiAmJgoJdGVzdF9jbXAgZXhwZWN0ZWQgYWN0dWFsCiMJcm0gLWYgZXhwZWN0ZWQgYWN0dWFsCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2NoZWNrIGlmIC0tbWVzc2FnZSB3b3JrcyBmb3Igc3BsaXQrcmVqb2luJyAnCglzcGwxPScnIiQoZ2l0IHN1YnRyZWUgc3BsaXQgLS1hbm5vdGF0ZT0nIicqJyInIC0tcHJlZml4IHN1YmRpciAtLW9udG8gRkVUQ0hfSEVBRCAtLW1lc3NhZ2UgIlNwbGl0ICYgcmVqb2luIiAtLXJlam9pbikiJycgJiYKCWdpdCBicmFuY2ggc3BsMSAiJHNwbDEiICYmCgljaGVja19lcXVhbCAnJyIkKGxhc3RfY29tbWl0X21lc3NhZ2UpIicnICJTcGxpdCAmIHJlam9pbiIgJiYKCXVuZG8KJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnY2hlY2sgc3BsaXQgd2l0aCAtLWJyYW5jaCcgJwoJc3BsMT0kKGdpdCBzdWJ0cmVlIHNwbGl0IC0tYW5ub3RhdGU9JyInKiciJyAtLXByZWZpeCBzdWJkaXIgLS1vbnRvIEZFVENIX0hFQUQgLS1tZXNzYWdlICJTcGxpdCAmIHJlam9pbiIgLS1yZWpvaW4pICYmCgl1bmRvICYmCglnaXQgc3VidHJlZSBzcGxpdCAtLWFubm90YXRlPSciJyonIicgLS1wcmVmaXggc3ViZGlyIC0tb250byBGRVRDSF9IRUFEIC0tYnJhbmNoIHNwbGl0YnIxICYmCgljaGVja19lcXVhbCAnJyIkKGdpdCByZXYtcGFyc2Ugc3BsaXRicjEpIicnICIkc3BsMSIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnY2hlY2sgaGFzaCBvZiBzcGxpdCcgJwoJc3BsMT0kKGdpdCBzdWJ0cmVlIHNwbGl0IC0tcHJlZml4IHN1YmRpcikgJiYKCWdpdCBzdWJ0cmVlIHNwbGl0IC0tcHJlZml4IHN1YmRpciAtLWJyYW5jaCBzcGxpdGJyMXRlc3QgJiYKCWNoZWNrX2VxdWFsICcnIiQoZ2l0IHJldi1wYXJzZSBzcGxpdGJyMXRlc3QpIicnICIkc3BsMSIgJiYKCWdpdCBjaGVja291dCBzcGxpdGJyMXRlc3QgJiYKCW5ld19oYXNoPSQoZ2l0IHJldi1wYXJzZSBIRUFEfjIpICYmCglnaXQgY2hlY2tvdXQgbWFpbmxpbmUgJiYKCWNoZWNrX2VxdWFsICcnIiRuZXdfaGFzaCInJyAiJHN1YmRpcl9oYXNoIgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdjaGVjayBzcGxpdCB3aXRoIC0tYnJhbmNoIGZvciBhbiBleGlzdGluZyBicmFuY2gnICcKCXNwbDE9JyciJChnaXQgc3VidHJlZSBzcGxpdCAtLWFubm90YXRlPSciJyonIicgLS1wcmVmaXggc3ViZGlyIC0tb250byBGRVRDSF9IRUFEIC0tbWVzc2FnZSAiU3BsaXQgJiByZWpvaW4iIC0tcmVqb2luKSInJyAmJgoJdW5kbyAmJgoJZ2l0IGJyYW5jaCBzcGxpdGJyMiBzdWIxICYmCglnaXQgc3VidHJlZSBzcGxpdCAtLWFubm90YXRlPSciJyonIicgLS1wcmVmaXggc3ViZGlyIC0tb250byBGRVRDSF9IRUFEIC0tYnJhbmNoIHNwbGl0YnIyICYmCgljaGVja19lcXVhbCAnJyIkKGdpdCByZXYtcGFyc2Ugc3BsaXRicjIpIicnICIkc3BsMSIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnY2hlY2sgc3BsaXQgd2l0aCAtLWJyYW5jaCBmb3IgYW4gaW5jb21wYXRpYmxlIGJyYW5jaCcgJwoJdGVzdF9tdXN0X2ZhaWwgZ2l0IHN1YnRyZWUgc3BsaXQgLS1wcmVmaXggc3ViZGlyIC0tb250byBGRVRDSF9IRUFEIC0tYnJhbmNoIHN1YmRpcgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdjaGVjayBzcGxpdCtyZWpvaW4nICcKCXNwbDE9JyciJChnaXQgc3VidHJlZSBzcGxpdCAtLWFubm90YXRlPSciJyonIicgLS1wcmVmaXggc3ViZGlyIC0tb250byBGRVRDSF9IRUFEIC0tbWVzc2FnZSAiU3BsaXQgJiByZWpvaW4iIC0tcmVqb2luKSInJyAmJgoJdW5kbyAmJgoJZ2l0IHN1YnRyZWUgc3BsaXQgLS1hbm5vdGF0ZT0nIicqJyInIC0tcHJlZml4IHN1YmRpciAtLW9udG8gRkVUQ0hfSEVBRCAtLXJlam9pbiAmJgoJY2hlY2tfZXF1YWwgJyciJChsYXN0X2NvbW1pdF9tZXNzYWdlKSInJyAiU3BsaXQgJyInIidzdWJkaXIvJyInIicgaW50byBjb21taXQgJyInIiciJHNwbDEiJyInIiciCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2FkZCBtYWluLXN1YjgnICcKCWNyZWF0ZSBzdWJkaXIvbWFpbi1zdWI4ICYmCglnaXQgY29tbWl0IC1tICJtYWluLXN1YjgiCicKCiMgVG8gdGhlIHN1YnByb2plY3QhCmNkIC4vc3VicHJvagoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbWVyZ2Ugc3BsaXQgaW50byBzdWJwcm9qJyAnCglnaXQgZmV0Y2ggLi4gc3BsMSAmJgoJZ2l0IGJyYW5jaCBzcGwxIEZFVENIX0hFQUQgJiYKCWdpdCBtZXJnZSBGRVRDSF9IRUFECicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2FkZCBzdWI5JyAnCgljcmVhdGUgc3ViOSAmJgoJZ2l0IGNvbW1pdCAtbSAic3ViOSIKJwoKIyBCYWNrIHRvIG1haW5saW5lCmNkIC4uCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdzcGxpdCBmb3Igc3ViOCcgJwoJc3BsaXQyPScnIiQoZ2l0IHN1YnRyZWUgc3BsaXQgLS1hbm5vdGF0ZT0nIicqJyInIC0tcHJlZml4IHN1YmRpci8gLS1yZWpvaW4pIicnICYmCglnaXQgYnJhbmNoIHNwbGl0MiAiJHNwbGl0MiIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYWRkIG1haW4tc3ViMTAnICcKCWNyZWF0ZSBzdWJkaXIvbWFpbi1zdWIxMCAmJgoJZ2l0IGNvbW1pdCAtbSAibWFpbi1zdWIxMCIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnc3BsaXQgZm9yIHN1YjEwJyAnCglzcGwzPScnIiQoZ2l0IHN1YnRyZWUgc3BsaXQgLS1hbm5vdGF0ZT0nIicqJyInIC0tcHJlZml4IHN1YmRpciAtLXJlam9pbikiJycgJiYKCWdpdCBicmFuY2ggc3BsMyAiJHNwbDMiCicKCiMgVG8gdGhlIHN1YnByb2plY3QhCmNkIC4vc3VicHJvagoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbWVyZ2Ugc3BsaXQgaW50byBzdWJwcm9qJyAnCglnaXQgZmV0Y2ggLi4gc3BsMyAmJgoJZ2l0IGJyYW5jaCBzcGwzIEZFVENIX0hFQUQgJiYKCWdpdCBtZXJnZSBGRVRDSF9IRUFEICYmCglnaXQgYnJhbmNoIHN1YnByb2otbWVyZ2Utc3BsMwonCgpjaGttPSJtYWluNCBtYWluNiIKY2hrbXM9Im1haW4tc3ViMTAgbWFpbi1zdWI1IG1haW4tc3ViNyBtYWluLXN1YjgiCmNoa21zX3N1Yj0kKGVjaG8gJGNoa21zIHwgbXVsdGlsaW5lIHwgc2VkICdzLF4sc3ViZGlyLywnIHwgZml4bmwpCmNoa3M9InN1YjEgc3ViMiBzdWIzIHN1YjkiCmNoa3Nfc3ViPSQoZWNobyAkY2hrcyB8IG11bHRpbGluZSB8IHNlZCAncyxeLHN1YmRpci8sJyB8IGZpeG5sKQoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbWFrZSBzdXJlIGV4YWN0bHkgdGhlIHJpZ2h0IHNldCBvZiBmaWxlcyBlbmRzIHVwIGluIHRoZSBzdWJwcm9qJyAnCglzdWJmaWxlcz0nJyIkKGdpdCBscy1maWxlcyB8IGZpeG5sKSInJyAmJgoJY2hlY2tfZXF1YWwgIiRzdWJmaWxlcyIgIiRjaGttcyAkY2hrcyIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbWFrZSBzdXJlIHRoZSBzdWJwcm9qIGhpc3RvcnkgKm9ubHkqIGNvbnRhaW5zIGNvbW1pdHMgdGhhdCBhZmZlY3QgdGhlIHN1YmRpcicgJwoJYWxsY2hhbmdlcz0nJyIkKGdpdCBsb2cgLS1uYW1lLW9ubHkgLS1wcmV0dHk9Zm9ybWF0OiciJyciJyB8IHNvcnQgfCBmaXhubCkiJycgJiYKCWNoZWNrX2VxdWFsICIkYWxsY2hhbmdlcyIgIiRjaGttcyAkY2hrcyIKJwoKIyBCYWNrIHRvIG1haW5saW5lCmNkIC4uCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdwdWxsIGZyb20gc3VicHJvaicgJwoJZ2l0IGZldGNoIC4vc3VicHJvaiBzdWJwcm9qLW1lcmdlLXNwbDMgJiYKCWdpdCBicmFuY2ggc3VicHJvai1tZXJnZS1zcGwzIEZFVENIX0hFQUQgJiYKCWdpdCBzdWJ0cmVlIHB1bGwgLS1wcmVmaXg9c3ViZGlyIC4vc3VicHJvaiBzdWJwcm9qLW1lcmdlLXNwbDMKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbWFrZSBzdXJlIGV4YWN0bHkgdGhlIHJpZ2h0IHNldCBvZiBmaWxlcyBlbmRzIHVwIGluIHRoZSBtYWlubGluZScgJwoJbWFpbmZpbGVzPScnIiQoZ2l0IGxzLWZpbGVzIHwgZml4bmwpIicnICYmCgljaGVja19lcXVhbCAiJG1haW5maWxlcyIgIiRjaGttICRjaGttc19zdWIgJGNoa3Nfc3ViIgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdtYWtlIHN1cmUgZWFjaCBmaWxlbmFtZSBjaGFuZ2VkIGV4YWN0bHkgb25jZSBpbiB0aGUgZW50aXJlIGhpc3RvcnknICcKCSMgbWFpbi1zdWI/PyBhbmQgL3N1YmRpci9tYWluLXN1Yj8/IGJvdGggY2hhbmdlLCBiZWNhdXNlIHRob3NlIGFyZSB0aGUKCSMgY2hhbmdlcyB0aGF0IHdlcmUgc3BsaXQgaW50byB0aGVpciBvd24gaGlzdG9yeS4gIEFuZCBzdWJkaXIvc3ViPz8gbmV2ZXIKCSMgY2hhbmdlLCBzaW5jZSB0aGV5IHdlcmUgKm9ubHkqIGNoYW5nZWQgaW4gdGhlIHN1YnRyZWUgYnJhbmNoLgoJYWxsY2hhbmdlcz0nJyIkKGdpdCBsb2cgLS1uYW1lLW9ubHkgLS1wcmV0dHk9Zm9ybWF0OiciJyciJyB8IHNvcnQgfCBmaXhubCkiJycgJiYKCWNoZWNrX2VxdWFsICIkYWxsY2hhbmdlcyIgJyciJChlY2hvICRjaGttcyAkY2hrbSAkY2hrcyAkY2hrbXNfc3ViIHwgbXVsdGlsaW5lIHwgc29ydCB8IGZpeG5sKSInJwonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdtYWtlIHN1cmUgdGhlIC0tcmVqb2luIGNvbW1pdHMgbmV2ZXIgbWFrZSBpdCBpbnRvIHN1YnByb2onICcKCWNoZWNrX2VxdWFsICcnIiQoZ2l0IGxvZyAtLXByZXR0eT1mb3JtYXQ6JyInJXMnIicgSEVBRF4yIHwgZ3JlcCAtaSBzcGxpdCkiJycgIiIKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnbWFrZSBzdXJlIG5vICJnaXQgc3VidHJlZSIgdGFnZ2VkIGNvbW1pdHMgbWFrZSBpdCBpbnRvIHN1YnByb2onICcKCSMgVGhleSBhcmUgbWVhbmluZ2xlc3MgdG8gc3VicHJvaiBzaW5jZSBvbmUgc2lkZSBvZiB0aGUgbWVyZ2UgcmVmZXJzIHRvIHRoZSBtYWlubGluZQoJY2hlY2tfZXF1YWwgJyciJChnaXQgbG9nIC0tcHJldHR5PWZvcm1hdDonIiclcyVuJWInIicgSEVBRF4yIHwgZ3JlcCAiZ2l0LXN1YnRyZWUuKjoiKSInJyAiIgonCgojIHByZXBhcmUgc2Vjb25kIHBhaXIgb2YgcmVwb3NpdG9yaWVzCm1rZGlyIHRlc3QyCmNkIHRlc3QyCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdpbml0IG1haW4nICcKCXRlc3RfY3JlYXRlX3JlcG8gbWFpbgonCgpjZCBtYWluCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhZGQgbWFpbjEnICcKCWNyZWF0ZSBtYWluMSAmJgoJZ2l0IGNvbW1pdCAtbSAibWFpbjEiCicKCmNkIC4uCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdpbml0IHN1YicgJwoJdGVzdF9jcmVhdGVfcmVwbyBzdWIKJwoKY2Qgc3ViCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhZGQgc3ViMicgJwoJY3JlYXRlIHN1YjIgJiYKCWdpdCBjb21taXQgLW0gInN1YjIiCicKCmNkIC4uL21haW4KCiMgY2hlY2sgaWYgc3BsaXQgY2FuIGZpbmQgcHJvcGVyIGJhc2Ugd2l0aG91dCAtLW9udG8KCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2FkZCBzdWIgYXMgc3ViZGlyIGluIG1haW4nICcKCWdpdCBmZXRjaCAuLi9zdWIgbWFzdGVyICYmCglnaXQgYnJhbmNoIHN1YjIgRkVUQ0hfSEVBRCAmJgoJZ2l0IHN1YnRyZWUgYWRkIC0tcHJlZml4IHN1YmRpciBzdWIyCicKCmNkIC4uL3N1YgoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYWRkIHN1YjMnICcKCWNyZWF0ZSBzdWIzICYmCglnaXQgY29tbWl0IC1tICJzdWIzIgonCgpjZCAuLi9tYWluCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdtZXJnZSBmcm9tIHN1YicgJwoJZ2l0IGZldGNoIC4uL3N1YiBtYXN0ZXIgJiYKCWdpdCBicmFuY2ggc3ViMyBGRVRDSF9IRUFEICYmCglnaXQgc3VidHJlZSBtZXJnZSAtLXByZWZpeCBzdWJkaXIgc3ViMwonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhZGQgbWFpbi1zdWI0JyAnCgljcmVhdGUgc3ViZGlyL21haW4tc3ViNCAmJgoJZ2l0IGNvbW1pdCAtbSAibWFpbi1zdWI0IgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdzcGxpdCBmb3IgbWFpbi1zdWI0IHdpdGhvdXQgLS1vbnRvJyAnCglnaXQgc3VidHJlZSBzcGxpdCAtLXByZWZpeCBzdWJkaXIgLS1icmFuY2ggbWFpbnN1YjQKJwoKIyBhdCB0aGlzIHBvaW50LCB0aGUgbmV3IGNvbW1pdCBwYXJlbnQgc2hvdWxkIGJlIHN1YjMgaWYgaXQgaXMgbm90LAojIHNvbWV0aGluZyB3ZW50IHdyb25nICh0aGUgIm5ld3BhcmVudCIgb2YgIm1hc3Rlcn4iIGNvbW1pdCBzaG91bGQKIyBoYXZlIGJlZW4gc3ViMywgYnV0IGl0IHdhcyBub3QsIGJlY2F1c2UgaXRzIGNhY2hlIHdhcyBub3Qgc2V0IHRvCiMgaXRzZWxmKQoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnY2hlY2sgdGhhdCB0aGUgY29tbWl0IHBhcmVudCBpcyBzdWIzJyAnCgljaGVja19lcXVhbCAnJyIkKGdpdCBsb2cgLS1wcmV0dHk9Zm9ybWF0OiVQIC0xIG1haW5zdWI0KSInJyAnJyIkKGdpdCByZXYtcGFyc2Ugc3ViMykiJycKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAnYWRkIG1haW4tc3ViNScgJwoJbWtkaXIgc3ViZGlyMiAmJgoJY3JlYXRlIHN1YmRpcjIvbWFpbi1zdWI1ICYmCglnaXQgY29tbWl0IC1tICJtYWluLXN1YjUiCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3NwbGl0IGZvciBtYWluLXN1YjUgd2l0aG91dCAtLW9udG8nICcKCSMgYWxzbyB0ZXN0IHRoYXQgd2Ugc3RpbGwgY2FuIHNwbGl0IG91dCBhbiBlbnRpcmVseSBuZXcgc3VidHJlZQoJIyBpZiB0aGUgcGFyZW50IG9mIHRoZSBmaXJzdCBjb21taXQgaW4gdGhlIHRyZWUgaXMgbm90IGVtcHR5LAoJIyB0aGVuIHRoZSBuZXcgc3VidHJlZSBoYXMgYWNjaWRlbnRhbGx5IGJlZW4gYXR0YWNoZWQgdG8gc29tZXRoaW5nCglnaXQgc3VidHJlZSBzcGxpdCAtLXByZWZpeCBzdWJkaXIyIC0tYnJhbmNoIG1haW5zdWI1ICYmCgljaGVja19lcXVhbCAnJyIkKGdpdCBsb2cgLS1wcmV0dHk9Zm9ybWF0OiVQIC0xIG1haW5zdWI1KSInJyAiIgonCgojIG1ha2Ugc3VyZSBubyBwYXRjaCBjaGFuZ2VzIG1vcmUgdGhhbiBvbmUgZmlsZS4gIFRoZSBvcmlnaW5hbCBzZXQgb2YgY29tbWl0cwojIGNoYW5nZWQgb25seSBvbmUgZmlsZSBlYWNoLiAgQSBtdWx0aS1maWxlIGNoYW5nZSB3b3VsZCBpbXBseSB0aGF0IHdlIHBydW5lZAojIGNvbW1pdHMgdG9vIGFnZ3Jlc3NpdmVseS4Kam9pbmNvbW1pdHMoKQp7Cgljb21taXQ9CglhbGw9Cgl3aGlsZSByZWFkIHggeTsgZG8KCQkjZWNobyAieyR4fSIgPiYyCgkJaWYgWyAteiAiJHgiIF07IHRoZW4KCQkJY29udGludWUKCQllbGlmIFsgIiR4IiA9ICJjb21taXQ6IiBdOyB0aGVuCgkJCWlmIFsgLW4gIiRjb21taXQiIF07IHRoZW4KCQkJCWVjaG8gIiRjb21taXQgJGFsbCIKCQkJCWFsbD0KCQkJZmkKCQkJY29tbWl0PSIkeSIKCQllbHNlCgkJCWFsbD0iJGFsbCAkeSIKCQlmaQoJZG9uZQoJZWNobyAiJGNvbW1pdCAkYWxsIgp9Cgp0ZXN0X2V4cGVjdF9zdWNjZXNzICd2ZXJpZnkgb25lIGZpbGUgY2hhbmdlIHBlciBjb21taXQnICcKCXg9ICYmCglsaXN0PScnIiQoZ2l0IGxvZyAtLXByZXR0eT1mb3JtYXQ6JyInY29tbWl0OiAlSCciJyB8IGpvaW5jb21taXRzKSInJyAmJgojCXRlc3RfZGVidWcgImVjaG8gSEVSRSIgJiYKIwl0ZXN0X2RlYnVnICJlY2hvICcnIiRsaXN0IicnIiAmJgoJKGdpdCBsb2cgLS1wcmV0dHk9Zm9ybWF0OiciJ2NvbW1pdDogJUgnIicgfCBqb2luY29tbWl0cyB8CgkoCXdoaWxlIHJlYWQgY29tbWl0IGEgYjsgZG8KCQkJdGVzdF9kZWJ1ZyAiZWNobyBWZXJpZnlpbmcgY29tbWl0ICInJyIkY29tbWl0IicnCgkJCXRlc3RfZGVidWcgImVjaG8gYTogIicnIiRhIicnCgkJCXRlc3RfZGVidWcgImVjaG8gYjogIicnIiRiIicnCgkJCWNoZWNrX2VxdWFsICIkYiIgIiIKCQkJeD0xCgkJZG9uZQoJCWNoZWNrX2VxdWFsICIkeCIgMQoJKSkKJwoKdGVzdF9kb25lCg==",
    "text": "#!/bin/sh\n#\n# Copyright (c) 2012 Avery Pennaraum\n#\ntest_description='Basic porcelain support for subtrees\n\nThis test verifies the basic operation of the merge, pull, add\nand split subcommands of git subtree.\n'\n\nTEST_DIRECTORY=$(pwd)/../../../t\nexport TEST_DIRECTORY\n\n. ../../../t/test-lib.sh\n\ncreate()\n{\n\techo \"$1\" >\"$1\"\n\tgit add \"$1\"\n}\n\n\ncheck_equal()\n{\n\ttest_debug 'echo'\n\ttest_debug \"echo \\\"check a:\\\" \\\"{$1}\\\"\"\n\ttest_debug \"echo \\\"      b:\\\" \\\"{$2}\\\"\"\n\tif [ \"$1\" = \"$2\" ]; then\n\t\treturn 0\n\telse\n\t\treturn 1\n\tfi\n}\n\nfixnl()\n{\n\tt=\"\"\n\twhile read x; do\n\t\tt=\"$t$x \"\n\tdone\n\techo $t\n}\n\nmultiline()\n{\n\twhile read x; do\n\t\tset -- $x\n\t\tfor d in \"$@\"; do\n\t\t\techo \"$d\"\n\t\tdone\n\tdone\n}\n\nundo()\n{\n\tgit reset --hard HEAD~\n}\n\nlast_commit_message()\n{\n\tgit log --pretty=format:%s -1\n}\n\ntest_expect_success 'init subproj' '\n\ttest_create_repo subproj\n'\n\n# To the subproject!\ncd subproj\n\ntest_expect_success 'add sub1' '\n\tcreate sub1 &&\n\tgit commit -m \"sub1\" &&\n\tgit branch sub1 &&\n\tgit branch -m master subproj\n'\n\n# Save this hash for testing later.\n\nsubdir_hash=$(git rev-parse HEAD)\n\ntest_expect_success 'add sub2' '\n\tcreate sub2 &&\n\tgit commit -m \"sub2\" &&\n\tgit branch sub2\n'\n\ntest_expect_success 'add sub3' '\n\tcreate sub3 &&\n\tgit commit -m \"sub3\" &&\n\tgit branch sub3\n'\n\n# Back to mainline\ncd ..\n\ntest_expect_success 'add main4' '\n\tcreate main4 &&\n\tgit commit -m \"main4\" &&\n\tgit branch -m master mainline &&\n\tgit branch subdir\n'\n\ntest_expect_success 'fetch subproj history' '\n\tgit fetch ./subproj sub1 &&\n\tgit branch sub1 FETCH_HEAD\n'\n\ntest_expect_success 'no subtree exists in main tree' '\n\ttest_must_fail git subtree merge --prefix=subdir sub1\n'\n\ntest_expect_success 'no pull from non-existant subtree' '\n\ttest_must_fail git subtree pull --prefix=subdir ./subproj sub1\n'\n\ntest_expect_success 'check if --message works for add' '\n\tgit subtree add --prefix=subdir --message=\"Added subproject\" sub1 &&\n\tcheck_equal ''\"$(last_commit_message)\"'' \"Added subproject\" &&\n\tundo\n'\n\ntest_expect_success 'check if --message works as -m and --prefix as -P' '\n\tgit subtree add -P subdir -m \"Added subproject using git subtree\" sub1 &&\n\tcheck_equal ''\"$(last_commit_message)\"'' \"Added subproject using git subtree\" &&\n\tundo\n'\n\ntest_expect_success 'check if --message works with squash too' '\n\tgit subtree add -P subdir -m \"Added subproject with squash\" --squash sub1 &&\n\tcheck_equal ''\"$(last_commit_message)\"'' \"Added subproject with squash\" &&\n\tundo\n'\n\ntest_expect_success 'add subproj to mainline' '\n\tgit subtree add --prefix=subdir/ FETCH_HEAD &&\n\tcheck_equal ''\"$(last_commit_message)\"'' \"Add '\"'subdir/'\"' from commit '\"'\"'''\"$(git rev-parse sub1)\"'''\"'\"'\"\n'\n\n# this shouldn't actually do anything, since FETCH_HEAD is already a parent\ntest_expect_success 'merge fetched subproj' '\n\tgit merge -m \"merge -s -ours\" -s ours FETCH_HEAD\n'\n\ntest_expect_success 'add main-sub5' '\n\tcreate subdir/main-sub5 &&\n\tgit commit -m \"main-sub5\"\n'\n\ntest_expect_success 'add main6' '\n\tcreate main6 &&\n\tgit commit -m \"main6 boring\"\n'\n\ntest_expect_success 'add main-sub7' '\n\tcreate subdir/main-sub7 &&\n\tgit commit -m \"main-sub7\"\n'\n\ntest_expect_success 'fetch new subproj history' '\n\tgit fetch ./subproj sub2 &&\n\tgit branch sub2 FETCH_HEAD\n'\n\ntest_expect_success 'check if --message works for merge' '\n\tgit subtree merge --prefix=subdir -m \"Merged changes from subproject\" sub2 &&\n\tcheck_equal ''\"$(last_commit_message)\"'' \"Merged changes from subproject\" &&\n\tundo\n'\n\ntest_expect_success 'check if --message for merge works with squash too' '\n\tgit subtree merge --prefix subdir -m \"Merged changes from subproject using squash\" --squash sub2 &&\n\tcheck_equal ''\"$(last_commit_message)\"'' \"Merged changes from subproject using squash\" &&\n\tundo\n'\n\ntest_expect_success 'merge new subproj history into subdir' '\n\tgit subtree merge --prefix=subdir FETCH_HEAD &&\n\tgit branch pre-split &&\n\tcheck_equal ''\"$(last_commit_message)\"'' \"Merge commit '\"'\"'\"$(git rev-parse sub2)\"'\"'\"' into mainline\" &&\n\tundo\n'\n\ntest_expect_success 'Check that prefix argument is required for split' '\n\techo \"You must provide the --prefix option.\" > expected &&\n\ttest_must_fail git subtree split > actual 2>&1 &&\n\ttest_debug \"printf '\"'\"'expected: '\"'\"'\" &&\n\ttest_debug \"cat expected\" &&\n\ttest_debug \"printf '\"'\"'actual: '\"'\"'\" &&\n\ttest_debug \"cat actual\" &&\n\ttest_cmp expected actual &&\n\trm -f expected actual\n'\n\ntest_expect_success 'Check that the <prefix> exists for a split' '\n\techo \"'\"'\"'non-existent-directory'\"'\"'\" does not exist\\; use \"'\"'\"'git subtree add'\"'\"'\" > expected &&\n\ttest_must_fail git subtree split --prefix=non-existent-directory > actual 2>&1 &&\n\ttest_debug \"printf '\"'\"'expected: '\"'\"'\" &&\n\ttest_debug \"cat expected\" &&\n\ttest_debug \"printf '\"'\"'actual: '\"'\"'\" &&\n\ttest_debug \"cat actual\" &&\n\ttest_cmp expected actual\n#\trm -f expected actual\n'\n\ntest_expect_success 'check if --message works for split+rejoin' '\n\tspl1=''\"$(git subtree split --annotate='\"'*'\"' --prefix subdir --onto FETCH_HEAD --message \"Split & rejoin\" --rejoin)\"'' &&\n\tgit branch spl1 \"$spl1\" &&\n\tcheck_equal ''\"$(last_commit_message)\"'' \"Split & rejoin\" &&\n\tundo\n'\n\ntest_expect_success 'check split with --branch' '\n\tspl1=$(git subtree split --annotate='\"'*'\"' --prefix subdir --onto FETCH_HEAD --message \"Split & rejoin\" --rejoin) &&\n\tundo &&\n\tgit subtree split --annotate='\"'*'\"' --prefix subdir --onto FETCH_HEAD --branch splitbr1 &&\n\tcheck_equal ''\"$(git rev-parse splitbr1)\"'' \"$spl1\"\n'\n\ntest_expect_success 'check hash of split' '\n\tspl1=$(git subtree split --prefix subdir) &&\n\tgit subtree split --prefix subdir --branch splitbr1test &&\n\tcheck_equal ''\"$(git rev-parse splitbr1test)\"'' \"$spl1\" &&\n\tgit checkout splitbr1test &&\n\tnew_hash=$(git rev-parse HEAD~2) &&\n\tgit checkout mainline &&\n\tcheck_equal ''\"$new_hash\"'' \"$subdir_hash\"\n'\n\ntest_expect_success 'check split with --branch for an existing branch' '\n\tspl1=''\"$(git subtree split --annotate='\"'*'\"' --prefix subdir --onto FETCH_HEAD --message \"Split & rejoin\" --rejoin)\"'' &&\n\tundo &&\n\tgit branch splitbr2 sub1 &&\n\tgit subtree split --annotate='\"'*'\"' --prefix subdir --onto FETCH_HEAD --branch splitbr2 &&\n\tcheck_equal ''\"$(git rev-parse splitbr2)\"'' \"$spl1\"\n'\n\ntest_expect_success 'check split with --branch for an incompatible branch' '\n\ttest_must_fail git subtree split --prefix subdir --onto FETCH_HEAD --branch subdir\n'\n\ntest_expect_success 'check split+rejoin' '\n\tspl1=''\"$(git subtree split --annotate='\"'*'\"' --prefix subdir --onto FETCH_HEAD --message \"Split & rejoin\" --rejoin)\"'' &&\n\tundo &&\n\tgit subtree split --annotate='\"'*'\"' --prefix subdir --onto FETCH_HEAD --rejoin &&\n\tcheck_equal ''\"$(last_commit_message)\"'' \"Split '\"'\"'subdir/'\"'\"' into commit '\"'\"'\"$spl1\"'\"'\"'\"\n'\n\ntest_expect_success 'add main-sub8' '\n\tcreate subdir/main-sub8 &&\n\tgit commit -m \"main-sub8\"\n'\n\n# To the subproject!\ncd ./subproj\n\ntest_expect_success 'merge split into subproj' '\n\tgit fetch .. spl1 &&\n\tgit branch spl1 FETCH_HEAD &&\n\tgit merge FETCH_HEAD\n'\n\ntest_expect_success 'add sub9' '\n\tcreate sub9 &&\n\tgit commit -m \"sub9\"\n'\n\n# Back to mainline\ncd ..\n\ntest_expect_success 'split for sub8' '\n\tsplit2=''\"$(git subtree split --annotate='\"'*'\"' --prefix subdir/ --rejoin)\"'' &&\n\tgit branch split2 \"$split2\"\n'\n\ntest_expect_success 'add main-sub10' '\n\tcreate subdir/main-sub10 &&\n\tgit commit -m \"main-sub10\"\n'\n\ntest_expect_success 'split for sub10' '\n\tspl3=''\"$(git subtree split --annotate='\"'*'\"' --prefix subdir --rejoin)\"'' &&\n\tgit branch spl3 \"$spl3\"\n'\n\n# To the subproject!\ncd ./subproj\n\ntest_expect_success 'merge split into subproj' '\n\tgit fetch .. spl3 &&\n\tgit branch spl3 FETCH_HEAD &&\n\tgit merge FETCH_HEAD &&\n\tgit branch subproj-merge-spl3\n'\n\nchkm=\"main4 main6\"\nchkms=\"main-sub10 main-sub5 main-sub7 main-sub8\"\nchkms_sub=$(echo $chkms | multiline | sed 's,^,subdir/,' | fixnl)\nchks=\"sub1 sub2 sub3 sub9\"\nchks_sub=$(echo $chks | multiline | sed 's,^,subdir/,' | fixnl)\n\ntest_expect_success 'make sure exactly the right set of files ends up in the subproj' '\n\tsubfiles=''\"$(git ls-files | fixnl)\"'' &&\n\tcheck_equal \"$subfiles\" \"$chkms $chks\"\n'\n\ntest_expect_success 'make sure the subproj history *only* contains commits that affect the subdir' '\n\tallchanges=''\"$(git log --name-only --pretty=format:'\"''\"' | sort | fixnl)\"'' &&\n\tcheck_equal \"$allchanges\" \"$chkms $chks\"\n'\n\n# Back to mainline\ncd ..\n\ntest_expect_success 'pull from subproj' '\n\tgit fetch ./subproj subproj-merge-spl3 &&\n\tgit branch subproj-merge-spl3 FETCH_HEAD &&\n\tgit subtree pull --prefix=subdir ./subproj subproj-merge-spl3\n'\n\ntest_expect_success 'make sure exactly the right set of files ends up in the mainline' '\n\tmainfiles=''\"$(git ls-files | fixnl)\"'' &&\n\tcheck_equal \"$mainfiles\" \"$chkm $chkms_sub $chks_sub\"\n'\n\ntest_expect_success 'make sure each filename changed exactly once in the entire history' '\n\t# main-sub?? and /subdir/main-sub?? both change, because those are the\n\t# changes that were split into their own history.  And subdir/sub?? never\n\t# change, since they were *only* changed in the subtree branch.\n\tallchanges=''\"$(git log --name-only --pretty=format:'\"''\"' | sort | fixnl)\"'' &&\n\tcheck_equal \"$allchanges\" ''\"$(echo $chkms $chkm $chks $chkms_sub | multiline | sort | fixnl)\"''\n'\n\ntest_expect_success 'make sure the --rejoin commits never make it into subproj' '\n\tcheck_equal ''\"$(git log --pretty=format:'\"'%s'\"' HEAD^2 | grep -i split)\"'' \"\"\n'\n\ntest_expect_success 'make sure no \"git subtree\" tagged commits make it into subproj' '\n\t# They are meaningless to subproj since one side of the merge refers to the mainline\n\tcheck_equal ''\"$(git log --pretty=format:'\"'%s%n%b'\"' HEAD^2 | grep \"git-subtree.*:\")\"'' \"\"\n'\n\n# prepare second pair of repositories\nmkdir test2\ncd test2\n\ntest_expect_success 'init main' '\n\ttest_create_repo main\n'\n\ncd main\n\ntest_expect_success 'add main1' '\n\tcreate main1 &&\n\tgit commit -m \"main1\"\n'\n\ncd ..\n\ntest_expect_success 'init sub' '\n\ttest_create_repo sub\n'\n\ncd sub\n\ntest_expect_success 'add sub2' '\n\tcreate sub2 &&\n\tgit commit -m \"sub2\"\n'\n\ncd ../main\n\n# check if split can find proper base without --onto\n\ntest_expect_success 'add sub as subdir in main' '\n\tgit fetch ../sub master &&\n\tgit branch sub2 FETCH_HEAD &&\n\tgit subtree add --prefix subdir sub2\n'\n\ncd ../sub\n\ntest_expect_success 'add sub3' '\n\tcreate sub3 &&\n\tgit commit -m \"sub3\"\n'\n\ncd ../main\n\ntest_expect_success 'merge from sub' '\n\tgit fetch ../sub master &&\n\tgit branch sub3 FETCH_HEAD &&\n\tgit subtree merge --prefix subdir sub3\n'\n\ntest_expect_success 'add main-sub4' '\n\tcreate subdir/main-sub4 &&\n\tgit commit -m \"main-sub4\"\n'\n\ntest_expect_success 'split for main-sub4 without --onto' '\n\tgit subtree split --prefix subdir --branch mainsub4\n'\n\n# at this point, the new commit parent should be sub3 if it is not,\n# something went wrong (the \"newparent\" of \"master~\" commit should\n# have been sub3, but it was not, because its cache was not set to\n# itself)\n\ntest_expect_success 'check that the commit parent is sub3' '\n\tcheck_equal ''\"$(git log --pretty=format:%P -1 mainsub4)\"'' ''\"$(git rev-parse sub3)\"''\n'\n\ntest_expect_success 'add main-sub5' '\n\tmkdir subdir2 &&\n\tcreate subdir2/main-sub5 &&\n\tgit commit -m \"main-sub5\"\n'\n\ntest_expect_success 'split for main-sub5 without --onto' '\n\t# also test that we still can split out an entirely new subtree\n\t# if the parent of the first commit in the tree is not empty,\n\t# then the new subtree has accidentally been attached to something\n\tgit subtree split --prefix subdir2 --branch mainsub5 &&\n\tcheck_equal ''\"$(git log --pretty=format:%P -1 mainsub5)\"'' \"\"\n'\n\n# make sure no patch changes more than one file.  The original set of commits\n# changed only one file each.  A multi-file change would imply that we pruned\n# commits too aggressively.\njoincommits()\n{\n\tcommit=\n\tall=\n\twhile read x y; do\n\t\t#echo \"{$x}\" >&2\n\t\tif [ -z \"$x\" ]; then\n\t\t\tcontinue\n\t\telif [ \"$x\" = \"commit:\" ]; then\n\t\t\tif [ -n \"$commit\" ]; then\n\t\t\t\techo \"$commit $all\"\n\t\t\t\tall=\n\t\t\tfi\n\t\t\tcommit=\"$y\"\n\t\telse\n\t\t\tall=\"$all $y\"\n\t\tfi\n\tdone\n\techo \"$commit $all\"\n}\n\ntest_expect_success 'verify one file change per commit' '\n\tx= &&\n\tlist=''\"$(git log --pretty=format:'\"'commit: %H'\"' | joincommits)\"'' &&\n#\ttest_debug \"echo HERE\" &&\n#\ttest_debug \"echo ''\"$list\"''\" &&\n\t(git log --pretty=format:'\"'commit: %H'\"' | joincommits |\n\t(\twhile read commit a b; do\n\t\t\ttest_debug \"echo Verifying commit \"''\"$commit\"''\n\t\t\ttest_debug \"echo a: \"''\"$a\"''\n\t\t\ttest_debug \"echo b: \"''\"$b\"''\n\t\t\tcheck_equal \"$b\" \"\"\n\t\t\tx=1\n\t\tdone\n\t\tcheck_equal \"$x\" 1\n\t))\n'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "001c604dd1093ea678ef4e183a6184f3c3dad2b1",
  "sha1_ok": true,
  "size": 12409
}
