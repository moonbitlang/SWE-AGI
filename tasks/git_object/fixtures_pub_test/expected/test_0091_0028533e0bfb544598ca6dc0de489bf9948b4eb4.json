{
  "content": {
    "base64": "IyEvYmluL3NoCgp0ZXN0X2Rlc2NyaXB0aW9uPSdhdXRvIHNxdWFzaCcKCi4gLi90ZXN0LWxpYi5zaAoKdGVzdF9leHBlY3Rfc3VjY2VzcyBzZXR1cCAnCgllY2hvIDAgPmZpbGUwICYmCglnaXQgYWRkIC4gJiYKCXRlc3RfdGljayAmJgoJZ2l0IGNvbW1pdCAtbSAiaW5pdGlhbCBjb21taXQiICYmCgllY2hvIDAgPmZpbGUxICYmCgllY2hvIDIgPmZpbGUyICYmCglnaXQgYWRkIC4gJiYKCXRlc3RfdGljayAmJgoJZ2l0IGNvbW1pdCAtbSAiZmlyc3QgY29tbWl0IiAmJgoJZ2l0IHRhZyBmaXJzdC1jb21taXQgJiYKCWVjaG8gMyA+ZmlsZTMgJiYKCWdpdCBhZGQgLiAmJgoJdGVzdF90aWNrICYmCglnaXQgY29tbWl0IC1tICJzZWNvbmQgY29tbWl0IiAmJgoJZ2l0IHRhZyBiYXNlCicKCnRlc3RfYXV0b19maXh1cCAoKSB7CglnaXQgcmVzZXQgLS1oYXJkIGJhc2UgJiYKCWVjaG8gMSA+ZmlsZTEgJiYKCWdpdCBhZGQgLXUgJiYKCXRlc3RfdGljayAmJgoJZ2l0IGNvbW1pdCAtbSAiZml4dXAhIGZpcnN0IiAmJgoKCWdpdCB0YWcgJDEgJiYKCXRlc3RfdGljayAmJgoJZ2l0IHJlYmFzZSAkMiAtaSBIRUFEXl5eICYmCglnaXQgbG9nIC0tb25lbGluZSA+YWN0dWFsICYmCgl0ZXN0IDMgPSAkKHdjIC1sIDxhY3R1YWwpICYmCglnaXQgZGlmZiAtLWV4aXQtY29kZSAkMSAmJgoJdGVzdCAxID0gIiQoZ2l0IGNhdC1maWxlIGJsb2IgSEVBRF46ZmlsZTEpIiAmJgoJdGVzdCAxID0gJChnaXQgY2F0LWZpbGUgY29tbWl0IEhFQUReIHwgZ3JlcCBmaXJzdCB8IHdjIC1sKQp9Cgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhdXRvIGZpeHVwIChvcHRpb24pJyAnCgl0ZXN0X2F1dG9fZml4dXAgZmluYWwtZml4dXAtb3B0aW9uIC0tYXV0b3NxdWFzaAonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhdXRvIGZpeHVwIChjb25maWcpJyAnCglnaXQgY29uZmlnIHJlYmFzZS5hdXRvc3F1YXNoIHRydWUgJiYKCXRlc3RfYXV0b19maXh1cCBmaW5hbC1maXh1cC1jb25maWctdHJ1ZSAmJgoJdGVzdF9tdXN0X2ZhaWwgdGVzdF9hdXRvX2ZpeHVwIGZpeHVwLWNvbmZpZy10cnVlLW5vIC0tbm8tYXV0b3NxdWFzaCAmJgoJZ2l0IGNvbmZpZyByZWJhc2UuYXV0b3NxdWFzaCBmYWxzZSAmJgoJdGVzdF9tdXN0X2ZhaWwgdGVzdF9hdXRvX2ZpeHVwIGZpbmFsLWZpeHVwLWNvbmZpZy1mYWxzZQonCgp0ZXN0X2F1dG9fc3F1YXNoICgpIHsKCWdpdCByZXNldCAtLWhhcmQgYmFzZSAmJgoJZWNobyAxID5maWxlMSAmJgoJZ2l0IGFkZCAtdSAmJgoJdGVzdF90aWNrICYmCglnaXQgY29tbWl0IC1tICJzcXVhc2ghIGZpcnN0IiAmJgoKCWdpdCB0YWcgJDEgJiYKCXRlc3RfdGljayAmJgoJZ2l0IHJlYmFzZSAkMiAtaSBIRUFEXl5eICYmCglnaXQgbG9nIC0tb25lbGluZSA+YWN0dWFsICYmCgl0ZXN0IDMgPSAkKHdjIC1sIDxhY3R1YWwpICYmCglnaXQgZGlmZiAtLWV4aXQtY29kZSAkMSAmJgoJdGVzdCAxID0gIiQoZ2l0IGNhdC1maWxlIGJsb2IgSEVBRF46ZmlsZTEpIiAmJgoJdGVzdCAyID0gJChnaXQgY2F0LWZpbGUgY29tbWl0IEhFQUReIHwgZ3JlcCBmaXJzdCB8IHdjIC1sKQp9Cgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhdXRvIHNxdWFzaCAob3B0aW9uKScgJwoJdGVzdF9hdXRvX3NxdWFzaCBmaW5hbC1zcXVhc2ggLS1hdXRvc3F1YXNoCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2F1dG8gc3F1YXNoIChjb25maWcpJyAnCglnaXQgY29uZmlnIHJlYmFzZS5hdXRvc3F1YXNoIHRydWUgJiYKCXRlc3RfYXV0b19zcXVhc2ggZmluYWwtc3F1YXNoLWNvbmZpZy10cnVlICYmCgl0ZXN0X211c3RfZmFpbCB0ZXN0X2F1dG9fc3F1YXNoIHNxdWFzaC1jb25maWctdHJ1ZS1ubyAtLW5vLWF1dG9zcXVhc2ggJiYKCWdpdCBjb25maWcgcmViYXNlLmF1dG9zcXVhc2ggZmFsc2UgJiYKCXRlc3RfbXVzdF9mYWlsIHRlc3RfYXV0b19zcXVhc2ggZmluYWwtc3F1YXNoLWNvbmZpZy1mYWxzZQonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdtaXNzcGVsbGVkIGF1dG8gc3F1YXNoJyAnCglnaXQgcmVzZXQgLS1oYXJkIGJhc2UgJiYKCWVjaG8gMSA+ZmlsZTEgJiYKCWdpdCBhZGQgLXUgJiYKCXRlc3RfdGljayAmJgoJZ2l0IGNvbW1pdCAtbSAic3F1YXNoISBmb3JzdCIgJiYKCWdpdCB0YWcgZmluYWwtbWlzc3F1YXNoICYmCgl0ZXN0X3RpY2sgJiYKCWdpdCByZWJhc2UgLS1hdXRvc3F1YXNoIC1pIEhFQUReXl4gJiYKCWdpdCBsb2cgLS1vbmVsaW5lID5hY3R1YWwgJiYKCXRlc3QgNCA9ICQod2MgLWwgPGFjdHVhbCkgJiYKCWdpdCBkaWZmIC0tZXhpdC1jb2RlIGZpbmFsLW1pc3NxdWFzaCAmJgoJdGVzdCAwID0gJChnaXQgcmV2LWxpc3QgZmluYWwtbWlzc3F1YXNoLi4uSEVBRCB8IHdjIC1sKQonCgp0ZXN0X2F1dG9fY29tbWl0X2ZsYWdzICgpIHsKCWdpdCByZXNldCAtLWhhcmQgYmFzZSAmJgoJZWNobyAxID5maWxlMSAmJgoJZ2l0IGFkZCAtdSAmJgoJdGVzdF90aWNrICYmCglnaXQgY29tbWl0IC0tJDEgZmlyc3QtY29tbWl0ICYmCglnaXQgdGFnIGZpbmFsLWNvbW1pdC0kMSAmJgoJdGVzdF90aWNrICYmCglnaXQgcmViYXNlIC0tYXV0b3NxdWFzaCAtaSBIRUFEXl5eICYmCglnaXQgbG9nIC0tb25lbGluZSA+YWN0dWFsICYmCgl0ZXN0IDMgPSAkKHdjIC1sIDxhY3R1YWwpICYmCglnaXQgZGlmZiAtLWV4aXQtY29kZSBmaW5hbC1jb21taXQtJDEgJiYKCXRlc3QgMSA9ICIkKGdpdCBjYXQtZmlsZSBibG9iIEhFQUReOmZpbGUxKSIgJiYKCXRlc3QgJDIgPSAkKGdpdCBjYXQtZmlsZSBjb21taXQgSEVBRF4gfCBncmVwIGZpcnN0IHwgd2MgLWwpCn0KCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3VzZSBjb21taXQgLS1maXh1cCcgJwoJdGVzdF9hdXRvX2NvbW1pdF9mbGFncyBmaXh1cCAxCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3VzZSBjb21taXQgLS1zcXVhc2gnICcKCXRlc3RfYXV0b19jb21taXRfZmxhZ3Mgc3F1YXNoIDIKJwoKdGVzdF9kb25lCg==",
    "text": "#!/bin/sh\n\ntest_description='auto squash'\n\n. ./test-lib.sh\n\ntest_expect_success setup '\n\techo 0 >file0 &&\n\tgit add . &&\n\ttest_tick &&\n\tgit commit -m \"initial commit\" &&\n\techo 0 >file1 &&\n\techo 2 >file2 &&\n\tgit add . &&\n\ttest_tick &&\n\tgit commit -m \"first commit\" &&\n\tgit tag first-commit &&\n\techo 3 >file3 &&\n\tgit add . &&\n\ttest_tick &&\n\tgit commit -m \"second commit\" &&\n\tgit tag base\n'\n\ntest_auto_fixup () {\n\tgit reset --hard base &&\n\techo 1 >file1 &&\n\tgit add -u &&\n\ttest_tick &&\n\tgit commit -m \"fixup! first\" &&\n\n\tgit tag $1 &&\n\ttest_tick &&\n\tgit rebase $2 -i HEAD^^^ &&\n\tgit log --oneline >actual &&\n\ttest 3 = $(wc -l <actual) &&\n\tgit diff --exit-code $1 &&\n\ttest 1 = \"$(git cat-file blob HEAD^:file1)\" &&\n\ttest 1 = $(git cat-file commit HEAD^ | grep first | wc -l)\n}\n\ntest_expect_success 'auto fixup (option)' '\n\ttest_auto_fixup final-fixup-option --autosquash\n'\n\ntest_expect_success 'auto fixup (config)' '\n\tgit config rebase.autosquash true &&\n\ttest_auto_fixup final-fixup-config-true &&\n\ttest_must_fail test_auto_fixup fixup-config-true-no --no-autosquash &&\n\tgit config rebase.autosquash false &&\n\ttest_must_fail test_auto_fixup final-fixup-config-false\n'\n\ntest_auto_squash () {\n\tgit reset --hard base &&\n\techo 1 >file1 &&\n\tgit add -u &&\n\ttest_tick &&\n\tgit commit -m \"squash! first\" &&\n\n\tgit tag $1 &&\n\ttest_tick &&\n\tgit rebase $2 -i HEAD^^^ &&\n\tgit log --oneline >actual &&\n\ttest 3 = $(wc -l <actual) &&\n\tgit diff --exit-code $1 &&\n\ttest 1 = \"$(git cat-file blob HEAD^:file1)\" &&\n\ttest 2 = $(git cat-file commit HEAD^ | grep first | wc -l)\n}\n\ntest_expect_success 'auto squash (option)' '\n\ttest_auto_squash final-squash --autosquash\n'\n\ntest_expect_success 'auto squash (config)' '\n\tgit config rebase.autosquash true &&\n\ttest_auto_squash final-squash-config-true &&\n\ttest_must_fail test_auto_squash squash-config-true-no --no-autosquash &&\n\tgit config rebase.autosquash false &&\n\ttest_must_fail test_auto_squash final-squash-config-false\n'\n\ntest_expect_success 'misspelled auto squash' '\n\tgit reset --hard base &&\n\techo 1 >file1 &&\n\tgit add -u &&\n\ttest_tick &&\n\tgit commit -m \"squash! forst\" &&\n\tgit tag final-missquash &&\n\ttest_tick &&\n\tgit rebase --autosquash -i HEAD^^^ &&\n\tgit log --oneline >actual &&\n\ttest 4 = $(wc -l <actual) &&\n\tgit diff --exit-code final-missquash &&\n\ttest 0 = $(git rev-list final-missquash...HEAD | wc -l)\n'\n\ntest_auto_commit_flags () {\n\tgit reset --hard base &&\n\techo 1 >file1 &&\n\tgit add -u &&\n\ttest_tick &&\n\tgit commit --$1 first-commit &&\n\tgit tag final-commit-$1 &&\n\ttest_tick &&\n\tgit rebase --autosquash -i HEAD^^^ &&\n\tgit log --oneline >actual &&\n\ttest 3 = $(wc -l <actual) &&\n\tgit diff --exit-code final-commit-$1 &&\n\ttest 1 = \"$(git cat-file blob HEAD^:file1)\" &&\n\ttest $2 = $(git cat-file commit HEAD^ | grep first | wc -l)\n}\n\ntest_expect_success 'use commit --fixup' '\n\ttest_auto_commit_flags fixup 1\n'\n\ntest_expect_success 'use commit --squash' '\n\ttest_auto_commit_flags squash 2\n'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "0028533e0bfb544598ca6dc0de489bf9948b4eb4",
  "sha1_ok": true,
  "size": 2941
}
