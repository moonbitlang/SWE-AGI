{
  "content": {
    "base64": "IyEvYmluL3NoCiMKIyBDb3B5cmlnaHQgKGMpIDIwMDYgU2hhd24gTy4gUGVhcmNlCiMKCnRlc3RfZGVzY3JpcHRpb249J1Rlc3QgdGhlIHVwZGF0ZSBob29rIGluZnJhc3RydWN0dXJlLicKLiAuL3Rlc3QtbGliLnNoCgp0ZXN0X2V4cGVjdF9zdWNjZXNzIHNldHVwICcKCWVjaG8gVGhpcyBpcyBhIHRlc3QuID5hICYmCglnaXQgdXBkYXRlLWluZGV4IC0tYWRkIGEgJiYKCXRyZWUwPSQoZ2l0IHdyaXRlLXRyZWUpICYmCgljb21taXQwPSQoZWNobyBzZXR1cCB8IGdpdCBjb21taXQtdHJlZSAkdHJlZTApICYmCgllY2hvIFdlIGhvcGUgaXQgd29ya3MuID5hICYmCglnaXQgdXBkYXRlLWluZGV4IGEgJiYKCXRyZWUxPSQoZ2l0IHdyaXRlLXRyZWUpICYmCgljb21taXQxPSQoZWNobyBtb2RpZnkgfCBnaXQgY29tbWl0LXRyZWUgJHRyZWUxIC1wICRjb21taXQwKSAmJgoJZ2l0IHVwZGF0ZS1yZWYgcmVmcy9oZWFkcy9tYWluICRjb21taXQwICYmCglnaXQgdXBkYXRlLXJlZiByZWZzL2hlYWRzL3RvZmFpbCAkY29tbWl0MSAmJgoJZ2l0IGNsb25lIC0tYmFyZSAuLy4gdmljdGltLmdpdCAmJgoJR0lUX0RJUj12aWN0aW0uZ2l0IGdpdCB1cGRhdGUtcmVmIHJlZnMvaGVhZHMvdG9mYWlsICRjb21taXQxICYmCglnaXQgdXBkYXRlLXJlZiByZWZzL2hlYWRzL21haW4gJGNvbW1pdDEgJiYKCWdpdCB1cGRhdGUtcmVmIHJlZnMvaGVhZHMvdG9mYWlsICRjb21taXQwICYmCgoJdGVzdF9ob29rIC0tc2V0dXAgLUMgdmljdGltLmdpdCBwcmUtcmVjZWl2ZSA8PC1cRU9GICYmCglwcmludGYgJXMgIiRAIiA+PiRHSVRfRElSL3ByZS1yZWNlaXZlLmFyZ3MKCWNhdCAtID4kR0lUX0RJUi9wcmUtcmVjZWl2ZS5zdGRpbgoJZWNobyBTVERPVVQgcHJlLXJlY2VpdmUKCWVjaG8gU1RERVJSIHByZS1yZWNlaXZlID4mMgoJRU9GCgoJdGVzdF9ob29rIC0tc2V0dXAgLUMgdmljdGltLmdpdCB1cGRhdGUgPDwtXEVPRiAmJgoJZWNobyAiJEAiID4+JEdJVF9ESVIvdXBkYXRlLmFyZ3MKCXJlYWQgeDsgcHJpbnRmICVzICIkeCIgPiRHSVRfRElSL3VwZGF0ZS5zdGRpbgoJZWNobyBTVERPVVQgdXBkYXRlICQxCgllY2hvIFNUREVSUiB1cGRhdGUgJDEgPiYyCgl0ZXN0ICIkMSIgPSByZWZzL2hlYWRzL21haW4gfHwgZXhpdAoJRU9GCgoJdGVzdF9ob29rIC0tc2V0dXAgLUMgdmljdGltLmdpdCBwb3N0LXJlY2VpdmUgPDwtXEVPRiAmJgoJcHJpbnRmICVzICIkQCIgPj4kR0lUX0RJUi9wb3N0LXJlY2VpdmUuYXJncwoJY2F0IC0gPiRHSVRfRElSL3Bvc3QtcmVjZWl2ZS5zdGRpbgoJZWNobyBTVERPVVQgcG9zdC1yZWNlaXZlCgllY2hvIFNUREVSUiBwb3N0LXJlY2VpdmUgPiYyCglFT0YKCgl0ZXN0X2hvb2sgLS1zZXR1cCAtQyB2aWN0aW0uZ2l0IHBvc3QtdXBkYXRlIDw8LVxFT0YKCWVjaG8gIiRAIiA+PiRHSVRfRElSL3Bvc3QtdXBkYXRlLmFyZ3MKCXJlYWQgeDsgcHJpbnRmICVzICIkeCIgPiRHSVRfRElSL3Bvc3QtdXBkYXRlLnN0ZGluCgllY2hvIFNURE9VVCBwb3N0LXVwZGF0ZQoJZWNobyBTVERFUlIgcG9zdC11cGRhdGUgPiYyCglFT0YKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyBwdXNoICcKCXRlc3RfbXVzdF9mYWlsIGdpdCBzZW5kLXBhY2sgLS1mb3JjZSAuL3ZpY3RpbS5naXQgXAoJCW1haW4gdG9mYWlsID5zZW5kLm91dCAyPnNlbmQuZXJyCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3VwZGF0ZWQgYXMgZXhwZWN0ZWQnICcKCXRlc3QgJChHSVRfRElSPXZpY3RpbS5naXQgZ2l0IHJldi1wYXJzZSBtYWluKSA9ICRjb21taXQxICYmCgl0ZXN0ICQoR0lUX0RJUj12aWN0aW0uZ2l0IGdpdCByZXYtcGFyc2UgdG9mYWlsKSA9ICRjb21taXQxCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2hvb2tzIHJhbicgJwoJdGVzdCAtZiB2aWN0aW0uZ2l0L3ByZS1yZWNlaXZlLmFyZ3MgJiYKCXRlc3QgLWYgdmljdGltLmdpdC9wcmUtcmVjZWl2ZS5zdGRpbiAmJgoJdGVzdCAtZiB2aWN0aW0uZ2l0L3VwZGF0ZS5hcmdzICYmCgl0ZXN0IC1mIHZpY3RpbS5naXQvdXBkYXRlLnN0ZGluICYmCgl0ZXN0IC1mIHZpY3RpbS5naXQvcG9zdC1yZWNlaXZlLmFyZ3MgJiYKCXRlc3QgLWYgdmljdGltLmdpdC9wb3N0LXJlY2VpdmUuc3RkaW4gJiYKCXRlc3QgLWYgdmljdGltLmdpdC9wb3N0LXVwZGF0ZS5hcmdzICYmCgl0ZXN0IC1mIHZpY3RpbS5naXQvcG9zdC11cGRhdGUuc3RkaW4KJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAncHJlLXJlY2VpdmUgaG9vayBpbnB1dCcgJwoJKGVjaG8gJGNvbW1pdDAgJGNvbW1pdDEgcmVmcy9oZWFkcy9tYWluICYmCgkgZWNobyAkY29tbWl0MSAkY29tbWl0MCByZWZzL2hlYWRzL3RvZmFpbAoJKSB8IHRlc3RfY21wIC0gdmljdGltLmdpdC9wcmUtcmVjZWl2ZS5zdGRpbgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICd1cGRhdGUgaG9vayBhcmd1bWVudHMnICcKCShlY2hvIHJlZnMvaGVhZHMvbWFpbiAkY29tbWl0MCAkY29tbWl0MSAmJgoJIGVjaG8gcmVmcy9oZWFkcy90b2ZhaWwgJGNvbW1pdDEgJGNvbW1pdDAKCSkgfCB0ZXN0X2NtcCAtIHZpY3RpbS5naXQvdXBkYXRlLmFyZ3MKJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAncG9zdC1yZWNlaXZlIGhvb2sgaW5wdXQnICcKCWVjaG8gJGNvbW1pdDAgJGNvbW1pdDEgcmVmcy9oZWFkcy9tYWluIHwKCXRlc3RfY21wIC0gdmljdGltLmdpdC9wb3N0LXJlY2VpdmUuc3RkaW4KJwoKdGVzdF9leHBlY3Rfc3VjY2VzcyAncG9zdC11cGRhdGUgaG9vayBhcmd1bWVudHMnICcKCWVjaG8gcmVmcy9oZWFkcy9tYWluIHwKCXRlc3RfY21wIC0gdmljdGltLmdpdC9wb3N0LXVwZGF0ZS5hcmdzCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ2FsbCBob29rIHN0ZGluIGlzIC9kZXYvbnVsbCcgJwoJdGVzdF9tdXN0X2JlX2VtcHR5IHZpY3RpbS5naXQvdXBkYXRlLnN0ZGluICYmCgl0ZXN0X211c3RfYmVfZW1wdHkgdmljdGltLmdpdC9wb3N0LXVwZGF0ZS5zdGRpbgonCgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdhbGwgKi1yZWNlaXZlIGhvb2sgYXJncyBhcmUgZW1wdHknICcKCXRlc3RfbXVzdF9iZV9lbXB0eSB2aWN0aW0uZ2l0L3ByZS1yZWNlaXZlLmFyZ3MgJiYKCXRlc3RfbXVzdF9iZV9lbXB0eSB2aWN0aW0uZ2l0L3Bvc3QtcmVjZWl2ZS5hcmdzCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3NlbmQtcGFjayBwcm9kdWNlZCBubyBvdXRwdXQnICcKCXRlc3RfbXVzdF9iZV9lbXB0eSBzZW5kLm91dAonCgpjYXQgPDxFT0YgPmV4cGVjdApyZW1vdGU6IFNURE9VVCBwcmUtcmVjZWl2ZQpyZW1vdGU6IFNUREVSUiBwcmUtcmVjZWl2ZQpyZW1vdGU6IFNURE9VVCB1cGRhdGUgcmVmcy9oZWFkcy9tYWluCnJlbW90ZTogU1RERVJSIHVwZGF0ZSByZWZzL2hlYWRzL21haW4KcmVtb3RlOiBTVERPVVQgdXBkYXRlIHJlZnMvaGVhZHMvdG9mYWlsCnJlbW90ZTogU1RERVJSIHVwZGF0ZSByZWZzL2hlYWRzL3RvZmFpbApyZW1vdGU6IGVycm9yOiBob29rIGRlY2xpbmVkIHRvIHVwZGF0ZSByZWZzL2hlYWRzL3RvZmFpbApyZW1vdGU6IFNURE9VVCBwb3N0LXJlY2VpdmUKcmVtb3RlOiBTVERFUlIgcG9zdC1yZWNlaXZlCnJlbW90ZTogU1RET1VUIHBvc3QtdXBkYXRlCnJlbW90ZTogU1RERVJSIHBvc3QtdXBkYXRlCkVPRgp0ZXN0X2V4cGVjdF9zdWNjZXNzICdzZW5kLXBhY2sgc3RkZXJyIGNvbnRhaW5zIGhvb2sgbWVzc2FnZXMnICcKCWdyZXAgXnJlbW90ZTogc2VuZC5lcnIgfCBzZWQgInMvICpcJC8vIiA+YWN0dWFsICYmCgl0ZXN0X2NtcCBleHBlY3QgYWN0dWFsCicKCnRlc3RfZXhwZWN0X3N1Y2Nlc3MgJ3ByZS1yZWNlaXZlIGhvb2sgdGhhdCBmb3JnZXRzIHRvIHJlYWQgaXRzIGlucHV0JyAnCgl0ZXN0X2hvb2sgLS1jbG9iYmVyIC1DIHZpY3RpbS5naXQgcHJlLXJlY2VpdmUgPDwtXEVPRiAmJgoJZXhpdCAwCglFT0YKCXJtIC1mIHZpY3RpbS5naXQvaG9va3MvdXBkYXRlIHZpY3RpbS5naXQvaG9va3MvcG9zdC11cGRhdGUgJiYKCglmb3IgdiBpbiAkKHRlc3Rfc2VxIDEwMCA5OTkpCglkbwoJCWdpdCBicmFuY2ggYnJhbmNoXyR2IG1haW4gfHwgcmV0dXJuCglkb25lICYmCglnaXQgcHVzaCAuL3ZpY3RpbS5naXQgIityZWZzL2hlYWRzLyo6cmVmcy9oZWFkcy8qIgonCgp0ZXN0X2RvbmUK",
    "text": "#!/bin/sh\n#\n# Copyright (c) 2006 Shawn O. Pearce\n#\n\ntest_description='Test the update hook infrastructure.'\n. ./test-lib.sh\n\ntest_expect_success setup '\n\techo This is a test. >a &&\n\tgit update-index --add a &&\n\ttree0=$(git write-tree) &&\n\tcommit0=$(echo setup | git commit-tree $tree0) &&\n\techo We hope it works. >a &&\n\tgit update-index a &&\n\ttree1=$(git write-tree) &&\n\tcommit1=$(echo modify | git commit-tree $tree1 -p $commit0) &&\n\tgit update-ref refs/heads/main $commit0 &&\n\tgit update-ref refs/heads/tofail $commit1 &&\n\tgit clone --bare ./. victim.git &&\n\tGIT_DIR=victim.git git update-ref refs/heads/tofail $commit1 &&\n\tgit update-ref refs/heads/main $commit1 &&\n\tgit update-ref refs/heads/tofail $commit0 &&\n\n\ttest_hook --setup -C victim.git pre-receive <<-\\EOF &&\n\tprintf %s \"$@\" >>$GIT_DIR/pre-receive.args\n\tcat - >$GIT_DIR/pre-receive.stdin\n\techo STDOUT pre-receive\n\techo STDERR pre-receive >&2\n\tEOF\n\n\ttest_hook --setup -C victim.git update <<-\\EOF &&\n\techo \"$@\" >>$GIT_DIR/update.args\n\tread x; printf %s \"$x\" >$GIT_DIR/update.stdin\n\techo STDOUT update $1\n\techo STDERR update $1 >&2\n\ttest \"$1\" = refs/heads/main || exit\n\tEOF\n\n\ttest_hook --setup -C victim.git post-receive <<-\\EOF &&\n\tprintf %s \"$@\" >>$GIT_DIR/post-receive.args\n\tcat - >$GIT_DIR/post-receive.stdin\n\techo STDOUT post-receive\n\techo STDERR post-receive >&2\n\tEOF\n\n\ttest_hook --setup -C victim.git post-update <<-\\EOF\n\techo \"$@\" >>$GIT_DIR/post-update.args\n\tread x; printf %s \"$x\" >$GIT_DIR/post-update.stdin\n\techo STDOUT post-update\n\techo STDERR post-update >&2\n\tEOF\n'\n\ntest_expect_success push '\n\ttest_must_fail git send-pack --force ./victim.git \\\n\t\tmain tofail >send.out 2>send.err\n'\n\ntest_expect_success 'updated as expected' '\n\ttest $(GIT_DIR=victim.git git rev-parse main) = $commit1 &&\n\ttest $(GIT_DIR=victim.git git rev-parse tofail) = $commit1\n'\n\ntest_expect_success 'hooks ran' '\n\ttest -f victim.git/pre-receive.args &&\n\ttest -f victim.git/pre-receive.stdin &&\n\ttest -f victim.git/update.args &&\n\ttest -f victim.git/update.stdin &&\n\ttest -f victim.git/post-receive.args &&\n\ttest -f victim.git/post-receive.stdin &&\n\ttest -f victim.git/post-update.args &&\n\ttest -f victim.git/post-update.stdin\n'\n\ntest_expect_success 'pre-receive hook input' '\n\t(echo $commit0 $commit1 refs/heads/main &&\n\t echo $commit1 $commit0 refs/heads/tofail\n\t) | test_cmp - victim.git/pre-receive.stdin\n'\n\ntest_expect_success 'update hook arguments' '\n\t(echo refs/heads/main $commit0 $commit1 &&\n\t echo refs/heads/tofail $commit1 $commit0\n\t) | test_cmp - victim.git/update.args\n'\n\ntest_expect_success 'post-receive hook input' '\n\techo $commit0 $commit1 refs/heads/main |\n\ttest_cmp - victim.git/post-receive.stdin\n'\n\ntest_expect_success 'post-update hook arguments' '\n\techo refs/heads/main |\n\ttest_cmp - victim.git/post-update.args\n'\n\ntest_expect_success 'all hook stdin is /dev/null' '\n\ttest_must_be_empty victim.git/update.stdin &&\n\ttest_must_be_empty victim.git/post-update.stdin\n'\n\ntest_expect_success 'all *-receive hook args are empty' '\n\ttest_must_be_empty victim.git/pre-receive.args &&\n\ttest_must_be_empty victim.git/post-receive.args\n'\n\ntest_expect_success 'send-pack produced no output' '\n\ttest_must_be_empty send.out\n'\n\ncat <<EOF >expect\nremote: STDOUT pre-receive\nremote: STDERR pre-receive\nremote: STDOUT update refs/heads/main\nremote: STDERR update refs/heads/main\nremote: STDOUT update refs/heads/tofail\nremote: STDERR update refs/heads/tofail\nremote: error: hook declined to update refs/heads/tofail\nremote: STDOUT post-receive\nremote: STDERR post-receive\nremote: STDOUT post-update\nremote: STDERR post-update\nEOF\ntest_expect_success 'send-pack stderr contains hook messages' '\n\tgrep ^remote: send.err | sed \"s/ *\\$//\" >actual &&\n\ttest_cmp expect actual\n'\n\ntest_expect_success 'pre-receive hook that forgets to read its input' '\n\ttest_hook --clobber -C victim.git pre-receive <<-\\EOF &&\n\texit 0\n\tEOF\n\trm -f victim.git/hooks/update victim.git/hooks/post-update &&\n\n\tfor v in $(test_seq 100 999)\n\tdo\n\t\tgit branch branch_$v main || return\n\tdone &&\n\tgit push ./victim.git \"+refs/heads/*:refs/heads/*\"\n'\n\ntest_done\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "001b7a17ad2bb93610198ebf134ccbedc2781f00",
  "sha1_ok": true,
  "size": 4080
}
