{
  "content": {
    "base64": "LyoKICogV2UgcHV0IGFsbCB0aGUgZ2l0IGNvbmZpZyB2YXJpYWJsZXMgaW4gdGhpcyBzYW1lIG9iamVjdAogKiBmaWxlLCBzbyB0aGF0IHByb2dyYW1zIGNhbiBsaW5rIGFnYWluc3QgdGhlIGNvbmZpZyBwYXJzZXIKICogd2l0aG91dCBoYXZpbmcgdG8gbGluayBhZ2FpbnN0IGFsbCB0aGUgcmVzdCBvZiBnaXQuCiAqCiAqIEluIHBhcnRpY3VsYXIsIG5vIG5lZWQgdG8gYnJpbmcgaW4gbGlieiBldGMgdW5sZXNzIG5lZWRlZCwKICogZXZlbiBpZiB5b3UgbWlnaHQgd2FudCB0byBrbm93IHdoZXJlIHRoZSBnaXQgZGlyZWN0b3J5IGV0YwogKiBhcmUuCiAqLwoKI2RlZmluZSBVU0VfVEhFX1JFUE9TSVRPUllfVkFSSUFCTEUKCiNpbmNsdWRlICJnaXQtY29tcGF0LXV0aWwuaCIKI2luY2x1ZGUgImFic3BhdGguaCIKI2luY2x1ZGUgImFkdmljZS5oIgojaW5jbHVkZSAiYXR0ci5oIgojaW5jbHVkZSAiYnJhbmNoLmgiCiNpbmNsdWRlICJjb2xvci5oIgojaW5jbHVkZSAiY29udmVydC5oIgojaW5jbHVkZSAiZW52aXJvbm1lbnQuaCIKI2luY2x1ZGUgImdldHRleHQuaCIKI2luY2x1ZGUgImdpdC16bGliLmgiCiNpbmNsdWRlICJpZGVudC5oIgojaW5jbHVkZSAibG9ja2ZpbGUuaCIKI2luY2x1ZGUgIm1haWxtYXAuaCIKI2luY2x1ZGUgIm9iamVjdC1uYW1lLmgiCiNpbmNsdWRlICJyZXBvc2l0b3J5LmgiCiNpbmNsdWRlICJjb25maWcuaCIKI2luY2x1ZGUgInJlZnMuaCIKI2luY2x1ZGUgImZtdC1tZXJnZS1tc2cuaCIKI2luY2x1ZGUgImNvbW1pdC5oIgojaW5jbHVkZSAic3RydmVjLmgiCiNpbmNsdWRlICJwYWdlci5oIgojaW5jbHVkZSAicGF0aC5oIgojaW5jbHVkZSAicXVvdGUuaCIKI2luY2x1ZGUgImNoZGlyLW5vdGlmeS5oIgojaW5jbHVkZSAic2V0dXAuaCIKI2luY2x1ZGUgIndzLmgiCiNpbmNsdWRlICJ3cml0ZS1vci1kaWUuaCIKCnN0YXRpYyBpbnQgcGFja19jb21wcmVzc2lvbl9zZWVuOwpzdGF0aWMgaW50IHpsaWJfY29tcHJlc3Npb25fc2VlbjsKCmludCB0cnVzdF9leGVjdXRhYmxlX2JpdCA9IDE7CmludCB0cnVzdF9jdGltZSA9IDE7CmludCBjaGVja19zdGF0ID0gMTsKaW50IGhhc19zeW1saW5rcyA9IDE7CmludCBtaW5pbXVtX2FiYnJldiA9IDQsIGRlZmF1bHRfYWJicmV2ID0gLTE7CmludCBpZ25vcmVfY2FzZTsKaW50IGFzc3VtZV91bmNoYW5nZWQ7CmludCBpc19iYXJlX3JlcG9zaXRvcnlfY2ZnID0gLTE7IC8qIHVuc3BlY2lmaWVkICovCmludCB3YXJuX29uX29iamVjdF9yZWZuYW1lX2FtYmlndWl0eSA9IDE7CmNoYXIgKmdpdF9jb21taXRfZW5jb2Rpbmc7CmNoYXIgKmdpdF9sb2dfb3V0cHV0X2VuY29kaW5nOwpjaGFyICphcHBseV9kZWZhdWx0X3doaXRlc3BhY2U7CmNoYXIgKmFwcGx5X2RlZmF1bHRfaWdub3Jld2hpdGVzcGFjZTsKY2hhciAqZ2l0X2F0dHJpYnV0ZXNfZmlsZTsKaW50IHpsaWJfY29tcHJlc3Npb25fbGV2ZWwgPSBaX0JFU1RfU1BFRUQ7CmludCBwYWNrX2NvbXByZXNzaW9uX2xldmVsID0gWl9ERUZBVUxUX0NPTVBSRVNTSU9OOwppbnQgZnN5bmNfb2JqZWN0X2ZpbGVzID0gLTE7CmludCB1c2VfZnN5bmMgPSAtMTsKZW51bSBmc3luY19tZXRob2QgZnN5bmNfbWV0aG9kID0gRlNZTkNfTUVUSE9EX0RFRkFVTFQ7CmVudW0gZnN5bmNfY29tcG9uZW50IGZzeW5jX2NvbXBvbmVudHMgPSBGU1lOQ19DT01QT05FTlRTX0RFRkFVTFQ7CmNoYXIgKmVkaXRvcl9wcm9ncmFtOwpjaGFyICphc2twYXNzX3Byb2dyYW07CmNoYXIgKmV4Y2x1ZGVzX2ZpbGU7CmVudW0gYXV0b19jcmxmIGF1dG9fY3JsZiA9IEFVVE9fQ1JMRl9GQUxTRTsKZW51bSBlb2wgY29yZV9lb2wgPSBFT0xfVU5TRVQ7CmludCBnbG9iYWxfY29udl9mbGFnc19lb2wgPSBDT05WX0VPTF9STkRUUlBfV0FSTjsKY2hhciAqY2hlY2tfcm91bmR0cmlwX2VuY29kaW5nOwplbnVtIGJyYW5jaF90cmFjayBnaXRfYnJhbmNoX3RyYWNrID0gQlJBTkNIX1RSQUNLX1JFTU9URTsKZW51bSByZWJhc2Vfc2V0dXBfdHlwZSBhdXRvcmViYXNlID0gQVVUT1JFQkFTRV9ORVZFUjsKZW51bSBwdXNoX2RlZmF1bHRfdHlwZSBwdXNoX2RlZmF1bHQgPSBQVVNIX0RFRkFVTFRfVU5TUEVDSUZJRUQ7CiNpZm5kZWYgT0JKRUNUX0NSRUFUSU9OX01PREUKI2RlZmluZSBPQkpFQ1RfQ1JFQVRJT05fTU9ERSBPQkpFQ1RfQ1JFQVRJT05fVVNFU19IQVJETElOS1MKI2VuZGlmCmVudW0gb2JqZWN0X2NyZWF0aW9uX21vZGUgb2JqZWN0X2NyZWF0aW9uX21vZGUgPSBPQkpFQ1RfQ1JFQVRJT05fTU9ERTsKaW50IGdyYWZ0c19rZWVwX3RydWVfcGFyZW50czsKaW50IGNvcmVfYXBwbHlfc3BhcnNlX2NoZWNrb3V0OwppbnQgY29yZV9zcGFyc2VfY2hlY2tvdXRfY29uZTsKaW50IHNwYXJzZV9leHBlY3RfZmlsZXNfb3V0c2lkZV9vZl9wYXR0ZXJuczsKaW50IHByZWNvbXBvc2VkX3VuaWNvZGUgPSAtMTsgLyogc2VlIHByb2JlX3V0ZjhfcGF0aG5hbWVfY29tcG9zaXRpb24oKSAqLwp1bnNpZ25lZCBsb25nIHBhY2tfc2l6ZV9saW1pdF9jZmc7CgojaWZuZGVmIFBST1RFQ1RfSEZTX0RFRkFVTFQKI2RlZmluZSBQUk9URUNUX0hGU19ERUZBVUxUIDAKI2VuZGlmCmludCBwcm90ZWN0X2hmcyA9IFBST1RFQ1RfSEZTX0RFRkFVTFQ7CgojaWZuZGVmIFBST1RFQ1RfTlRGU19ERUZBVUxUCiNkZWZpbmUgUFJPVEVDVF9OVEZTX0RFRkFVTFQgMQojZW5kaWYKaW50IHByb3RlY3RfbnRmcyA9IFBST1RFQ1RfTlRGU19ERUZBVUxUOwoKLyoKICogVGhlIGNoYXJhY3RlciB0aGF0IGJlZ2lucyBhIGNvbW1lbnRlZCBsaW5lIGluIHVzZXItZWRpdGFibGUgZmlsZQogKiB0aGF0IGlzIHN1YmplY3QgdG8gc3RyaXBzcGFjZS4KICovCmNvbnN0IGNoYXIgKmNvbW1lbnRfbGluZV9zdHIgPSAiIyI7CmNoYXIgKmNvbW1lbnRfbGluZV9zdHJfdG9fZnJlZTsKI2lmbmRlZiBXSVRIX0JSRUFLSU5HX0NIQU5HRVMKaW50IGF1dG9fY29tbWVudF9saW5lX2NoYXI7CmJvb2wgd2Fybl9vbl9hdXRvX2NvbW1lbnRfY2hhcjsKI2VuZGlmIC8qICFXSVRIX0JSRUFLSU5HX0NIQU5HRVMgKi8KCi8qIFRoaXMgaXMgc2V0IGJ5IHNldHVwX2dpdF9kaXJlY3RvcnlfZ2VudGx5KCkgYW5kL29yIGdpdF9kZWZhdWx0X2NvbmZpZygpICovCmNoYXIgKmdpdF93b3JrX3RyZWVfY2ZnOwoKLyoKICogUmVwb3NpdG9yeS1sb2NhbCBHSVRfKiBlbnZpcm9ubWVudCB2YXJpYWJsZXM7IHNlZSBlbnZpcm9ubWVudC5oIGZvciBkZXRhaWxzLgogKi8KY29uc3QgY2hhciAqIGNvbnN0IGxvY2FsX3JlcG9fZW52W10gPSB7CglBTFRFUk5BVEVfREJfRU5WSVJPTk1FTlQsCglDT05GSUdfRU5WSVJPTk1FTlQsCglDT05GSUdfREFUQV9FTlZJUk9OTUVOVCwKCUNPTkZJR19DT1VOVF9FTlZJUk9OTUVOVCwKCURCX0VOVklST05NRU5ULAoJR0lUX0RJUl9FTlZJUk9OTUVOVCwKCUdJVF9XT1JLX1RSRUVfRU5WSVJPTk1FTlQsCglHSVRfSU1QTElDSVRfV09SS19UUkVFX0VOVklST05NRU5ULAoJR1JBRlRfRU5WSVJPTk1FTlQsCglJTkRFWF9FTlZJUk9OTUVOVCwKCU5PX1JFUExBQ0VfT0JKRUNUU19FTlZJUk9OTUVOVCwKCUdJVF9SRVBMQUNFX1JFRl9CQVNFX0VOVklST05NRU5ULAoJR0lUX1BSRUZJWF9FTlZJUk9OTUVOVCwKCUdJVF9TSEFMTE9XX0ZJTEVfRU5WSVJPTk1FTlQsCglHSVRfQ09NTU9OX0RJUl9FTlZJUk9OTUVOVCwKCU5VTEwKfTsKCmNvbnN0IGNoYXIgKmdldGVudl9zYWZlKHN0cnVjdCBzdHJ2ZWMgKmFyZ3YsIGNvbnN0IGNoYXIgKm5hbWUpCnsKCWNvbnN0IGNoYXIgKnZhbHVlID0gZ2V0ZW52KG5hbWUpOwoKCWlmICghdmFsdWUpCgkJcmV0dXJuIE5VTEw7CgoJc3RydmVjX3B1c2goYXJndiwgdmFsdWUpOwoJcmV0dXJuIGFyZ3YtPnZbYXJndi0+bnIgLSAxXTsKfQoKaW50IGlzX2JhcmVfcmVwb3NpdG9yeSh2b2lkKQp7CgkvKiBpZiBjb3JlLmJhcmUgaXMgbm90ICdmYWxzZScsIGxldCdzIHNlZSBpZiB0aGVyZSBpcyBhIHdvcmsgdHJlZSAqLwoJcmV0dXJuIGlzX2JhcmVfcmVwb3NpdG9yeV9jZmcgJiYgIXJlcG9fZ2V0X3dvcmtfdHJlZSh0aGVfcmVwb3NpdG9yeSk7Cn0KCmludCBoYXZlX2dpdF9kaXIodm9pZCkKewoJcmV0dXJuIHN0YXJ0dXBfaW5mby0+aGF2ZV9yZXBvc2l0b3J5CgkJfHwgdGhlX3JlcG9zaXRvcnktPmdpdGRpcjsKfQoKY29uc3QgY2hhciAqZ2V0X2dpdF9uYW1lc3BhY2Uodm9pZCkKewoJc3RhdGljIGNvbnN0IGNoYXIgKm5hbWVzcGFjZTsKCXN0cnVjdCBzdHJidWYgYnVmID0gU1RSQlVGX0lOSVQ7Cgljb25zdCBjaGFyICpyYXdfbmFtZXNwYWNlOwoJc3RydWN0IHN0cmluZ19saXN0IGNvbXBvbmVudHMgPSBTVFJJTkdfTElTVF9JTklUX0RVUDsKCXN0cnVjdCBzdHJpbmdfbGlzdF9pdGVtICppdGVtOwoKCWlmIChuYW1lc3BhY2UpCgkJcmV0dXJuIG5hbWVzcGFjZTsKCglyYXdfbmFtZXNwYWNlID0gZ2V0ZW52KEdJVF9OQU1FU1BBQ0VfRU5WSVJPTk1FTlQpOwoJaWYgKCFyYXdfbmFtZXNwYWNlIHx8ICEqcmF3X25hbWVzcGFjZSkgewoJCW5hbWVzcGFjZSA9ICIiOwoJCXJldHVybiBuYW1lc3BhY2U7Cgl9CgoJc3RyYnVmX2FkZHN0cigmYnVmLCByYXdfbmFtZXNwYWNlKTsKCglzdHJpbmdfbGlzdF9zcGxpdCgmY29tcG9uZW50cywgYnVmLmJ1ZiwgIi8iLCAtMSk7CglzdHJidWZfcmVzZXQoJmJ1Zik7CgoJZm9yX2VhY2hfc3RyaW5nX2xpc3RfaXRlbShpdGVtLCAmY29tcG9uZW50cykgewoJCWlmIChpdGVtLT5zdHJpbmdbMF0pCgkJCXN0cmJ1Zl9hZGRmKCZidWYsICJyZWZzL25hbWVzcGFjZXMvJXMvIiwgaXRlbS0+c3RyaW5nKTsKCX0KCXN0cmluZ19saXN0X2NsZWFyKCZjb21wb25lbnRzLCAwKTsKCglzdHJidWZfdHJpbV90cmFpbGluZ19kaXJfc2VwKCZidWYpOwoJaWYgKGNoZWNrX3JlZm5hbWVfZm9ybWF0KGJ1Zi5idWYsIDApKQoJCWRpZShfKCJiYWQgZ2l0IG5hbWVzcGFjZSBwYXRoIFwiJXNcIiIpLCByYXdfbmFtZXNwYWNlKTsKCXN0cmJ1Zl9hZGRjaCgmYnVmLCAnLycpOwoKCW5hbWVzcGFjZSA9IHN0cmJ1Zl9kZXRhY2goJmJ1ZiwgTlVMTCk7CgoJcmV0dXJuIG5hbWVzcGFjZTsKfQoKY29uc3QgY2hhciAqc3RyaXBfbmFtZXNwYWNlKGNvbnN0IGNoYXIgKm5hbWVzcGFjZWRfcmVmKQp7Cgljb25zdCBjaGFyICpvdXQ7CglpZiAoc2tpcF9wcmVmaXgobmFtZXNwYWNlZF9yZWYsIGdldF9naXRfbmFtZXNwYWNlKCksICZvdXQpKQoJCXJldHVybiBvdXQ7CglyZXR1cm4gTlVMTDsKfQoKY29uc3QgY2hhciAqZ2V0X2xvZ19vdXRwdXRfZW5jb2Rpbmcodm9pZCkKewoJcmV0dXJuIGdpdF9sb2dfb3V0cHV0X2VuY29kaW5nID8gZ2l0X2xvZ19vdXRwdXRfZW5jb2RpbmcKCQk6IGdldF9jb21taXRfb3V0cHV0X2VuY29kaW5nKCk7Cn0KCmNvbnN0IGNoYXIgKmdldF9jb21taXRfb3V0cHV0X2VuY29kaW5nKHZvaWQpCnsKCXJldHVybiBnaXRfY29tbWl0X2VuY29kaW5nID8gZ2l0X2NvbW1pdF9lbmNvZGluZyA6ICJVVEYtOCI7Cn0KCmludCB1c2Vfb3B0aW9uYWxfbG9ja3Modm9pZCkKewoJcmV0dXJuIGdpdF9lbnZfYm9vbChHSVRfT1BUSU9OQUxfTE9DS1NfRU5WSVJPTk1FTlQsIDEpOwp9CgppbnQgcHJpbnRfc2hhMV9lbGxpcHNpcyh2b2lkKQp7CgkvKgoJICogRGV0ZXJtaW5lIGlmIHRoZSBjYWxsaW5nIGVudmlyb25tZW50IGNvbnRhaW5zIHRoZSB2YXJpYWJsZQoJICogR0lUX1BSSU5UX1NIQTFfRUxMSVBTSVMgc2V0IHRvICJ5ZXMiLgoJICovCglzdGF0aWMgaW50IGNhY2hlZF9yZXN1bHQgPSAtMTsgLyogdW5rbm93biAqLwoKCWlmIChjYWNoZWRfcmVzdWx0IDwgMCkgewoJCWNvbnN0IGNoYXIgKnYgPSBnZXRlbnYoIkdJVF9QUklOVF9TSEExX0VMTElQU0lTIik7CgkJY2FjaGVkX3Jlc3VsdCA9ICh2ICYmICFzdHJjYXNlY21wKHYsICJ5ZXMiKSk7Cgl9CglyZXR1cm4gY2FjaGVkX3Jlc3VsdDsKfQoKc3RhdGljIGNvbnN0IHN0cnVjdCBmc3luY19jb21wb25lbnRfbmFtZSB7Cgljb25zdCBjaGFyICpuYW1lOwoJZW51bSBmc3luY19jb21wb25lbnQgY29tcG9uZW50X2JpdHM7Cn0gZnN5bmNfY29tcG9uZW50X25hbWVzW10gPSB7Cgl7ICJsb29zZS1vYmplY3QiLCBGU1lOQ19DT01QT05FTlRfTE9PU0VfT0JKRUNUIH0sCgl7ICJwYWNrIiwgRlNZTkNfQ09NUE9ORU5UX1BBQ0sgfSwKCXsgInBhY2stbWV0YWRhdGEiLCBGU1lOQ19DT01QT05FTlRfUEFDS19NRVRBREFUQSB9LAoJeyAiY29tbWl0LWdyYXBoIiwgRlNZTkNfQ09NUE9ORU5UX0NPTU1JVF9HUkFQSCB9LAoJeyAiaW5kZXgiLCBGU1lOQ19DT01QT05FTlRfSU5ERVggfSwKCXsgIm9iamVjdHMiLCBGU1lOQ19DT01QT05FTlRTX09CSkVDVFMgfSwKCXsgInJlZmVyZW5jZSIsIEZTWU5DX0NPTVBPTkVOVF9SRUZFUkVOQ0UgfSwKCXsgImRlcml2ZWQtbWV0YWRhdGEiLCBGU1lOQ19DT01QT05FTlRTX0RFUklWRURfTUVUQURBVEEgfSwKCXsgImNvbW1pdHRlZCIsIEZTWU5DX0NPTVBPTkVOVFNfQ09NTUlUVEVEIH0sCgl7ICJhZGRlZCIsIEZTWU5DX0NPTVBPTkVOVFNfQURERUQgfSwKCXsgImFsbCIsIEZTWU5DX0NPTVBPTkVOVFNfQUxMIH0sCn07CgpzdGF0aWMgZW51bSBmc3luY19jb21wb25lbnQgcGFyc2VfZnN5bmNfY29tcG9uZW50cyhjb25zdCBjaGFyICp2YXIsIGNvbnN0IGNoYXIgKnN0cmluZykKewoJZW51bSBmc3luY19jb21wb25lbnQgY3VycmVudCA9IEZTWU5DX0NPTVBPTkVOVFNfUExBVEZPUk1fREVGQVVMVDsKCWVudW0gZnN5bmNfY29tcG9uZW50IHBvc2l0aXZlID0gMCwgbmVnYXRpdmUgPSAwOwoKCXdoaWxlIChzdHJpbmcpIHsKCQlzaXplX3QgbGVuOwoJCWNvbnN0IGNoYXIgKmVwOwoJCWludCBuZWdhdGVkID0gMDsKCQlpbnQgZm91bmQgPSAwOwoKCQlzdHJpbmcgPSBzdHJpbmcgKyBzdHJzcG4oc3RyaW5nLCAiLCBcdFxuXHIiKTsKCQllcCA9IHN0cmNocm51bChzdHJpbmcsICcsJyk7CgkJbGVuID0gZXAgLSBzdHJpbmc7CgkJaWYgKCFzdHJjbXAoc3RyaW5nLCAibm9uZSIpKSB7CgkJCWN1cnJlbnQgPSBGU1lOQ19DT01QT05FTlRfTk9ORTsKCQkJZ290byBuZXh0X25hbWU7CgkJfQoKCQlpZiAoKnN0cmluZyA9PSAnLScpIHsKCQkJbmVnYXRlZCA9IDE7CgkJCXN0cmluZysrOwoJCQlsZW4tLTsKCQkJaWYgKCFsZW4pCgkJCQl3YXJuaW5nKF8oImludmFsaWQgdmFsdWUgZm9yIHZhcmlhYmxlICVzIiksIHZhcik7CgkJfQoKCQlpZiAoIWxlbikKCQkJYnJlYWs7CgoJCWZvciAoc2l6ZV90IGkgPSAwOyBpIDwgQVJSQVlfU0laRShmc3luY19jb21wb25lbnRfbmFtZXMpOyArK2kpIHsKCQkJY29uc3Qgc3RydWN0IGZzeW5jX2NvbXBvbmVudF9uYW1lICpuID0gJmZzeW5jX2NvbXBvbmVudF9uYW1lc1tpXTsKCgkJCWlmIChzdHJuY21wKG4tPm5hbWUsIHN0cmluZywgbGVuKSkKCQkJCWNvbnRpbnVlOwoKCQkJZm91bmQgPSAxOwoJCQlpZiAobmVnYXRlZCkKCQkJCW5lZ2F0aXZlIHw9IG4tPmNvbXBvbmVudF9iaXRzOwoJCQllbHNlCgkJCQlwb3NpdGl2ZSB8PSBuLT5jb21wb25lbnRfYml0czsKCQl9CgoJCWlmICghZm91bmQpIHsKCQkJY2hhciAqY29tcG9uZW50ID0geHN0cm5kdXAoc3RyaW5nLCBsZW4pOwoJCQl3YXJuaW5nKF8oImlnbm9yaW5nIHVua25vd24gY29yZS5mc3luYyBjb21wb25lbnQgJyVzJyIpLCBjb21wb25lbnQpOwoJCQlmcmVlKGNvbXBvbmVudCk7CgkJfQoKbmV4dF9uYW1lOgoJCXN0cmluZyA9IGVwOwoJfQoKCXJldHVybiAoY3VycmVudCAmIH5uZWdhdGl2ZSkgfCBwb3NpdGl2ZTsKfQoKaW50IGdpdF9kZWZhdWx0X2NvcmVfY29uZmlnKGNvbnN0IGNoYXIgKnZhciwgY29uc3QgY2hhciAqdmFsdWUsCgkJCSAgICBjb25zdCBzdHJ1Y3QgY29uZmlnX2NvbnRleHQgKmN0eCwgdm9pZCAqY2IpCnsKCS8qIFRoaXMgbmVlZHMgYSBiZXR0ZXIgbmFtZSAqLwoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5maWxlbW9kZSIpKSB7CgkJdHJ1c3RfZXhlY3V0YWJsZV9iaXQgPSBnaXRfY29uZmlnX2Jvb2wodmFyLCB2YWx1ZSk7CgkJcmV0dXJuIDA7Cgl9CglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLnRydXN0Y3RpbWUiKSkgewoJCXRydXN0X2N0aW1lID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCXJldHVybiAwOwoJfQoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5jaGVja3N0YXQiKSkgewoJCWlmICghdmFsdWUpCgkJCXJldHVybiBjb25maWdfZXJyb3Jfbm9uYm9vbCh2YXIpOwoJCWlmICghc3RyY2FzZWNtcCh2YWx1ZSwgImRlZmF1bHQiKSkKCQkJY2hlY2tfc3RhdCA9IDE7CgkJZWxzZSBpZiAoIXN0cmNhc2VjbXAodmFsdWUsICJtaW5pbWFsIikpCgkJCWNoZWNrX3N0YXQgPSAwOwoJCWVsc2UKCQkJcmV0dXJuIGVycm9yKF8oImludmFsaWQgdmFsdWUgZm9yICclcyc6ICclcyciKSwKCQkJCSAgICAgdmFyLCB2YWx1ZSk7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5xdW90ZXBhdGgiKSkgewoJCXF1b3RlX3BhdGhfZnVsbHkgPSBnaXRfY29uZmlnX2Jvb2wodmFyLCB2YWx1ZSk7CgkJcmV0dXJuIDA7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5zeW1saW5rcyIpKSB7CgkJaGFzX3N5bWxpbmtzID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCXJldHVybiAwOwoJfQoKCWlmICghc3RyY21wKHZhciwgImNvcmUuaWdub3JlY2FzZSIpKSB7CgkJaWdub3JlX2Nhc2UgPSBnaXRfY29uZmlnX2Jvb2wodmFyLCB2YWx1ZSk7CgkJcmV0dXJuIDA7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5hdHRyaWJ1dGVzZmlsZSIpKSB7CgkJRlJFRV9BTkRfTlVMTChnaXRfYXR0cmlidXRlc19maWxlKTsKCQlyZXR1cm4gZ2l0X2NvbmZpZ19wYXRobmFtZSgmZ2l0X2F0dHJpYnV0ZXNfZmlsZSwgdmFyLCB2YWx1ZSk7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5iYXJlIikpIHsKCQlpc19iYXJlX3JlcG9zaXRvcnlfY2ZnID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCXJldHVybiAwOwoJfQoKCWlmICghc3RyY21wKHZhciwgImNvcmUuaWdub3Jlc3RhdCIpKSB7CgkJYXNzdW1lX3VuY2hhbmdlZCA9IGdpdF9jb25maWdfYm9vbCh2YXIsIHZhbHVlKTsKCQlyZXR1cm4gMDsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLmFiYnJldiIpKSB7CgkJaWYgKCF2YWx1ZSkKCQkJcmV0dXJuIGNvbmZpZ19lcnJvcl9ub25ib29sKHZhcik7CgkJaWYgKCFzdHJjYXNlY21wKHZhbHVlLCAiYXV0byIpKQoJCQlkZWZhdWx0X2FiYnJldiA9IC0xOwoJCWVsc2UgaWYgKCFnaXRfcGFyc2VfbWF5YmVfYm9vbF90ZXh0KHZhbHVlKSkKCQkJZGVmYXVsdF9hYmJyZXYgPSBHSVRfTUFYX0hFWFNaOwoJCWVsc2UgewoJCQlpbnQgYWJicmV2ID0gZ2l0X2NvbmZpZ19pbnQodmFyLCB2YWx1ZSwgY3R4LT5rdmkpOwoJCQlpZiAoYWJicmV2IDwgbWluaW11bV9hYmJyZXYpCgkJCQlyZXR1cm4gZXJyb3IoXygiYWJicmV2IGxlbmd0aCBvdXQgb2YgcmFuZ2U6ICVkIiksIGFiYnJldik7CgkJCWRlZmF1bHRfYWJicmV2ID0gYWJicmV2OwoJCX0KCQlyZXR1cm4gMDsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLmRpc2FtYmlndWF0ZSIpKQoJCXJldHVybiBzZXRfZGlzYW1iaWd1YXRlX2hpbnRfY29uZmlnKHZhciwgdmFsdWUpOwoKCWlmICghc3RyY21wKHZhciwgImNvcmUubG9vc2Vjb21wcmVzc2lvbiIpKSB7CgkJaW50IGxldmVsID0gZ2l0X2NvbmZpZ19pbnQodmFyLCB2YWx1ZSwgY3R4LT5rdmkpOwoJCWlmIChsZXZlbCA9PSAtMSkKCQkJbGV2ZWwgPSBaX0RFRkFVTFRfQ09NUFJFU1NJT047CgkJZWxzZSBpZiAobGV2ZWwgPCAwIHx8IGxldmVsID4gWl9CRVNUX0NPTVBSRVNTSU9OKQoJCQlkaWUoXygiYmFkIHpsaWIgY29tcHJlc3Npb24gbGV2ZWwgJWQiKSwgbGV2ZWwpOwoJCXpsaWJfY29tcHJlc3Npb25fbGV2ZWwgPSBsZXZlbDsKCQl6bGliX2NvbXByZXNzaW9uX3NlZW4gPSAxOwoJCXJldHVybiAwOwoJfQoKCWlmICghc3RyY21wKHZhciwgImNvcmUuY29tcHJlc3Npb24iKSkgewoJCWludCBsZXZlbCA9IGdpdF9jb25maWdfaW50KHZhciwgdmFsdWUsIGN0eC0+a3ZpKTsKCQlpZiAobGV2ZWwgPT0gLTEpCgkJCWxldmVsID0gWl9ERUZBVUxUX0NPTVBSRVNTSU9OOwoJCWVsc2UgaWYgKGxldmVsIDwgMCB8fCBsZXZlbCA+IFpfQkVTVF9DT01QUkVTU0lPTikKCQkJZGllKF8oImJhZCB6bGliIGNvbXByZXNzaW9uIGxldmVsICVkIiksIGxldmVsKTsKCQlpZiAoIXpsaWJfY29tcHJlc3Npb25fc2VlbikKCQkJemxpYl9jb21wcmVzc2lvbl9sZXZlbCA9IGxldmVsOwoJCWlmICghcGFja19jb21wcmVzc2lvbl9zZWVuKQoJCQlwYWNrX2NvbXByZXNzaW9uX2xldmVsID0gbGV2ZWw7CgkJcmV0dXJuIDA7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5hdXRvY3JsZiIpKSB7CgkJaWYgKHZhbHVlICYmICFzdHJjYXNlY21wKHZhbHVlLCAiaW5wdXQiKSkgewoJCQlhdXRvX2NybGYgPSBBVVRPX0NSTEZfSU5QVVQ7CgkJCXJldHVybiAwOwoJCX0KCQlhdXRvX2NybGYgPSBnaXRfY29uZmlnX2Jvb2wodmFyLCB2YWx1ZSk7CgkJcmV0dXJuIDA7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5zYWZlY3JsZiIpKSB7CgkJaW50IGVvbF9ybmR0cnBfZGllOwoJCWlmICh2YWx1ZSAmJiAhc3RyY2FzZWNtcCh2YWx1ZSwgIndhcm4iKSkgewoJCQlnbG9iYWxfY29udl9mbGFnc19lb2wgPSBDT05WX0VPTF9STkRUUlBfV0FSTjsKCQkJcmV0dXJuIDA7CgkJfQoJCWVvbF9ybmR0cnBfZGllID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCWdsb2JhbF9jb252X2ZsYWdzX2VvbCA9IGVvbF9ybmR0cnBfZGllID8KCQkJQ09OVl9FT0xfUk5EVFJQX0RJRSA6IDA7CgkJcmV0dXJuIDA7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5lb2wiKSkgewoJCWlmICh2YWx1ZSAmJiAhc3RyY2FzZWNtcCh2YWx1ZSwgImxmIikpCgkJCWNvcmVfZW9sID0gRU9MX0xGOwoJCWVsc2UgaWYgKHZhbHVlICYmICFzdHJjYXNlY21wKHZhbHVlLCAiY3JsZiIpKQoJCQljb3JlX2VvbCA9IEVPTF9DUkxGOwoJCWVsc2UgaWYgKHZhbHVlICYmICFzdHJjYXNlY21wKHZhbHVlLCAibmF0aXZlIikpCgkJCWNvcmVfZW9sID0gRU9MX05BVElWRTsKCQllbHNlCgkJCWNvcmVfZW9sID0gRU9MX1VOU0VUOwoJCXJldHVybiAwOwoJfQoKCWlmICghc3RyY21wKHZhciwgImNvcmUuY2hlY2tyb3VuZHRyaXBlbmNvZGluZyIpKSB7CgkJRlJFRV9BTkRfTlVMTChjaGVja19yb3VuZHRyaXBfZW5jb2RpbmcpOwoJCXJldHVybiBnaXRfY29uZmlnX3N0cmluZygmY2hlY2tfcm91bmR0cmlwX2VuY29kaW5nLCB2YXIsIHZhbHVlKTsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLmVkaXRvciIpKSB7CgkJRlJFRV9BTkRfTlVMTChlZGl0b3JfcHJvZ3JhbSk7CgkJcmV0dXJuIGdpdF9jb25maWdfc3RyaW5nKCZlZGl0b3JfcHJvZ3JhbSwgdmFyLCB2YWx1ZSk7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5jb21tZW50Y2hhciIpIHx8CgkgICAgIXN0cmNtcCh2YXIsICJjb3JlLmNvbW1lbnRzdHJpbmciKSkgewoJCWlmICghdmFsdWUpIHsKCQkJcmV0dXJuIGNvbmZpZ19lcnJvcl9ub25ib29sKHZhcik7CiNpZm5kZWYgV0lUSF9CUkVBS0lOR19DSEFOR0VTCgkJfSBlbHNlIGlmICghc3RyY2FzZWNtcCh2YWx1ZSwgImF1dG8iKSkgewoJCQlhdXRvX2NvbW1lbnRfbGluZV9jaGFyID0gMTsKCQkJRlJFRV9BTkRfTlVMTChjb21tZW50X2xpbmVfc3RyX3RvX2ZyZWUpOwoJCQljb21tZW50X2xpbmVfc3RyID0gIiMiOwojZW5kaWYgLyogIVdJVEhfQlJFQUtJTkdfQ0hBTkdFUyAqLwoJCX0gZWxzZSBpZiAodmFsdWVbMF0pIHsKCQkJaWYgKHN0cmNocih2YWx1ZSwgJ1xuJykpCgkJCQlyZXR1cm4gZXJyb3IoXygiJXMgY2Fubm90IGNvbnRhaW4gbmV3bGluZSIpLCB2YXIpOwoJCQljb21tZW50X2xpbmVfc3RyID0gdmFsdWU7CgkJCUZSRUVfQU5EX05VTEwoY29tbWVudF9saW5lX3N0cl90b19mcmVlKTsKI2lmbmRlZiBXSVRIX0JSRUFLSU5HX0NIQU5HRVMKCQkJYXV0b19jb21tZW50X2xpbmVfY2hhciA9IDA7CiNlbmRpZiAvKiAhV0lUSF9CUkVBS0lOR19DSEFOR0VTICovCgkJfSBlbHNlCgkJCXJldHVybiBlcnJvcihfKCIlcyBtdXN0IGhhdmUgYXQgbGVhc3Qgb25lIGNoYXJhY3RlciIpLCB2YXIpOwoJCXJldHVybiAwOwoJfQoKCWlmICghc3RyY21wKHZhciwgImNvcmUuYXNrcGFzcyIpKSB7CgkJRlJFRV9BTkRfTlVMTChhc2twYXNzX3Byb2dyYW0pOwoJCXJldHVybiBnaXRfY29uZmlnX3N0cmluZygmYXNrcGFzc19wcm9ncmFtLCB2YXIsIHZhbHVlKTsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLmV4Y2x1ZGVzZmlsZSIpKSB7CgkJRlJFRV9BTkRfTlVMTChleGNsdWRlc19maWxlKTsKCQlyZXR1cm4gZ2l0X2NvbmZpZ19wYXRobmFtZSgmZXhjbHVkZXNfZmlsZSwgdmFyLCB2YWx1ZSk7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS53aGl0ZXNwYWNlIikpIHsKCQlpZiAoIXZhbHVlKQoJCQlyZXR1cm4gY29uZmlnX2Vycm9yX25vbmJvb2wodmFyKTsKCQl3aGl0ZXNwYWNlX3J1bGVfY2ZnID0gcGFyc2Vfd2hpdGVzcGFjZV9ydWxlKHZhbHVlKTsKCQlyZXR1cm4gMDsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLmZzeW5jIikpIHsKCQlpZiAoIXZhbHVlKQoJCQlyZXR1cm4gY29uZmlnX2Vycm9yX25vbmJvb2wodmFyKTsKCQlmc3luY19jb21wb25lbnRzID0gcGFyc2VfZnN5bmNfY29tcG9uZW50cyh2YXIsIHZhbHVlKTsKCQlyZXR1cm4gMDsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLmZzeW5jbWV0aG9kIikpIHsKCQlpZiAoIXZhbHVlKQoJCQlyZXR1cm4gY29uZmlnX2Vycm9yX25vbmJvb2wodmFyKTsKCQlpZiAoIXN0cmNtcCh2YWx1ZSwgImZzeW5jIikpCgkJCWZzeW5jX21ldGhvZCA9IEZTWU5DX01FVEhPRF9GU1lOQzsKCQllbHNlIGlmICghc3RyY21wKHZhbHVlLCAid3JpdGVvdXQtb25seSIpKQoJCQlmc3luY19tZXRob2QgPSBGU1lOQ19NRVRIT0RfV1JJVEVPVVRfT05MWTsKCQllbHNlIGlmICghc3RyY21wKHZhbHVlLCAiYmF0Y2giKSkKCQkJZnN5bmNfbWV0aG9kID0gRlNZTkNfTUVUSE9EX0JBVENIOwoJCWVsc2UKCQkJd2FybmluZyhfKCJpZ25vcmluZyB1bmtub3duIGNvcmUuZnN5bmNNZXRob2QgdmFsdWUgJyVzJyIpLCB2YWx1ZSk7CgoJfQoKCWlmICghc3RyY21wKHZhciwgImNvcmUuZnN5bmNvYmplY3RmaWxlcyIpKSB7CgkJaWYgKGZzeW5jX29iamVjdF9maWxlcyA8IDApCgkJCXdhcm5pbmcoXygiY29yZS5mc3luY09iamVjdEZpbGVzIGlzIGRlcHJlY2F0ZWQ7IHVzZSBjb3JlLmZzeW5jIGluc3RlYWQiKSk7CgkJZnN5bmNfb2JqZWN0X2ZpbGVzID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCXJldHVybiAwOwoJfQoKCWlmICghc3RyY21wKHZhciwgImNvcmUubG9ja2ZpbGVwaWQiKSkgewoJCWxvY2tmaWxlX3BpZF9lbmFibGVkID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCXJldHVybiAwOwoJfQoKCWlmICghc3RyY21wKHZhciwgImNvcmUuY3JlYXRlb2JqZWN0IikpIHsKCQlpZiAoIXZhbHVlKQoJCQlyZXR1cm4gY29uZmlnX2Vycm9yX25vbmJvb2wodmFyKTsKCQlpZiAoIXN0cmNtcCh2YWx1ZSwgInJlbmFtZSIpKQoJCQlvYmplY3RfY3JlYXRpb25fbW9kZSA9IE9CSkVDVF9DUkVBVElPTl9VU0VTX1JFTkFNRVM7CgkJZWxzZSBpZiAoIXN0cmNtcCh2YWx1ZSwgImxpbmsiKSkKCQkJb2JqZWN0X2NyZWF0aW9uX21vZGUgPSBPQkpFQ1RfQ1JFQVRJT05fVVNFU19IQVJETElOS1M7CgkJZWxzZQoJCQlkaWUoXygiaW52YWxpZCBtb2RlIGZvciBvYmplY3QgY3JlYXRpb246ICVzIiksIHZhbHVlKTsKCQlyZXR1cm4gMDsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLnNwYXJzZWNoZWNrb3V0IikpIHsKCQljb3JlX2FwcGx5X3NwYXJzZV9jaGVja291dCA9IGdpdF9jb25maWdfYm9vbCh2YXIsIHZhbHVlKTsKCQlyZXR1cm4gMDsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLnNwYXJzZWNoZWNrb3V0Y29uZSIpKSB7CgkJY29yZV9zcGFyc2VfY2hlY2tvdXRfY29uZSA9IGdpdF9jb25maWdfYm9vbCh2YXIsIHZhbHVlKTsKCQlyZXR1cm4gMDsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJjb3JlLnByZWNvbXBvc2V1bmljb2RlIikpIHsKCQlwcmVjb21wb3NlZF91bmljb2RlID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCXJldHVybiAwOwoJfQoKCWlmICghc3RyY21wKHZhciwgImNvcmUucHJvdGVjdGhmcyIpKSB7CgkJcHJvdGVjdF9oZnMgPSBnaXRfY29uZmlnX2Jvb2wodmFyLCB2YWx1ZSk7CgkJcmV0dXJuIDA7Cgl9CgoJaWYgKCFzdHJjbXAodmFyLCAiY29yZS5wcm90ZWN0bnRmcyIpKSB7CgkJcHJvdGVjdF9udGZzID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCXJldHVybiAwOwoJfQoKCS8qIEFkZCBvdGhlciBjb25maWcgdmFyaWFibGVzIGhlcmUgYW5kIHRvIERvY3VtZW50YXRpb24vY29uZmlnLmFkb2MuICovCglyZXR1cm4gcGxhdGZvcm1fY29yZV9jb25maWcodmFyLCB2YWx1ZSwgY3R4LCBjYik7Cn0KCnN0YXRpYyBpbnQgZ2l0X2RlZmF1bHRfc3BhcnNlX2NvbmZpZyhjb25zdCBjaGFyICp2YXIsIGNvbnN0IGNoYXIgKnZhbHVlKQp7CglpZiAoIXN0cmNtcCh2YXIsICJzcGFyc2UuZXhwZWN0ZmlsZXNvdXRzaWRlb2ZwYXR0ZXJucyIpKSB7CgkJc3BhcnNlX2V4cGVjdF9maWxlc19vdXRzaWRlX29mX3BhdHRlcm5zID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCXJldHVybiAwOwoJfQoKCS8qIEFkZCBvdGhlciBjb25maWcgdmFyaWFibGVzIGhlcmUgYW5kIHRvIERvY3VtZW50YXRpb24vY29uZmlnL3NwYXJzZS5hZG9jLiAqLwoJcmV0dXJuIDA7Cn0KCnN0YXRpYyBpbnQgZ2l0X2RlZmF1bHRfaTE4bl9jb25maWcoY29uc3QgY2hhciAqdmFyLCBjb25zdCBjaGFyICp2YWx1ZSkKewoJaWYgKCFzdHJjbXAodmFyLCAiaTE4bi5jb21taXRlbmNvZGluZyIpKSB7CgkJRlJFRV9BTkRfTlVMTChnaXRfY29tbWl0X2VuY29kaW5nKTsKCQlyZXR1cm4gZ2l0X2NvbmZpZ19zdHJpbmcoJmdpdF9jb21taXRfZW5jb2RpbmcsIHZhciwgdmFsdWUpOwoJfQoKCWlmICghc3RyY21wKHZhciwgImkxOG4ubG9nb3V0cHV0ZW5jb2RpbmciKSkgewoJCUZSRUVfQU5EX05VTEwoZ2l0X2xvZ19vdXRwdXRfZW5jb2RpbmcpOwoJCXJldHVybiBnaXRfY29uZmlnX3N0cmluZygmZ2l0X2xvZ19vdXRwdXRfZW5jb2RpbmcsIHZhciwgdmFsdWUpOwoJfQoKCS8qIEFkZCBvdGhlciBjb25maWcgdmFyaWFibGVzIGhlcmUgYW5kIHRvIERvY3VtZW50YXRpb24vY29uZmlnLmFkb2MuICovCglyZXR1cm4gMDsKfQoKc3RhdGljIGludCBnaXRfZGVmYXVsdF9icmFuY2hfY29uZmlnKGNvbnN0IGNoYXIgKnZhciwgY29uc3QgY2hhciAqdmFsdWUpCnsKCWlmICghc3RyY21wKHZhciwgImJyYW5jaC5hdXRvc2V0dXBtZXJnZSIpKSB7CgkJaWYgKHZhbHVlICYmICFzdHJjbXAodmFsdWUsICJhbHdheXMiKSkgewoJCQlnaXRfYnJhbmNoX3RyYWNrID0gQlJBTkNIX1RSQUNLX0FMV0FZUzsKCQkJcmV0dXJuIDA7CgkJfSBlbHNlIGlmICh2YWx1ZSAmJiAhc3RyY21wKHZhbHVlLCAiaW5oZXJpdCIpKSB7CgkJCWdpdF9icmFuY2hfdHJhY2sgPSBCUkFOQ0hfVFJBQ0tfSU5IRVJJVDsKCQkJcmV0dXJuIDA7CgkJfSBlbHNlIGlmICh2YWx1ZSAmJiAhc3RyY21wKHZhbHVlLCAic2ltcGxlIikpIHsKCQkJZ2l0X2JyYW5jaF90cmFjayA9IEJSQU5DSF9UUkFDS19TSU1QTEU7CgkJCXJldHVybiAwOwoJCX0KCQlnaXRfYnJhbmNoX3RyYWNrID0gZ2l0X2NvbmZpZ19ib29sKHZhciwgdmFsdWUpOwoJCXJldHVybiAwOwoJfQoJaWYgKCFzdHJjbXAodmFyLCAiYnJhbmNoLmF1dG9zZXR1cHJlYmFzZSIpKSB7CgkJaWYgKCF2YWx1ZSkKCQkJcmV0dXJuIGNvbmZpZ19lcnJvcl9ub25ib29sKHZhcik7CgkJZWxzZSBpZiAoIXN0cmNtcCh2YWx1ZSwgIm5ldmVyIikpCgkJCWF1dG9yZWJhc2UgPSBBVVRPUkVCQVNFX05FVkVSOwoJCWVsc2UgaWYgKCFzdHJjbXAodmFsdWUsICJsb2NhbCIpKQoJCQlhdXRvcmViYXNlID0gQVVUT1JFQkFTRV9MT0NBTDsKCQllbHNlIGlmICghc3RyY21wKHZhbHVlLCAicmVtb3RlIikpCgkJCWF1dG9yZWJhc2UgPSBBVVRPUkVCQVNFX1JFTU9URTsKCQllbHNlIGlmICghc3RyY21wKHZhbHVlLCAiYWx3YXlzIikpCgkJCWF1dG9yZWJhc2UgPSBBVVRPUkVCQVNFX0FMV0FZUzsKCQllbHNlCgkJCXJldHVybiBlcnJvcihfKCJtYWxmb3JtZWQgdmFsdWUgZm9yICVzIiksIHZhcik7CgkJcmV0dXJuIDA7Cgl9CgoJLyogQWRkIG90aGVyIGNvbmZpZyB2YXJpYWJsZXMgaGVyZSBhbmQgdG8gRG9jdW1lbnRhdGlvbi9jb25maWcuYWRvYy4gKi8KCXJldHVybiAwOwp9CgpzdGF0aWMgaW50IGdpdF9kZWZhdWx0X3B1c2hfY29uZmlnKGNvbnN0IGNoYXIgKnZhciwgY29uc3QgY2hhciAqdmFsdWUpCnsKCWlmICghc3RyY21wKHZhciwgInB1c2guZGVmYXVsdCIpKSB7CgkJaWYgKCF2YWx1ZSkKCQkJcmV0dXJuIGNvbmZpZ19lcnJvcl9ub25ib29sKHZhcik7CgkJZWxzZSBpZiAoIXN0cmNtcCh2YWx1ZSwgIm5vdGhpbmciKSkKCQkJcHVzaF9kZWZhdWx0ID0gUFVTSF9ERUZBVUxUX05PVEhJTkc7CgkJZWxzZSBpZiAoIXN0cmNtcCh2YWx1ZSwgIm1hdGNoaW5nIikpCgkJCXB1c2hfZGVmYXVsdCA9IFBVU0hfREVGQVVMVF9NQVRDSElORzsKCQllbHNlIGlmICghc3RyY21wKHZhbHVlLCAic2ltcGxlIikpCgkJCXB1c2hfZGVmYXVsdCA9IFBVU0hfREVGQVVMVF9TSU1QTEU7CgkJZWxzZSBpZiAoIXN0cmNtcCh2YWx1ZSwgInVwc3RyZWFtIikpCgkJCXB1c2hfZGVmYXVsdCA9IFBVU0hfREVGQVVMVF9VUFNUUkVBTTsKCQllbHNlIGlmICghc3RyY21wKHZhbHVlLCAidHJhY2tpbmciKSkgLyogZGVwcmVjYXRlZCAqLwoJCQlwdXNoX2RlZmF1bHQgPSBQVVNIX0RFRkFVTFRfVVBTVFJFQU07CgkJZWxzZSBpZiAoIXN0cmNtcCh2YWx1ZSwgImN1cnJlbnQiKSkKCQkJcHVzaF9kZWZhdWx0ID0gUFVTSF9ERUZBVUxUX0NVUlJFTlQ7CgkJZWxzZSB7CgkJCWVycm9yKF8oIm1hbGZvcm1lZCB2YWx1ZSBmb3IgJXM6ICVzIiksIHZhciwgdmFsdWUpOwoJCQlyZXR1cm4gZXJyb3IoXygibXVzdCBiZSBvbmUgb2Ygbm90aGluZywgbWF0Y2hpbmcsIHNpbXBsZSwgIgoJCQkJICAgICAgICJ1cHN0cmVhbSBvciBjdXJyZW50IikpOwoJCX0KCQlyZXR1cm4gMDsKCX0KCgkvKiBBZGQgb3RoZXIgY29uZmlnIHZhcmlhYmxlcyBoZXJlIGFuZCB0byBEb2N1bWVudGF0aW9uL2NvbmZpZy5hZG9jLiAqLwoJcmV0dXJuIDA7Cn0KCnN0YXRpYyBpbnQgZ2l0X2RlZmF1bHRfbWFpbG1hcF9jb25maWcoY29uc3QgY2hhciAqdmFyLCBjb25zdCBjaGFyICp2YWx1ZSkKewoJaWYgKCFzdHJjbXAodmFyLCAibWFpbG1hcC5maWxlIikpIHsKCQlGUkVFX0FORF9OVUxMKGdpdF9tYWlsbWFwX2ZpbGUpOwoJCXJldHVybiBnaXRfY29uZmlnX3BhdGhuYW1lKCZnaXRfbWFpbG1hcF9maWxlLCB2YXIsIHZhbHVlKTsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJtYWlsbWFwLmJsb2IiKSkgewoJCUZSRUVfQU5EX05VTEwoZ2l0X21haWxtYXBfYmxvYik7CgkJcmV0dXJuIGdpdF9jb25maWdfc3RyaW5nKCZnaXRfbWFpbG1hcF9ibG9iLCB2YXIsIHZhbHVlKTsKCX0KCgkvKiBBZGQgb3RoZXIgY29uZmlnIHZhcmlhYmxlcyBoZXJlIGFuZCB0byBEb2N1bWVudGF0aW9uL2NvbmZpZy5hZG9jLiAqLwoJcmV0dXJuIDA7Cn0KCnN0YXRpYyBpbnQgZ2l0X2RlZmF1bHRfYXR0cl9jb25maWcoY29uc3QgY2hhciAqdmFyLCBjb25zdCBjaGFyICp2YWx1ZSkKewoJaWYgKCFzdHJjbXAodmFyLCAiYXR0ci50cmVlIikpIHsKCQlGUkVFX0FORF9OVUxMKGdpdF9hdHRyX3RyZWUpOwoJCXJldHVybiBnaXRfY29uZmlnX3N0cmluZygmZ2l0X2F0dHJfdHJlZSwgdmFyLCB2YWx1ZSk7Cgl9CgoJLyoKCSAqIEFkZCBvdGhlciBhdHRyaWJ1dGUgcmVsYXRlZCBjb25maWcgdmFyaWFibGVzIGhlcmUgYW5kIHRvCgkgKiBEb2N1bWVudGF0aW9uL2NvbmZpZy9hdHRyLmFkb2MuCgkgKi8KCXJldHVybiAwOwp9CgppbnQgZ2l0X2RlZmF1bHRfY29uZmlnKGNvbnN0IGNoYXIgKnZhciwgY29uc3QgY2hhciAqdmFsdWUsCgkJICAgICAgIGNvbnN0IHN0cnVjdCBjb25maWdfY29udGV4dCAqY3R4LCB2b2lkICpjYikKewoJaWYgKHN0YXJ0c193aXRoKHZhciwgImNvcmUuIikpCgkJcmV0dXJuIGdpdF9kZWZhdWx0X2NvcmVfY29uZmlnKHZhciwgdmFsdWUsIGN0eCwgY2IpOwoKCWlmIChzdGFydHNfd2l0aCh2YXIsICJ1c2VyLiIpIHx8CgkgICAgc3RhcnRzX3dpdGgodmFyLCAiYXV0aG9yLiIpIHx8CgkgICAgc3RhcnRzX3dpdGgodmFyLCAiY29tbWl0dGVyLiIpKQoJCXJldHVybiBnaXRfaWRlbnRfY29uZmlnKHZhciwgdmFsdWUsIGN0eCwgY2IpOwoKCWlmIChzdGFydHNfd2l0aCh2YXIsICJpMThuLiIpKQoJCXJldHVybiBnaXRfZGVmYXVsdF9pMThuX2NvbmZpZyh2YXIsIHZhbHVlKTsKCglpZiAoc3RhcnRzX3dpdGgodmFyLCAiYnJhbmNoLiIpKQoJCXJldHVybiBnaXRfZGVmYXVsdF9icmFuY2hfY29uZmlnKHZhciwgdmFsdWUpOwoKCWlmIChzdGFydHNfd2l0aCh2YXIsICJwdXNoLiIpKQoJCXJldHVybiBnaXRfZGVmYXVsdF9wdXNoX2NvbmZpZyh2YXIsIHZhbHVlKTsKCglpZiAoc3RhcnRzX3dpdGgodmFyLCAibWFpbG1hcC4iKSkKCQlyZXR1cm4gZ2l0X2RlZmF1bHRfbWFpbG1hcF9jb25maWcodmFyLCB2YWx1ZSk7CgoJaWYgKHN0YXJ0c193aXRoKHZhciwgImF0dHIuIikpCgkJcmV0dXJuIGdpdF9kZWZhdWx0X2F0dHJfY29uZmlnKHZhciwgdmFsdWUpOwoKCWlmIChzdGFydHNfd2l0aCh2YXIsICJhZHZpY2UuIikgfHwgc3RhcnRzX3dpdGgodmFyLCAiY29sb3IuYWR2aWNlIikpCgkJcmV0dXJuIGdpdF9kZWZhdWx0X2FkdmljZV9jb25maWcodmFyLCB2YWx1ZSk7CgoJaWYgKCFzdHJjbXAodmFyLCAicGFnZXIuY29sb3IiKSB8fCAhc3RyY21wKHZhciwgImNvbG9yLnBhZ2VyIikpIHsKCQlwYWdlcl91c2VfY29sb3IgPSBnaXRfY29uZmlnX2Jvb2wodmFyLHZhbHVlKTsKCQlyZXR1cm4gMDsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJwYWNrLnBhY2tzaXplbGltaXQiKSkgewoJCXBhY2tfc2l6ZV9saW1pdF9jZmcgPSBnaXRfY29uZmlnX3Vsb25nKHZhciwgdmFsdWUsIGN0eC0+a3ZpKTsKCQlyZXR1cm4gMDsKCX0KCglpZiAoIXN0cmNtcCh2YXIsICJwYWNrLmNvbXByZXNzaW9uIikpIHsKCQlpbnQgbGV2ZWwgPSBnaXRfY29uZmlnX2ludCh2YXIsIHZhbHVlLCBjdHgtPmt2aSk7CgkJaWYgKGxldmVsID09IC0xKQoJCQlsZXZlbCA9IFpfREVGQVVMVF9DT01QUkVTU0lPTjsKCQllbHNlIGlmIChsZXZlbCA8IDAgfHwgbGV2ZWwgPiBaX0JFU1RfQ09NUFJFU1NJT04pCgkJCWRpZShfKCJiYWQgcGFjayBjb21wcmVzc2lvbiBsZXZlbCAlZCIpLCBsZXZlbCk7CgkJcGFja19jb21wcmVzc2lvbl9sZXZlbCA9IGxldmVsOwoJCXBhY2tfY29tcHJlc3Npb25fc2VlbiA9IDE7CgkJcmV0dXJuIDA7Cgl9CgoJaWYgKHN0YXJ0c193aXRoKHZhciwgInNwYXJzZS4iKSkKCQlyZXR1cm4gZ2l0X2RlZmF1bHRfc3BhcnNlX2NvbmZpZyh2YXIsIHZhbHVlKTsKCgkvKiBBZGQgb3RoZXIgY29uZmlnIHZhcmlhYmxlcyBoZXJlIGFuZCB0byBEb2N1bWVudGF0aW9uL2NvbmZpZy5hZG9jLiAqLwoJcmV0dXJuIDA7Cn0K",
    "text": "/*\n * We put all the git config variables in this same object\n * file, so that programs can link against the config parser\n * without having to link against all the rest of git.\n *\n * In particular, no need to bring in libz etc unless needed,\n * even if you might want to know where the git directory etc\n * are.\n */\n\n#define USE_THE_REPOSITORY_VARIABLE\n\n#include \"git-compat-util.h\"\n#include \"abspath.h\"\n#include \"advice.h\"\n#include \"attr.h\"\n#include \"branch.h\"\n#include \"color.h\"\n#include \"convert.h\"\n#include \"environment.h\"\n#include \"gettext.h\"\n#include \"git-zlib.h\"\n#include \"ident.h\"\n#include \"lockfile.h\"\n#include \"mailmap.h\"\n#include \"object-name.h\"\n#include \"repository.h\"\n#include \"config.h\"\n#include \"refs.h\"\n#include \"fmt-merge-msg.h\"\n#include \"commit.h\"\n#include \"strvec.h\"\n#include \"pager.h\"\n#include \"path.h\"\n#include \"quote.h\"\n#include \"chdir-notify.h\"\n#include \"setup.h\"\n#include \"ws.h\"\n#include \"write-or-die.h\"\n\nstatic int pack_compression_seen;\nstatic int zlib_compression_seen;\n\nint trust_executable_bit = 1;\nint trust_ctime = 1;\nint check_stat = 1;\nint has_symlinks = 1;\nint minimum_abbrev = 4, default_abbrev = -1;\nint ignore_case;\nint assume_unchanged;\nint is_bare_repository_cfg = -1; /* unspecified */\nint warn_on_object_refname_ambiguity = 1;\nchar *git_commit_encoding;\nchar *git_log_output_encoding;\nchar *apply_default_whitespace;\nchar *apply_default_ignorewhitespace;\nchar *git_attributes_file;\nint zlib_compression_level = Z_BEST_SPEED;\nint pack_compression_level = Z_DEFAULT_COMPRESSION;\nint fsync_object_files = -1;\nint use_fsync = -1;\nenum fsync_method fsync_method = FSYNC_METHOD_DEFAULT;\nenum fsync_component fsync_components = FSYNC_COMPONENTS_DEFAULT;\nchar *editor_program;\nchar *askpass_program;\nchar *excludes_file;\nenum auto_crlf auto_crlf = AUTO_CRLF_FALSE;\nenum eol core_eol = EOL_UNSET;\nint global_conv_flags_eol = CONV_EOL_RNDTRP_WARN;\nchar *check_roundtrip_encoding;\nenum branch_track git_branch_track = BRANCH_TRACK_REMOTE;\nenum rebase_setup_type autorebase = AUTOREBASE_NEVER;\nenum push_default_type push_default = PUSH_DEFAULT_UNSPECIFIED;\n#ifndef OBJECT_CREATION_MODE\n#define OBJECT_CREATION_MODE OBJECT_CREATION_USES_HARDLINKS\n#endif\nenum object_creation_mode object_creation_mode = OBJECT_CREATION_MODE;\nint grafts_keep_true_parents;\nint core_apply_sparse_checkout;\nint core_sparse_checkout_cone;\nint sparse_expect_files_outside_of_patterns;\nint precomposed_unicode = -1; /* see probe_utf8_pathname_composition() */\nunsigned long pack_size_limit_cfg;\n\n#ifndef PROTECT_HFS_DEFAULT\n#define PROTECT_HFS_DEFAULT 0\n#endif\nint protect_hfs = PROTECT_HFS_DEFAULT;\n\n#ifndef PROTECT_NTFS_DEFAULT\n#define PROTECT_NTFS_DEFAULT 1\n#endif\nint protect_ntfs = PROTECT_NTFS_DEFAULT;\n\n/*\n * The character that begins a commented line in user-editable file\n * that is subject to stripspace.\n */\nconst char *comment_line_str = \"#\";\nchar *comment_line_str_to_free;\n#ifndef WITH_BREAKING_CHANGES\nint auto_comment_line_char;\nbool warn_on_auto_comment_char;\n#endif /* !WITH_BREAKING_CHANGES */\n\n/* This is set by setup_git_directory_gently() and/or git_default_config() */\nchar *git_work_tree_cfg;\n\n/*\n * Repository-local GIT_* environment variables; see environment.h for details.\n */\nconst char * const local_repo_env[] = {\n\tALTERNATE_DB_ENVIRONMENT,\n\tCONFIG_ENVIRONMENT,\n\tCONFIG_DATA_ENVIRONMENT,\n\tCONFIG_COUNT_ENVIRONMENT,\n\tDB_ENVIRONMENT,\n\tGIT_DIR_ENVIRONMENT,\n\tGIT_WORK_TREE_ENVIRONMENT,\n\tGIT_IMPLICIT_WORK_TREE_ENVIRONMENT,\n\tGRAFT_ENVIRONMENT,\n\tINDEX_ENVIRONMENT,\n\tNO_REPLACE_OBJECTS_ENVIRONMENT,\n\tGIT_REPLACE_REF_BASE_ENVIRONMENT,\n\tGIT_PREFIX_ENVIRONMENT,\n\tGIT_SHALLOW_FILE_ENVIRONMENT,\n\tGIT_COMMON_DIR_ENVIRONMENT,\n\tNULL\n};\n\nconst char *getenv_safe(struct strvec *argv, const char *name)\n{\n\tconst char *value = getenv(name);\n\n\tif (!value)\n\t\treturn NULL;\n\n\tstrvec_push(argv, value);\n\treturn argv->v[argv->nr - 1];\n}\n\nint is_bare_repository(void)\n{\n\t/* if core.bare is not 'false', let's see if there is a work tree */\n\treturn is_bare_repository_cfg && !repo_get_work_tree(the_repository);\n}\n\nint have_git_dir(void)\n{\n\treturn startup_info->have_repository\n\t\t|| the_repository->gitdir;\n}\n\nconst char *get_git_namespace(void)\n{\n\tstatic const char *namespace;\n\tstruct strbuf buf = STRBUF_INIT;\n\tconst char *raw_namespace;\n\tstruct string_list components = STRING_LIST_INIT_DUP;\n\tstruct string_list_item *item;\n\n\tif (namespace)\n\t\treturn namespace;\n\n\traw_namespace = getenv(GIT_NAMESPACE_ENVIRONMENT);\n\tif (!raw_namespace || !*raw_namespace) {\n\t\tnamespace = \"\";\n\t\treturn namespace;\n\t}\n\n\tstrbuf_addstr(&buf, raw_namespace);\n\n\tstring_list_split(&components, buf.buf, \"/\", -1);\n\tstrbuf_reset(&buf);\n\n\tfor_each_string_list_item(item, &components) {\n\t\tif (item->string[0])\n\t\t\tstrbuf_addf(&buf, \"refs/namespaces/%s/\", item->string);\n\t}\n\tstring_list_clear(&components, 0);\n\n\tstrbuf_trim_trailing_dir_sep(&buf);\n\tif (check_refname_format(buf.buf, 0))\n\t\tdie(_(\"bad git namespace path \\\"%s\\\"\"), raw_namespace);\n\tstrbuf_addch(&buf, '/');\n\n\tnamespace = strbuf_detach(&buf, NULL);\n\n\treturn namespace;\n}\n\nconst char *strip_namespace(const char *namespaced_ref)\n{\n\tconst char *out;\n\tif (skip_prefix(namespaced_ref, get_git_namespace(), &out))\n\t\treturn out;\n\treturn NULL;\n}\n\nconst char *get_log_output_encoding(void)\n{\n\treturn git_log_output_encoding ? git_log_output_encoding\n\t\t: get_commit_output_encoding();\n}\n\nconst char *get_commit_output_encoding(void)\n{\n\treturn git_commit_encoding ? git_commit_encoding : \"UTF-8\";\n}\n\nint use_optional_locks(void)\n{\n\treturn git_env_bool(GIT_OPTIONAL_LOCKS_ENVIRONMENT, 1);\n}\n\nint print_sha1_ellipsis(void)\n{\n\t/*\n\t * Determine if the calling environment contains the variable\n\t * GIT_PRINT_SHA1_ELLIPSIS set to \"yes\".\n\t */\n\tstatic int cached_result = -1; /* unknown */\n\n\tif (cached_result < 0) {\n\t\tconst char *v = getenv(\"GIT_PRINT_SHA1_ELLIPSIS\");\n\t\tcached_result = (v && !strcasecmp(v, \"yes\"));\n\t}\n\treturn cached_result;\n}\n\nstatic const struct fsync_component_name {\n\tconst char *name;\n\tenum fsync_component component_bits;\n} fsync_component_names[] = {\n\t{ \"loose-object\", FSYNC_COMPONENT_LOOSE_OBJECT },\n\t{ \"pack\", FSYNC_COMPONENT_PACK },\n\t{ \"pack-metadata\", FSYNC_COMPONENT_PACK_METADATA },\n\t{ \"commit-graph\", FSYNC_COMPONENT_COMMIT_GRAPH },\n\t{ \"index\", FSYNC_COMPONENT_INDEX },\n\t{ \"objects\", FSYNC_COMPONENTS_OBJECTS },\n\t{ \"reference\", FSYNC_COMPONENT_REFERENCE },\n\t{ \"derived-metadata\", FSYNC_COMPONENTS_DERIVED_METADATA },\n\t{ \"committed\", FSYNC_COMPONENTS_COMMITTED },\n\t{ \"added\", FSYNC_COMPONENTS_ADDED },\n\t{ \"all\", FSYNC_COMPONENTS_ALL },\n};\n\nstatic enum fsync_component parse_fsync_components(const char *var, const char *string)\n{\n\tenum fsync_component current = FSYNC_COMPONENTS_PLATFORM_DEFAULT;\n\tenum fsync_component positive = 0, negative = 0;\n\n\twhile (string) {\n\t\tsize_t len;\n\t\tconst char *ep;\n\t\tint negated = 0;\n\t\tint found = 0;\n\n\t\tstring = string + strspn(string, \", \\t\\n\\r\");\n\t\tep = strchrnul(string, ',');\n\t\tlen = ep - string;\n\t\tif (!strcmp(string, \"none\")) {\n\t\t\tcurrent = FSYNC_COMPONENT_NONE;\n\t\t\tgoto next_name;\n\t\t}\n\n\t\tif (*string == '-') {\n\t\t\tnegated = 1;\n\t\t\tstring++;\n\t\t\tlen--;\n\t\t\tif (!len)\n\t\t\t\twarning(_(\"invalid value for variable %s\"), var);\n\t\t}\n\n\t\tif (!len)\n\t\t\tbreak;\n\n\t\tfor (size_t i = 0; i < ARRAY_SIZE(fsync_component_names); ++i) {\n\t\t\tconst struct fsync_component_name *n = &fsync_component_names[i];\n\n\t\t\tif (strncmp(n->name, string, len))\n\t\t\t\tcontinue;\n\n\t\t\tfound = 1;\n\t\t\tif (negated)\n\t\t\t\tnegative |= n->component_bits;\n\t\t\telse\n\t\t\t\tpositive |= n->component_bits;\n\t\t}\n\n\t\tif (!found) {\n\t\t\tchar *component = xstrndup(string, len);\n\t\t\twarning(_(\"ignoring unknown core.fsync component '%s'\"), component);\n\t\t\tfree(component);\n\t\t}\n\nnext_name:\n\t\tstring = ep;\n\t}\n\n\treturn (current & ~negative) | positive;\n}\n\nint git_default_core_config(const char *var, const char *value,\n\t\t\t    const struct config_context *ctx, void *cb)\n{\n\t/* This needs a better name */\n\tif (!strcmp(var, \"core.filemode\")) {\n\t\ttrust_executable_bit = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\tif (!strcmp(var, \"core.trustctime\")) {\n\t\ttrust_ctime = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\tif (!strcmp(var, \"core.checkstat\")) {\n\t\tif (!value)\n\t\t\treturn config_error_nonbool(var);\n\t\tif (!strcasecmp(value, \"default\"))\n\t\t\tcheck_stat = 1;\n\t\telse if (!strcasecmp(value, \"minimal\"))\n\t\t\tcheck_stat = 0;\n\t\telse\n\t\t\treturn error(_(\"invalid value for '%s': '%s'\"),\n\t\t\t\t     var, value);\n\t}\n\n\tif (!strcmp(var, \"core.quotepath\")) {\n\t\tquote_path_fully = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.symlinks\")) {\n\t\thas_symlinks = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.ignorecase\")) {\n\t\tignore_case = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.attributesfile\")) {\n\t\tFREE_AND_NULL(git_attributes_file);\n\t\treturn git_config_pathname(&git_attributes_file, var, value);\n\t}\n\n\tif (!strcmp(var, \"core.bare\")) {\n\t\tis_bare_repository_cfg = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.ignorestat\")) {\n\t\tassume_unchanged = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.abbrev\")) {\n\t\tif (!value)\n\t\t\treturn config_error_nonbool(var);\n\t\tif (!strcasecmp(value, \"auto\"))\n\t\t\tdefault_abbrev = -1;\n\t\telse if (!git_parse_maybe_bool_text(value))\n\t\t\tdefault_abbrev = GIT_MAX_HEXSZ;\n\t\telse {\n\t\t\tint abbrev = git_config_int(var, value, ctx->kvi);\n\t\t\tif (abbrev < minimum_abbrev)\n\t\t\t\treturn error(_(\"abbrev length out of range: %d\"), abbrev);\n\t\t\tdefault_abbrev = abbrev;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.disambiguate\"))\n\t\treturn set_disambiguate_hint_config(var, value);\n\n\tif (!strcmp(var, \"core.loosecompression\")) {\n\t\tint level = git_config_int(var, value, ctx->kvi);\n\t\tif (level == -1)\n\t\t\tlevel = Z_DEFAULT_COMPRESSION;\n\t\telse if (level < 0 || level > Z_BEST_COMPRESSION)\n\t\t\tdie(_(\"bad zlib compression level %d\"), level);\n\t\tzlib_compression_level = level;\n\t\tzlib_compression_seen = 1;\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.compression\")) {\n\t\tint level = git_config_int(var, value, ctx->kvi);\n\t\tif (level == -1)\n\t\t\tlevel = Z_DEFAULT_COMPRESSION;\n\t\telse if (level < 0 || level > Z_BEST_COMPRESSION)\n\t\t\tdie(_(\"bad zlib compression level %d\"), level);\n\t\tif (!zlib_compression_seen)\n\t\t\tzlib_compression_level = level;\n\t\tif (!pack_compression_seen)\n\t\t\tpack_compression_level = level;\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.autocrlf\")) {\n\t\tif (value && !strcasecmp(value, \"input\")) {\n\t\t\tauto_crlf = AUTO_CRLF_INPUT;\n\t\t\treturn 0;\n\t\t}\n\t\tauto_crlf = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.safecrlf\")) {\n\t\tint eol_rndtrp_die;\n\t\tif (value && !strcasecmp(value, \"warn\")) {\n\t\t\tglobal_conv_flags_eol = CONV_EOL_RNDTRP_WARN;\n\t\t\treturn 0;\n\t\t}\n\t\teol_rndtrp_die = git_config_bool(var, value);\n\t\tglobal_conv_flags_eol = eol_rndtrp_die ?\n\t\t\tCONV_EOL_RNDTRP_DIE : 0;\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.eol\")) {\n\t\tif (value && !strcasecmp(value, \"lf\"))\n\t\t\tcore_eol = EOL_LF;\n\t\telse if (value && !strcasecmp(value, \"crlf\"))\n\t\t\tcore_eol = EOL_CRLF;\n\t\telse if (value && !strcasecmp(value, \"native\"))\n\t\t\tcore_eol = EOL_NATIVE;\n\t\telse\n\t\t\tcore_eol = EOL_UNSET;\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.checkroundtripencoding\")) {\n\t\tFREE_AND_NULL(check_roundtrip_encoding);\n\t\treturn git_config_string(&check_roundtrip_encoding, var, value);\n\t}\n\n\tif (!strcmp(var, \"core.editor\")) {\n\t\tFREE_AND_NULL(editor_program);\n\t\treturn git_config_string(&editor_program, var, value);\n\t}\n\n\tif (!strcmp(var, \"core.commentchar\") ||\n\t    !strcmp(var, \"core.commentstring\")) {\n\t\tif (!value) {\n\t\t\treturn config_error_nonbool(var);\n#ifndef WITH_BREAKING_CHANGES\n\t\t} else if (!strcasecmp(value, \"auto\")) {\n\t\t\tauto_comment_line_char = 1;\n\t\t\tFREE_AND_NULL(comment_line_str_to_free);\n\t\t\tcomment_line_str = \"#\";\n#endif /* !WITH_BREAKING_CHANGES */\n\t\t} else if (value[0]) {\n\t\t\tif (strchr(value, '\\n'))\n\t\t\t\treturn error(_(\"%s cannot contain newline\"), var);\n\t\t\tcomment_line_str = value;\n\t\t\tFREE_AND_NULL(comment_line_str_to_free);\n#ifndef WITH_BREAKING_CHANGES\n\t\t\tauto_comment_line_char = 0;\n#endif /* !WITH_BREAKING_CHANGES */\n\t\t} else\n\t\t\treturn error(_(\"%s must have at least one character\"), var);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.askpass\")) {\n\t\tFREE_AND_NULL(askpass_program);\n\t\treturn git_config_string(&askpass_program, var, value);\n\t}\n\n\tif (!strcmp(var, \"core.excludesfile\")) {\n\t\tFREE_AND_NULL(excludes_file);\n\t\treturn git_config_pathname(&excludes_file, var, value);\n\t}\n\n\tif (!strcmp(var, \"core.whitespace\")) {\n\t\tif (!value)\n\t\t\treturn config_error_nonbool(var);\n\t\twhitespace_rule_cfg = parse_whitespace_rule(value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.fsync\")) {\n\t\tif (!value)\n\t\t\treturn config_error_nonbool(var);\n\t\tfsync_components = parse_fsync_components(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.fsyncmethod\")) {\n\t\tif (!value)\n\t\t\treturn config_error_nonbool(var);\n\t\tif (!strcmp(value, \"fsync\"))\n\t\t\tfsync_method = FSYNC_METHOD_FSYNC;\n\t\telse if (!strcmp(value, \"writeout-only\"))\n\t\t\tfsync_method = FSYNC_METHOD_WRITEOUT_ONLY;\n\t\telse if (!strcmp(value, \"batch\"))\n\t\t\tfsync_method = FSYNC_METHOD_BATCH;\n\t\telse\n\t\t\twarning(_(\"ignoring unknown core.fsyncMethod value '%s'\"), value);\n\n\t}\n\n\tif (!strcmp(var, \"core.fsyncobjectfiles\")) {\n\t\tif (fsync_object_files < 0)\n\t\t\twarning(_(\"core.fsyncObjectFiles is deprecated; use core.fsync instead\"));\n\t\tfsync_object_files = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.lockfilepid\")) {\n\t\tlockfile_pid_enabled = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.createobject\")) {\n\t\tif (!value)\n\t\t\treturn config_error_nonbool(var);\n\t\tif (!strcmp(value, \"rename\"))\n\t\t\tobject_creation_mode = OBJECT_CREATION_USES_RENAMES;\n\t\telse if (!strcmp(value, \"link\"))\n\t\t\tobject_creation_mode = OBJECT_CREATION_USES_HARDLINKS;\n\t\telse\n\t\t\tdie(_(\"invalid mode for object creation: %s\"), value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.sparsecheckout\")) {\n\t\tcore_apply_sparse_checkout = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.sparsecheckoutcone\")) {\n\t\tcore_sparse_checkout_cone = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.precomposeunicode\")) {\n\t\tprecomposed_unicode = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.protecthfs\")) {\n\t\tprotect_hfs = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"core.protectntfs\")) {\n\t\tprotect_ntfs = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\t/* Add other config variables here and to Documentation/config.adoc. */\n\treturn platform_core_config(var, value, ctx, cb);\n}\n\nstatic int git_default_sparse_config(const char *var, const char *value)\n{\n\tif (!strcmp(var, \"sparse.expectfilesoutsideofpatterns\")) {\n\t\tsparse_expect_files_outside_of_patterns = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\n\t/* Add other config variables here and to Documentation/config/sparse.adoc. */\n\treturn 0;\n}\n\nstatic int git_default_i18n_config(const char *var, const char *value)\n{\n\tif (!strcmp(var, \"i18n.commitencoding\")) {\n\t\tFREE_AND_NULL(git_commit_encoding);\n\t\treturn git_config_string(&git_commit_encoding, var, value);\n\t}\n\n\tif (!strcmp(var, \"i18n.logoutputencoding\")) {\n\t\tFREE_AND_NULL(git_log_output_encoding);\n\t\treturn git_config_string(&git_log_output_encoding, var, value);\n\t}\n\n\t/* Add other config variables here and to Documentation/config.adoc. */\n\treturn 0;\n}\n\nstatic int git_default_branch_config(const char *var, const char *value)\n{\n\tif (!strcmp(var, \"branch.autosetupmerge\")) {\n\t\tif (value && !strcmp(value, \"always\")) {\n\t\t\tgit_branch_track = BRANCH_TRACK_ALWAYS;\n\t\t\treturn 0;\n\t\t} else if (value && !strcmp(value, \"inherit\")) {\n\t\t\tgit_branch_track = BRANCH_TRACK_INHERIT;\n\t\t\treturn 0;\n\t\t} else if (value && !strcmp(value, \"simple\")) {\n\t\t\tgit_branch_track = BRANCH_TRACK_SIMPLE;\n\t\t\treturn 0;\n\t\t}\n\t\tgit_branch_track = git_config_bool(var, value);\n\t\treturn 0;\n\t}\n\tif (!strcmp(var, \"branch.autosetuprebase\")) {\n\t\tif (!value)\n\t\t\treturn config_error_nonbool(var);\n\t\telse if (!strcmp(value, \"never\"))\n\t\t\tautorebase = AUTOREBASE_NEVER;\n\t\telse if (!strcmp(value, \"local\"))\n\t\t\tautorebase = AUTOREBASE_LOCAL;\n\t\telse if (!strcmp(value, \"remote\"))\n\t\t\tautorebase = AUTOREBASE_REMOTE;\n\t\telse if (!strcmp(value, \"always\"))\n\t\t\tautorebase = AUTOREBASE_ALWAYS;\n\t\telse\n\t\t\treturn error(_(\"malformed value for %s\"), var);\n\t\treturn 0;\n\t}\n\n\t/* Add other config variables here and to Documentation/config.adoc. */\n\treturn 0;\n}\n\nstatic int git_default_push_config(const char *var, const char *value)\n{\n\tif (!strcmp(var, \"push.default\")) {\n\t\tif (!value)\n\t\t\treturn config_error_nonbool(var);\n\t\telse if (!strcmp(value, \"nothing\"))\n\t\t\tpush_default = PUSH_DEFAULT_NOTHING;\n\t\telse if (!strcmp(value, \"matching\"))\n\t\t\tpush_default = PUSH_DEFAULT_MATCHING;\n\t\telse if (!strcmp(value, \"simple\"))\n\t\t\tpush_default = PUSH_DEFAULT_SIMPLE;\n\t\telse if (!strcmp(value, \"upstream\"))\n\t\t\tpush_default = PUSH_DEFAULT_UPSTREAM;\n\t\telse if (!strcmp(value, \"tracking\")) /* deprecated */\n\t\t\tpush_default = PUSH_DEFAULT_UPSTREAM;\n\t\telse if (!strcmp(value, \"current\"))\n\t\t\tpush_default = PUSH_DEFAULT_CURRENT;\n\t\telse {\n\t\t\terror(_(\"malformed value for %s: %s\"), var, value);\n\t\t\treturn error(_(\"must be one of nothing, matching, simple, \"\n\t\t\t\t       \"upstream or current\"));\n\t\t}\n\t\treturn 0;\n\t}\n\n\t/* Add other config variables here and to Documentation/config.adoc. */\n\treturn 0;\n}\n\nstatic int git_default_mailmap_config(const char *var, const char *value)\n{\n\tif (!strcmp(var, \"mailmap.file\")) {\n\t\tFREE_AND_NULL(git_mailmap_file);\n\t\treturn git_config_pathname(&git_mailmap_file, var, value);\n\t}\n\n\tif (!strcmp(var, \"mailmap.blob\")) {\n\t\tFREE_AND_NULL(git_mailmap_blob);\n\t\treturn git_config_string(&git_mailmap_blob, var, value);\n\t}\n\n\t/* Add other config variables here and to Documentation/config.adoc. */\n\treturn 0;\n}\n\nstatic int git_default_attr_config(const char *var, const char *value)\n{\n\tif (!strcmp(var, \"attr.tree\")) {\n\t\tFREE_AND_NULL(git_attr_tree);\n\t\treturn git_config_string(&git_attr_tree, var, value);\n\t}\n\n\t/*\n\t * Add other attribute related config variables here and to\n\t * Documentation/config/attr.adoc.\n\t */\n\treturn 0;\n}\n\nint git_default_config(const char *var, const char *value,\n\t\t       const struct config_context *ctx, void *cb)\n{\n\tif (starts_with(var, \"core.\"))\n\t\treturn git_default_core_config(var, value, ctx, cb);\n\n\tif (starts_with(var, \"user.\") ||\n\t    starts_with(var, \"author.\") ||\n\t    starts_with(var, \"committer.\"))\n\t\treturn git_ident_config(var, value, ctx, cb);\n\n\tif (starts_with(var, \"i18n.\"))\n\t\treturn git_default_i18n_config(var, value);\n\n\tif (starts_with(var, \"branch.\"))\n\t\treturn git_default_branch_config(var, value);\n\n\tif (starts_with(var, \"push.\"))\n\t\treturn git_default_push_config(var, value);\n\n\tif (starts_with(var, \"mailmap.\"))\n\t\treturn git_default_mailmap_config(var, value);\n\n\tif (starts_with(var, \"attr.\"))\n\t\treturn git_default_attr_config(var, value);\n\n\tif (starts_with(var, \"advice.\") || starts_with(var, \"color.advice\"))\n\t\treturn git_default_advice_config(var, value);\n\n\tif (!strcmp(var, \"pager.color\") || !strcmp(var, \"color.pager\")) {\n\t\tpager_use_color = git_config_bool(var,value);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"pack.packsizelimit\")) {\n\t\tpack_size_limit_cfg = git_config_ulong(var, value, ctx->kvi);\n\t\treturn 0;\n\t}\n\n\tif (!strcmp(var, \"pack.compression\")) {\n\t\tint level = git_config_int(var, value, ctx->kvi);\n\t\tif (level == -1)\n\t\t\tlevel = Z_DEFAULT_COMPRESSION;\n\t\telse if (level < 0 || level > Z_BEST_COMPRESSION)\n\t\t\tdie(_(\"bad pack compression level %d\"), level);\n\t\tpack_compression_level = level;\n\t\tpack_compression_seen = 1;\n\t\treturn 0;\n\t}\n\n\tif (starts_with(var, \"sparse.\"))\n\t\treturn git_default_sparse_config(var, value);\n\n\t/* Add other config variables here and to Documentation/config.adoc. */\n\treturn 0;\n}\n",
    "type": "blob"
  },
  "kind": "blob",
  "oid": "0026eb227487dd3cc3290d13f61a9d977682bac8",
  "sha1_ok": true,
  "size": 19563
}
